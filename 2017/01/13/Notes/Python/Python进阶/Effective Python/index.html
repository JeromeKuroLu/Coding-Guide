<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Table of Contents  generated with DocToc

Effective Python
Pythonic
列表切割
列表推导式
迭代
反向迭代
try/except/else/finally


函数
使用装饰器
使用生成器
可迭代对象
使用位置参数
使用关键字参数
关于参数的默认值


类
__slots__
__call__
@classmethod &amp;amp">
<meta property="og:type" content="article">
<meta property="og:title" content="Effective Python">
<meta property="og:url" content="http://ecmadao.com/2017/01/13/Notes/Python/Python进阶/Effective Python/index.html">
<meta property="og:site_name" content="ecmadao">
<meta property="og:description" content="Table of Contents  generated with DocToc

Effective Python
Pythonic
列表切割
列表推导式
迭代
反向迭代
try/except/else/finally


函数
使用装饰器
使用生成器
可迭代对象
使用位置参数
使用关键字参数
关于参数的默认值


类
__slots__
__call__
@classmethod &amp;amp">
<meta property="og:updated_time" content="2017-01-14T12:11:43.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Effective Python">
<meta name="twitter:description" content="Table of Contents  generated with DocToc

Effective Python
Pythonic
列表切割
列表推导式
迭代
反向迭代
try/except/else/finally


函数
使用装饰器
使用生成器
可迭代对象
使用位置参数
使用关键字参数
关于参数的默认值


类
__slots__
__call__
@classmethod &amp;amp">
    
    
        
          
              <link rel="shortcut icon" href="/Coding-Guide/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/Coding-Guide/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/Coding-Guide/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Effective Python</title>
    <!-- styles -->
    <link rel="stylesheet" href="/Coding-Guide/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/Coding-Guide/lib/meslo-LG/styles.css">
    <link rel="stylesheet" href="/Coding-Guide/lib/justified-gallery/justifiedGallery.min.css">
    <link rel="stylesheet" href="/Coding-Guide/css/style.css">
    <!-- rss -->
    
    
    <!-- jquery -->
    <script src="/Coding-Guide/lib/jquery/jquery.min.js"></script>
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/Coding-Guide/">Home</a></li>
         
          <li><a href="/Coding-Guide/about/">About</a></li>
         
          <li><a href="/Coding-Guide/archives/">Articles</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/Coding-Guide/2017/01/13/Notes/NodeJS/Node基础/Node.js初步-模块化/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Python Design Pattern/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&text=Effective Python"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&title=Effective Python"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&is_video=false&description=Effective Python"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Effective Python&body=Check out this article: http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&title=Effective Python"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&title=Effective Python"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&title=Effective Python"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&title=Effective Python"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&name=Effective Python&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Effective-Python"><span class="toc-number">1.</span> <span class="toc-text">Effective Python</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pythonic"><span class="toc-number">1.1.</span> <span class="toc-text">Pythonic</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#列表切割"><span class="toc-number">1.1.1.</span> <span class="toc-text">列表切割</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#列表推导式"><span class="toc-number">1.1.2.</span> <span class="toc-text">列表推导式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#迭代"><span class="toc-number">1.1.3.</span> <span class="toc-text">迭代</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#反向迭代"><span class="toc-number">1.1.4.</span> <span class="toc-text">反向迭代</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#try-except-else-finally"><span class="toc-number">1.1.5.</span> <span class="toc-text">try/except/else/finally</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数"><span class="toc-number">1.2.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用装饰器"><span class="toc-number">1.2.1.</span> <span class="toc-text">使用装饰器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用生成器"><span class="toc-number">1.2.2.</span> <span class="toc-text">使用生成器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#可迭代对象"><span class="toc-number">1.2.3.</span> <span class="toc-text">可迭代对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用位置参数"><span class="toc-number">1.2.4.</span> <span class="toc-text">使用位置参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用关键字参数"><span class="toc-number">1.2.5.</span> <span class="toc-text">使用关键字参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#关于参数的默认值"><span class="toc-number">1.2.6.</span> <span class="toc-text">关于参数的默认值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类"><span class="toc-number">1.3.</span> <span class="toc-text">类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#slots"><span class="toc-number">1.3.1.</span> <span class="toc-text">__slots__</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#call"><span class="toc-number">1.3.2.</span> <span class="toc-text">__call__</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#classmethod-amp-staticmethod"><span class="toc-number">1.3.3.</span> <span class="toc-text">@classmethod & @staticmethod</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建上下文管理器"><span class="toc-number">1.3.4.</span> <span class="toc-text">创建上下文管理器</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Effective Python
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">ecmadao</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-01-13T05:58:37.000Z" itemprop="datePublished">2017-01-13</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/Coding-Guide/tags/Python/">Python</a>, <a class="tag-link" href="/Coding-Guide/tags/Python进阶/">Python进阶</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#effective-python">Effective Python</a><ul>
<li><a href="#pythonic">Pythonic</a><ul>
<li><a href="#%E5%88%97%E8%A1%A8%E5%88%87%E5%89%B2">列表切割</a></li>
<li><a href="#%E5%88%97%E8%A1%A8%E6%8E%A8%E5%AF%BC%E5%BC%8F">列表推导式</a></li>
<li><a href="#%E8%BF%AD%E4%BB%A3">迭代</a></li>
<li><a href="#%E5%8F%8D%E5%90%91%E8%BF%AD%E4%BB%A3">反向迭代</a></li>
<li><a href="#tryexceptelsefinally"><code>try/except/else/finally</code></a></li>
</ul>
</li>
<li><a href="#%E5%87%BD%E6%95%B0">函数</a><ul>
<li><a href="#%E4%BD%BF%E7%94%A8%E8%A3%85%E9%A5%B0%E5%99%A8">使用装饰器</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E7%94%9F%E6%88%90%E5%99%A8">使用生成器</a></li>
<li><a href="#%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1">可迭代对象</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E4%BD%8D%E7%BD%AE%E5%8F%82%E6%95%B0">使用位置参数</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%82%E6%95%B0">使用关键字参数</a></li>
<li><a href="#%E5%85%B3%E4%BA%8E%E5%8F%82%E6%95%B0%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC">关于参数的默认值</a></li>
</ul>
</li>
<li><a href="#%E7%B1%BB">类</a><ul>
<li><a href="#__slots__"><code>__slots__</code></a></li>
<li><a href="#__call__"><code>__call__</code></a></li>
<li><a href="#classmethod-&amp;-staticmethod"><code>@classmethod</code> &amp; <code>@staticmethod</code></a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8">创建上下文管理器</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="Effective-Python"><a href="#Effective-Python" class="headerlink" title="Effective Python"></a>Effective Python</h2><blockquote>
<p>部分提炼自书籍：《Effective Python》&amp;《Python3 Cookbook》，但也做出了修改，并加上了我自己的理解和运用中的最佳实践</p>
</blockquote>
<h3 id="Pythonic"><a href="#Pythonic" class="headerlink" title="Pythonic"></a>Pythonic</h3><h4 id="列表切割"><a href="#列表切割" class="headerlink" title="列表切割"></a>列表切割</h4><blockquote>
<p><code>list[start:end:step]</code></p>
</blockquote>
<ul>
<li>如果从列表开头开始切割，那么忽略 start 位的 0，例如<code>list[:4]</code></li>
<li>如果一直切到列表尾部，则忽略 end 位的 0，例如<code>list[3:]</code></li>
<li>切割列表时，即便 start 或者 end 索引跨界也不会有问题</li>
<li>列表切片不会改变原列表。索引都留空时，会生成一份原列表的拷贝</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">b = a[:]</div><div class="line"><span class="keyword">assert</span> b == a <span class="keyword">and</span> b <span class="keyword">is</span> <span class="keyword">not</span> a <span class="comment"># true</span></div></pre></td></tr></table></figure>
<h4 id="列表推导式"><a href="#列表推导式" class="headerlink" title="列表推导式"></a>列表推导式</h4><ul>
<li>使用列表推导式来取代<code>map</code>和<code>filter</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</div><div class="line"><span class="comment"># use map</span></div><div class="line">squares = map(<span class="keyword">lambda</span> x: x ** <span class="number">2</span>, a)</div><div class="line"><span class="comment"># use list comprehension</span></div><div class="line">squares = [x ** <span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> a]</div><div class="line"><span class="comment"># 一个很大的好处是，列表推导式可以对值进行判断，比如</span></div><div class="line">squares = [x ** <span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> a <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>]</div><div class="line"><span class="comment"># 而如果这种情况要用 map 或者 filter 方法实现的话，则要多写一些函数</span></div></pre></td></tr></table></figure>
<ul>
<li>不要使用含有两个以上表达式的列表推导式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 有一个嵌套的列表，现在要把它里面的所有元素扁平化输出</span></div><div class="line">list = [[</div><div class="line">  [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</div><div class="line">  [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</div><div class="line">]]</div><div class="line"><span class="comment"># 使用列表推导式</span></div><div class="line">flat_list = [x <span class="keyword">for</span> list0 <span class="keyword">in</span> list <span class="keyword">for</span> list1 <span class="keyword">in</span> list0 <span class="keyword">for</span> x <span class="keyword">in</span> list1]</div><div class="line"><span class="comment"># [1, 2, 3, 4, 5, 6]</span></div><div class="line"></div><div class="line"><span class="comment"># 可读性太差，易出错。这种时候更建议使用普通的循环</span></div><div class="line">flat_list = []</div><div class="line"><span class="keyword">for</span> list0 <span class="keyword">in</span> list:</div><div class="line">	<span class="keyword">for</span> list1 <span class="keyword">in</span> list0:</div><div class="line">		flat_list.extend(list1)</div></pre></td></tr></table></figure>
<ul>
<li>数据多时，列表推导式可能会消耗大量内存，此时建议使用生成器表达式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 在列表推导式的推导过程中，对于输入序列的每个值来说，都可能要创建仅含一项元素的全新列表。因此数据量大时很耗性能。</span></div><div class="line"><span class="comment"># 使用生成器表达式</span></div><div class="line">list = (x ** <span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">1000000000</span>))</div><div class="line"><span class="comment"># 生成器表达式返回的迭代器，只有在每次调用时才生成值，从而避免了内存占用</span></div></pre></td></tr></table></figure>
<h4 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h4><ul>
<li>需要获取 index 时使用<code>enumerate</code></li>
<li><code>enumerate</code>可以接受第二个参数，作为迭代时加在<code>index</code>上的数值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">list = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>]</div><div class="line"></div><div class="line"><span class="keyword">for</span> index, value <span class="keyword">in</span> enumerate(list):</div><div class="line">	print(index)</div><div class="line"><span class="comment"># 0</span></div><div class="line"><span class="comment"># 1</span></div><div class="line"><span class="comment"># 2</span></div><div class="line"><span class="comment"># 3</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> index, value <span class="keyword">in</span> enumerate(list, <span class="number">2</span>):</div><div class="line">	print(index)</div><div class="line"><span class="comment"># 2</span></div><div class="line"><span class="comment"># 3</span></div><div class="line"><span class="comment"># 4</span></div><div class="line"><span class="comment"># 5</span></div></pre></td></tr></table></figure>
<ul>
<li>用<code>zip</code>同时遍历两个迭代器</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">list_a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>]</div><div class="line">list_b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line"><span class="comment"># 虽然列表长度不一样，但只要有一个列表耗尽，则迭代就会停止</span></div><div class="line"><span class="keyword">for</span> letter, number <span class="keyword">in</span> zip(list_a, list_b):</div><div class="line">	print(letter, number)</div><div class="line"><span class="comment"># a 1</span></div><div class="line"><span class="comment"># b 2</span></div><div class="line"><span class="comment"># c 3</span></div></pre></td></tr></table></figure>
<ul>
<li><code>zip</code>遍历时返回一个元组</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line">b = [<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>]</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> zip(a,b):</div><div class="line">	print(i)</div><div class="line"></div><div class="line"><span class="comment"># (1, 'w')</span></div><div class="line"><span class="comment"># (2, 'x')</span></div><div class="line"><span class="comment"># (3, 'y')</span></div></pre></td></tr></table></figure>
<ul>
<li>关于<code>for</code>和<code>while</code>循环后的<code>else</code>块<ul>
<li>循环<strong>正常结束</strong>之后会调用<code>else</code>内的代码</li>
<li>循环里通过<code>break</code>跳出循环，则不会执行<code>else</code></li>
<li>要遍历的序列为空时，立即执行<code>else</code></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</div><div class="line">	print(i)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">	print(<span class="string">'loop finish'</span>)</div><div class="line"><span class="comment"># 0</span></div><div class="line"><span class="comment"># 1</span></div><div class="line"><span class="comment"># loop finish</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</div><div class="line">	print(i)</div><div class="line">	<span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>:</div><div class="line">		<span class="keyword">break</span></div><div class="line"><span class="keyword">else</span>:</div><div class="line">	print(<span class="string">'loop finish'</span>)</div><div class="line"><span class="comment"># 0</span></div></pre></td></tr></table></figure>
<h4 id="反向迭代"><a href="#反向迭代" class="headerlink" title="反向迭代"></a>反向迭代</h4><p>对于普通的序列（列表），我们可以通过内置的<code>reversed()</code>函数进行反向迭代：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">list_example = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)]</div><div class="line">iter_example = (i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)) <span class="comment"># 迭代器</span></div><div class="line">set_example = &#123;i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)&#125; <span class="comment"># 集合</span></div><div class="line"></div><div class="line"><span class="comment"># 普通的正向迭代</span></div><div class="line"><span class="comment"># for i in list_example</span></div><div class="line"></div><div class="line"><span class="comment"># 通过 reversed 进行反向迭代</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> reversed(list_example):</div><div class="line">	print(i)</div><div class="line"><span class="comment"># 4</span></div><div class="line"><span class="comment"># 3</span></div><div class="line"><span class="comment"># 2</span></div><div class="line"><span class="comment"># 1</span></div><div class="line"><span class="comment"># 0</span></div><div class="line"></div><div class="line"><span class="comment"># 但无法作用于 集合 和 迭代器</span></div><div class="line">reversed(iter_example) <span class="comment"># TypeError: argument to reversed() must be a sequence</span></div></pre></td></tr></table></figure>
<p>除此以外，还可以通过实现类里的<code>__reversed__</code>方法，将类进行反向迭代：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Countdown</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, start)</span>:</span></div><div class="line">        self.start = start</div><div class="line"></div><div class="line">    <span class="comment"># 正向迭代</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></div><div class="line">        n = self.start</div><div class="line">        <span class="keyword">while</span> n &gt; <span class="number">0</span>:</div><div class="line">            <span class="keyword">yield</span> n</div><div class="line">            n -= <span class="number">1</span></div><div class="line"></div><div class="line">    <span class="comment"># 反向迭代</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reversed__</span><span class="params">(self)</span>:</span></div><div class="line">        n = <span class="number">1</span></div><div class="line">        <span class="keyword">while</span> n &lt;= self.start:</div><div class="line">            <span class="keyword">yield</span> n</div><div class="line">            n += <span class="number">1</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> reversed(Countdown(<span class="number">4</span>)):</div><div class="line">    print(i)</div><div class="line"><span class="comment"># 1</span></div><div class="line"><span class="comment"># 2</span></div><div class="line"><span class="comment"># 3</span></div><div class="line"><span class="comment"># 4</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> Countdown(<span class="number">4</span>):</div><div class="line">    print(i)</div><div class="line"><span class="comment"># 4</span></div><div class="line"><span class="comment"># 3</span></div><div class="line"><span class="comment"># 2</span></div><div class="line"><span class="comment"># 1</span></div></pre></td></tr></table></figure>
<h4 id="try-except-else-finally"><a href="#try-except-else-finally" class="headerlink" title="try/except/else/finally"></a><code>try/except/else/finally</code></h4><ul>
<li>如果<code>try</code>内没有发生异常，则调用<code>else</code>内的代码</li>
<li><code>else</code>会在<code>finally</code>之前运行</li>
<li>最终一定会执行<code>finally</code>，可以在其中进行清理工作</li>
</ul>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="使用装饰器"><a href="#使用装饰器" class="headerlink" title="使用装饰器"></a>使用装饰器</h4><p>装饰器用于在不改变原函数代码的情况下修改已存在的函数。常见场景是增加一句调试，或者为已有的函数增加<code>log</code>监控</p>
<p>举个栗子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator_fun</span><span class="params">(fun)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">new_fun</span><span class="params">(*args, **kwargs)</span>:</span></div><div class="line">		print(<span class="string">'current fun:'</span>, fun.__name__)</div><div class="line">		print(<span class="string">'position arguments:'</span>, args)</div><div class="line">		print(<span class="string">'key arguments:'</span>, **kwargs)</div><div class="line">		result = fun(*args, **kwargs)</div><div class="line">		print(result)</div><div class="line">		<span class="keyword">return</span> result</div><div class="line">	<span class="keyword">return</span> new_fun</div><div class="line">	</div><div class="line"><span class="meta">@decorator_fun</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></div><div class="line">	<span class="keyword">return</span> a + b</div><div class="line"></div><div class="line">add(<span class="number">3</span>, <span class="number">2</span>)</div><div class="line"><span class="comment"># current fun: add</span></div><div class="line"><span class="comment"># position arguments: (3, 2)</span></div><div class="line"><span class="comment"># key arguments: &#123;&#125;</span></div><div class="line"><span class="comment"># 5</span></div></pre></td></tr></table></figure>
<p>除此以外，还可以编写接收参数的装饰器，其实就是在原本的装饰器上的外层又嵌套了一个函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span><span class="params">(filename=<span class="string">'results.txt'</span>)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">decorator_fun</span><span class="params">(fun)</span>:</span></div><div class="line">		<span class="function"><span class="keyword">def</span> <span class="title">new_fun</span><span class="params">(*args, **kwargs)</span>:</span></div><div class="line">			result = fun(*args, **kwargs)</div><div class="line">			<span class="keyword">with</span> open(filename, <span class="string">'a'</span>) <span class="keyword">as</span> f:</div><div class="line">                f.write(result + <span class="string">'\n'</span>)</div><div class="line">			<span class="keyword">return</span> result</div><div class="line">		<span class="keyword">return</span> new_fun</div><div class="line">	<span class="keyword">return</span> decorator_fun</div><div class="line"></div><div class="line"><span class="comment"># 使用装饰器时代入参数</span></div><div class="line"><span class="meta">@read_file(filename='log.txt')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></div><div class="line">	<span class="keyword">return</span> a + b</div></pre></td></tr></table></figure>
<p>但是像上面那样使用装饰器的话有一个问题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@decorator_fun</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></div><div class="line">	<span class="keyword">return</span> a + b</div><div class="line"></div><div class="line">print(add.__name__)</div><div class="line"><span class="comment"># new_fun</span></div></pre></td></tr></table></figure>
<p>也就是说原函数已经被装饰器里的<code>new_fun</code>函数替代掉了。调用经过装饰的函数，相当于调用一个新函数。查看原函数的参数、注释、甚至函数名的时候，只能看到装饰器的相关信息。为了解决这个问题，我们可以使用 Python 自带的<code>functools.wraps</code>方法。</p>
<blockquote>
<p><a href="http://stackoverflow.com/questions/308999/what-does-functools-wraps-do" target="_blank" rel="external">stackoverflow: What does functools.wraps do?</a></p>
</blockquote>
<p><code>functools.wraps</code>是个很 hack 的方法，它本事作为一个装饰器，做用在装饰器内部将要返回的函数上。也就是说，它是装饰器的装饰器，并且以原函数为参数，作用是保留原函数的各种信息，使得我们之后查看被装饰了的原函数的信息时，可以保持跟原函数一模一样。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator_fun</span><span class="params">(fun)</span>:</span></div><div class="line"><span class="meta">	@wraps(fun)</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">new_fun</span><span class="params">(*args, **kwargs)</span>:</span></div><div class="line">		result = fun(*args, **kwargs)</div><div class="line">		print(result)</div><div class="line">		<span class="keyword">return</span> result</div><div class="line">	<span class="keyword">return</span> new_fun</div><div class="line">	</div><div class="line"><span class="meta">@decorator_fun</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></div><div class="line">	<span class="keyword">return</span> a + b</div><div class="line"></div><div class="line">print(add.__name__)</div><div class="line"><span class="comment"># add</span></div></pre></td></tr></table></figure>
<p>此外，有时候我们的装饰器里可能会干不止一个事情，此时应该把事件作为额外的函数分离出去。但是又因为它可能仅仅和该装饰器有关，所以此时可以构造一个装饰器类。原理很简单，主要就是编写类里的<code>__call__</code>方法，使类能够像函数一样的调用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">logResult</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, filename=<span class="string">'results.txt'</span>)</span>:</span></div><div class="line">		self.filename = filename</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, fun)</span>:</span></div><div class="line"><span class="meta">		@wraps(fun)</span></div><div class="line">		<span class="function"><span class="keyword">def</span> <span class="title">new_fun</span><span class="params">(*args, **kwargs)</span>:</span></div><div class="line">			result = fun(*args, **kwargs)</div><div class="line">			<span class="keyword">with</span> open(filename, <span class="string">'a'</span>) <span class="keyword">as</span> f:</div><div class="line">                f.write(result + <span class="string">'\n'</span>)</div><div class="line">			<span class="keyword">return</span> result</div><div class="line">		self.send_notification()</div><div class="line">		<span class="keyword">return</span> new_fun</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">send_notification</span><span class="params">(self)</span>:</span></div><div class="line">		<span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="meta">@logResult('log.txt')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></div><div class="line">	<span class="keyword">return</span> a + b</div></pre></td></tr></table></figure>
<h4 id="使用生成器"><a href="#使用生成器" class="headerlink" title="使用生成器"></a>使用生成器</h4><blockquote>
<p>考虑使用生成器来改写直接返回列表的函数</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 定义一个函数，其作用是检测字符串里所有 a 的索引位置，最终返回所有 index 组成的数组</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_a_indexs</span><span class="params">(string)</span>:</span></div><div class="line">	result = []</div><div class="line">	<span class="keyword">for</span> index, letter <span class="keyword">in</span> enumerate(string):</div><div class="line">		<span class="keyword">if</span> letter == <span class="string">'a'</span>:</div><div class="line">			result.append(index)</div><div class="line">	<span class="keyword">return</span> result</div></pre></td></tr></table></figure>
<p>用这种方法有几个小问题：</p>
<ul>
<li>每次获取到符合条件的结果，都要调用<code>append</code>方法。但实际上我们的关注点根本不在这个方法，它只是我们达成目的的手段，实际上只需要<code>index</code>就好了</li>
<li>返回的<code>result</code>可以继续优化</li>
<li>数据都存在<code>result</code>里面，如果数据量很大的话，会比较占用内存</li>
</ul>
<p>因此，使用生成器<code>generator</code>会更好。生成器是使用<code>yield</code>表达式的函数，调用生成器时，它不会真的执行，而是返回一个迭代器，每次在迭代器上调用内置的<code>next</code>函数时，迭代器会把生成器推进到下一个<code>yield</code>表达式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_a_indexs</span><span class="params">(string)</span>:</span></div><div class="line">	<span class="keyword">for</span> index, letter <span class="keyword">in</span> enumerate(string):</div><div class="line">		<span class="keyword">if</span> letter == <span class="string">'a'</span>:</div><div class="line">			<span class="keyword">yield</span> index</div></pre></td></tr></table></figure>
<p>获取到一个生成器以后，可以正常的遍历它：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">string = <span class="string">'this is a test to find a\' index'</span></div><div class="line">indexs = get_a_indexs(string)</div><div class="line"></div><div class="line"><span class="comment"># 可以这样遍历</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> indexs:</div><div class="line">	print(i)</div><div class="line"></div><div class="line"><span class="comment"># 或者这样</span></div><div class="line"><span class="keyword">try</span>:</div><div class="line">	<span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">		print(next(indexs))</div><div class="line"><span class="keyword">except</span> StopIteration:</div><div class="line">	print(<span class="string">'finish!'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 生成器在获取完之后如果继续通过 next() 取值，则会触发 StopIteration 错误</span></div><div class="line"><span class="comment"># 但通过 for 循环遍历时会自动捕获到这个错误</span></div></pre></td></tr></table></figure>
<p>如果你还是需要一个列表，那么可以将函数的调用结果作为参数，再调用<code>list</code>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">results = get_a_indexs(<span class="string">'this is a test to check a'</span>)</div><div class="line">results_list = list(results)</div></pre></td></tr></table></figure>
<h4 id="可迭代对象"><a href="#可迭代对象" class="headerlink" title="可迭代对象"></a>可迭代对象</h4><p>需要注意的是，普通的迭代器只能迭代一轮，一轮之后重复调用是无效的。解决这种问题的方法是，你可以<strong>定义一个可迭代的容器类</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoopIter</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data)</span>:</span></div><div class="line">		self.data = data</div><div class="line">	<span class="comment"># 必须在 __iter__ 中 yield 结果</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></div><div class="line">		<span class="keyword">for</span> index, letter <span class="keyword">in</span> enumerate(self.data):</div><div class="line">			<span class="keyword">if</span> letter == <span class="string">'a'</span>:</div><div class="line">				<span class="keyword">yield</span> index</div></pre></td></tr></table></figure>
<p>这样的话，将类的实例迭代重复多少次都没问题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">string = <span class="string">'this is a test to find a\' index'</span></div><div class="line">indexs = LoopIter(string)</div><div class="line"></div><div class="line">print(<span class="string">'loop 1'</span>)</div><div class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> indexs:</div><div class="line">	print(_)</div><div class="line"><span class="comment"># loop 1</span></div><div class="line"><span class="comment"># 8</span></div><div class="line"><span class="comment"># 23</span></div><div class="line"></div><div class="line">print(<span class="string">'loop 2'</span>)</div><div class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> indexs:</div><div class="line">	print(_)</div><div class="line"><span class="comment"># loop 2</span></div><div class="line"><span class="comment"># 8</span></div><div class="line"><span class="comment"># 23</span></div></pre></td></tr></table></figure>
<p>但要注意的是，仅仅是实现<code>__iter__</code>方法的迭代器，只能通过<code>for</code>循环来迭代；想要通过<code>next</code>方法迭代的话则需要使用<code>iter</code>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">string = <span class="string">'this is a test to find a\' index'</span></div><div class="line">indexs = LoopIter(string)</div><div class="line"></div><div class="line">next(indexs) <span class="comment"># TypeError: 'LoopIter' object is not an iterator</span></div><div class="line"></div><div class="line">iter_indexs = iter(indexs)</div><div class="line">next(iter_indexs) <span class="comment"># 8</span></div></pre></td></tr></table></figure>
<h4 id="使用位置参数"><a href="#使用位置参数" class="headerlink" title="使用位置参数"></a>使用位置参数</h4><p>有时候，方法接收的参数数目可能不一定，比如定义一个求和的方法，至少要接收两个参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span><span class="params">(a, b)</span>:</span></div><div class="line">	<span class="keyword">return</span> a + b</div><div class="line"></div><div class="line"><span class="comment"># 正常使用</span></div><div class="line">sum(<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># 3</span></div><div class="line"><span class="comment"># 但如果我想求很多数的总和，而将参数全部代入是会报错的，而一次一次代入又太麻烦</span></div><div class="line">sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>) <span class="comment"># sum() takes 2 positional arguments but 5 were given</span></div></pre></td></tr></table></figure>
<p>对于这种接收参数数目不一定，而且不在乎参数传入顺序的函数，则应该利用位置参数<code>*args</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span><span class="params">(*args)</span>:</span></div><div class="line">	result = <span class="number">0</span></div><div class="line">	<span class="keyword">for</span> num <span class="keyword">in</span> args:</div><div class="line">		result += num</div><div class="line">	<span class="keyword">return</span> result</div><div class="line"></div><div class="line">sum(<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># 3</span></div><div class="line">sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>) <span class="comment"># 15</span></div><div class="line"><span class="comment"># 同时，也可以直接把一个数组带入，在带入时使用 * 进行解构</span></div><div class="line">sum(*[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]) <span class="comment"># 15</span></div></pre></td></tr></table></figure>
<p>但要注意的是，不定长度的参数<code>args</code>在传递给函数时，需要先转换成元组<code>tuple</code>。这意味着，如果你将一个生成器作为参数带入到函数中，生成器将会先遍历一遍，转换为元组。这可能会消耗大量内存：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_nums</span><span class="params">()</span>:</span></div><div class="line">	<span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">10</span>):</div><div class="line">		<span class="keyword">yield</span> num</div><div class="line"></div><div class="line">nums = get_nums()</div><div class="line">sum(*nums) <span class="comment"># 45</span></div><div class="line"><span class="comment"># 但在需要遍历的数目较多时，会占用大量内存</span></div></pre></td></tr></table></figure>
<h4 id="使用关键字参数"><a href="#使用关键字参数" class="headerlink" title="使用关键字参数"></a>使用关键字参数</h4><ul>
<li>关键字参数可提高代码可读性</li>
<li>可以通过关键字参数给函数提供默认值</li>
<li>便于扩充函数参数</li>
</ul>
<p><strong>定义只能使用关键字参数的函数</strong></p>
<ul>
<li>普通的方式，在调用时不会强制要求使用关键字参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 定义一个方法，它的作用是遍历一个数组，找出等于(或不等于)目标元素的 index</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_indexs</span><span class="params">(array, target=<span class="string">''</span>, judge=True)</span>:</span></div><div class="line">	<span class="keyword">for</span> index, item <span class="keyword">in</span> enumerate(array):</div><div class="line">		<span class="keyword">if</span> judge <span class="keyword">and</span> item == target:</div><div class="line">			<span class="keyword">yield</span> index</div><div class="line">		<span class="keyword">elif</span> <span class="keyword">not</span> judge <span class="keyword">and</span> item != target:</div><div class="line">			<span class="keyword">yield</span> index</div><div class="line"></div><div class="line">array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>]</div><div class="line"><span class="comment"># 下面这些都是可行的</span></div><div class="line">result = get_indexs(array, target=<span class="number">1</span>, judge=<span class="keyword">True</span>)</div><div class="line">print(list(result)) <span class="comment"># [0, 4]</span></div><div class="line">result = get_indexs(array, <span class="number">1</span>, <span class="keyword">True</span>)</div><div class="line">print(list(result)) <span class="comment"># [0, 4]</span></div><div class="line">result = get_indexs(array, <span class="number">1</span>)</div><div class="line">print(list(result)) <span class="comment"># [0, 4]</span></div></pre></td></tr></table></figure>
<ul>
<li>使用 <em>Python3</em> 中强制关键字参数的方式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 定义一个方法，它的作用是遍历一个数组，找出等于(或不等于)目标元素的 index</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_indexs</span><span class="params">(array, *, target=<span class="string">''</span>, judge=True)</span>:</span></div><div class="line">	<span class="keyword">for</span> index, item <span class="keyword">in</span> enumerate(array):</div><div class="line">		<span class="keyword">if</span> judge <span class="keyword">and</span> item == target:</div><div class="line">			<span class="keyword">yield</span> index</div><div class="line">		<span class="keyword">elif</span> <span class="keyword">not</span> judge <span class="keyword">and</span> item != target:</div><div class="line">			<span class="keyword">yield</span> index</div><div class="line"></div><div class="line">array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>]</div><div class="line"><span class="comment"># 这样可行</span></div><div class="line">result = get_indexs(array, target=<span class="number">1</span>, judge=<span class="keyword">True</span>)</div><div class="line">print(list(result)) <span class="comment"># [0, 4]</span></div><div class="line"><span class="comment"># 也可以忽略有默认值的参数</span></div><div class="line">result = get_indexs(array, target=<span class="number">1</span>)</div><div class="line">print(list(result)) <span class="comment"># [0, 4]</span></div><div class="line"><span class="comment"># 但不指定关键字参数则报错</span></div><div class="line">get_indexs(array, <span class="number">1</span>, <span class="keyword">True</span>)</div><div class="line"><span class="comment"># TypeError: get_indexs() takes 1 positional argument but 3 were given</span></div></pre></td></tr></table></figure>
<ul>
<li>使用 <em>Python2</em> 中强制关键字参数的方式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 定义一个方法，它的作用是遍历一个数组，找出等于(或不等于)目标元素的 index</span></div><div class="line"><span class="comment"># 使用 **kwargs，代表接收关键字参数，函数内的 kwargs 则是一个字典，传入的关键字参数作为键值对的形式存在</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_indexs</span><span class="params">(array, **kwargs)</span>:</span></div><div class="line">	target = kwargs.pop(<span class="string">'target'</span>, <span class="string">''</span>)</div><div class="line">	judge = kwargs.pop(<span class="string">'judge'</span>, <span class="keyword">True</span>)</div><div class="line">	<span class="keyword">for</span> index, item <span class="keyword">in</span> enumerate(array):</div><div class="line">		<span class="keyword">if</span> judge <span class="keyword">and</span> item == target:</div><div class="line">			<span class="keyword">yield</span> index</div><div class="line">		<span class="keyword">elif</span> <span class="keyword">not</span> judge <span class="keyword">and</span> item != target:</div><div class="line">			<span class="keyword">yield</span> index</div><div class="line"></div><div class="line">array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>]</div><div class="line"><span class="comment"># 这样可行</span></div><div class="line">result = get_indexs(array, target=<span class="number">1</span>, judge=<span class="keyword">True</span>)</div><div class="line">print(list(result)) <span class="comment"># [0, 4]</span></div><div class="line"><span class="comment"># 也可以忽略有默认值的参数</span></div><div class="line">result = get_indexs(array, target=<span class="number">1</span>)</div><div class="line">print(list(result)) <span class="comment"># [0, 4]</span></div><div class="line"><span class="comment"># 但不指定关键字参数则报错</span></div><div class="line">get_indexs(array, <span class="number">1</span>, <span class="keyword">True</span>)</div><div class="line"><span class="comment"># TypeError: get_indexs() takes 1 positional argument but 3 were given</span></div></pre></td></tr></table></figure>
<h4 id="关于参数的默认值"><a href="#关于参数的默认值" class="headerlink" title="关于参数的默认值"></a>关于参数的默认值</h4><p>算是老生常谈了：<strong>函数的默认值只会在程序加载模块并读取到该函数的定义时设置一次</strong></p>
<p>也就是说，如果给某参数赋予动态的值（ 比如<code>[]</code>或者<code>{}</code>），则如果之后在调用函数的时候给参数赋予了其他参数，则以后再调用这个函数的时候，之前定义的默认值将会改变，成为上一次调用时赋予的值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_default</span><span class="params">(value=[])</span>:</span></div><div class="line">	<span class="keyword">return</span> value</div><div class="line">	</div><div class="line">result = get_default()</div><div class="line">result.append(<span class="number">1</span>)</div><div class="line">result2 = get_default()</div><div class="line">result2.append(<span class="number">2</span>)</div><div class="line">print(result) <span class="comment"># [1, 2]</span></div><div class="line">print(result2) <span class="comment"># [1, 2]</span></div></pre></td></tr></table></figure>
<p>因此，更推荐使用<code>None</code>作为默认参数，在函数内进行判断之后赋值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_default</span><span class="params">(value=None)</span>:</span></div><div class="line">	<span class="keyword">if</span> value <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">		<span class="keyword">return</span> []</div><div class="line">	<span class="keyword">return</span> value</div><div class="line">	</div><div class="line">result = get_default()</div><div class="line">result.append(<span class="number">1</span>)</div><div class="line">result2 = get_default()</div><div class="line">result2.append(<span class="number">2</span>)</div><div class="line">print(result) <span class="comment"># [1]</span></div><div class="line">print(result2) <span class="comment"># [2]</span></div></pre></td></tr></table></figure>
<h3 id="类"><a href="#类" class="headerlink" title="类"></a>类</h3><h4 id="slots"><a href="#slots" class="headerlink" title="__slots__"></a><code>__slots__</code></h4><p>默认情况下，Python 用一个字典来保存一个对象的实例属性。这使得我们可以在运行的时候动态的给类的实例添加新的属性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">test = Test()</div><div class="line">test.new_key = <span class="string">'new_value'</span></div></pre></td></tr></table></figure>
<p>然而这个字典浪费了多余的空间 — 很多时候我们不会创建那么多的属性。因此通过<code>__slots__</code>可以告诉 Python 不要使用字典而是固定集合来分配空间。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="comment"># 用列表罗列所有的属性</span></div><div class="line">	__slots__ = [<span class="string">'name'</span>, <span class="string">'value'</span>]</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name=<span class="string">'test'</span>, value=<span class="string">'0'</span>)</span>:</span></div><div class="line">		self.name = name</div><div class="line">		self.value = value</div><div class="line"></div><div class="line">test = Test()</div><div class="line"><span class="comment"># 此时再增加新的属性则会报错</span></div><div class="line">test.new_key = <span class="string">'new_value'</span></div><div class="line"><span class="comment"># AttributeError: 'Test' object has no attribute 'new_key'</span></div></pre></td></tr></table></figure>
<h4 id="call"><a href="#call" class="headerlink" title="__call__"></a><code>__call__</code></h4><p>通过定义类中的<code>__call__</code>方法，可以使该类的实例能够像普通函数一样调用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddNumber</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">		self.num = <span class="number">0</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, num=<span class="number">1</span>)</span>:</span></div><div class="line">		self.num += num</div><div class="line"></div><div class="line">add_number = AddNumber()</div><div class="line">print(add_number.num) <span class="comment"># 0</span></div><div class="line">add_number() <span class="comment"># 像方法一样的调用</span></div><div class="line">print(add_number.num) <span class="comment"># 1</span></div><div class="line">add_number(<span class="number">3</span>)</div><div class="line">print(add_number.num) <span class="comment"># 4</span></div></pre></td></tr></table></figure>
<p>通过这种方式实现的好处是，可以通过类的属性来保存状态，而不必创建一个闭包或者全局变量。</p>
<h4 id="classmethod-amp-staticmethod"><a href="#classmethod-amp-staticmethod" class="headerlink" title="@classmethod &amp; @staticmethod"></a><code>@classmethod</code> &amp; <code>@staticmethod</code></h4><p>资料：</p>
<ul>
<li><a href="http://stackoverflow.com/questions/12179271/python-classmethod-and-staticmethod-for-beginner" target="_blank" rel="external">Python @classmethod and @staticmethod for beginner</a></li>
<li><a href="http://pythoncentral.io/difference-between-staticmethod-and-classmethod-in-python/" target="_blank" rel="external">Difference between staticmethod and classmethod in python</a></li>
</ul>
<p><code>@classmethod</code>和<code>@staticmethod</code>很像，但他们的使用场景并不一样。</p>
<ul>
<li>类内部普通的方法，都是以<code>self</code>作为第一个参数，代表着通过实例调用时，将实例的作用域传入方法内；</li>
<li><code>@classmethod</code>以<code>cls</code>作为第一个参数，代表将类本身的作用域传入。无论通过类来调用，还是通过类的实例调用，默认传入的第一个参数都将是类本身</li>
<li><code>@staticmethod</code>不需要传入默认参数，类似于一个普通的函数</li>
</ul>
<p>来通过实例了解它们的使用场景：</p>
<p>假设我们需要创建一个名为<code>Date</code>的类，用于储存 年/月/日 三个数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, year=<span class="number">0</span>, month=<span class="number">0</span>, day=<span class="number">0</span>)</span>:</span></div><div class="line">		self.year = year</div><div class="line">		self.month = month</div><div class="line">		self.day = day</div><div class="line">	</div><div class="line"><span class="meta">	@property</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">time</span><span class="params">(self)</span>:</span></div><div class="line">		<span class="keyword">return</span> <span class="string">"&#123;year&#125;-&#123;month&#125;-&#123;day&#125;"</span>.format(</div><div class="line">			year=self.year,</div><div class="line">			month=self.month,</div><div class="line">			day=self.day</div><div class="line">		)</div></pre></td></tr></table></figure>
<p>上述代码创建了<code>Date</code>类，该类会在初始化时设置<code>day/month/year</code>属性，并且通过<code>property</code>设置了一个<code>getter</code>，可以在实例化之后，通过<code>time</code>获取存储的时间：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">date = Date(<span class="string">'2016'</span>, <span class="string">'11'</span>, <span class="string">'09'</span>)</div><div class="line">date.time <span class="comment"># 2016-11-09</span></div></pre></td></tr></table></figure>
<p>但如果我们想改变属性传入的方式呢？毕竟，在初始化时就要传入年/月/日三个属性还是很烦人的。能否找到一个方法，在不改变现有接口和方法的情况下，可以通过传入<code>2016-11-09</code>这样的字符串来创建一个<code>Date</code>实例？</p>
<p>你可能会想到这样的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">date_string = <span class="string">'2016-11-09'</span></div><div class="line">year, month, day = map(str, date_string.split(<span class="string">'-'</span>))</div><div class="line">date = Date(year, month, day)</div></pre></td></tr></table></figure>
<p>但不够好：</p>
<ul>
<li>在类外额外多写了一个方法，每次还得格式化以后获取参数</li>
<li>这个方法也只跟<code>Date</code>类有关</li>
<li>没有解决传入参数过多的问题</li>
</ul>
<p>此时就可以利用<code>@classmethod</code>，在类的内部新建一个格式化字符串，并返回类的实例的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 在 Date 内新增一个 classmethod</span></div><div class="line"><span class="meta">@classmethod</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">from_string</span><span class="params">(cls, string)</span>:</span></div><div class="line">	year, month, day = map(str, string.split(<span class="string">'-'</span>))</div><div class="line">	<span class="comment"># 在 classmethod 内可以通过 cls 来调用到类的方法，甚至创建实例</span></div><div class="line">	date = cls(year, month, day)</div><div class="line">	<span class="keyword">return</span> date</div></pre></td></tr></table></figure>
<p>这样，我们就可以通过<code>Date</code>类来调用<code>from_string</code>方法创建实例，并且不侵略、修改旧的实例化方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">date = Date.from_string(<span class="string">'2016-11-09'</span>)</div><div class="line"><span class="comment"># 旧的实例化方式仍可以使用</span></div><div class="line">date_old = Date(<span class="string">'2016'</span>, <span class="string">'11'</span>, <span class="string">'09'</span>)</div></pre></td></tr></table></figure>
<p>好处：</p>
<ul>
<li>在<code>@classmethod</code>内，可以通过<code>cls</code>参数，获取到跟外部调用类时一样的便利</li>
<li>可以在其中进一步封装该方法，提高复用性</li>
<li>更加符合面向对象的编程方式</li>
</ul>
<p>而<code>@staticmethod</code>，因为其本身类似于普通的函数，所以可以把和这个类相关的 helper 方法作为<code>@staticmethod</code>，放在类里，然后直接通过类来调用这个方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 在 Date 内新增一个 staticmethod</span></div><div class="line"><span class="meta">@staticmethod</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_month_validate</span><span class="params">(month)</span>:</span></div><div class="line">	<span class="keyword">return</span> int(month) &lt;= <span class="number">12</span> <span class="keyword">and</span> int(month) &gt;= <span class="number">1</span></div></pre></td></tr></table></figure>
<p>将与日期相关的辅助类函数作为<code>@staticmethod</code>方法放在<code>Date</code>类内后，可以通过类来调用这些方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">month = <span class="string">'08'</span></div><div class="line"><span class="keyword">if</span> <span class="keyword">not</span> Date.is_month_validate(month):</div><div class="line">	print(<span class="string">'&#123;&#125; is a validate month number'</span>.format(month))</div></pre></td></tr></table></figure>
<h4 id="创建上下文管理器"><a href="#创建上下文管理器" class="headerlink" title="创建上下文管理器"></a>创建上下文管理器</h4><p>上下文管理器，通俗的介绍就是：在代码块执行前，先进行准备工作；在代码块执行完成后，做收尾的处理工作。<code>with</code>语句常伴随上下文管理器一起出现，经典场景有：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> open(<span class="string">'test.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> file:</div><div class="line">	<span class="keyword">for</span> line <span class="keyword">in</span> file.readlines():</div><div class="line">		print(line)</div></pre></td></tr></table></figure>
<p>通过<code>with</code>语句，代码完成了文件打开操作，并在调用结束，或者读取发生异常时自动关闭文件，即完成了文件读写之后的处理工作。如果不通过上下文管理器的话，则会是这样的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">file = open(<span class="string">'test.txt'</span>, <span class="string">'r'</span>)</div><div class="line"><span class="keyword">try</span>:</div><div class="line">	<span class="keyword">for</span> line <span class="keyword">in</span> file.readlines():</div><div class="line">		print(line)</div><div class="line"><span class="keyword">finally</span>:</div><div class="line">    file.close()</div></pre></td></tr></table></figure>
<p>比较繁琐吧？所以说使用上下文管理器的好处就是，通过调用我们预先设置好的回调，自动帮我们处理代码块开始执行和执行完毕时的工作。而通过自定义类的<code>__enter__</code>和<code>__exit__</code>方法，我们可以自定义一个上下文管理器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadFile</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, filename)</span>:</span></div><div class="line">		self.file = open(filename, <span class="string">'r'</span>)</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></div><div class="line">		<span class="keyword">return</span> self.file</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, type, value, traceback)</span>:</span></div><div class="line">		<span class="comment"># type, value, traceback 分别代表错误的类型、值、追踪栈</span></div><div class="line">		self.file.close()</div><div class="line">		<span class="comment"># 返回 True 代表不抛出错误</span></div><div class="line">		<span class="comment"># 否则错误会被 with 语句抛出</span></div><div class="line">		<span class="keyword">return</span> <span class="keyword">True</span></div></pre></td></tr></table></figure>
<p>然后可以以这样的方式进行调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> ReadFile(<span class="string">'test.txt'</span>) <span class="keyword">as</span> file_read:</div><div class="line">	<span class="keyword">for</span> line <span class="keyword">in</span> file_read.readlines():</div><div class="line">		print(line)</div></pre></td></tr></table></figure>
<p>在调用的时候：</p>
<ol>
<li><code>with</code>语句先暂存了<code>ReadFile</code>类的<code>__exit__</code>方法</li>
<li>然后调用<code>ReadFile</code>类的<code>__enter__</code>方法</li>
<li><code>__enter__</code>方法打开文件，并将结果返回给<code>with</code>语句</li>
<li>上一步的结果被传递给<code>file_read</code>参数</li>
<li>在<code>with</code>语句内对<code>file_read</code>参数进行操作，读取每一行</li>
<li>读取完成之后，<code>with</code>语句调用之前暂存的<code>__exit__</code>方法</li>
<li><code>__exit__</code>方法关闭了文件</li>
</ol>
<p>要注意的是，在<code>__exit__</code>方法内，我们关闭了文件，但最后返回<code>True</code>，所以错误不会被<code>with</code>语句抛出。否则<code>with</code>语句会抛出一个对应的错误。</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/Coding-Guide/">Home</a></li>
         
          <li><a href="/Coding-Guide/about/">About</a></li>
         
          <li><a href="/Coding-Guide/archives/">Articles</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Effective-Python"><span class="toc-number">1.</span> <span class="toc-text">Effective Python</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pythonic"><span class="toc-number">1.1.</span> <span class="toc-text">Pythonic</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#列表切割"><span class="toc-number">1.1.1.</span> <span class="toc-text">列表切割</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#列表推导式"><span class="toc-number">1.1.2.</span> <span class="toc-text">列表推导式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#迭代"><span class="toc-number">1.1.3.</span> <span class="toc-text">迭代</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#反向迭代"><span class="toc-number">1.1.4.</span> <span class="toc-text">反向迭代</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#try-except-else-finally"><span class="toc-number">1.1.5.</span> <span class="toc-text">try/except/else/finally</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数"><span class="toc-number">1.2.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用装饰器"><span class="toc-number">1.2.1.</span> <span class="toc-text">使用装饰器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用生成器"><span class="toc-number">1.2.2.</span> <span class="toc-text">使用生成器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#可迭代对象"><span class="toc-number">1.2.3.</span> <span class="toc-text">可迭代对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用位置参数"><span class="toc-number">1.2.4.</span> <span class="toc-text">使用位置参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用关键字参数"><span class="toc-number">1.2.5.</span> <span class="toc-text">使用关键字参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#关于参数的默认值"><span class="toc-number">1.2.6.</span> <span class="toc-text">关于参数的默认值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类"><span class="toc-number">1.3.</span> <span class="toc-text">类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#slots"><span class="toc-number">1.3.1.</span> <span class="toc-text">__slots__</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#call"><span class="toc-number">1.3.2.</span> <span class="toc-text">__call__</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#classmethod-amp-staticmethod"><span class="toc-number">1.3.3.</span> <span class="toc-text">@classmethod & @staticmethod</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建上下文管理器"><span class="toc-number">1.3.4.</span> <span class="toc-text">创建上下文管理器</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&text=Effective Python"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&title=Effective Python"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&is_video=false&description=Effective Python"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Effective Python&body=Check out this article: http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&title=Effective Python"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&title=Effective Python"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&title=Effective Python"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&title=Effective Python"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/Python/Python进阶/Effective Python/&name=Effective Python&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 ecmadao
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/Coding-Guide/">Home</a></li>
         
          <li><a href="/Coding-Guide/about/">About</a></li>
         
          <li><a href="/Coding-Guide/archives/">Articles</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    <script src="/Coding-Guide/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/Coding-Guide/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'ecmadao-blog';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


</body>
</html>
