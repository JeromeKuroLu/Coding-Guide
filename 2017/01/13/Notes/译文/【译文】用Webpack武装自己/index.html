<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Table of Contents  generated with DocToc

【译文】用Webpack武装自己
Webpack是啥?
究竟为什么要这么做？
来让我们一起构建一个简单的App
基础指引（setup）
设置第一个loader（loader-01）
写个小组件（loader-02）


代码分离（require.ensure）
再加个组件（CommonChunksPlugin）">
<meta property="og:type" content="article">
<meta property="og:title" content="【译文】用Webpack武装自己">
<meta property="og:url" content="http://ecmadao.com/2017/01/13/Notes/译文/【译文】用Webpack武装自己/index.html">
<meta property="og:site_name" content="ecmadao">
<meta property="og:description" content="Table of Contents  generated with DocToc

【译文】用Webpack武装自己
Webpack是啥?
究竟为什么要这么做？
来让我们一起构建一个简单的App
基础指引（setup）
设置第一个loader（loader-01）
写个小组件（loader-02）


代码分离（require.ensure）
再加个组件（CommonChunksPlugin）">
<meta property="og:image" content="http://ecmadao.com/images/WebpackYourBags/what-is-webpack.png">
<meta property="og:image" content="http://ecmadao.com/images/WebpackYourBags/What-is-Webpack.gif">
<meta property="og:image" content="http://ecmadao.com/images/WebpackYourBags/example01.png">
<meta property="og:image" content="http://ecmadao.com/images/WebpackYourBags/example02.png">
<meta property="og:image" content="http://ecmadao.com/images/WebpackYourBags/example03.gif">
<meta property="og:image" content="http://ecmadao.com/images/WebpackYourBags/example04.jpg">
<meta property="og:image" content="http://ecmadao.com/images/WebpackYourBags/example05.png">
<meta property="og:image" content="http://ecmadao.com/images/WebpackYourBags/example06.gif">
<meta property="og:image" content="http://ecmadao.com/images/WebpackYourBags/example07.png">
<meta property="og:image" content="http://ecmadao.com/images/WebpackYourBags/example08.png">
<meta property="og:updated_time" content="2017-01-14T12:11:43.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【译文】用Webpack武装自己">
<meta name="twitter:description" content="Table of Contents  generated with DocToc

【译文】用Webpack武装自己
Webpack是啥?
究竟为什么要这么做？
来让我们一起构建一个简单的App
基础指引（setup）
设置第一个loader（loader-01）
写个小组件（loader-02）


代码分离（require.ensure）
再加个组件（CommonChunksPlugin）">
<meta name="twitter:image" content="http://ecmadao.com/images/WebpackYourBags/what-is-webpack.png">
    
    
        
          
              <link rel="shortcut icon" href="/Coding-Guide/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/Coding-Guide/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/Coding-Guide/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>【译文】用Webpack武装自己</title>
    <!-- styles -->
    <link rel="stylesheet" href="/Coding-Guide/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/Coding-Guide/lib/meslo-LG/styles.css">
    <link rel="stylesheet" href="/Coding-Guide/lib/justified-gallery/justifiedGallery.min.css">
    <link rel="stylesheet" href="/Coding-Guide/css/style.css">
    <!-- rss -->
    
    
    <!-- jquery -->
    <script src="/Coding-Guide/lib/jquery/jquery.min.js"></script>
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/Coding-Guide/">Home</a></li>
         
          <li><a href="/Coding-Guide/about/">About</a></li>
         
          <li><a href="/Coding-Guide/archives/">Articles</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/Coding-Guide/2017/01/13/Notes/CSS/PostCSS配置指北/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&text=【译文】用Webpack武装自己"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&title=【译文】用Webpack武装自己"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&is_video=false&description=【译文】用Webpack武装自己"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=【译文】用Webpack武装自己&body=Check out this article: http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&title=【译文】用Webpack武装自己"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&title=【译文】用Webpack武装自己"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&title=【译文】用Webpack武装自己"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&title=【译文】用Webpack武装自己"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&name=【译文】用Webpack武装自己&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#【译文】用Webpack武装自己"><span class="toc-number">1.</span> <span class="toc-text">【译文】用Webpack武装自己</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Webpack是啥"><span class="toc-number">1.1.</span> <span class="toc-text">Webpack是啥?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#究竟为什么要这么做？"><span class="toc-number">1.2.</span> <span class="toc-text">究竟为什么要这么做？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#来让我们一起构建一个简单的App"><span class="toc-number">1.3.</span> <span class="toc-text">来让我们一起构建一个简单的App</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基础指引（setup）"><span class="toc-number">1.3.1.</span> <span class="toc-text">基础指引（setup）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#设置第一个loader（loader-01）"><span class="toc-number">1.3.2.</span> <span class="toc-text">设置第一个loader（loader-01）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#写个小组件（loader-02）"><span class="toc-number">1.3.3.</span> <span class="toc-text">写个小组件（loader-02）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码分离（require-ensure）"><span class="toc-number">1.4.</span> <span class="toc-text">代码分离（require.ensure）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#再加个组件（CommonChunksPlugin）"><span class="toc-number">1.5.</span> <span class="toc-text">再加个组件（CommonChunksPlugin）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#飞跃到生产环境（production）"><span class="toc-number">1.6.</span> <span class="toc-text">飞跃到生产环境（production）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#抽取（extract-text-webpack-plugin）"><span class="toc-number">1.7.</span> <span class="toc-text">抽取（extract-text-webpack-plugin）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用图片（url-loader-amp-file-loader）"><span class="toc-number">1.8.</span> <span class="toc-text">使用图片（url-loader&file-loader）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#来个牛逼的热加载（dev-server）"><span class="toc-number">1.9.</span> <span class="toc-text">来个牛逼的热加载（dev-server）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码不干净的人都给我去罚站！（pre-loader-amp-lint"><span class="toc-number">1.10.</span> <span class="toc-text">代码不干净的人都给我去罚站！（pre-loader & lint)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#还没看够？"><span class="toc-number">1.11.</span> <span class="toc-text">还没看够？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#就先讲到这儿吧"><span class="toc-number">1.12.</span> <span class="toc-text">就先讲到这儿吧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#资源"><span class="toc-number">1.13.</span> <span class="toc-text">资源</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        【译文】用Webpack武装自己
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">ecmadao</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-01-13T05:58:37.000Z" itemprop="datePublished">2017-01-13</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/Coding-Guide/tags/译文/">译文</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#%E3%80%90%E8%AF%91%E6%96%87%E3%80%91%E7%94%A8webpack%E6%AD%A6%E8%A3%85%E8%87%AA%E5%B7%B1">【译文】用Webpack武装自己</a><ul>
<li><a href="#webpack%E6%98%AF%E5%95%A5">Webpack是啥?</a></li>
<li><a href="#%E7%A9%B6%E7%AB%9F%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%BF%99%E4%B9%88%E5%81%9A%EF%BC%9F">究竟为什么要这么做？</a></li>
<li><a href="#%E6%9D%A5%E8%AE%A9%E6%88%91%E4%BB%AC%E4%B8%80%E8%B5%B7%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84app">来让我们一起构建一个简单的App</a><ul>
<li><a href="#%E5%9F%BA%E7%A1%80%E6%8C%87%E5%BC%95%EF%BC%88setup%EF%BC%89">基础指引（setup）</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE%E7%AC%AC%E4%B8%80%E4%B8%AAloader%EF%BC%88loader-01%EF%BC%89">设置第一个loader（<code>loader</code>-01）</a></li>
<li><a href="#%E5%86%99%E4%B8%AA%E5%B0%8F%E7%BB%84%E4%BB%B6%EF%BC%88loader-02%EF%BC%89">写个小组件（<code>loader</code>-02）</a></li>
</ul>
</li>
<li><a href="#%E4%BB%A3%E7%A0%81%E5%88%86%E7%A6%BB%EF%BC%88requireensure%EF%BC%89">代码分离（<code>require.ensure</code>）</a></li>
<li><a href="#%E5%86%8D%E5%8A%A0%E4%B8%AA%E7%BB%84%E4%BB%B6%EF%BC%88commonchunksplugin%EF%BC%89">再加个组件（<code>CommonChunksPlugin</code>）</a></li>
<li><a href="#%E9%A3%9E%E8%B7%83%E5%88%B0%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%EF%BC%88production%EF%BC%89">飞跃到生产环境（<code>production</code>）</a></li>
<li><a href="#%E6%8A%BD%E5%8F%96%EF%BC%88extract-text-webpack-plugin%EF%BC%89">抽取（<code>extract-text-webpack-plugin</code>）</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%9B%BE%E7%89%87%EF%BC%88url-loader&amp;file-loader%EF%BC%89">使用图片（<code>url-loader</code>&amp;<code>file-loader</code>）</a></li>
<li><a href="#%E6%9D%A5%E4%B8%AA%E7%89%9B%E9%80%BC%E7%9A%84%E7%83%AD%E5%8A%A0%E8%BD%BD%EF%BC%88dev-server%EF%BC%89">来个牛逼的热加载（dev-server）</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E4%B8%8D%E5%B9%B2%E5%87%80%E7%9A%84%E4%BA%BA%E9%83%BD%E7%BB%99%E6%88%91%E5%8E%BB%E7%BD%9A%E7%AB%99%EF%BC%81%EF%BC%88pre-loader-&amp;-lint">代码不干净的人都给我去罚站！（pre-loader &amp; lint)</a></li>
<li><a href="#%E8%BF%98%E6%B2%A1%E7%9C%8B%E5%A4%9F%EF%BC%9F">还没看够？</a></li>
<li><a href="#%E5%B0%B1%E5%85%88%E8%AE%B2%E5%88%B0%E8%BF%99%E5%84%BF%E5%90%A7">就先讲到这儿吧</a></li>
<li><a href="#%E8%B5%84%E6%BA%90">资源</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="【译文】用Webpack武装自己"><a href="#【译文】用Webpack武装自己" class="headerlink" title="【译文】用Webpack武装自己"></a>【译文】用Webpack武装自己</h2><blockquote>
<p>译自：<a href="https://blog.madewithlove.be/post/webpack-your-bags/" target="_blank" rel="external">Webpack your bags</a></p>
</blockquote>
<p><img src="/images/WebpackYourBags/what-is-webpack.png" alt="what-is-webpack"></p>
<p>你可能已经听说过这个酷酷的工具-Webpack。一些人称之为类似于Gulp的工具，还有一些人则认为它类似于Browserify。如果你还没接触过它，那很有可能会因此感到困惑。而Webpack的主页上则认为它是两者的结合，那或许更让你困惑了。</p>
<p>说实话，一开始的时候，“什么是Webpack”这个话题让我很心烦，也就没有继续研究下去了。直到后来，当我已经构建了几个项目后，才真心的为之痴迷。如果你像我一样紧随Javascript的发展步伐，你很有可能会因为太追随潮流跨度太大而蛋疼。在经历了上面这些之后，我写下这篇文章，以便更加细致的解释Webpack是什么，以及它如此重要的原因。</p>
<h3 id="Webpack是啥"><a href="#Webpack是啥" class="headerlink" title="Webpack是啥?"></a>Webpack是啥?</h3><p>首先来让我们回答最开始的问题：Webpack是个系统的构建工具，还是打包工具？答案是两者都是–这不代表它做了这两件事（先构建资源，在分别进行打包），而是说它将两者结合在一起了。</p>
<p>更加清晰的说明：与“构建sass文件，压缩图片，然后引用它们，再打包，再在页面上引用”相比，你只要这么做：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> stylesheet <span class="keyword">from</span> <span class="string">'styles/my-styles.scss'</span>;</div><div class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'img/my-logo.svg'</span>;</div><div class="line"><span class="keyword">import</span> someTemplate <span class="keyword">from</span> <span class="string">'html/some-template.html'</span>;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(stylesheet); <span class="comment">// "body&#123;font-size:12px&#125;"</span></div><div class="line"><span class="built_in">console</span>.log(logo); <span class="comment">// "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5[...]"</span></div><div class="line"><span class="built_in">console</span>.log(someTemplate) <span class="comment">// "&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span></div></pre></td></tr></table></figure>
<p>你的所有资源都被当做包处理，可以被import，修改，控制，最终展现在你最后的一个bundle上。</p>
<p>为了能让上面那些有效运转，你需要在自己的Webpage配置里配置<code>loader</code>。<code>loader</code>是一个“当程序遇见XXX类型文件的时候，就做YYY”的小型插件。来看一些<code>loader</code>的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="comment">// 如果引用了 .ts 文件, 将会触发 Typescript loader</span></div><div class="line">  test: <span class="regexp">/\.ts/</span>,</div><div class="line">  <span class="attr">loader</span>: <span class="string">'typescript'</span>,</div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">  <span class="comment">// 如果引用了png|jpg|svg图片,则会用 image-webpack 进行压缩 (wrapper around imagemin)</span></div><div class="line">  <span class="comment">// 并转化成 data64 URL 格式</span></div><div class="line">  test: <span class="regexp">/\.(png|jpg|svg)/</span>,</div><div class="line">  <span class="attr">loaders</span>: [<span class="string">'url'</span>, <span class="string">'image-webpack'</span>],</div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">  <span class="comment">// 如果使用了 SCSS files, 则会用 node-sass 解析, 最终返回CSS格式</span></div><div class="line">  test: <span class="regexp">/\.scss/</span>,</div><div class="line">  <span class="attr">loaders</span>: [<span class="string">'css'</span>, <span class="string">'autoprefixer'</span>, <span class="string">'sass'</span>],</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最终在食物链的最底端，所有的<code>loader</code>都返回<code>string</code>，这样Webpack就可以将它们加入到javascript模块中去。当你的Sass文件被loader转换之后，它的引用实际上是这样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">'body&#123;font-size:12px&#125;'</span>;</div></pre></td></tr></table></figure>
<p><img src="/images/WebpackYourBags/What-is-Webpack.gif" alt="What-is-Webpack"></p>
<h3 id="究竟为什么要这么做？"><a href="#究竟为什么要这么做？" class="headerlink" title="究竟为什么要这么做？"></a>究竟为什么要这么做？</h3><p>在你理解了Webpack是做什么的之后，第二个问题就接踵而至：使用它有什么好处？“把图片和CSS扔进我的js里？什么鬼？”其实在很久之前，为了减少HTTP request请求，我们都被教育要把所有东西写在一个文件里面。</p>
<p>到了现在，与之类似的是，很多人把所有东西打包进<code>app.js</code>。这两种方法都有一个很大的负面影响：很多时候人们在下载的是他们用不到的资源。但如果你不这么做吧，你就得手动的在每个页面引用相应的资源，最终会混乱成一坨：哪个页面已经引用了它所依赖的资源？</p>
<p>这些方法没有绝对的对错。把Webpage当做一个中间件–不仅仅是打包或构建工具，而是个聪明的模块打包系统。只要你设置正确，它会比你还要清楚使用的技术栈，并更好的优化它们。</p>
<h3 id="来让我们一起构建一个简单的App"><a href="#来让我们一起构建一个简单的App" class="headerlink" title="来让我们一起构建一个简单的App"></a>来让我们一起构建一个简单的App</h3><p>为了让你更快捷的理解使用Webpack的好处，我们会构建一个简单的App，并将资源打包进去。在这里教程中我推荐使用Node4（或5），以及NPM3作为包管理工具，以便在使用Webpack的时候避免大量的麻烦。如果你还没装NPM3，可以通过<code>npm install npm@3 -g</code>来安装。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ node --version</div><div class="line">v5<span class="number">.7</span><span class="number">.1</span></div><div class="line">$ npm --version</div><div class="line"><span class="number">3.6</span><span class="number">.0</span></div></pre></td></tr></table></figure>
<p>我还要推荐你把<code>node_modules/.bin</code>放进你的<code>PATH</code>变量，以避免每次都要输入<code>node_modules/.bin/webpack</code>。在下面了例子里我输入的指令都不会再包含<code>node_modules/.bin</code>。</p>
<h4 id="基础指引（setup）"><a href="#基础指引（setup）" class="headerlink" title="基础指引（setup）"></a>基础指引（setup）</h4><p>从创建项目安装Webpack开始。我们同时也安装了jQuery以便支持后续操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ npm init -y</div><div class="line">$ npm install jquery --save</div><div class="line">$ npm install webpack --save-dev</div></pre></td></tr></table></figure>
<p>现在来做一个App的入口：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/index.js</span></div><div class="line"><span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</div><div class="line"></div><div class="line">$(<span class="string">'body'</span>).html(<span class="string">'Hello'</span>);</div></pre></td></tr></table></figure>
<p>让我们在<code>webpack.config.js</code>文件里进行的Webpack配置。Webpack配置实质上是Javascript，并且在最后<code>export</code>出去一个Object：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// webpack.config.js</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">entry</span>:  <span class="string">'./src'</span>,</div><div class="line">    <span class="attr">output</span>: &#123;</div><div class="line">        <span class="attr">path</span>: <span class="string">'builds'</span>,</div><div class="line">        <span class="attr">filename</span>: <span class="string">'bundle.js'</span>,</div><div class="line">    &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>在这里，<code>entry</code>告诉Webpack哪些文件是应用的入口文件。它们是你的主要文件，在依赖树的最顶端。之后，我们告诉Webpack把资源打包在<code>builds</code>文件夹下的<code>bundle.js</code>文件里。让我们编写index HTML文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>My title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"builds/bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>运行Webpack。如果一切正确那就可以看见下面的信息：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ webpack</div><div class="line">Hash: d41fc61f5b9d72c13744</div><div class="line">Version: webpack <span class="number">1.12</span><span class="number">.14</span></div><div class="line">Time: <span class="number">301</span>ms</div><div class="line">    Asset    Size  Chunks             Chunk Names</div><div class="line">bundle.js  <span class="number">268</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line">   [<span class="number">0</span>] ./src/index.js <span class="number">53</span> bytes &#123;<span class="number">0</span>&#125; [built]</div><div class="line">    + <span class="number">1</span> hidden modules</div></pre></td></tr></table></figure>
<p>在这段信息里可以看出，<code>bundle.js</code>包含了<code>index.js</code>和一个隐藏的模块。隐藏的模块是jQuery。在默认模式下Webpack隐藏的模块都不是你写的。如果想要显示它们，我们可以在运行Webpack的时候使用<code>--display-modules</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ webpack --display-modules</div><div class="line">bundle.js  <span class="number">268</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line">   [<span class="number">0</span>] ./src/index.js <span class="number">53</span> bytes &#123;<span class="number">0</span>&#125; [built]</div><div class="line">   [<span class="number">1</span>] ./~<span class="regexp">/jquery/</span>dist/jquery.js <span class="number">259</span> kB &#123;<span class="number">0</span>&#125; [built]</div></pre></td></tr></table></figure>
<p>你还可以使用<code>webpack --watch</code>，在改变代码的时候自动进行打包。</p>
<h4 id="设置第一个loader（loader-01）"><a href="#设置第一个loader（loader-01）" class="headerlink" title="设置第一个loader（loader-01）"></a>设置第一个loader（<code>loader</code>-01）</h4><p>还记得Webpack可以处理各种资源的引用吗？该怎么搞？如果你跟随了这些年Web组件发展的步伐（Angular2，Vue，React，Polymer，X-Tag等等），那么你应该知道，与一堆UI相互连接组合而成的App相比，使用可维护的小型可复用的UI组件会更好：web component。</p>
<p>为了确保组件能够保持独立，它们需要在自己内部打包需要的资源。想象一个按钮组件：除了HTML之外，还需要js以便和外部结合。噢对或许还需要一些样式。如果能够在需要这个按钮组件的时候，加载所有它所依赖的资源的话那就太赞了。当我们import按钮组件的时候，就获取到了所有资源。</p>
<p>开始编写这个按钮组件吧。首先，假设你已经习惯了ES2015语法，那么需要安装第一个loader：Babel。安装好一个loader你需要做下面这两步：首先，通过<code>npm install {whatever}-loader</code>安装你需要的loader，然后，将它加到Webpage配置的<code>module.loaders</code>里：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install babel-loader --save-dev</div></pre></td></tr></table></figure>
<p>loader并不会帮我们安装Babel所以我们要自己安装它。需要安装<code>babel-core</code>包和<code>es2015</code>预处理包。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install babel-core babel-preset-es2015 --save-dev</div></pre></td></tr></table></figure>
<p>新建<code>.babelrc</code>文件，里面是一段JSON，告诉Babel使用<code>es2015</code>进行预处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// .babelrc </span></div><div class="line">&#123; <span class="string">"presets"</span>: [<span class="string">"es2015"</span>] &#125;</div></pre></td></tr></table></figure>
<p>现在，Babel已经被安装并配置完成，我们要更新Webpack配置。我们想要Babel运行在所有以<code>.js</code>结尾的文件里，但是要避免运行在第三方依赖包例如jQuery里面。loader拥有<code>include</code>和<code>exclude</code>规则，里面可以是一段字符串、正则、回调等等。在这个例子里，我们只想让Babel在我们自己的文件里运行，因此使用<code>include</code>包含自己的资源文件夹：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">entry</span>: <span class="string">'./src'</span>,</div><div class="line">    <span class="attr">output</span>: &#123;</div><div class="line">        <span class="attr">path</span>: <span class="string">'builds'</span>,</div><div class="line">        <span class="attr">filename</span>: <span class="string">'bundle.js'</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">module</span>: &#123;</div><div class="line">        <span class="attr">loaders</span>: [</div><div class="line">            &#123;</div><div class="line">                <span class="attr">test</span>: <span class="regexp">/\.js/</span>,</div><div class="line">                <span class="attr">loader</span>: <span class="string">'babel'</span>,</div><div class="line">                <span class="attr">include</span>: __dirname + <span class="string">'/src'</span>,</div><div class="line">            &#125;</div><div class="line">        ],</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>现在，我们可以用ES6语法重写<code>index.js</code>了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// index.js</span></div><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"></div><div class="line">$(<span class="string">'body'</span>).html(<span class="string">'Hello'</span>);</div></pre></td></tr></table></figure>
<h4 id="写个小组件（loader-02）"><a href="#写个小组件（loader-02）" class="headerlink" title="写个小组件（loader-02）"></a>写个小组件（<code>loader</code>-02）</h4><p>来写个按钮组件吧，它将包含一些SCSS样式，HTML模板和一些操作。所以我们要安装需要的工具。首先安装Mustache这个轻量级的模板库，然后安装处理Sass和HTML的loader。同样的，为了处理Sass loader返回的结果，还要安装CSS loader。一旦获取到了CSS文件，我们就可以用很多种方式来处理。目前使用的是一个叫<code>style-loader</code>的东西，它能够把CSS插入到包中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm install mustache --save</div><div class="line">$ npm install css-loader style-loader html-loader sass-loader node-sass --save-dev</div></pre></td></tr></table></figure>
<p>为了能够让Webpack依次处理不同loader的返回结果，我们可以将loader通过<code>!</code>链接到一起，获取使用<code>loaders</code>并对应一个由loader组成的数组：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.js/</span>,</div><div class="line">    <span class="attr">loader</span>: <span class="string">'babel'</span>,</div><div class="line">    <span class="attr">include</span>: __dirname + <span class="string">'/src'</span>,</div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.scss/</span>,</div><div class="line">    <span class="attr">loader</span>: <span class="string">'style!css!sass'</span>,</div><div class="line">    <span class="comment">// Or</span></div><div class="line">    loaders: [<span class="string">'style'</span>, <span class="string">'css'</span>, <span class="string">'sass'</span>],</div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.html/</span>,</div><div class="line">    <span class="attr">loader</span>: <span class="string">'html'</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>有了loader，我们来写写按钮：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/Components/Button.scss</span></div><div class="line"><span class="selector-class">.button</span> &#123;</div><div class="line">  <span class="attribute">background</span>: tomato;</div><div class="line">  <span class="attribute">color</span>: white;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- src/Components/Button.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"button"</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;link&#125;&#125;"</span>&gt;</span>&#123;&#123;text&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/Components/Button.js</span></div><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"><span class="keyword">import</span> template <span class="keyword">from</span> <span class="string">'./Button.html'</span>;</div><div class="line"><span class="keyword">import</span> Mustache <span class="keyword">from</span> <span class="string">'mustache'</span>;</div><div class="line"><span class="keyword">import</span> <span class="string">'./Button.scss'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Button</span> </span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(link) &#123;</div><div class="line">        <span class="keyword">this</span>.link = link;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    onClick(event) &#123;</div><div class="line">        event.preventDefault();</div><div class="line">        alert(<span class="keyword">this</span>.link);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    render(node) &#123;</div><div class="line">        <span class="keyword">const</span> text = $(node).text();</div><div class="line">        <span class="comment">// Render our button</span></div><div class="line">        $(node).html(</div><div class="line">            Mustache.render(template, &#123;text&#125;)</div><div class="line">        );</div><div class="line">        <span class="comment">// Attach our listeners</span></div><div class="line">        $(<span class="string">'.button'</span>).click(<span class="keyword">this</span>.onClick.bind(<span class="keyword">this</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>你的<code>Button.js</code>现在处于完全独立的状态，不管何时何地的引用它，都能获取到所有需要的依赖并渲染出来。现在渲染我们的按钮试试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/index.js</span></div><div class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> ‘./Components/Button’;</div><div class="line"></div><div class="line"><span class="keyword">const</span> button = <span class="keyword">new</span> Button(‘google.com’); </div><div class="line">button.render(‘a’);</div></pre></td></tr></table></figure>
<p>运行Webpack，刷新页面，立刻就能看见我们这个难看的按钮了。</p>
<p><img src="/images/WebpackYourBags/example01.png" alt="example01"></p>
<p>现在你已经学习了如何安装loader，以及定义各个依赖配置。看起来好像也没啥。但让我们来深入扩展一下这个例子。</p>
<h3 id="代码分离（require-ensure）"><a href="#代码分离（require-ensure）" class="headerlink" title="代码分离（require.ensure）"></a>代码分离（<code>require.ensure</code>）</h3><p>上面的例子还不错，但我们并不总是需要这个按钮。或许有的页面没有可以用来渲染按钮的<code>a</code>，我们并不想在这样的页面引用按钮的资源文件。这种时候代码分离就能起到作用了。代码分离是Webpack对于“整块全部打包”vs“难以维护的手动引导”这个问题而给出的解决方案。这需要在你的代码中设定“分离点”：代码可以据此分离成不同区域进行按需加载。它的语法很简单：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"></div><div class="line"><span class="comment">// 这个是分割点</span></div><div class="line"><span class="built_in">require</span>.ensure([], () =&gt; &#123;</div><div class="line">  <span class="comment">// 在这里import进的代码都会被打包到一个单独的文件里</span></div><div class="line">  <span class="keyword">const</span> library = <span class="built_in">require</span>(<span class="string">'some-big-library'</span>);</div><div class="line">  $(<span class="string">'foo'</span>).click(<span class="function"><span class="params">()</span> =&gt;</span> library.doSomething());</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>在<code>require.ensure</code>中的东西都会在打包结果中分离开来–只有当需要加载它的时候Webpack才会通过AJAX请求进行加载。也就是说我们实际上得到的是这样的文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">bundle.js</div><div class="line">|- jquery.js</div><div class="line">|- index.js <span class="comment">// 入口文件</span></div><div class="line">chunk1.js</div><div class="line">|- some-big-libray.js</div><div class="line">|- index-chunk.js <span class="comment">// 回调中的代码在这里</span></div></pre></td></tr></table></figure>
<p>你不需要在任何地方引用<code>chunk1.js</code>文件，Webpack会帮你在需要的时候进行请求。这意味着你可以像我们的例子一样，根据逻辑需要引进的资源全部扔进代码里。</p>
<p>只有当页面上有链接存在时，再引用按钮组件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/index.js</span></div><div class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.querySelectorAll(<span class="string">'a'</span>).length) &#123;</div><div class="line">    <span class="built_in">require</span>.ensure([], () =&gt; &#123;</div><div class="line">        <span class="keyword">const</span> Button = <span class="built_in">require</span>(<span class="string">'./Components/Button'</span>).default;</div><div class="line">        <span class="keyword">const</span> button = <span class="keyword">new</span> Button(<span class="string">'google.com'</span>);</div><div class="line"></div><div class="line">        button.render(<span class="string">'a'</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>需要注意的一点是，因为<code>require</code>不会同时处理default export和normal export，所以使用<code>require</code>引用资源里default export的时候，需要手动加上<code>.default</code>。相比之下，<code>import</code>则可以进行处理：</p>
<p><code>import foo from &#39;bar&#39;</code> vs <code>import {baz} from &#39;bar&#39;</code></p>
<p>此时Webpack的output将会变得更复杂了。跑下Webpack，用<code>--display-chunks</code>打印出来看看：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ webpack --display-modules --display-chunks</div><div class="line">Hash: <span class="number">43</span>b51e6cec5eb6572608</div><div class="line">Version: webpack <span class="number">1.12</span><span class="number">.14</span></div><div class="line">Time: <span class="number">1185</span>ms</div><div class="line">      Asset     Size  Chunks             Chunk Names</div><div class="line">  bundle.js  <span class="number">3.82</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line"><span class="number">1.</span>bundle.js   <span class="number">300</span> kB       <span class="number">1</span>  [emitted]</div><div class="line">chunk    &#123;<span class="number">0</span>&#125; bundle.js (main) <span class="number">235</span> bytes [rendered]</div><div class="line">    [<span class="number">0</span>] ./src/index.js <span class="number">235</span> bytes &#123;<span class="number">0</span>&#125; [built]</div><div class="line">chunk    &#123;<span class="number">1</span>&#125; <span class="number">1.</span>bundle.js <span class="number">290</span> kB &#123;<span class="number">0</span>&#125; [rendered]</div><div class="line">    [<span class="number">1</span>] ./src/Components/Button.js <span class="number">1.94</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">2</span>] ./~<span class="regexp">/jquery/</span>dist/jquery.js <span class="number">259</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">3</span>] ./src/Components/Button.html <span class="number">72</span> bytes &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">4</span>] ./~<span class="regexp">/mustache/mu</span>stache.js <span class="number">19.4</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">5</span>] ./src/Components/Button.scss <span class="number">1.05</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">6</span>] ./~<span class="regexp">/css-loader!./</span>~<span class="regexp">/sass-loader!./</span>src/Components/Button.scss <span class="number">212</span> bytes &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">7</span>] ./~<span class="regexp">/css-loader/</span>lib/css-base.js <span class="number">1.51</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">8</span>] ./~<span class="regexp">/style-loader/</span>addStyles.js <span class="number">7.21</span> kB &#123;<span class="number">1</span>&#125; [built]</div></pre></td></tr></table></figure>
<p>正如你所见的那样，我们的入口<code>bundle.js</code>值包含了一些逻辑，而其他东西（jQuery，Mustache，Button）都被打包进了<code>1.bundle.js</code>，并且只在需要的时候才会被引用。现在为了能够让Webpack在AJAX的时候找到这些资源，我们需要改下配置里的<code>output</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">path: <span class="string">'builds'</span>,</div><div class="line"><span class="attr">filename</span>: <span class="string">'bundle.js'</span>,</div><div class="line"><span class="attr">publicPath</span>: <span class="string">'builds/'</span>,</div></pre></td></tr></table></figure>
<p><code>output.publicPath</code>告诉Webpack，从当前页面的位置出发哪里可以找到需要的资源（在这个例子里是<code>/builds/</code>）。当我们加载页面的时候一切正常，而且能够看见Webpack已经根据页面上预留的“锚”加载好了包。</p>
<p><img src="/images/WebpackYourBags/example02.png" alt="example02"></p>
<p>如果页面上缺少“锚”(代指link)，那么只会加载<code>bundle.js</code>。通过这种方式，你可以做到在真正需要资源的时候才进行加载，避免让自己的页面变成笨重的一坨。顺带一提，我们可以改变分割点的名字，不使用<code>1.bundle.js</code>而使用更加语义化的名称。通过<code>require.ensure</code>的第三个参数来实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>.ensure([], () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> Button = <span class="built_in">require</span>(<span class="string">'./Components/Button'</span>).default;</div><div class="line">    <span class="keyword">const</span> button = <span class="keyword">new</span> Button(<span class="string">'google.com'</span>);</div><div class="line"></div><div class="line">    button.render(<span class="string">'a'</span>);</div><div class="line">&#125;, <span class="string">'button'</span>);</div></pre></td></tr></table></figure>
<p>这样的话就会生成<code>button.bundle.js</code>而不是<code>1.bundle.js</code></p>
<h3 id="再加个组件（CommonChunksPlugin）"><a href="#再加个组件（CommonChunksPlugin）" class="headerlink" title="再加个组件（CommonChunksPlugin）"></a>再加个组件（<code>CommonChunksPlugin</code>）</h3><p>来让我们再加个组件吧：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/Components/Header.scss</span></div><div class="line"><span class="selector-class">.header</span> &#123;</div><div class="line">  <span class="attribute">font-size</span>: <span class="number">3rem</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- src/Components/Header.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span>&#123;&#123;text&#125;&#125;<span class="tag">&lt;/<span class="name">header</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/Components/Header.js</span></div><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"><span class="keyword">import</span> Mustache <span class="keyword">from</span> <span class="string">'mustache'</span>;</div><div class="line"><span class="keyword">import</span> template <span class="keyword">from</span> <span class="string">'./Header.html'</span>;</div><div class="line"><span class="keyword">import</span> <span class="string">'./Header.scss'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Header</span> </span>&#123;</div><div class="line">    render(node) &#123;</div><div class="line">        <span class="keyword">const</span> text = $(node).text();</div><div class="line">        $(node).html(</div><div class="line">            Mustache.render(template, &#123;text&#125;)</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>将它在应用中渲染出来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 如果有链接，则渲染按钮组件</span></div><div class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.querySelectorAll(<span class="string">'a'</span>).length) &#123;</div><div class="line">    <span class="built_in">require</span>.ensure([], () =&gt; &#123;</div><div class="line">        <span class="keyword">const</span> Button = <span class="built_in">require</span>(<span class="string">'./Components/Button'</span>);</div><div class="line">        <span class="keyword">const</span> button = <span class="keyword">new</span> Button(<span class="string">'google.com'</span>);</div><div class="line"></div><div class="line">        button.render(<span class="string">'a'</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 如果有标题，则渲染标题组件</span></div><div class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.querySelectorAll(<span class="string">'h1'</span>).length) &#123;</div><div class="line">    <span class="built_in">require</span>.ensure([], () =&gt; &#123;</div><div class="line">        <span class="keyword">const</span> Header = <span class="built_in">require</span>(<span class="string">'./Components/Header'</span>);</div><div class="line"></div><div class="line">        <span class="keyword">new</span> Header().render(<span class="string">'h1'</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>瞅瞅使用了<code>--display-chunks --display-modules</code>标记后Webpack的output输出：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">$ webpack --display-modules --display-chunks</div><div class="line">Hash: <span class="number">178</span>b46d1d1570ff8bceb</div><div class="line">Version: webpack <span class="number">1.12</span><span class="number">.14</span></div><div class="line">Time: <span class="number">1548</span>ms</div><div class="line">      Asset     Size  Chunks             Chunk Names</div><div class="line">  bundle.js  <span class="number">4.16</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line"><span class="number">1.</span>bundle.js   <span class="number">300</span> kB       <span class="number">1</span>  [emitted]</div><div class="line"><span class="number">2.</span>bundle.js   <span class="number">299</span> kB       <span class="number">2</span>  [emitted]</div><div class="line">chunk    &#123;<span class="number">0</span>&#125; bundle.js (main) <span class="number">550</span> bytes [rendered]</div><div class="line">    [<span class="number">0</span>] ./src/index.js <span class="number">550</span> bytes &#123;<span class="number">0</span>&#125; [built]</div><div class="line">chunk    &#123;<span class="number">1</span>&#125; <span class="number">1.</span>bundle.js <span class="number">290</span> kB &#123;<span class="number">0</span>&#125; [rendered]</div><div class="line">    [<span class="number">1</span>] ./src/Components/Button.js <span class="number">1.94</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">2</span>] ./~<span class="regexp">/jquery/</span>dist/jquery.js <span class="number">259</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">3</span>] ./src/Components/Button.html <span class="number">72</span> bytes &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">4</span>] ./~<span class="regexp">/mustache/mu</span>stache.js <span class="number">19.4</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">5</span>] ./src/Components/Button.scss <span class="number">1.05</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">6</span>] ./~<span class="regexp">/css-loader!./</span>~<span class="regexp">/sass-loader!./</span>src/Components/Button.scss <span class="number">212</span> bytes &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">7</span>] ./~<span class="regexp">/css-loader/</span>lib/css-base.js <span class="number">1.51</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">8</span>] ./~<span class="regexp">/style-loader/</span>addStyles.js <span class="number">7.21</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">chunk    &#123;<span class="number">2</span>&#125; <span class="number">2.</span>bundle.js <span class="number">290</span> kB &#123;<span class="number">0</span>&#125; [rendered]</div><div class="line">    [<span class="number">2</span>] ./~<span class="regexp">/jquery/</span>dist/jquery.js <span class="number">259</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">4</span>] ./~<span class="regexp">/mustache/mu</span>stache.js <span class="number">19.4</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">7</span>] ./~<span class="regexp">/css-loader/</span>lib/css-base.js <span class="number">1.51</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">8</span>] ./~<span class="regexp">/style-loader/</span>addStyles.js <span class="number">7.21</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">9</span>] ./src/Components/Header.js <span class="number">1.62</span> kB &#123;<span class="number">2</span>&#125; [built]</div><div class="line">   [<span class="number">10</span>] ./src/Components/Header.html <span class="number">64</span> bytes &#123;<span class="number">2</span>&#125; [built]</div><div class="line">   [<span class="number">11</span>] ./src/Components/Header.scss <span class="number">1.05</span> kB &#123;<span class="number">2</span>&#125; [built]</div><div class="line">   [<span class="number">12</span>] ./~<span class="regexp">/css-loader!./</span>~<span class="regexp">/sass-loader!./</span>src/Components/Header.scss <span class="number">192</span> bytes &#123;<span class="number">2</span>&#125; [built]</div></pre></td></tr></table></figure>
<p>可以看出一点问题了：这两个组件都需要jQuery和Mustache，这样的话就造成了包中的依赖重复，这可不是我们想要的。尽管Webpack会在默认情况下进行一定的优化，但还得靠插件来加足火力搞定它。</p>
<p>插件和loader的不同在于，loader只对一类特定的文件有效，而插件往往面向所有文件，并且并不总是会引起转化。Webpack提供了很多插件供你优化。在这里我们使用<code>CommonChunksPlugin</code>插件：它会分析你包中的重复依赖并提取出来，生成一个完全独立的文件（例如vendor.js），甚至生成你的主文件。</p>
<p>现在，我们想要把共同的依赖包从入口中剔除。如果所有的页面都用到了jQuery和Mustache，那么就要把它们提取出来。更新下配置吧：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">entry</span>: <span class="string">'./src'</span>,</div><div class="line">    <span class="attr">output</span>: &#123;</div><div class="line">      <span class="comment">// ...</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">plugins</span>: [</div><div class="line">        <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">'main'</span>, <span class="comment">// 将依赖移到我们的主文件中</span></div><div class="line">            children: <span class="literal">true</span>, <span class="comment">// 再在所有的子文件中检查依赖文件</span></div><div class="line">            minChunks: <span class="number">2</span>, <span class="comment">// 一个依赖重复几次会被提取出来</span></div><div class="line">        &#125;),</div><div class="line">    ],</div><div class="line">    <span class="attr">module</span>: &#123;</div><div class="line">      <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>再跑次Webpack，可以看出现在就好多了。其中，<code>main</code>是我们的默认依赖。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">chunk    &#123;<span class="number">0</span>&#125; bundle.js (main) <span class="number">287</span> kB [rendered]</div><div class="line">    [<span class="number">0</span>] ./src/index.js <span class="number">550</span> bytes &#123;<span class="number">0</span>&#125; [built]</div><div class="line">    [<span class="number">2</span>] ./~<span class="regexp">/jquery/</span>dist/jquery.js <span class="number">259</span> kB &#123;<span class="number">0</span>&#125; [built]</div><div class="line">    [<span class="number">4</span>] ./~<span class="regexp">/mustache/mu</span>stache.js <span class="number">19.4</span> kB &#123;<span class="number">0</span>&#125; [built]</div><div class="line">    [<span class="number">7</span>] ./~<span class="regexp">/css-loader/</span>lib/css-base.js <span class="number">1.51</span> kB &#123;<span class="number">0</span>&#125; [built]</div><div class="line">    [<span class="number">8</span>] ./~<span class="regexp">/style-loader/</span>addStyles.js <span class="number">7.21</span> kB &#123;<span class="number">0</span>&#125; [built]</div><div class="line">chunk    &#123;<span class="number">1</span>&#125; <span class="number">1.</span>bundle.js <span class="number">3.28</span> kB &#123;<span class="number">0</span>&#125; [rendered]</div><div class="line">    [<span class="number">1</span>] ./src/Components/Button.js <span class="number">1.94</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">3</span>] ./src/Components/Button.html <span class="number">72</span> bytes &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">5</span>] ./src/Components/Button.scss <span class="number">1.05</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">6</span>] ./~<span class="regexp">/css-loader!./</span>~<span class="regexp">/sass-loader!./</span>src/Components/Button.scss <span class="number">212</span> bytes &#123;<span class="number">1</span>&#125; [built]</div><div class="line">chunk    &#123;<span class="number">2</span>&#125; <span class="number">2.</span>bundle.js <span class="number">2.92</span> kB &#123;<span class="number">0</span>&#125; [rendered]</div><div class="line">    [<span class="number">9</span>] ./src/Components/Header.js <span class="number">1.62</span> kB &#123;<span class="number">2</span>&#125; [built]</div><div class="line">   [<span class="number">10</span>] ./src/Components/Header.html <span class="number">64</span> bytes &#123;<span class="number">2</span>&#125; [built]</div><div class="line">   [<span class="number">11</span>] ./src/Components/Header.scss <span class="number">1.05</span> kB &#123;<span class="number">2</span>&#125; [built]</div><div class="line">   [<span class="number">12</span>] ./~<span class="regexp">/css-loader!./</span>~<span class="regexp">/sass-loader!./</span>src/Components/Header.scss <span class="number">192</span> bytes &#123;<span class="number">2</span>&#125; [built]</div></pre></td></tr></table></figure>
<p>如果我们改变下名字<code>name: &#39;vendor&#39;</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'vendor'</span>,</div><div class="line">    <span class="attr">children</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">minChunks</span>: <span class="number">2</span>,</div><div class="line">&#125;),</div></pre></td></tr></table></figure>
<p>Webpack会在没有该文件的情况下自动生成<code>builds/vendor.js</code>，之后我们可以手动引入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"builds/vendor.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"builds/bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>你也可以通过<code>async: true</code>，并且不提供共同依赖包的命名，来达到异步加载共同依赖的效果。</p>
<p>Webpack有很多这样给力的优化方案。我没法一个一个介绍它们，不过可以通过创造一个生产环境的应用来进一步学习。</p>
<h3 id="飞跃到生产环境（production）"><a href="#飞跃到生产环境（production）" class="headerlink" title="飞跃到生产环境（production）"></a>飞跃到生产环境（<code>production</code>）</h3><p>首先，要在设置中添加几个插件，但要求只有当<code>NODE_ENV</code>为<code>production</code>的时候才运行它们：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="keyword">var</span> production = process.env.NODE_ENV === <span class="string">'production'</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> plugins = [</div><div class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">'main'</span>,</div><div class="line">        <span class="attr">children</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">minChunks</span>: <span class="number">2</span>,</div><div class="line">    &#125;),</div><div class="line">];</div><div class="line"></div><div class="line"><span class="keyword">if</span> (production) &#123;</div><div class="line">    plugins = plugins.concat([</div><div class="line">       <span class="comment">// 生产环境下需要的插件</span></div><div class="line">    ]);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">entry</span>: <span class="string">'./src'</span>,</div><div class="line">    <span class="attr">output</span>:  &#123;</div><div class="line">        <span class="attr">path</span>: <span class="string">'builds'</span>,</div><div class="line">        <span class="attr">filename</span>: <span class="string">'bundle.js'</span>,</div><div class="line">        <span class="attr">publicPath</span>: <span class="string">'builds/'</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">plugins</span>: plugins,</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Webpack也提供了一些可以切换生产环境的设置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">debug</span>: !production,</div><div class="line">    <span class="attr">devtool</span>: production ? <span class="literal">false</span> : <span class="string">'eval'</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>设置中的第一行表明在开发环境下，将开启debug模式，代码不再混做一团，利于本地调试。第二行则用来生产资源地图（sourcemaps）。Webpack有<a href="http://webpack.github.io/docs/configuration.html#devtool" target="_blank" rel="external">一些方法</a>可以生成<a href="http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/" target="_blank" rel="external">sourcemaps</a>，而<code>eval</code>则是在本地表现最赞的一个。在生产环境下，我们并不关心sourcemaps，因此关闭了这个选项。</p>
<p>现在来添加生产环境下的插件吧：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (production) &#123;</div><div class="line">    plugins = plugins.concat([</div><div class="line">        <span class="comment">// 这个插件用来寻找相同的包和文件，并把它们合并在一起</span></div><div class="line">        <span class="keyword">new</span> webpack.optimize.DedupePlugin(),</div><div class="line"></div><div class="line">        <span class="comment">// 这个插件根据包/库的引用次数来优化它们</span></div><div class="line">        <span class="keyword">new</span> webpack.optimize.OccurenceOrderPlugin(),</div><div class="line"></div><div class="line">        <span class="comment">// 这个插件用来阻止Webpack把过小的文件打成单独的包</span></div><div class="line">        <span class="keyword">new</span> webpack.optimize.MinChunkSizePlugin(&#123;</div><div class="line">            <span class="attr">minChunkSize</span>: <span class="number">51200</span>, <span class="comment">// ~50kb</span></div><div class="line">        &#125;),</div><div class="line"></div><div class="line">        <span class="comment">// 压缩js文件</span></div><div class="line">        <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</div><div class="line">            <span class="attr">mangle</span>: <span class="literal">true</span>,</div><div class="line">            <span class="attr">compress</span>: &#123;</div><div class="line">                <span class="attr">warnings</span>: <span class="literal">false</span>, <span class="comment">// 禁止生成warning</span></div><div class="line">            &#125;,</div><div class="line">        &#125;),</div><div class="line"></div><div class="line">        <span class="comment">// 这个插件提供了各种可用在生产环境下的变量</span></div><div class="line">        <span class="comment">// 通过设置为false，可避免生产环境下调用到它们</span></div><div class="line">        <span class="keyword">new</span> webpack.DefinePlugin(&#123;</div><div class="line">            <span class="attr">__SERVER__</span>: !production,</div><div class="line">            <span class="attr">__DEVELOPMENT__</span>: !production,</div><div class="line">            <span class="attr">__DEVTOOLS__</span>: !production,</div><div class="line">            <span class="string">'process.env'</span>: &#123;</div><div class="line">                <span class="attr">BABEL_ENV</span>: <span class="built_in">JSON</span>.stringify(process.env.NODE_ENV),</div><div class="line">            &#125;,</div><div class="line">        &#125;),</div><div class="line"></div><div class="line">    ]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我普遍使用的差不多就这么多了，不过Webpack还提供了非常多的插件，你可以自己去研究它们。也可以在NPM上找到很多用户自己贡献的插件。插件的链接在文末提供。</p>
<p>还有一个关于生产环境的优化是给资源提供版本的概念。还记得<code>output.filename</code>里的<code>bundle.js</code>吗？在这个配置里面，你可以使用一些变量，而<code>[hash]</code>则会给文件提供一段随机的字符串。除此以外，我们想要包可以被版本化，因此添加了<code>output.chunkFilename</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">output: &#123;</div><div class="line">    <span class="attr">path</span>: <span class="string">'builds'</span>,</div><div class="line">    <span class="attr">filename</span>: production ? <span class="string">'[name]-[hash].js'</span> : <span class="string">'bundle.js'</span>,</div><div class="line">    <span class="attr">chunkFilename</span>: <span class="string">'[name]-[chunkhash].js'</span>,</div><div class="line">    <span class="attr">publicPath</span>: <span class="string">'builds/'</span>,</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>因为无法得知每次打包生成的文件名，所以我们只在生产环境下使用它。除此之外，我们还想保证每次打包的时候，builds文件夹都会被清空以节约空间，因此使用了一个第三方插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install clean-webpack-plugin --save-dev</div></pre></td></tr></table></figure>
<p>并将它添加到配置中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="keyword">var</span> CleanPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">if</span> (production) &#123;</div><div class="line">    plugins = plugins.concat([</div><div class="line">        <span class="comment">// 在打包前清空 builds/ 文件夹</span></div><div class="line">        <span class="keyword">new</span> CleanPlugin(<span class="string">'builds'</span>),</div></pre></td></tr></table></figure>
<p>做完这些漂亮的优化，来比较下结果的不同吧：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ webpack</div><div class="line">                bundle.js   <span class="number">314</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line"><span class="number">1</span><span class="number">-21660</span>ec268fe9de7776c.js  <span class="number">4.46</span> kB       <span class="number">1</span>  [emitted]</div><div class="line"><span class="number">2</span>-fcc95abf34773e79afda.js  <span class="number">4.15</span> kB       <span class="number">2</span>  [emitted]</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ NODE_ENV=production webpack</div><div class="line">main<span class="number">-937</span>cc23ccbf192c9edd6.js  <span class="number">97.2</span> kB       <span class="number">0</span>  [emitted]  main</div></pre></td></tr></table></figure>
<p>来看看Webpack都做了什么：</p>
<ul>
<li>在第一段代码中，后两个包非常轻量，异步请求不会占用多少HTTP带宽，所以在生产环境下Webpack将它们打包进了入口文件里</li>
<li>所有东西都压缩过了。从322kb降到了97kb</li>
</ul>
<blockquote>
<p>但是这样下去，Webpack岂不是会将js文件合并成巨大的一坨吗？</p>
</blockquote>
<p>是的，在这个小小的应用中是这样没错。但是你需要这么想：你不需要考虑在什么时候合并什么。如果你的包中含有太多的依赖，它们会被移走到异步请求包中而不会被合并起来。反之，如果它们很小，不值得独立加载，那么就会被合并。你只需要建立规则，Webpack会最大化的将其优化。没有人力劳作，不需要思考依赖关系，一切都是自动化的。</p>
<p><img src="/images/WebpackYourBags/example03.gif" alt="example03"></p>
<p>或许你已经注意到了，我没有对HTML或CSS进行压缩。那是因为当<code>debug</code>模式开启的时候，<code>css-loader</code>和<code>html-loader</code>已经帮我们搞好了。这也是为什么Uglify是一个独立插件的原因：在Webpack中没有<code>js-loader</code>这种东西，Webpack自己就是个JS loader。</p>
<h3 id="抽取（extract-text-webpack-plugin）"><a href="#抽取（extract-text-webpack-plugin）" class="headerlink" title="抽取（extract-text-webpack-plugin）"></a>抽取（<code>extract-text-webpack-plugin</code>）</h3><p>可能你已经注意到了，从这个教程一开始，Webpack打包好之后，我们的样式就直接插在网页页面上，简直不能更难看了。能通过Webpack把打包过的CSS生成独立的文件吗？当然没问题：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install extract-text-webpack-plugin --save-dev</div></pre></td></tr></table></figure>
<p>这个插件所做的就是我刚刚说的那些：从打出的最终包里面，提取出某一类内容分离开来单独引用。它通常被用于提取CSS文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="keyword">var</span> CleanPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</div><div class="line"><span class="keyword">var</span> ExtractPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>);</div><div class="line"><span class="keyword">var</span> production = process.env.NODE_ENV === <span class="string">'production'</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> plugins = [</div><div class="line">    <span class="keyword">new</span> ExtractPlugin(<span class="string">'bundle.css'</span>), <span class="comment">// &lt;=== 提取出来的文件</span></div><div class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">'main'</span>,</div><div class="line">        <span class="attr">children</span>: <span class="literal">true</span>, </div><div class="line">        <span class="attr">minChunks</span>: <span class="number">2</span>,</div><div class="line">    &#125;),</div><div class="line">];</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    plugins: plugins,</div><div class="line">    <span class="attr">module</span>:  &#123;</div><div class="line">        <span class="attr">loaders</span>: [</div><div class="line">            &#123;</div><div class="line">                <span class="attr">test</span>: <span class="regexp">/\.scss/</span>,</div><div class="line">                <span class="attr">loader</span>: ExtractPlugin.extract(<span class="string">'style'</span>, <span class="string">'css!sass'</span>),</div><div class="line">            &#125;,</div><div class="line">            <span class="comment">// ...</span></div><div class="line">        ],</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><code>ExtractPlugin.extrac</code>方法接收两个参数，第一个参数代表当它处于已经打包好的包（’style’）里时，如何处理那些提取出来的东西；第二个参数代表当它在主文件（’css!sass’）里时，如何对待提取出的东西。当它在包里时，肯定不能直接将CSS加在生成的东西后面，所以先用<code>style-loader</code>进行处理；而对于主文件里面的styles，则将它们放进<code>builds/bundle.css</code>文件。我们来给应用加一个主样式：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/styles.scss</span></div><div class="line"><span class="selector-tag">body</span> &#123;</div><div class="line">  <span class="attribute">font-family</span>: sans-serif;</div><div class="line">  <span class="attribute">background</span>: darken(white, <span class="number">0.2</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/index.js</span></div><div class="line"><span class="keyword">import</span> <span class="string">'./styles.scss'</span>;</div><div class="line"></div><div class="line"><span class="comment">// Rest of our file</span></div></pre></td></tr></table></figure>
<p>跑下Webpack，就能看见已经生成了<code>bundle.css</code>，可以把它引用进HTML里：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ webpack</div><div class="line">                bundle.js    <span class="number">318</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line"><span class="number">1</span>-a110b2d7814eb963b0b5.js   <span class="number">4.43</span> kB       <span class="number">1</span>  [emitted]</div><div class="line"><span class="number">2</span><span class="number">-03</span>eb25b4d6b52a50eb89.js    <span class="number">4.1</span> kB       <span class="number">2</span>  [emitted]</div><div class="line">               bundle.css  <span class="number">59</span> bytes       <span class="number">0</span>  [emitted]  main</div></pre></td></tr></table></figure>
<p>如果你想提取出所有包里的样式，则需要设置<code>ExtractTextPlugin(&#39;bundle.css&#39;, {allChunks: true})</code></p>
<p>顺带一提，你也可以自定义文件名，就跟之前说的改变js output-file名称一样：<code>ExtractTextPlugin(&#39;[name]-[hash].css&#39;)</code></p>
<h3 id="使用图片（url-loader-amp-file-loader）"><a href="#使用图片（url-loader-amp-file-loader）" class="headerlink" title="使用图片（url-loader&amp;file-loader）"></a>使用图片（<code>url-loader</code>&amp;<code>file-loader</code>）</h3><p>到目前为止，我们还没处理例如图片、字体这样的资源文件。它们在Webpack中如何工作，我们又该如何优化？接下来，我要在网站的背景里加入图片，看起来一定酷酷的：</p>
<p><img src="/images/WebpackYourBags/example04.jpg" alt="example04"></p>
<p>把图片保存在<code>img/puppy.jpg</code>，更新下Sass文件：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/styles.scss</span></div><div class="line"><span class="selector-tag">body</span> &#123;</div><div class="line">    <span class="attribute">font-family</span>: sans-serif;</div><div class="line">    <span class="attribute">background</span>: darken(white, <span class="number">0.2</span>);</div><div class="line">    <span class="attribute">background-image</span>: url(<span class="string">'../img/puppy.jpg'</span>);</div><div class="line">    <span class="attribute">background-size</span>: cover;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果仅仅是这样，Webpack一定会告诉你：“你特么的想让我对JPG做啥？”，那是因为还没有加入对应的loader。有两种loader可以使用：<code>file-loader</code>和<code>url-loader</code>：</p>
<ul>
<li><code>file-loader</code>：返回一段指向资源的URL，允许你给文件加入版本的概念（默认）</li>
<li><code>url-loader</code>：以<code>data:image/jpeg;base64</code>的形式返回URL</li>
</ul>
<p>很难说两种方法谁好谁坏：如果你的图片大于2M的话那你一定不希望它直接夹杂在代码中，而是独立出去；而如果仅仅是2kb左右的小图标。那么合并在一起减少HTTP请求会更好。因此，我们两个都要设置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install url-loader file-loader --save-dev</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.(png|gif|jpe?g|svg)$/i</span>,</div><div class="line">    <span class="attr">loader</span>: <span class="string">'url?limit=10000'</span>,</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>在这里，我们给<code>url-loader</code>了一个<code>limit</code>参数，这样，当文件大小小于10kb的时候，会采取行内样式，否则的话，会转到<code>file-loader</code>进行处理。你也可以通过<code>query</code>传递一个Object来实现它：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.(png|gif|jpe?g|svg)$/i</span>,</div><div class="line">    <span class="attr">loader</span>: <span class="string">'url'</span>,</div><div class="line">    <span class="attr">query</span>: &#123;</div><div class="line">      <span class="attr">limit</span>: <span class="number">10000</span>,</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>来瞅一眼Webpack的输出：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">bundle.js   <span class="number">15</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line"><span class="number">1</span>-b8256867498f4be01fd7.js  <span class="number">317</span> kB       <span class="number">1</span>  [emitted]</div><div class="line"><span class="number">2</span>-e1bc215a6b91d55a09aa.js  <span class="number">317</span> kB       <span class="number">2</span>  [emitted]</div><div class="line">               bundle.css  <span class="number">2.9</span> kB       <span class="number">0</span>  [emitted]  main</div></pre></td></tr></table></figure>
<p>输出里面没有JPG图像，那是因为我们的小狗图片比配置里限制的大小要小，因此被加到了行内。访问页面，你就能看见这只可爱的小狗了。</p>
<p><img src="/images/WebpackYourBags/example05.png" alt="example05"></p>
<p>这是一个非常强大的功能，它意味着Webpack可以智能的根据资源的大小和HTTP请求占有的比率，采取不同的优化方案。还有一个叫做<a href="/images/-webpack-loader">image-loader</a>的loader，可以在打包前检查所有图片，避免图片的重复压缩。它有一个叫<code>?bypassOnDebug</code>的参数，通过它你可以只在生产环境下启动该插件。</p>
<p>还有很多优秀的插件，我强烈建议你使用文末的链接去查看它们。</p>
<h3 id="来个牛逼的热加载（dev-server）"><a href="#来个牛逼的热加载（dev-server）" class="headerlink" title="来个牛逼的热加载（dev-server）"></a>来个牛逼的热加载（dev-server）</h3><p>我们的生产环境以及整的差不多了，现在应该更多的关心一下本地开发。或许你以及注意到了，当人们提及开发工具的时候，总是会提及热加载：LiveReload，BrowserSync，或者其他的什么鬼东西。但是只有傻瓜才会整页的刷新，我们则使用更高端的热加载。因为Webpack可以确切的知道你依赖树中某一点位置的代码，因此每次的改变都会据此生成一个新的文件。简单的说，就是不需要刷新页面就能将改变展现在屏幕上。</p>
<p>为了能够使用HMR，我们需要一个server来启动热加载。Webpack提供的<code>dev-server</code>可以完成这个任务：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install webpack-dev-server --save-dev</div></pre></td></tr></table></figure>
<p>安装下面的命令启动server，不能再简单了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ webpack-dev-server --inline --hot</div></pre></td></tr></table></figure>
<p>第一个标记<code>--inline</code>是让Webpack把HMR逻辑直接写入页面上而不是放到iframe里，而第二个标记则开启了HMR。接下来，访问<code>http://localhost:8080/webpack-dev-server/</code>,嗯还是那个正常的页面。试着修改Sass文件，MAGIC！</p>
<p><img src="/images/WebpackYourBags/example06.gif" alt="example06"></p>
<p>你可以把webpack-dev-server作为自己本地的server。如果你打算一直使用HMR，就需要这么配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">output: &#123;</div><div class="line">    <span class="attr">path</span>: <span class="string">'builds'</span>,</div><div class="line">    <span class="attr">filename</span>: production ? <span class="string">'[name]-[hash].js'</span> : <span class="string">'bundle.js'</span>,</div><div class="line">    <span class="attr">chunkFilename</span>: <span class="string">'[name]-[chunkhash].js'</span>,</div><div class="line">    <span class="attr">publicPath</span>: <span class="string">'builds/'</span>,</div><div class="line">&#125;,</div><div class="line"><span class="attr">devServer</span>: &#123;</div><div class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>这样的话，不管我们什么时候运行<code>webpack-dev-server</code>，都会是HMR模式。值得一提的是，我们在这里使用<code>webpack-dev-server</code>对资源进行热加载，但也可以使用在其他地方例如Express server上。Webpack提供了一个中间件，使得你可以把HMR的功能用在其他server上。</p>
<h3 id="代码不干净的人都给我去罚站！（pre-loader-amp-lint"><a href="#代码不干净的人都给我去罚站！（pre-loader-amp-lint" class="headerlink" title="代码不干净的人都给我去罚站！（pre-loader &amp; lint)"></a>代码不干净的人都给我去罚站！（pre-loader &amp; lint)</h3><p>如果你一直跟着本教程走，那或许会有这样的疑问：为什么loader都在<code>module.loaders</code>中而插件不在？那当然是因为还有其他可以配置进<code>module</code>的东西~Webpack不只是有loader，也有pre-loader和post-loader：在main-loader运行之前和之后发动的玩意。举个栗子：我基本可以确信自己在这个文章里面写的代码很糟糕，所以使用ESLint进行代码检查：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install eslint eslint-loader babel-eslint --save-dev</div></pre></td></tr></table></figure>
<p>新建一个肯定会引发错误的<code>.eslintrc</code>文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// .eslintrc</span></div><div class="line">parser: <span class="string">'babel-eslint'</span></div><div class="line">rules:</div><div class="line">  quotes: <span class="number">2</span></div></pre></td></tr></table></figure>
<p>现在增加pre-loader，语法和之前的一样，只不过加在<code>module.preLoaders</code>里：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>:  &#123;</div><div class="line">    <span class="attr">preLoaders</span>: [</div><div class="line">        &#123;</div><div class="line">            <span class="attr">test</span>: <span class="regexp">/\.js/</span>,</div><div class="line">            <span class="attr">loader</span>: <span class="string">'eslint'</span>,</div><div class="line">        &#125;</div><div class="line">    ],</div></pre></td></tr></table></figure>
<p>启动Webpack，然后淡定的看它失败：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">$ webpack</div><div class="line">Hash: <span class="number">33</span>cc307122f0a9608812</div><div class="line">Version: webpack <span class="number">1.12</span><span class="number">.2</span></div><div class="line">Time: <span class="number">1307</span>ms</div><div class="line">                    Asset      Size  Chunks             Chunk Names</div><div class="line">                bundle.js    <span class="number">305</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line"><span class="number">1</span><span class="number">-551</span>ae2634fda70fd8502.js    <span class="number">4.5</span> kB       <span class="number">1</span>  [emitted]</div><div class="line"><span class="number">2</span><span class="number">-999713</span>ac2cd9c7cf079b.js   <span class="number">4.17</span> kB       <span class="number">2</span>  [emitted]</div><div class="line">               bundle.css  <span class="number">59</span> bytes       <span class="number">0</span>  [emitted]  main</div><div class="line">    + <span class="number">15</span> hidden modules</div><div class="line"></div><div class="line">ERROR <span class="keyword">in</span> ./src/index.js</div><div class="line"></div><div class="line">/Users/anahkiasen/Sites/webpack/src/index.js</div><div class="line">   <span class="number">1</span>:<span class="number">8</span>   error  Strings must use doublequote  quotes</div><div class="line">   <span class="number">4</span>:<span class="number">31</span>  error  Strings must use doublequote  quotes</div><div class="line">   <span class="number">6</span>:<span class="number">32</span>  error  Strings must use doublequote  quotes</div><div class="line">   <span class="number">7</span>:<span class="number">35</span>  error  Strings must use doublequote  quotes</div><div class="line">   <span class="number">9</span>:<span class="number">23</span>  error  Strings must use doublequote  quotes</div><div class="line">  <span class="number">14</span>:<span class="number">31</span>  error  Strings must use doublequote  quotes</div><div class="line">  <span class="number">16</span>:<span class="number">32</span>  error  Strings must use doublequote  quotes</div><div class="line">  <span class="number">18</span>:<span class="number">29</span>  error  Strings must use doublequote  quotes</div></pre></td></tr></table></figure>
<p>再举个pre-loader的例子：每个组件里我们都引用了stylesheet，而它们都有相同命名的对应模板。使用一个pre-loader可以自动将有相同名称的文件作为一个module载入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install baggage-loader --save-dev</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.js/</span>,</div><div class="line">    <span class="attr">loader</span>: <span class="string">'baggage?[file].html=template&amp;[file].scss'</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过这样的方式告知Webpack，如果遇见和配置相同的HTML文件，则将它作为<code>template</code>引入，同时引入和它同名的Sass文件。这样就能改写组件文件：</p>
<p>将：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"><span class="keyword">import</span> template <span class="keyword">from</span> <span class="string">'./Button.html'</span>;</div><div class="line"><span class="keyword">import</span> Mustache <span class="keyword">from</span> <span class="string">'mustache'</span>;</div><div class="line"><span class="keyword">import</span> <span class="string">'./Button.scss'</span>;</div></pre></td></tr></table></figure>
<p>改为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"><span class="keyword">import</span> Mustache <span class="keyword">from</span> <span class="string">'mustache'</span>;</div></pre></td></tr></table></figure>
<p>你看，pre-loaders也可以很强大。在文末你可以找到更多的loader</p>
<h3 id="还没看够？"><a href="#还没看够？" class="headerlink" title="还没看够？"></a>还没看够？</h3><p>现在我们的应用还很小，当它变的庞大的时候，观测依赖树就变的非常有用了，从中可以看出我们做的是对是错，应用的瓶颈在哪里等等。Webpack知晓这一切，不过我们得礼貌的请教它才能知晓答案。为了做到这点，你可以通过下面的命令运行Webpack：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webpack --profile --json &gt; stats.json</div></pre></td></tr></table></figure>
<p>第一个标记会让Webpack生成一个profile文件，而第二个则将它转化为JSON格式。最终，讲所有的output都生成了JSON文件。现在有很多网站都可以解析这个JSON文件，不过Webpack官方提供了一个解码的网站<a href="http://webpack.github.io/analyse/" target="_blank" rel="external">Webpack Analyze</a>。将JSON文件导入，进入Modules板块，就可以看见自己依赖树的可视化图像：</p>
<p><img src="/images/WebpackYourBags/example07.png" alt="example07"></p>
<p>小圆点越红，则证明在打包的时候越困难。在这个例子中，jQuery作为最大的文件而成为罪魁祸首。再瞅瞅网站上的其他模块。或许你无法从这个小小的例子里学到很多东西，但是这个工具在分析依赖树和包的时候真的非常有用。</p>
<p>我之前提过，现在有很多服务提供可以对profile文件进行分析。其中一个是<a href="http://chrisbateman.github.io/webpack-visualizer/" target="_blank" rel="external">Webpack Visualizer</a>，它可以以饼状图的形式告知你各个文件占据了多大的比重：</p>
<p><img src="/images/WebpackYourBags/example08.png" alt="example08"></p>
<h3 id="就先讲到这儿吧"><a href="#就先讲到这儿吧" class="headerlink" title="就先讲到这儿吧"></a>就先讲到这儿吧</h3><p>对我而言，Webpack已经取代了Grunt或者Gulp：大部分的功能可以使用Webpack替代，其他的则使用NPM脚本就够了。在以前，每个任务中我们都要通过Aglio，把API文档转换为HTML，而现在只需要这么做：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// package.json</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"build"</span>: <span class="string">"webpack"</span>,</div><div class="line">    <span class="string">"build:api"</span>: <span class="string">"aglio -i docs/api/index.apib -o docs/api/index.html"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>即便是一些不需要打包和构建的Glup任务，Webpack都贴心的提供了对应的服务。下面是一个将Glup融合进Webpack的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line"><span class="keyword">var</span> gutil = <span class="built_in">require</span>(<span class="string">'gutil'</span>);</div><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'./webpack.config'</span>);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  webpack(config, <span class="function"><span class="keyword">function</span>(<span class="params">error, stats</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (error) <span class="keyword">throw</span> <span class="keyword">new</span> gutil.PluginError(<span class="string">'webpack'</span>, error);</div><div class="line">    gutil.log(<span class="string">'[webpack]'</span>, stats.toString());</div><div class="line"></div><div class="line">    callback();</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>因为Webpack具有Node API，因此可以很轻松了运用在其他构建体系中。不用多久你就能发现自己深爱着它无法自拔了。</p>
<p>不管怎样，这篇文字带你预览了Webpack能够帮你做的事情。或许你认为我们讲了很多方面，但实际上这只是个表皮而已：multiple entry points, prefetching, context replacement等等都还没有涉及到。Webpack是个强大的工具，也因此比那些传统的工具更加难懂。但一旦你知道如何使用它，它就会为你鸣奏最悦耳动听的声音。我曾在一些项目里使用过它，它提供的强大的优化和自动化让我深深不能自拔。</p>
<h3 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h3><ul>
<li><a href="https://webpack.github.io/" target="_blank" rel="external">Webpack documentation</a></li>
<li><a href="http://webpack.github.io/docs/list-of-loaders.html" target="_blank" rel="external">List of loaders</a></li>
<li><a href="http://webpack.github.io/docs/list-of-plugins.html" target="_blank" rel="external">List of plugins</a></li>
<li><a href="https://github.com/madewithlove/webpack-article/commits/master" target="_blank" rel="external">Sources for this article</a></li>
<li><a href="https://github.com/madewithlove/webpack-config" target="_blank" rel="external">Our Webpack configuration package</a></li>
</ul>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/Coding-Guide/">Home</a></li>
         
          <li><a href="/Coding-Guide/about/">About</a></li>
         
          <li><a href="/Coding-Guide/archives/">Articles</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#【译文】用Webpack武装自己"><span class="toc-number">1.</span> <span class="toc-text">【译文】用Webpack武装自己</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Webpack是啥"><span class="toc-number">1.1.</span> <span class="toc-text">Webpack是啥?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#究竟为什么要这么做？"><span class="toc-number">1.2.</span> <span class="toc-text">究竟为什么要这么做？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#来让我们一起构建一个简单的App"><span class="toc-number">1.3.</span> <span class="toc-text">来让我们一起构建一个简单的App</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基础指引（setup）"><span class="toc-number">1.3.1.</span> <span class="toc-text">基础指引（setup）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#设置第一个loader（loader-01）"><span class="toc-number">1.3.2.</span> <span class="toc-text">设置第一个loader（loader-01）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#写个小组件（loader-02）"><span class="toc-number">1.3.3.</span> <span class="toc-text">写个小组件（loader-02）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码分离（require-ensure）"><span class="toc-number">1.4.</span> <span class="toc-text">代码分离（require.ensure）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#再加个组件（CommonChunksPlugin）"><span class="toc-number">1.5.</span> <span class="toc-text">再加个组件（CommonChunksPlugin）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#飞跃到生产环境（production）"><span class="toc-number">1.6.</span> <span class="toc-text">飞跃到生产环境（production）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#抽取（extract-text-webpack-plugin）"><span class="toc-number">1.7.</span> <span class="toc-text">抽取（extract-text-webpack-plugin）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用图片（url-loader-amp-file-loader）"><span class="toc-number">1.8.</span> <span class="toc-text">使用图片（url-loader&file-loader）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#来个牛逼的热加载（dev-server）"><span class="toc-number">1.9.</span> <span class="toc-text">来个牛逼的热加载（dev-server）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码不干净的人都给我去罚站！（pre-loader-amp-lint"><span class="toc-number">1.10.</span> <span class="toc-text">代码不干净的人都给我去罚站！（pre-loader & lint)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#还没看够？"><span class="toc-number">1.11.</span> <span class="toc-text">还没看够？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#就先讲到这儿吧"><span class="toc-number">1.12.</span> <span class="toc-text">就先讲到这儿吧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#资源"><span class="toc-number">1.13.</span> <span class="toc-text">资源</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&text=【译文】用Webpack武装自己"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&title=【译文】用Webpack武装自己"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&is_video=false&description=【译文】用Webpack武装自己"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=【译文】用Webpack武装自己&body=Check out this article: http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&title=【译文】用Webpack武装自己"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&title=【译文】用Webpack武装自己"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&title=【译文】用Webpack武装自己"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&title=【译文】用Webpack武装自己"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/译文/【译文】用Webpack武装自己/&name=【译文】用Webpack武装自己&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 ecmadao
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/Coding-Guide/">Home</a></li>
         
          <li><a href="/Coding-Guide/about/">About</a></li>
         
          <li><a href="/Coding-Guide/archives/">Articles</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    <script src="/Coding-Guide/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/Coding-Guide/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'ecmadao-blog';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


</body>
</html>
