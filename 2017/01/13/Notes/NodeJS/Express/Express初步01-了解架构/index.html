<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Table of Contents  generated with DocToc

Express初步01 - 了解架构
Express 安装
Express 组成部分
application对象
request对象
response对象


Express 目录结构
定义路由
分发路由,加载中间件
view层
资源文件
处理错误页面






Express初步01 - 了解架构
以 ex">
<meta property="og:type" content="article">
<meta property="og:title" content="Express初步01-了解架构">
<meta property="og:url" content="http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/index.html">
<meta property="og:site_name" content="ecmadao">
<meta property="og:description" content="Table of Contents  generated with DocToc

Express初步01 - 了解架构
Express 安装
Express 组成部分
application对象
request对象
response对象


Express 目录结构
定义路由
分发路由,加载中间件
view层
资源文件
处理错误页面






Express初步01 - 了解架构
以 ex">
<meta property="og:updated_time" content="2017-01-14T12:11:43.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Express初步01-了解架构">
<meta name="twitter:description" content="Table of Contents  generated with DocToc

Express初步01 - 了解架构
Express 安装
Express 组成部分
application对象
request对象
response对象


Express 目录结构
定义路由
分发路由,加载中间件
view层
资源文件
处理错误页面






Express初步01 - 了解架构
以 ex">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Express初步01-了解架构</title>
    <!-- styles -->
    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/lib/meslo-LG/styles.css">
    <link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
    <!-- jquery -->
    <script src="/lib/jquery/jquery.min.js"></script>
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/01/13/Notes/NodeJS/Node基础/Node.js初步-模块化/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/2017/01/13/Notes/NodeJS/Express/Express初步02-中间件/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&text=Express初步01-了解架构"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&title=Express初步01-了解架构"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&is_video=false&description=Express初步01-了解架构"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Express初步01-了解架构&body=Check out this article: http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&title=Express初步01-了解架构"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&title=Express初步01-了解架构"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&title=Express初步01-了解架构"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&title=Express初步01-了解架构"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&name=Express初步01-了解架构&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Express初步01-了解架构"><span class="toc-number">1.</span> <span class="toc-text">Express初步01 - 了解架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-安装"><span class="toc-number">1.1.</span> <span class="toc-text">Express 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-组成部分"><span class="toc-number">1.2.</span> <span class="toc-text">Express 组成部分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#application对象"><span class="toc-number">1.2.1.</span> <span class="toc-text">application对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#request对象"><span class="toc-number">1.2.2.</span> <span class="toc-text">request对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#response对象"><span class="toc-number">1.2.3.</span> <span class="toc-text">response对象</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-目录结构"><span class="toc-number">1.3.</span> <span class="toc-text">Express 目录结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#定义路由"><span class="toc-number">1.3.1.</span> <span class="toc-text">定义路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分发路由-加载中间件"><span class="toc-number">1.3.2.</span> <span class="toc-text">分发路由,加载中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#view层"><span class="toc-number">1.3.3.</span> <span class="toc-text">view层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#资源文件"><span class="toc-number">1.3.4.</span> <span class="toc-text">资源文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#处理错误页面"><span class="toc-number">1.3.5.</span> <span class="toc-text">处理错误页面</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Express初步01-了解架构
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">ecmadao</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-01-13T05:58:37.000Z" itemprop="datePublished">2017-01-13</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Express/">Express</a>, <a class="tag-link" href="/tags/NodeJS/">NodeJS</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#express%E5%88%9D%E6%AD%A501---%E4%BA%86%E8%A7%A3%E6%9E%B6%E6%9E%84">Express初步01 - 了解架构</a><ul>
<li><a href="#express-%E5%AE%89%E8%A3%85">Express 安装</a></li>
<li><a href="#express-%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86">Express 组成部分</a><ul>
<li><a href="#application%E5%AF%B9%E8%B1%A1">application对象</a></li>
<li><a href="#request%E5%AF%B9%E8%B1%A1">request对象</a></li>
<li><a href="#response%E5%AF%B9%E8%B1%A1">response对象</a></li>
</ul>
</li>
<li><a href="#express-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">Express 目录结构</a><ul>
<li><a href="#%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1">定义路由</a></li>
<li><a href="#%E5%88%86%E5%8F%91%E8%B7%AF%E7%94%B1%E5%8A%A0%E8%BD%BD%E4%B8%AD%E9%97%B4%E4%BB%B6">分发路由,加载中间件</a></li>
<li><a href="#view%E5%B1%82">view层</a></li>
<li><a href="#%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6">资源文件</a></li>
<li><a href="#%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2">处理错误页面</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="Express初步01-了解架构"><a href="#Express初步01-了解架构" class="headerlink" title="Express初步01 - 了解架构"></a>Express初步01 - 了解架构</h2><blockquote>
<p>以 express V4.13.1为例</p>
</blockquote>
<h3 id="Express-安装"><a href="#Express-安装" class="headerlink" title="Express 安装"></a>Express 安装</h3><ul>
<li>安装 Node</li>
<li>全局安装Express</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// install node</span></div><div class="line"></div><div class="line"><span class="comment">// install express</span></div><div class="line">$ sudo npm install -g express-generator</div><div class="line">$ express [项目名]</div><div class="line">$ cd [项目名] &amp;&amp; npm install</div><div class="line"></div><div class="line"><span class="comment">// start </span></div><div class="line">$ DEBUG=blog:* npm start</div><div class="line"><span class="comment">// if it can't used, then try</span></div><div class="line">$ npm start</div></pre></td></tr></table></figure>
<h3 id="Express-组成部分"><a href="#Express-组成部分" class="headerlink" title="Express 组成部分"></a>Express 组成部分</h3><h4 id="application对象"><a href="#application对象" class="headerlink" title="application对象"></a>application对象</h4><p>创造一个Express模块对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> express();</div></pre></td></tr></table></figure>
<p>application对象的方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">app.set(name, value) <span class="comment">// 设置一个app属性 </span></div><div class="line">app.get(name) <span class="comment">// 提取由app.set()设置的值 </span></div><div class="line">app.enable(name) <span class="comment">// 开启一个设置 </span></div><div class="line">app.disable(name) <span class="comment">// 关闭一个设置 </span></div><div class="line">app.enabled(name) <span class="comment">// 检查设置是否开启 </span></div><div class="line">app.disabled(name) <span class="comment">// 检查设置是否不可用 </span></div><div class="line">app.configure([env], callback) <span class="comment">// 根据开发环境进行设置 </span></div><div class="line">app.use([path], <span class="function"><span class="keyword">function</span>) // 在<span class="title">app</span>中载入一个中间件 </span></div><div class="line"><span class="title">app</span>.<span class="title">engine</span>(<span class="params">ext, callback</span>) // 为<span class="title">app</span>注册一个模板 </div><div class="line"><span class="title">app</span>.<span class="title">param</span>(<span class="params">[name], callback</span>) // 为路径变量增加逻辑 </div><div class="line"><span class="title">app</span>.<span class="title">VERB</span>(<span class="params">path, [callback...], callback</span>) // 根据<span class="title">HTTP</span> <span class="title">verbs</span> 定义路径和处理器 </div><div class="line"><span class="title">app</span>.<span class="title">all</span>(<span class="params">path, [callback...], callback</span>) // 为所有<span class="title">HTTP</span> <span class="title">verbs</span>定义路径和处理器 </div><div class="line"><span class="title">app</span>.<span class="title">locals</span> // 存储所有视图都能访问的变量的对象 </div><div class="line"><span class="title">app</span>.<span class="title">render</span>(<span class="params">view, [options], callback</span>) // 从<span class="title">app</span>中渲染一个视图 </div><div class="line"><span class="title">app</span>.<span class="title">routes</span> // 在<span class="title">app</span>中定义的所有路径列表 </div><div class="line"><span class="title">app</span>.<span class="title">listen</span>(<span class="params"></span>) // 绑定并监听所有连接</div></pre></td></tr></table></figure>
<h4 id="request对象"><a href="#request对象" class="headerlink" title="request对象"></a>request对象</h4><p>当一个客户端对Express app发起一个请求时，HTTP request对象被创建。<br>它包含许多与当前请求相关的方法和属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">req.params <span class="comment">// 包含请求路径中的变量 </span></div><div class="line">req.params(name) <span class="comment">// 从GET变量或者POST变量中返回一个特定变量 </span></div><div class="line">req.query <span class="comment">// 包含GET中的值 </span></div><div class="line">req.body <span class="comment">// 包含POST中的值 </span></div><div class="line">req.files <span class="comment">// 包含由表单上传的文件 req.route 提供当前匹配路径的信息 </span></div><div class="line">req.cookies <span class="comment">// Cookie值 </span></div><div class="line">req.signedCookies <span class="comment">// Signed cookie 值 </span></div><div class="line">req.get(header) <span class="comment">// 获取http请求头文件 </span></div><div class="line">req.accepts(types) <span class="comment">// 检查客户端是否接受媒体类型 </span></div><div class="line">req.accepted <span class="comment">// 客户端可接受的媒体类型列表 </span></div><div class="line">req.is(type) <span class="comment">// 检查请求中是否包含某种媒体类型 </span></div><div class="line">req.ip <span class="comment">// 客户端的ip地址 </span></div><div class="line">req.ips <span class="comment">// 客户端以及代理的ip地址 </span></div><div class="line">req.path <span class="comment">// 请求路径 </span></div><div class="line">req.host <span class="comment">// 来自HTTP头文件的主机信息 </span></div><div class="line">req.fresh <span class="comment">// 检查请求是否刚发生 </span></div><div class="line">req.stale <span class="comment">// 检查请求是否稳定 </span></div><div class="line">req.xhr <span class="comment">// 检查请求是否来自于AJAX请求 </span></div><div class="line">req.protocol <span class="comment">// 进行请求的协议 </span></div><div class="line">req.secure <span class="comment">// 检查是否是安全连接 </span></div><div class="line">req.subdomains <span class="comment">// 主域名下面的子域名 </span></div><div class="line">req.url <span class="comment">// 请求路径以及查询变量 </span></div><div class="line">req.originalUrl <span class="comment">// req.url的根源</span></div><div class="line">req.acceptedLanguages <span class="comment">// 客户端所接受的语言列表 </span></div><div class="line">req.acceptsLanguage(langauge) <span class="comment">// 检查客户端是否接受某种特定语言 req.acceptedCharsets // 客户端可接受字符列表 </span></div><div class="line">req.acceptsCharsets(charset) <span class="comment">// 检查客户端是否接受某种特定字符</span></div></pre></td></tr></table></figure>
<h4 id="response对象"><a href="#response对象" class="headerlink" title="response对象"></a>response对象</h4><p>response对象和request对象一起被创建</p>
<p>每个中间件在把控制传递给下一个中间件之前都需要包含一个res对象和一个req对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">res.status(code) <span class="comment">// 设置HTTP恢复状态码 </span></div><div class="line">res.set(field, [value]) <span class="comment">// 设置回复HTTP头文件 </span></div><div class="line">res.get(header) <span class="comment">// 获取回复HTTP头文件 </span></div><div class="line">res.cookie(name, value, [options]) <span class="comment">// 在客户端上设置cookie </span></div><div class="line">res.clearCookie(name, [options]) <span class="comment">// 清除客户端上的cookie </span></div><div class="line">res.redirect([status], url) <span class="comment">// 连同一个HTTP状态码重定向到一个新的url </span></div><div class="line">res.location <span class="comment">// HTTP头文件中的location值 </span></div><div class="line">res.charset <span class="comment">// HTTP头文件中的charset值 </span></div><div class="line">res.send([body|status], [body]) <span class="comment">// 连同一个HTTP回复码，发送一个HTTP回复对象 </span></div><div class="line">res.json([status|body], [body]) <span class="comment">// 连同一个HTTP回复码，发送一个JSON对象 </span></div><div class="line">res.jsonp([status|body], [body]) <span class="comment">// 连同一个HTTP回复码，发送一个JSONP对象 </span></div><div class="line">res.type(type) <span class="comment">// 设置回复HTTP头文件的媒体类型 </span></div><div class="line">res.format(object) <span class="comment">// 根据客户端可接受的类型发送一个HTTP回复 </span></div><div class="line">res.attachment([filename]) <span class="comment">// 设置HTTP头文件内容为一个附件 </span></div><div class="line">res.sendfile(path, [options], [callback]]) <span class="comment">// 向客户端发送一个文件 </span></div><div class="line">res.download(path, [filename], [callback]) <span class="comment">// 提示客户端下载一个文件 </span></div><div class="line">res.links(links) <span class="comment">// 设置HTTP连接头文件 </span></div><div class="line">res.locals <span class="comment">// 存储所有视图能够访问的req的变量值 </span></div><div class="line">res.render(view, [locals], callback) <span class="comment">// 渲染一个视图</span></div></pre></td></tr></table></figure>
<h3 id="Express-目录结构"><a href="#Express-目录结构" class="headerlink" title="Express 目录结构"></a>Express 目录结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-- app.js [根文件，生成了ExpressApp实例，分发路由]</div><div class="line">-- bin</div><div class="line">---- www [最终的执行文件]</div><div class="line">-- node_modules [node依赖包]</div><div class="line">-- public [public资源文件，存放js/css/image等]</div><div class="line">-- routes [路由目录]</div><div class="line">-- views [view层]</div><div class="line">-- package.json</div></pre></td></tr></table></figure>
<h4 id="定义路由"><a href="#定义路由" class="headerlink" title="定义路由"></a>定义路由</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">./routes/index.js</div><div class="line"></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"></div><div class="line"><span class="comment">// express.Router 类来创建可安装的模块化路由处理程序。Router 实例是完整的中间件和路由系统</span></div><div class="line"><span class="keyword">var</span> router = express.Router();</div><div class="line"></div><div class="line"><span class="comment">// 定义路由</span></div><div class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// render出view层</span></div><div class="line">  res.render(<span class="string">'index'</span>, &#123; <span class="attr">title</span>: <span class="string">'Express'</span> &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = router;</div></pre></td></tr></table></figure>
<p>其底层都是通过如下方法实现:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// GET method route</span></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.send(<span class="string">'GET request to the homepage'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// POST method route</span></div><div class="line">app.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.send(<span class="string">'POST request to the homepage'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>可以提供多个回调函数, 这些回调函数可能调用 next(‘route’) 来绕过剩余的路由回调</p>
<p>可以使用此机制对路由施加先决条件，在没有理由继续执行当前路由的情况下，可将控制权传递给后续路由</p>
<p>多个回调函数可以处理一个路由（确保您指定 next 对象）:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">'/example/b'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'the response will be sent by the next function ...'</span>);</div><div class="line">  next();</div><div class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.send(<span class="string">'Hello from B!'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>一组回调函数可以处理一个路由。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> cb0 = <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'CB0'</span>);</div><div class="line">  next();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> cb1 = <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'CB1'</span>);</div><div class="line">  next();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> cb2 = <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.send(<span class="string">'Hello from C!'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">app.get(<span class="string">'/example/c'</span>, [cb0, cb1, cb2]);</div></pre></td></tr></table></figure>
<h4 id="分发路由-加载中间件"><a href="#分发路由-加载中间件" class="headerlink" title="分发路由,加载中间件"></a>分发路由,加载中间件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">./app.js</div><div class="line"></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">var</span> favicon = <span class="built_in">require</span>(<span class="string">'serve-favicon'</span>); </div><div class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">'cookie-parser'</span>);</div><div class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> routes = <span class="built_in">require</span>(<span class="string">'./routes/index'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"></div><div class="line"><span class="comment">// view引擎初始化</span></div><div class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>)); <span class="comment">// 配置view文件目录</span></div><div class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'jade'</span>); <span class="comment">// 使用 jade</span></div><div class="line"></div><div class="line"><span class="comment">// 配置网站的favicon</span></div><div class="line">app.use(favicon(path.join(__dirname, <span class="string">'public'</span>, <span class="string">'favicon.ico'</span>)));</div><div class="line"></div><div class="line"><span class="comment">// 加载解析json的中间件</span></div><div class="line">app.use(bodyParser.json());</div><div class="line"><span class="comment">// 加载解析urlencoded请求体的中间件</span></div><div class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</div><div class="line"><span class="comment">// 加载解析cookie的中间件</span></div><div class="line">app.use(cookieParser());</div><div class="line"></div><div class="line"><span class="comment">// 配置public资源文件目录</span></div><div class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</div><div class="line"></div><div class="line"><span class="comment">// 分发路由</span></div><div class="line">app.use(<span class="string">'/'</span>, routes);</div><div class="line">app.use(<span class="string">'/users'</span>, users);</div><div class="line">app.use(<span class="string">'/about'</span>, routes);</div><div class="line"></div><div class="line"><span class="comment">// 设置404页面</span></div><div class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> err = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Not Found'</span>);</div><div class="line">  err.status = <span class="number">404</span>;</div><div class="line">  next(err);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = app;</div></pre></td></tr></table></figure>
<p>在根路由 (/) 上（应用程序的主页）对 POST 请求进行响应:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.send(<span class="string">'Got a POST request'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>对 /user 路由的 PUT 请求进行响应:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.put(<span class="string">'/user'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.send(<span class="string">'Got a PUT request at /user'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>对 /user 路由的 DELETE 请求进行响应:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.delete(<span class="string">'/user'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.send(<span class="string">'Got a DELETE request at /user'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="view层"><a href="#view层" class="headerlink" title="view层"></a>view层</h4><p>使用<code>.jade</code>格式文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">doctype html</div><div class="line">html</div><div class="line">  head</div><div class="line">    title= title</div><div class="line">    link(rel=&apos;stylesheet&apos;, href=&apos;/stylesheets/style.css&apos;)</div><div class="line">  body</div><div class="line">    block content</div></pre></td></tr></table></figure>
<h4 id="资源文件"><a href="#资源文件" class="headerlink" title="资源文件"></a>资源文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">./app.js</div><div class="line"></div><div class="line"><span class="comment">// 配置路径</span></div><div class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</div><div class="line"></div><div class="line"><span class="comment">// result</span></div><div class="line">http:<span class="comment">//localhost:3000/css/style.css</span></div></pre></td></tr></table></figure>
<p>要使用多个静态资产目录，请多次调用 express.static 中间件函数:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">app.use(express.static(<span class="string">'public'</span>));</div><div class="line">app.use(express.static(<span class="string">'files'</span>));</div></pre></td></tr></table></figure>
<p>要为 express.static 函数提供的文件创建虚拟路径前缀（路径并不实际存在于文件系统中），请为静态目录指定安装路径，如下所示:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="string">'/static'</span>, express.static(<span class="string">'public'</span>));</div><div class="line"><span class="comment">// 推荐使用绝对路径</span></div><div class="line">app.use(<span class="string">'/static'</span>, express.static(__dirname + <span class="string">'/public'</span>));</div><div class="line"></div><div class="line"><span class="comment">// result</span></div><div class="line">http:<span class="comment">//localhost:3000/static/css/style.css</span></div></pre></td></tr></table></figure>
<h4 id="处理错误页面"><a href="#处理错误页面" class="headerlink" title="处理错误页面"></a>处理错误页面</h4><p>设置404</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  res.status(<span class="number">404</span>).send(<span class="string">'Sorry cant find that!'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>设置500</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.error(err.stack);</div><div class="line">  res.status(<span class="number">500</span>).send(<span class="string">'Something broke!'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Express初步01-了解架构"><span class="toc-number">1.</span> <span class="toc-text">Express初步01 - 了解架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-安装"><span class="toc-number">1.1.</span> <span class="toc-text">Express 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-组成部分"><span class="toc-number">1.2.</span> <span class="toc-text">Express 组成部分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#application对象"><span class="toc-number">1.2.1.</span> <span class="toc-text">application对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#request对象"><span class="toc-number">1.2.2.</span> <span class="toc-text">request对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#response对象"><span class="toc-number">1.2.3.</span> <span class="toc-text">response对象</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express-目录结构"><span class="toc-number">1.3.</span> <span class="toc-text">Express 目录结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#定义路由"><span class="toc-number">1.3.1.</span> <span class="toc-text">定义路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分发路由-加载中间件"><span class="toc-number">1.3.2.</span> <span class="toc-text">分发路由,加载中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#view层"><span class="toc-number">1.3.3.</span> <span class="toc-text">view层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#资源文件"><span class="toc-number">1.3.4.</span> <span class="toc-text">资源文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#处理错误页面"><span class="toc-number">1.3.5.</span> <span class="toc-text">处理错误页面</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&text=Express初步01-了解架构"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&title=Express初步01-了解架构"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&is_video=false&description=Express初步01-了解架构"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Express初步01-了解架构&body=Check out this article: http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&title=Express初步01-了解架构"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&title=Express初步01-了解架构"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&title=Express初步01-了解架构"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&title=Express初步01-了解架构"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://ecmadao.com/2017/01/13/Notes/NodeJS/Express/Express初步01-了解架构/&name=Express初步01-了解架构&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 ecmadao
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    <script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'ecmadao-blog';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


</body>
</html>
