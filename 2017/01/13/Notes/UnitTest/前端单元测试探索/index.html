<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Table of Contents  generated with DocToc

前端单元测试探索
Intro
TDD(Test-driven development)
IMPORTANT
大致过程


BDD(Behavior-driven development)
测试的分类 &amp;amp; 测试工具
分类
工具


mocha + chai的API/Func UnitTest
initia">
<meta property="og:type" content="article">
<meta property="og:title" content="前端单元测试探索">
<meta property="og:url" content="http://ecmadao.com/2017/01/13/Notes/UnitTest/前端单元测试探索/index.html">
<meta property="og:site_name" content="ecmadao">
<meta property="og:description" content="Table of Contents  generated with DocToc

前端单元测试探索
Intro
TDD(Test-driven development)
IMPORTANT
大致过程


BDD(Behavior-driven development)
测试的分类 &amp;amp; 测试工具
分类
工具


mocha + chai的API/Func UnitTest
initia">
<meta property="og:updated_time" content="2017-01-14T13:18:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="前端单元测试探索">
<meta name="twitter:description" content="Table of Contents  generated with DocToc

前端单元测试探索
Intro
TDD(Test-driven development)
IMPORTANT
大致过程


BDD(Behavior-driven development)
测试的分类 &amp;amp; 测试工具
分类
工具


mocha + chai的API/Func UnitTest
initia">
    
    
        
          
              <link rel="shortcut icon" href="/Coding-Guide/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/Coding-Guide/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/Coding-Guide/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>前端单元测试探索</title>
    <!-- styles -->
    <link rel="stylesheet" href="/Coding-Guide/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/Coding-Guide/lib/meslo-LG/styles.css">
    <link rel="stylesheet" href="/Coding-Guide/lib/justified-gallery/justifiedGallery.min.css">
    <link rel="stylesheet" href="/Coding-Guide/css/style.css">
    <!-- rss -->
    
    
    <!-- jquery -->
    <script src="/Coding-Guide/lib/jquery/jquery.min.js"></script>
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/Coding-Guide/">Home</a></li>
         
          <li><a href="/Coding-Guide/about/">About</a></li>
         
          <li><a href="/Coding-Guide/archives/">Articles</a></li>
         
          <li><a href="http://github.com/ecmadao">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/Coding-Guide/2017/01/13/Notes/UnitTest/Selenium可视化测试(with python)/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/Coding-Guide/2017/01/13/Notes/ember/Ember初步--Controller/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&text=前端单元测试探索"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&title=前端单元测试探索"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&is_video=false&description=前端单元测试探索"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=前端单元测试探索&body=Check out this article: http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&title=前端单元测试探索"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&title=前端单元测试探索"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&title=前端单元测试探索"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&title=前端单元测试探索"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&name=前端单元测试探索&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前端单元测试探索"><span class="toc-number">1.</span> <span class="toc-text">前端单元测试探索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Intro"><span class="toc-number">1.1.</span> <span class="toc-text">Intro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TDD-Test-driven-development"><span class="toc-number">1.2.</span> <span class="toc-text">TDD(Test-driven development)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IMPORTANT"><span class="toc-number">1.2.1.</span> <span class="toc-text">IMPORTANT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#大致过程"><span class="toc-number">1.2.2.</span> <span class="toc-text">大致过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BDD-Behavior-driven-development"><span class="toc-number">1.3.</span> <span class="toc-text">BDD(Behavior-driven development)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试的分类-amp-测试工具"><span class="toc-number">1.4.</span> <span class="toc-text">测试的分类 & 测试工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分类"><span class="toc-number">1.4.1.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#工具"><span class="toc-number">1.4.2.</span> <span class="toc-text">工具</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mocha-chai的API-Func-UnitTest"><span class="toc-number">1.5.</span> <span class="toc-text">mocha + chai的API/Func UnitTest</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#initial"><span class="toc-number">1.5.1.</span> <span class="toc-text">initial</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#setup"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">setup</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Use-with-es6"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">Use with es6</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Use-with-coffeescript"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">Use with coffeescript</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Use-with-es6-coffeescript"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">Use with es6+coffeescript</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chai"><span class="toc-number">1.5.2.</span> <span class="toc-text">chai</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Test"><span class="toc-number">1.5.3.</span> <span class="toc-text">Test</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AsynTest"><span class="toc-number">1.5.4.</span> <span class="toc-text">AsynTest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mock"><span class="toc-number">1.5.5.</span> <span class="toc-text">mock</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React单元测试"><span class="toc-number">1.6.</span> <span class="toc-text">React单元测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-React-Component"><span class="toc-number">1.6.1.</span> <span class="toc-text">Test React Component</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-Redux"><span class="toc-number">1.6.2.</span> <span class="toc-text">Test Redux</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于phantomjs和selenium的UI-UnitTest"><span class="toc-number">1.7.</span> <span class="toc-text">基于phantomjs和selenium的UI UnitTest</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        前端单元测试探索
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">ecmadao</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-01-13T05:58:37.000Z" itemprop="datePublished">2017-01-13</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/Coding-Guide/tags/UnitTest/">UnitTest</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#%E5%89%8D%E7%AB%AF%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%8E%A2%E7%B4%A2">前端单元测试探索</a><ul>
<li><a href="#intro">Intro</a></li>
<li><a href="#tddtest-driven-development">TDD(Test-driven development)</a><ul>
<li><a href="#important">IMPORTANT</a></li>
<li><a href="#%E5%A4%A7%E8%87%B4%E8%BF%87%E7%A8%8B">大致过程</a></li>
</ul>
</li>
<li><a href="#bddbehavior-driven-development">BDD(Behavior-driven development)</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95%E7%9A%84%E5%88%86%E7%B1%BB-&amp;-%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7">测试的分类 &amp; 测试工具</a><ul>
<li><a href="#%E5%88%86%E7%B1%BB">分类</a></li>
<li><a href="#%E5%B7%A5%E5%85%B7">工具</a></li>
</ul>
</li>
<li><a href="#mocha--chai%E7%9A%84apifunc-unittest">mocha + chai的API/Func UnitTest</a><ul>
<li><a href="#initial">initial</a><ul>
<li><a href="#setup">setup</a></li>
<li><a href="#use-with-es6">Use with es6</a></li>
<li><a href="#use-with-coffeescript">Use with coffeescript</a></li>
<li><a href="#use-with-es6coffeescript">Use with es6+coffeescript</a></li>
</ul>
</li>
<li><a href="#chai">chai</a></li>
<li><a href="#test">Test</a></li>
<li><a href="#asyntest">AsynTest</a></li>
<li><a href="#mock">mock</a></li>
</ul>
</li>
<li><a href="#react%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">React单元测试</a><ul>
<li><a href="#test-react-component">Test React Component</a></li>
<li><a href="#test-redux">Test Redux</a></li>
</ul>
</li>
<li><a href="#%E5%9F%BA%E4%BA%8Ephantomjs%E5%92%8Cselenium%E7%9A%84ui-unittest">基于phantomjs和selenium的UI UnitTest</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="前端单元测试探索"><a href="#前端单元测试探索" class="headerlink" title="前端单元测试探索"></a>前端单元测试探索</h2><p>虽然很多公司有自己的测试部门，而且前端开发大多不涉及测试环节，但鉴于目前前端领域的快速发展，其涉及面越来越广，前端开发者们必然不能止步于目前的状态。我觉得学会编写良好的测试，不仅仅有利于自己整理需求、检查代码，更是一个优秀开发者的体现。</p>
<p>首先不得不推荐两篇文章：</p>
<blockquote>
<p><a href="http://fex.baidu.com/blog/2015/07/front-end-test/" target="_blank" rel="external">前端自动化测试探索</a></p>
<p><a href="http://blog.jobbole.com/64431/" target="_blank" rel="external">测试驱动开发（TDD）介绍中的误区</a></p>
</blockquote>
<h3 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h3><p><strong>单元测试到底是什么？</strong></p>
<blockquote>
<p>需要访问数据库的测试不是单元测试</p>
<p>需要访问网络的测试不是单元测试</p>
<p>需要访问文件系统的测试不是单元测试</p>
<p>— 修改代码的艺术</p>
</blockquote>
<p><strong>我们在单元测试中应该避免什么？</strong></p>
<ul>
<li>太多的条件逻辑</li>
<li>构造函数中做了太多事情</li>
<li>too many全局变量</li>
<li>too many静态方法</li>
<li>无关逻辑</li>
<li>过多外部依赖</li>
</ul>
<h3 id="TDD-Test-driven-development"><a href="#TDD-Test-driven-development" class="headerlink" title="TDD(Test-driven development)"></a>TDD(Test-driven development)</h3><p>测试驱动开发（TDD），其基本思路是通过测试来推动整个开发的进行。</p>
<ul>
<li><strong>单元测试的首要目的不是为了能够编写出大覆盖率的全部通过的测试代码，而是需要从使用者(调用者)的角度出发，尝试函数逻辑的各种可能性，进而辅助性增强代码质量</strong></li>
<li>测试是手段而不是目的。测试的主要目的不是证明代码正确，而是帮助发现错误，包括低级的错误</li>
<li>测试要快。快速运行、快速编写</li>
<li>测试代码保持简洁</li>
<li>不会忽略失败的测试。一旦团队开始接受1个测试的构建失败，那么他们渐渐地适应2、3、4或者更多的失败。在这种情况下，测试集就不再起作用</li>
</ul>
<h4 id="IMPORTANT"><a href="#IMPORTANT" class="headerlink" title="IMPORTANT"></a>IMPORTANT</h4><ul>
<li>一定不能误解了TDD的核心目的！</li>
<li>测试不是为了覆盖率和正确率</li>
<li>而是作为实例，告诉开发人员要编写什么代码</li>
<li>红灯（代码还不完善，测试挂）-&gt; 绿灯（编写代码，测试通过）-&gt; 重构（优化代码并保证测试通过）</li>
</ul>
<h4 id="大致过程"><a href="#大致过程" class="headerlink" title="大致过程"></a>大致过程</h4><ol>
<li>需求分析，思考实现。考虑如何“使用”产品代码，是一个实例方法还是一个类方法，是从构造函数传参还是从方法调用传参，方法的命名，返回值等。这时其实就是在做设计，而且设计以代码来体现。此时测试为红</li>
<li>实现代码让测试为绿</li>
<li>重构，然后重复测试</li>
<li>最终符合所有要求：<ul>
<li>每个概念都被清晰的表达</li>
<li>Not Repeat Self</li>
<li>没有多余的东西</li>
<li>通过测试</li>
</ul>
</li>
</ol>
<h3 id="BDD-Behavior-driven-development"><a href="#BDD-Behavior-driven-development" class="headerlink" title="BDD(Behavior-driven development)"></a>BDD(Behavior-driven development)</h3><p>行为驱动开发（BDD），重点是通过与利益相关者的讨论，取得对预期的软件行为的清醒认识，其<strong>重点在于沟通</strong></p>
<p><strong>大致过程</strong></p>
<ol>
<li>从业务的角度定义具体的，以及可衡量的目标</li>
<li>找到一种可以达到设定目标的、对业务最重要的那些功能的方法</li>
<li>然后像故事一样描述出一个个具体可执行的行为。其描述方法基于一些通用词汇，这些词汇具有准确无误的表达能力和一致的含义。例如，<code>expect</code>, <code>should</code>, <code>assert</code></li>
<li>寻找合适语言及方法，对行为进行实现</li>
<li>测试人员检验产品运行结果是否符合预期行为。最大程度的交付出符合用户期望的产品，避免表达不一致带来的问题</li>
</ol>
<h3 id="测试的分类-amp-测试工具"><a href="#测试的分类-amp-测试工具" class="headerlink" title="测试的分类 &amp; 测试工具"></a>测试的分类 &amp; 测试工具</h3><h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><ul>
<li>API/Func UnitTest<ul>
<li>测试不常变化的函数逻辑</li>
<li>测试前后端API接口</li>
</ul>
</li>
<li>UI UnitTest<ul>
<li>页面自动截图</li>
<li>页面DOM元素检查</li>
<li>跑通交互流程</li>
</ul>
</li>
</ul>
<h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><ul>
<li><a href="http://mochajs.org/" target="_blank" rel="external">Mocha</a> + <a href="http://chaijs.com/" target="_blank" rel="external">Chai</a></li>
<li><a href="http://phantomjs.org/" target="_blank" rel="external">PhantomJS</a> or <a href="http://casperjs.org/" target="_blank" rel="external">CasperJS</a> or <a href="http://nightwatchjs.org/" target="_blank" rel="external">Nightwatch.js</a></li>
<li><a href="https://github.com/SeleniumHQ/selenium" target="_blank" rel="external">selenium</a><ul>
<li><a href="http://seleniumhq.github.io/selenium/docs/api/py/" target="_blank" rel="external">with python</a></li>
<li><a href="http://seleniumhq.github.io/selenium/docs/api/javascript/" target="_blank" rel="external">with js</a></li>
</ul>
</li>
</ul>
<h3 id="mocha-chai的API-Func-UnitTest"><a href="#mocha-chai的API-Func-UnitTest" class="headerlink" title="mocha + chai的API/Func UnitTest"></a><a href="http://mochajs.org/" target="_blank" rel="external">mocha</a> + <a href="http://chaijs.com/" target="_blank" rel="external">chai</a>的API/Func UnitTest</h3><blockquote>
<p>mocha是一套前端测试工具，我们可以拿它和其他测试工具搭配。</p>
<p>而chai则是BDD/TDD测试断言库，提供诸如expect这样的测试语法</p>
</blockquote>
<h4 id="initial"><a href="#initial" class="headerlink" title="initial"></a>initial</h4><p>下面两篇文章值得一看：</p>
<blockquote>
<p><a href="http://jamesknelson.com/testing-in-es6-with-mocha-and-babel-6/" target="_blank" rel="external">Testing in ES6 with Mocha and Babel 6</a></p>
<p><a href="https://babeljs.io/docs/setup/#installation" target="_blank" rel="external">Using Babel</a></p>
</blockquote>
<h5 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm i mocha --save-dev</div><div class="line">$ npm i chai --save-dev</div></pre></td></tr></table></figure>
<h5 id="Use-with-es6"><a href="#Use-with-es6" class="headerlink" title="Use with es6"></a>Use with es6</h5><p><em>babel 6+</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm install --save-dev babel-register</div><div class="line">$ npm install babel-preset-es2015 --save-dev</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// package.json</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"test"</span>: <span class="string">"./node_modules/mocha/bin/mocha --compilers js:babel-register"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"babel"</span>: &#123;</div><div class="line">    <span class="string">"presets"</span>: [</div><div class="line">      <span class="string">"es2015"</span></div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><em>babel 5+</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install --save-dev babel-core</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// package.json</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"test"</span>: <span class="string">"./node_modules/mocha/bin/mocha --compilers js:babel-core/register"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Use-with-coffeescript"><a href="#Use-with-coffeescript" class="headerlink" title="Use with coffeescript"></a>Use with coffeescript</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install --save coffee-script</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"test"</span>: <span class="string">"./node_modules/mocha/bin/mocha --compilers coffee:coffee-script/register"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Use-with-es6-coffeescript"><a href="#Use-with-es6-coffeescript" class="headerlink" title="Use with es6+coffeescript"></a>Use with es6+coffeescript</h5><p>After done both…</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"test"</span>: <span class="string">"./node_modules/mocha/bin/mocha --compilers js:babel-core/register,coffee:coffee-script/register"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># $ mocha</span></div><div class="line">$ npm t</div><div class="line">$ npm <span class="built_in">test</span></div></pre></td></tr></table></figure>
<h4 id="chai"><a href="#chai" class="headerlink" title="chai"></a>chai</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> chai <span class="keyword">from</span> <span class="string">'chai'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> assert = chai.assert;</div><div class="line"><span class="keyword">const</span> expect = chai.expect;</div><div class="line"><span class="keyword">const</span> should = chai.should();</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">foo.should.be.a(<span class="string">'string'</span>);</div><div class="line">foo.should.equal(<span class="string">'bar'</span>);</div><div class="line">list.should.have.length(<span class="number">3</span>);</div><div class="line">obj.should.have.property(<span class="string">'name'</span>);</div><div class="line"></div><div class="line">expect(foo).to.be.a(<span class="string">'string'</span>);</div><div class="line">expect(foo).to.equal(<span class="string">'bar'</span>);</div><div class="line">expect(list).to.have.length(<span class="number">3</span>);</div><div class="line">expect(obj).to.have.property(<span class="string">'flavors'</span>);</div><div class="line"></div><div class="line">assert.typeOf(foo, <span class="string">'string'</span>);</div><div class="line">assert.equal(foo, <span class="string">'bar'</span>);</div><div class="line">assert.lengthOf(list, <span class="number">3</span>);</div><div class="line">assert.property(obj, <span class="string">'flavors'</span>);</div></pre></td></tr></table></figure>
<h4 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h4><p>测试的一个基本思路是，自身从函数的调用者出发，对函数进行各种情况的调用，查看其容错程度、返回结果是否符合预期。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> chai <span class="keyword">from</span> <span class="string">'chai'</span>;</div><div class="line"><span class="keyword">const</span> assert = chai.assert;</div><div class="line"><span class="keyword">const</span> expect = chai.expect;</div><div class="line"><span class="keyword">const</span> should = chai.should();</div><div class="line"></div><div class="line">describe(<span class="string">'describe a test'</span>, () =&gt; &#123;</div><div class="line"></div><div class="line">  it(<span class="string">'should return true'</span>, () =&gt; &#123;</div><div class="line">  	<span class="keyword">let</span> example = <span class="literal">true</span>;</div><div class="line">  	<span class="comment">// expect</span></div><div class="line">  	expect(example).not.to.equal(<span class="literal">false</span>);</div><div class="line">  	expect(example).to.equal(<span class="literal">true</span>);</div><div class="line">  	<span class="comment">// should</span></div><div class="line">  	example.should.equal(<span class="literal">true</span>);</div><div class="line">  	example.should.be.a(boolen);</div><div class="line">  	[<span class="number">1</span>, <span class="number">2</span>].should.have.length(<span class="number">2</span>);</div><div class="line">  &#125;);</div><div class="line">  </div><div class="line">  it(<span class="string">'should check an object'</span>, () =&gt; &#123;</div><div class="line">    <span class="comment">// 对于多层嵌套的Object而言..</span></div><div class="line">    <span class="keyword">let</span> nestedObj = &#123;</div><div class="line">  	  <span class="attr">a</span>: &#123;</div><div class="line">  	    <span class="attr">b</span>: <span class="number">1</span></div><div class="line">	  &#125;</div><div class="line">	&#125;;</div><div class="line">	<span class="keyword">let</span> nestedObjCopy = <span class="built_in">Object</span>.assign(&#123;&#125;, nestedObj);</div><div class="line">	nestedObj.a.b = <span class="number">2</span>;</div><div class="line">	</div><div class="line">	<span class="comment">// do a function to change nestedObjCopy.a.b </span></div><div class="line">	expect(nestedObjCopy).to.deep.equal(nestedObj);</div><div class="line">	expect(nestedObjCopy).to.have.property(<span class="string">'a'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="AsynTest"><a href="#AsynTest" class="headerlink" title="AsynTest"></a>AsynTest</h4><p><a href="http://staxmanade.com/2015/11/testing-asyncronous-code-with-mochajs-and-es7-async-await/" target="_blank" rel="external">Testing Asynchronous Code with MochaJS and ES7 async/await</a></p>
<p>mocha无法自动监听异步方法的完成，需要我们在完成之后手动调用<code>done()</code>方法</p>
<p>而如果要在回调之后使用异步测试语句，则需要使用<code>try/catch</code>进行捕获。成功则<code>done()</code>，失败则<code>done(error)</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 普通的测试方法</span></div><div class="line">it(<span class="string">"should work"</span>, () =&gt;&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"Synchronous test"</span>);</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 异步的测试方法</span></div><div class="line">it(<span class="string">"should work"</span>, (done) =&gt;&#123;</div><div class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">  	  expect(<span class="number">1</span>).not.to.equal(<span class="number">0</span>);</div><div class="line">  	  done(); <span class="comment">// 成功</span></div><div class="line">	&#125; <span class="keyword">catch</span> (err) &#123;</div><div class="line">  	  done(err); <span class="comment">// 失败</span></div><div class="line">	&#125;</div><div class="line">  &#125;, <span class="number">200</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>异步测试有两种方法完结：<code>done</code>或者返回<code>Promise</code>。而通过返回<code>Promise</code>，则不再需要编写笨重的<code>try/catch</code>语句</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">it(<span class="string">"Using a Promise that resolves successfully with wrong expectation!"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> testPromise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            resolve(<span class="string">"Hello World!"</span>);</div><div class="line">        &#125;, <span class="number">200</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> testPromise.then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">        expect(result).to.equal(<span class="string">"Hello!"</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="mock"><a href="#mock" class="headerlink" title="mock"></a><a href="https://github.com/node-nock/nock" target="_blank" rel="external">mock</a></h4><blockquote>
<p>mock是一个接口模拟库，我们可以通过它来模拟代码中的一些异步操作</p>
</blockquote>
<h3 id="React单元测试"><a href="#React单元测试" class="headerlink" title="React单元测试"></a>React单元测试</h3><h4 id="Test-React-Component"><a href="#Test-React-Component" class="headerlink" title="Test React Component"></a>Test React Component</h4><p>React组件无法直接通过上述方法进行测试，需要安装<a href="https://github.com/airbnb/enzyme" target="_blank" rel="external">enzyme</a>依赖。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ npm i --save-dev enzyme</div><div class="line"><span class="comment">#</span></div><div class="line">$ npm i --save-dev react-addons-test-utils</div></pre></td></tr></table></figure>
<p>假设有这样一个组件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ...省略部分import代码</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(props) &#123;</div><div class="line">    <span class="keyword">super</span>(props);</div><div class="line">    <span class="keyword">let</span> &#123;num&#125; = props;</div><div class="line">    <span class="keyword">this</span>.state = &#123;</div><div class="line">      <span class="attr">clickNum</span>: num</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">this</span>.handleClick = <span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  handleClick() &#123;</div><div class="line">    <span class="keyword">let</span> &#123;clickNum&#125; = <span class="keyword">this</span>.state;</div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">      <span class="attr">clickNum</span>: clickNum + <span class="number">1</span></div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">let</span> &#123;clickNum&#125; = <span class="keyword">this</span>.state;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"test_component"</span>&gt;</span></span></div><div class="line">        &#123;clickNum&#125;</div><div class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>点我加1<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用样例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123;expect&#125; <span class="keyword">from</span> <span class="string">'chai'</span>;</div><div class="line"><span class="keyword">import</span> &#123;shallow&#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> TestComponent <span class="keyword">from</span> <span class="string">'../components/TestComponent'</span>;</div><div class="line"></div><div class="line">describe(<span class="string">'Test TestComponent'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// 创建一个虚拟的组件</span></div><div class="line">  <span class="keyword">const</span> wrapper = shallow(</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">TestComponent</span> <span class="attr">num</span>=<span class="string">&#123;10&#125;</span> /&gt;</span>/</span></div><div class="line">  );</div><div class="line"></div><div class="line">  /* </div><div class="line">  * 之后，我们可以:</div><div class="line">  * 通过wrapper.state()拿到组件的state</div><div class="line">  * 通过wrapper.instance()拿到组件实例，以此调用组件内的方法</div><div class="line">  * 通过wrapper.find()找到组件内的子组件</div><div class="line">  * 但是，无法通过wrapper.props()拿到组件的props</div><div class="line">  */</div><div class="line"></div><div class="line">  // 测试该组件组外层的class</div><div class="line">  it('should render with currect wrapper', () =&gt; &#123;</div><div class="line">    expect(wrapper.is('.test_component')).to.equal(true);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  // 测试该组件初始化的state</div><div class="line">  it('should render with currect state', () =&gt; &#123;</div><div class="line">    expect(wrapper.state()).to.deep.equal(&#123;</div><div class="line">      clickNum: 10</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  // 测试组件的方法</div><div class="line">  it('should add one', () =&gt; &#123;</div><div class="line">    wrapper.instance().handleClick();</div><div class="line">    expect(wrapper.state()).to.deep.equal(&#123;</div><div class="line">      clickNum: 11</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="Test-Redux"><a href="#Test-Redux" class="headerlink" title="Test Redux"></a>Test Redux</h4><p>redux身为纯函数，非常便于mocha进行测试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 测试actions</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ACTIONS <span class="keyword">from</span> <span class="string">'../redux/actions'</span>;</div><div class="line"></div><div class="line">describe(<span class="string">'test actions'</span>, () =&gt; &#123;</div><div class="line">  it(<span class="string">'should return an action to create a todo'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">let</span> expectedAction = &#123;</div><div class="line">  	  <span class="attr">type</span>: ACTIONS.NEW_TODO,</div><div class="line">  	  <span class="attr">todo</span>: <span class="string">'this is a new todo'</span></div><div class="line">    &#125;;</div><div class="line">	 expect(ACTIONS.addNewTodo(<span class="string">'this is a new todo'</span>)).to.deep.equal(expectedAction);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 测试reducer</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> REDUCERS <span class="keyword">from</span> <span class="string">'../redux/reducers'</span>;</div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ACTIONS <span class="keyword">from</span> <span class="string">'../redux/actions'</span>;</div><div class="line"></div><div class="line">describe(<span class="string">'todos'</span>, () =&gt; &#123;</div><div class="line">  <span class="keyword">let</span> todos = [];</div><div class="line">  it(<span class="string">'should add a new todo'</span>, () =&gt; &#123;</div><div class="line">  	todos.push(&#123;</div><div class="line">  	  <span class="attr">todo</span>: <span class="string">'new todo'</span>,</div><div class="line">  	  <span class="attr">complete</span>: <span class="literal">false</span></div><div class="line">    &#125;);</div><div class="line">    expect(REDUCERS.todos(todos, &#123;</div><div class="line">  	  <span class="attr">type</span>: ACTIONS.NEW_TODO,</div><div class="line">  	  <span class="attr">todo</span>: <span class="string">'new todo'</span></div><div class="line">    &#125;)).to.deep.equal([</div><div class="line">      &#123;</div><div class="line">  	    <span class="attr">todo</span>: <span class="string">'new todo'</span>,</div><div class="line">  	    <span class="attr">complete</span>: <span class="literal">false</span></div><div class="line">      &#125;</div><div class="line">    ]);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 还可以和store混用</span></div><div class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware, combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</div><div class="line"><span class="keyword">import</span> chai <span class="keyword">from</span> <span class="string">'chai'</span>;</div><div class="line"><span class="keyword">import</span> thunkMiddleware <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> REDUCERS <span class="keyword">from</span> <span class="string">'../redux/reducers'</span>;</div><div class="line"><span class="keyword">import</span> defaultState <span class="keyword">from</span> <span class="string">'../redux/ConstValues'</span>;</div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ACTIONS <span class="keyword">from</span> <span class="string">'../redux/actions'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> appReducers = combineReducers(REDUCERS);</div><div class="line"><span class="keyword">const</span> AppStore = createStore(appReducers, defaultState， applyMiddleware(thunk));</div><div class="line"><span class="keyword">let</span> state = <span class="built_in">Object</span>.assign(&#123;&#125;, AppStore.getState());</div><div class="line"></div><div class="line"><span class="comment">// 一旦注册就会时刻监听state变化</span></div><div class="line"><span class="keyword">const</span> subscribeListener = <span class="function">(<span class="params">result, done</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> AppStore.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    expect(AppStore.getState()).to.deep.equal(result);</div><div class="line">    done();</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">describe(<span class="string">'use store in unittest'</span>， () =&gt; &#123;</div><div class="line">  it(<span class="string">'should create a todo'</span>, (done) =&gt; &#123;</div><div class="line">    <span class="comment">// 首先取得我们的期望值</span></div><div class="line">  	state.todos.append(&#123;</div><div class="line">  	  <span class="attr">todo</span>: <span class="string">'new todo'</span>,</div><div class="line">  	  <span class="attr">complete</span>: <span class="literal">false</span></div><div class="line">	&#125;);</div><div class="line">	</div><div class="line">	<span class="comment">// 注册state监听</span></div><div class="line">	<span class="keyword">let</span> unsubscribe = subscribeListener(state, done);</div><div class="line">	AppStore.dispatch(ACTIONS.addNewTodo(<span class="string">'new todo'</span>));</div><div class="line">	<span class="comment">// 结束之后取消监听</span></div><div class="line">	unsubscribe();</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="基于phantomjs和selenium的UI-UnitTest"><a href="#基于phantomjs和selenium的UI-UnitTest" class="headerlink" title="基于phantomjs和selenium的UI UnitTest"></a>基于<a href="http://phantomjs.org/" target="_blank" rel="external">phantomjs</a>和<a href="https://github.com/SeleniumHQ/selenium" target="_blank" rel="external">selenium</a>的UI UnitTest</h3><p><code>PhantomJS</code>是一个基于webkit的服务器端JavaScript API，即相当于在内存中跑了个无界面的webkit内核的浏览器。通过它我们可以模拟页面加载，并获取到页面上的DOM元素，进行一系列的操作，以此来模拟UI测试。但缺点是无法实时看见页面上的情况（不过可以截图）。</p>
<p>而<code>Selenium</code>是专门为Web应用程序编写的一个验收测试工具，它直接运行在浏览器中。<code>Selenium</code>测试通常会调起一个可见的界面，但也可以通过设置，让它以<code>PhantomJS</code>的形式进行无界面的测试。</p>
<ul>
<li>open 某个 url</li>
<li>监听 onload 事件</li>
<li>事件完成后调用 sendEvent 之类的 api 去点击某个 DOM 元素所在 point</li>
<li>触发交互</li>
<li>根据 UI 交互情况 延时 setTimeout （规避惰加载组件点不到的情况）继续 sendEvent 之类的交互</li>
</ul>
<blockquote>
<p><a href="http://bites.goodeggs.com/posts/selenium-webdriver-nodejs-tutorial/" target="_blank" rel="external">Getting started with Selenium Webdriver for node.js</a></p>
</blockquote>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/Coding-Guide/">Home</a></li>
         
          <li><a href="/Coding-Guide/about/">About</a></li>
         
          <li><a href="/Coding-Guide/archives/">Articles</a></li>
         
          <li><a href="http://github.com/ecmadao">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前端单元测试探索"><span class="toc-number">1.</span> <span class="toc-text">前端单元测试探索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Intro"><span class="toc-number">1.1.</span> <span class="toc-text">Intro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TDD-Test-driven-development"><span class="toc-number">1.2.</span> <span class="toc-text">TDD(Test-driven development)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IMPORTANT"><span class="toc-number">1.2.1.</span> <span class="toc-text">IMPORTANT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#大致过程"><span class="toc-number">1.2.2.</span> <span class="toc-text">大致过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BDD-Behavior-driven-development"><span class="toc-number">1.3.</span> <span class="toc-text">BDD(Behavior-driven development)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试的分类-amp-测试工具"><span class="toc-number">1.4.</span> <span class="toc-text">测试的分类 & 测试工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#分类"><span class="toc-number">1.4.1.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#工具"><span class="toc-number">1.4.2.</span> <span class="toc-text">工具</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mocha-chai的API-Func-UnitTest"><span class="toc-number">1.5.</span> <span class="toc-text">mocha + chai的API/Func UnitTest</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#initial"><span class="toc-number">1.5.1.</span> <span class="toc-text">initial</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#setup"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">setup</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Use-with-es6"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">Use with es6</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Use-with-coffeescript"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">Use with coffeescript</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Use-with-es6-coffeescript"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">Use with es6+coffeescript</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chai"><span class="toc-number">1.5.2.</span> <span class="toc-text">chai</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Test"><span class="toc-number">1.5.3.</span> <span class="toc-text">Test</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AsynTest"><span class="toc-number">1.5.4.</span> <span class="toc-text">AsynTest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mock"><span class="toc-number">1.5.5.</span> <span class="toc-text">mock</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React单元测试"><span class="toc-number">1.6.</span> <span class="toc-text">React单元测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-React-Component"><span class="toc-number">1.6.1.</span> <span class="toc-text">Test React Component</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Test-Redux"><span class="toc-number">1.6.2.</span> <span class="toc-text">Test Redux</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于phantomjs和selenium的UI-UnitTest"><span class="toc-number">1.7.</span> <span class="toc-text">基于phantomjs和selenium的UI UnitTest</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&text=前端单元测试探索"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&title=前端单元测试探索"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&is_video=false&description=前端单元测试探索"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=前端单元测试探索&body=Check out this article: http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&title=前端单元测试探索"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&title=前端单元测试探索"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&title=前端单元测试探索"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&title=前端单元测试探索"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://ecmadao.com/Coding-Guide/2017/01/13/Notes/UnitTest/前端单元测试探索/&name=前端单元测试探索&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 ecmadao
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/Coding-Guide/">Home</a></li>
         
          <li><a href="/Coding-Guide/about/">About</a></li>
         
          <li><a href="/Coding-Guide/archives/">Articles</a></li>
         
          <li><a href="http://github.com/ecmadao">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    <script src="/Coding-Guide/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/Coding-Guide/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'ecmadao-blog';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


</body>
</html>
