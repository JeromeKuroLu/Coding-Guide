<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ecmadao</title>
  
  <link href="/Coding-Guide/atom.xml" rel="self"/>
  
  <link href="http://ecmadao.com/"/>
  <updated>2017-01-14T12:11:43.000Z</updated>
  <id>http://ecmadao.com/</id>
  
  <author>
    <name>ecmadao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>【译文】用Webpack武装自己</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/%E8%AF%91%E6%96%87/%E3%80%90%E8%AF%91%E6%96%87%E3%80%91%E7%94%A8Webpack%E6%AD%A6%E8%A3%85%E8%87%AA%E5%B7%B1/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/译文/【译文】用Webpack武装自己/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#%E3%80%90%E8%AF%91%E6%96%87%E3%80%91%E7%94%A8webpack%E6%AD%A6%E8%A3%85%E8%87%AA%E5%B7%B1">【译文】用Webpack武装自己</a><ul>
<li><a href="#webpack%E6%98%AF%E5%95%A5">Webpack是啥?</a></li>
<li><a href="#%E7%A9%B6%E7%AB%9F%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%BF%99%E4%B9%88%E5%81%9A%EF%BC%9F">究竟为什么要这么做？</a></li>
<li><a href="#%E6%9D%A5%E8%AE%A9%E6%88%91%E4%BB%AC%E4%B8%80%E8%B5%B7%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84app">来让我们一起构建一个简单的App</a><ul>
<li><a href="#%E5%9F%BA%E7%A1%80%E6%8C%87%E5%BC%95%EF%BC%88setup%EF%BC%89">基础指引（setup）</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE%E7%AC%AC%E4%B8%80%E4%B8%AAloader%EF%BC%88loader-01%EF%BC%89">设置第一个loader（<code>loader</code>-01）</a></li>
<li><a href="#%E5%86%99%E4%B8%AA%E5%B0%8F%E7%BB%84%E4%BB%B6%EF%BC%88loader-02%EF%BC%89">写个小组件（<code>loader</code>-02）</a></li>
</ul>
</li>
<li><a href="#%E4%BB%A3%E7%A0%81%E5%88%86%E7%A6%BB%EF%BC%88requireensure%EF%BC%89">代码分离（<code>require.ensure</code>）</a></li>
<li><a href="#%E5%86%8D%E5%8A%A0%E4%B8%AA%E7%BB%84%E4%BB%B6%EF%BC%88commonchunksplugin%EF%BC%89">再加个组件（<code>CommonChunksPlugin</code>）</a></li>
<li><a href="#%E9%A3%9E%E8%B7%83%E5%88%B0%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%EF%BC%88production%EF%BC%89">飞跃到生产环境（<code>production</code>）</a></li>
<li><a href="#%E6%8A%BD%E5%8F%96%EF%BC%88extract-text-webpack-plugin%EF%BC%89">抽取（<code>extract-text-webpack-plugin</code>）</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%9B%BE%E7%89%87%EF%BC%88url-loader&amp;file-loader%EF%BC%89">使用图片（<code>url-loader</code>&amp;<code>file-loader</code>）</a></li>
<li><a href="#%E6%9D%A5%E4%B8%AA%E7%89%9B%E9%80%BC%E7%9A%84%E7%83%AD%E5%8A%A0%E8%BD%BD%EF%BC%88dev-server%EF%BC%89">来个牛逼的热加载（dev-server）</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E4%B8%8D%E5%B9%B2%E5%87%80%E7%9A%84%E4%BA%BA%E9%83%BD%E7%BB%99%E6%88%91%E5%8E%BB%E7%BD%9A%E7%AB%99%EF%BC%81%EF%BC%88pre-loader-&amp;-lint">代码不干净的人都给我去罚站！（pre-loader &amp; lint)</a></li>
<li><a href="#%E8%BF%98%E6%B2%A1%E7%9C%8B%E5%A4%9F%EF%BC%9F">还没看够？</a></li>
<li><a href="#%E5%B0%B1%E5%85%88%E8%AE%B2%E5%88%B0%E8%BF%99%E5%84%BF%E5%90%A7">就先讲到这儿吧</a></li>
<li><a href="#%E8%B5%84%E6%BA%90">资源</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="【译文】用Webpack武装自己"><a href="#【译文】用Webpack武装自己" class="headerlink" title="【译文】用Webpack武装自己"></a>【译文】用Webpack武装自己</h2><blockquote>
<p>译自：<a href="https://blog.madewithlove.be/post/webpack-your-bags/" target="_blank" rel="external">Webpack your bags</a></p>
</blockquote>
<p><img src="/images/WebpackYourBags/what-is-webpack.png" alt="what-is-webpack"></p>
<p>你可能已经听说过这个酷酷的工具-Webpack。一些人称之为类似于Gulp的工具，还有一些人则认为它类似于Browserify。如果你还没接触过它，那很有可能会因此感到困惑。而Webpack的主页上则认为它是两者的结合，那或许更让你困惑了。</p>
<p>说实话，一开始的时候，“什么是Webpack”这个话题让我很心烦，也就没有继续研究下去了。直到后来，当我已经构建了几个项目后，才真心的为之痴迷。如果你像我一样紧随Javascript的发展步伐，你很有可能会因为太追随潮流跨度太大而蛋疼。在经历了上面这些之后，我写下这篇文章，以便更加细致的解释Webpack是什么，以及它如此重要的原因。</p>
<h3 id="Webpack是啥"><a href="#Webpack是啥" class="headerlink" title="Webpack是啥?"></a>Webpack是啥?</h3><p>首先来让我们回答最开始的问题：Webpack是个系统的构建工具，还是打包工具？答案是两者都是–这不代表它做了这两件事（先构建资源，在分别进行打包），而是说它将两者结合在一起了。</p>
<p>更加清晰的说明：与“构建sass文件，压缩图片，然后引用它们，再打包，再在页面上引用”相比，你只要这么做：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> stylesheet <span class="keyword">from</span> <span class="string">'styles/my-styles.scss'</span>;</div><div class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'img/my-logo.svg'</span>;</div><div class="line"><span class="keyword">import</span> someTemplate <span class="keyword">from</span> <span class="string">'html/some-template.html'</span>;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(stylesheet); <span class="comment">// "body&#123;font-size:12px&#125;"</span></div><div class="line"><span class="built_in">console</span>.log(logo); <span class="comment">// "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5[...]"</span></div><div class="line"><span class="built_in">console</span>.log(someTemplate) <span class="comment">// "&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span></div></pre></td></tr></table></figure>
<p>你的所有资源都被当做包处理，可以被import，修改，控制，最终展现在你最后的一个bundle上。</p>
<p>为了能让上面那些有效运转，你需要在自己的Webpage配置里配置<code>loader</code>。<code>loader</code>是一个“当程序遇见XXX类型文件的时候，就做YYY”的小型插件。来看一些<code>loader</code>的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="comment">// 如果引用了 .ts 文件, 将会触发 Typescript loader</span></div><div class="line">  test: <span class="regexp">/\.ts/</span>,</div><div class="line">  <span class="attr">loader</span>: <span class="string">'typescript'</span>,</div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">  <span class="comment">// 如果引用了png|jpg|svg图片,则会用 image-webpack 进行压缩 (wrapper around imagemin)</span></div><div class="line">  <span class="comment">// 并转化成 data64 URL 格式</span></div><div class="line">  test: <span class="regexp">/\.(png|jpg|svg)/</span>,</div><div class="line">  <span class="attr">loaders</span>: [<span class="string">'url'</span>, <span class="string">'image-webpack'</span>],</div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">  <span class="comment">// 如果使用了 SCSS files, 则会用 node-sass 解析, 最终返回CSS格式</span></div><div class="line">  test: <span class="regexp">/\.scss/</span>,</div><div class="line">  <span class="attr">loaders</span>: [<span class="string">'css'</span>, <span class="string">'autoprefixer'</span>, <span class="string">'sass'</span>],</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最终在食物链的最底端，所有的<code>loader</code>都返回<code>string</code>，这样Webpack就可以将它们加入到javascript模块中去。当你的Sass文件被loader转换之后，它的引用实际上是这样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">'body&#123;font-size:12px&#125;'</span>;</div></pre></td></tr></table></figure>
<p><img src="/images/WebpackYourBags/What-is-Webpack.gif" alt="What-is-Webpack"></p>
<h3 id="究竟为什么要这么做？"><a href="#究竟为什么要这么做？" class="headerlink" title="究竟为什么要这么做？"></a>究竟为什么要这么做？</h3><p>在你理解了Webpack是做什么的之后，第二个问题就接踵而至：使用它有什么好处？“把图片和CSS扔进我的js里？什么鬼？”其实在很久之前，为了减少HTTP request请求，我们都被教育要把所有东西写在一个文件里面。</p>
<p>到了现在，与之类似的是，很多人把所有东西打包进<code>app.js</code>。这两种方法都有一个很大的负面影响：很多时候人们在下载的是他们用不到的资源。但如果你不这么做吧，你就得手动的在每个页面引用相应的资源，最终会混乱成一坨：哪个页面已经引用了它所依赖的资源？</p>
<p>这些方法没有绝对的对错。把Webpage当做一个中间件–不仅仅是打包或构建工具，而是个聪明的模块打包系统。只要你设置正确，它会比你还要清楚使用的技术栈，并更好的优化它们。</p>
<h3 id="来让我们一起构建一个简单的App"><a href="#来让我们一起构建一个简单的App" class="headerlink" title="来让我们一起构建一个简单的App"></a>来让我们一起构建一个简单的App</h3><p>为了让你更快捷的理解使用Webpack的好处，我们会构建一个简单的App，并将资源打包进去。在这里教程中我推荐使用Node4（或5），以及NPM3作为包管理工具，以便在使用Webpack的时候避免大量的麻烦。如果你还没装NPM3，可以通过<code>npm install npm@3 -g</code>来安装。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ node --version</div><div class="line">v5<span class="number">.7</span><span class="number">.1</span></div><div class="line">$ npm --version</div><div class="line"><span class="number">3.6</span><span class="number">.0</span></div></pre></td></tr></table></figure>
<p>我还要推荐你把<code>node_modules/.bin</code>放进你的<code>PATH</code>变量，以避免每次都要输入<code>node_modules/.bin/webpack</code>。在下面了例子里我输入的指令都不会再包含<code>node_modules/.bin</code>。</p>
<h4 id="基础指引（setup）"><a href="#基础指引（setup）" class="headerlink" title="基础指引（setup）"></a>基础指引（setup）</h4><p>从创建项目安装Webpack开始。我们同时也安装了jQuery以便支持后续操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ npm init -y</div><div class="line">$ npm install jquery --save</div><div class="line">$ npm install webpack --save-dev</div></pre></td></tr></table></figure>
<p>现在来做一个App的入口：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/index.js</span></div><div class="line"><span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);</div><div class="line"></div><div class="line">$(<span class="string">'body'</span>).html(<span class="string">'Hello'</span>);</div></pre></td></tr></table></figure>
<p>让我们在<code>webpack.config.js</code>文件里进行的Webpack配置。Webpack配置实质上是Javascript，并且在最后<code>export</code>出去一个Object：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// webpack.config.js</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">entry</span>:  <span class="string">'./src'</span>,</div><div class="line">    <span class="attr">output</span>: &#123;</div><div class="line">        <span class="attr">path</span>: <span class="string">'builds'</span>,</div><div class="line">        <span class="attr">filename</span>: <span class="string">'bundle.js'</span>,</div><div class="line">    &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>在这里，<code>entry</code>告诉Webpack哪些文件是应用的入口文件。它们是你的主要文件，在依赖树的最顶端。之后，我们告诉Webpack把资源打包在<code>builds</code>文件夹下的<code>bundle.js</code>文件里。让我们编写index HTML文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>My title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"builds/bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>运行Webpack。如果一切正确那就可以看见下面的信息：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ webpack</div><div class="line">Hash: d41fc61f5b9d72c13744</div><div class="line">Version: webpack <span class="number">1.12</span><span class="number">.14</span></div><div class="line">Time: <span class="number">301</span>ms</div><div class="line">    Asset    Size  Chunks             Chunk Names</div><div class="line">bundle.js  <span class="number">268</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line">   [<span class="number">0</span>] ./src/index.js <span class="number">53</span> bytes &#123;<span class="number">0</span>&#125; [built]</div><div class="line">    + <span class="number">1</span> hidden modules</div></pre></td></tr></table></figure>
<p>在这段信息里可以看出，<code>bundle.js</code>包含了<code>index.js</code>和一个隐藏的模块。隐藏的模块是jQuery。在默认模式下Webpack隐藏的模块都不是你写的。如果想要显示它们，我们可以在运行Webpack的时候使用<code>--display-modules</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ webpack --display-modules</div><div class="line">bundle.js  <span class="number">268</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line">   [<span class="number">0</span>] ./src/index.js <span class="number">53</span> bytes &#123;<span class="number">0</span>&#125; [built]</div><div class="line">   [<span class="number">1</span>] ./~<span class="regexp">/jquery/</span>dist/jquery.js <span class="number">259</span> kB &#123;<span class="number">0</span>&#125; [built]</div></pre></td></tr></table></figure>
<p>你还可以使用<code>webpack --watch</code>，在改变代码的时候自动进行打包。</p>
<h4 id="设置第一个loader（loader-01）"><a href="#设置第一个loader（loader-01）" class="headerlink" title="设置第一个loader（loader-01）"></a>设置第一个loader（<code>loader</code>-01）</h4><p>还记得Webpack可以处理各种资源的引用吗？该怎么搞？如果你跟随了这些年Web组件发展的步伐（Angular2，Vue，React，Polymer，X-Tag等等），那么你应该知道，与一堆UI相互连接组合而成的App相比，使用可维护的小型可复用的UI组件会更好：web component。</p>
<p>为了确保组件能够保持独立，它们需要在自己内部打包需要的资源。想象一个按钮组件：除了HTML之外，还需要js以便和外部结合。噢对或许还需要一些样式。如果能够在需要这个按钮组件的时候，加载所有它所依赖的资源的话那就太赞了。当我们import按钮组件的时候，就获取到了所有资源。</p>
<p>开始编写这个按钮组件吧。首先，假设你已经习惯了ES2015语法，那么需要安装第一个loader：Babel。安装好一个loader你需要做下面这两步：首先，通过<code>npm install {whatever}-loader</code>安装你需要的loader，然后，将它加到Webpage配置的<code>module.loaders</code>里：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install babel-loader --save-dev</div></pre></td></tr></table></figure>
<p>loader并不会帮我们安装Babel所以我们要自己安装它。需要安装<code>babel-core</code>包和<code>es2015</code>预处理包。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install babel-core babel-preset-es2015 --save-dev</div></pre></td></tr></table></figure>
<p>新建<code>.babelrc</code>文件，里面是一段JSON，告诉Babel使用<code>es2015</code>进行预处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// .babelrc </span></div><div class="line">&#123; <span class="string">"presets"</span>: [<span class="string">"es2015"</span>] &#125;</div></pre></td></tr></table></figure>
<p>现在，Babel已经被安装并配置完成，我们要更新Webpack配置。我们想要Babel运行在所有以<code>.js</code>结尾的文件里，但是要避免运行在第三方依赖包例如jQuery里面。loader拥有<code>include</code>和<code>exclude</code>规则，里面可以是一段字符串、正则、回调等等。在这个例子里，我们只想让Babel在我们自己的文件里运行，因此使用<code>include</code>包含自己的资源文件夹：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">entry</span>: <span class="string">'./src'</span>,</div><div class="line">    <span class="attr">output</span>: &#123;</div><div class="line">        <span class="attr">path</span>: <span class="string">'builds'</span>,</div><div class="line">        <span class="attr">filename</span>: <span class="string">'bundle.js'</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">module</span>: &#123;</div><div class="line">        <span class="attr">loaders</span>: [</div><div class="line">            &#123;</div><div class="line">                <span class="attr">test</span>: <span class="regexp">/\.js/</span>,</div><div class="line">                <span class="attr">loader</span>: <span class="string">'babel'</span>,</div><div class="line">                <span class="attr">include</span>: __dirname + <span class="string">'/src'</span>,</div><div class="line">            &#125;</div><div class="line">        ],</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>现在，我们可以用ES6语法重写<code>index.js</code>了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// index.js</span></div><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"></div><div class="line">$(<span class="string">'body'</span>).html(<span class="string">'Hello'</span>);</div></pre></td></tr></table></figure>
<h4 id="写个小组件（loader-02）"><a href="#写个小组件（loader-02）" class="headerlink" title="写个小组件（loader-02）"></a>写个小组件（<code>loader</code>-02）</h4><p>来写个按钮组件吧，它将包含一些SCSS样式，HTML模板和一些操作。所以我们要安装需要的工具。首先安装Mustache这个轻量级的模板库，然后安装处理Sass和HTML的loader。同样的，为了处理Sass loader返回的结果，还要安装CSS loader。一旦获取到了CSS文件，我们就可以用很多种方式来处理。目前使用的是一个叫<code>style-loader</code>的东西，它能够把CSS插入到包中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm install mustache --save</div><div class="line">$ npm install css-loader style-loader html-loader sass-loader node-sass --save-dev</div></pre></td></tr></table></figure>
<p>为了能够让Webpack依次处理不同loader的返回结果，我们可以将loader通过<code>!</code>链接到一起，获取使用<code>loaders</code>并对应一个由loader组成的数组：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.js/</span>,</div><div class="line">    <span class="attr">loader</span>: <span class="string">'babel'</span>,</div><div class="line">    <span class="attr">include</span>: __dirname + <span class="string">'/src'</span>,</div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.scss/</span>,</div><div class="line">    <span class="attr">loader</span>: <span class="string">'style!css!sass'</span>,</div><div class="line">    <span class="comment">// Or</span></div><div class="line">    loaders: [<span class="string">'style'</span>, <span class="string">'css'</span>, <span class="string">'sass'</span>],</div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.html/</span>,</div><div class="line">    <span class="attr">loader</span>: <span class="string">'html'</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>有了loader，我们来写写按钮：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/Components/Button.scss</span></div><div class="line"><span class="selector-class">.button</span> &#123;</div><div class="line">  <span class="attribute">background</span>: tomato;</div><div class="line">  <span class="attribute">color</span>: white;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- src/Components/Button.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"button"</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;link&#125;&#125;"</span>&gt;</span>&#123;&#123;text&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/Components/Button.js</span></div><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"><span class="keyword">import</span> template <span class="keyword">from</span> <span class="string">'./Button.html'</span>;</div><div class="line"><span class="keyword">import</span> Mustache <span class="keyword">from</span> <span class="string">'mustache'</span>;</div><div class="line"><span class="keyword">import</span> <span class="string">'./Button.scss'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Button</span> </span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(link) &#123;</div><div class="line">        <span class="keyword">this</span>.link = link;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    onClick(event) &#123;</div><div class="line">        event.preventDefault();</div><div class="line">        alert(<span class="keyword">this</span>.link);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    render(node) &#123;</div><div class="line">        <span class="keyword">const</span> text = $(node).text();</div><div class="line">        <span class="comment">// Render our button</span></div><div class="line">        $(node).html(</div><div class="line">            Mustache.render(template, &#123;text&#125;)</div><div class="line">        );</div><div class="line">        <span class="comment">// Attach our listeners</span></div><div class="line">        $(<span class="string">'.button'</span>).click(<span class="keyword">this</span>.onClick.bind(<span class="keyword">this</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>你的<code>Button.js</code>现在处于完全独立的状态，不管何时何地的引用它，都能获取到所有需要的依赖并渲染出来。现在渲染我们的按钮试试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/index.js</span></div><div class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> ‘./Components/Button’;</div><div class="line"></div><div class="line"><span class="keyword">const</span> button = <span class="keyword">new</span> Button(‘google.com’); </div><div class="line">button.render(‘a’);</div></pre></td></tr></table></figure>
<p>运行Webpack，刷新页面，立刻就能看见我们这个难看的按钮了。</p>
<p><img src="/images/WebpackYourBags/example01.png" alt="example01"></p>
<p>现在你已经学习了如何安装loader，以及定义各个依赖配置。看起来好像也没啥。但让我们来深入扩展一下这个例子。</p>
<h3 id="代码分离（require-ensure）"><a href="#代码分离（require-ensure）" class="headerlink" title="代码分离（require.ensure）"></a>代码分离（<code>require.ensure</code>）</h3><p>上面的例子还不错，但我们并不总是需要这个按钮。或许有的页面没有可以用来渲染按钮的<code>a</code>，我们并不想在这样的页面引用按钮的资源文件。这种时候代码分离就能起到作用了。代码分离是Webpack对于“整块全部打包”vs“难以维护的手动引导”这个问题而给出的解决方案。这需要在你的代码中设定“分离点”：代码可以据此分离成不同区域进行按需加载。它的语法很简单：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"></div><div class="line"><span class="comment">// 这个是分割点</span></div><div class="line"><span class="built_in">require</span>.ensure([], () =&gt; &#123;</div><div class="line">  <span class="comment">// 在这里import进的代码都会被打包到一个单独的文件里</span></div><div class="line">  <span class="keyword">const</span> library = <span class="built_in">require</span>(<span class="string">'some-big-library'</span>);</div><div class="line">  $(<span class="string">'foo'</span>).click(<span class="function"><span class="params">()</span> =&gt;</span> library.doSomething());</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>在<code>require.ensure</code>中的东西都会在打包结果中分离开来–只有当需要加载它的时候Webpack才会通过AJAX请求进行加载。也就是说我们实际上得到的是这样的文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">bundle.js</div><div class="line">|- jquery.js</div><div class="line">|- index.js <span class="comment">// 入口文件</span></div><div class="line">chunk1.js</div><div class="line">|- some-big-libray.js</div><div class="line">|- index-chunk.js <span class="comment">// 回调中的代码在这里</span></div></pre></td></tr></table></figure>
<p>你不需要在任何地方引用<code>chunk1.js</code>文件，Webpack会帮你在需要的时候进行请求。这意味着你可以像我们的例子一样，根据逻辑需要引进的资源全部扔进代码里。</p>
<p>只有当页面上有链接存在时，再引用按钮组件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/index.js</span></div><div class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.querySelectorAll(<span class="string">'a'</span>).length) &#123;</div><div class="line">    <span class="built_in">require</span>.ensure([], () =&gt; &#123;</div><div class="line">        <span class="keyword">const</span> Button = <span class="built_in">require</span>(<span class="string">'./Components/Button'</span>).default;</div><div class="line">        <span class="keyword">const</span> button = <span class="keyword">new</span> Button(<span class="string">'google.com'</span>);</div><div class="line"></div><div class="line">        button.render(<span class="string">'a'</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>需要注意的一点是，因为<code>require</code>不会同时处理default export和normal export，所以使用<code>require</code>引用资源里default export的时候，需要手动加上<code>.default</code>。相比之下，<code>import</code>则可以进行处理：</p>
<p><code>import foo from &#39;bar&#39;</code> vs <code>import {baz} from &#39;bar&#39;</code></p>
<p>此时Webpack的output将会变得更复杂了。跑下Webpack，用<code>--display-chunks</code>打印出来看看：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ webpack --display-modules --display-chunks</div><div class="line">Hash: <span class="number">43</span>b51e6cec5eb6572608</div><div class="line">Version: webpack <span class="number">1.12</span><span class="number">.14</span></div><div class="line">Time: <span class="number">1185</span>ms</div><div class="line">      Asset     Size  Chunks             Chunk Names</div><div class="line">  bundle.js  <span class="number">3.82</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line"><span class="number">1.</span>bundle.js   <span class="number">300</span> kB       <span class="number">1</span>  [emitted]</div><div class="line">chunk    &#123;<span class="number">0</span>&#125; bundle.js (main) <span class="number">235</span> bytes [rendered]</div><div class="line">    [<span class="number">0</span>] ./src/index.js <span class="number">235</span> bytes &#123;<span class="number">0</span>&#125; [built]</div><div class="line">chunk    &#123;<span class="number">1</span>&#125; <span class="number">1.</span>bundle.js <span class="number">290</span> kB &#123;<span class="number">0</span>&#125; [rendered]</div><div class="line">    [<span class="number">1</span>] ./src/Components/Button.js <span class="number">1.94</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">2</span>] ./~<span class="regexp">/jquery/</span>dist/jquery.js <span class="number">259</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">3</span>] ./src/Components/Button.html <span class="number">72</span> bytes &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">4</span>] ./~<span class="regexp">/mustache/mu</span>stache.js <span class="number">19.4</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">5</span>] ./src/Components/Button.scss <span class="number">1.05</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">6</span>] ./~<span class="regexp">/css-loader!./</span>~<span class="regexp">/sass-loader!./</span>src/Components/Button.scss <span class="number">212</span> bytes &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">7</span>] ./~<span class="regexp">/css-loader/</span>lib/css-base.js <span class="number">1.51</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">8</span>] ./~<span class="regexp">/style-loader/</span>addStyles.js <span class="number">7.21</span> kB &#123;<span class="number">1</span>&#125; [built]</div></pre></td></tr></table></figure>
<p>正如你所见的那样，我们的入口<code>bundle.js</code>值包含了一些逻辑，而其他东西（jQuery，Mustache，Button）都被打包进了<code>1.bundle.js</code>，并且只在需要的时候才会被引用。现在为了能够让Webpack在AJAX的时候找到这些资源，我们需要改下配置里的<code>output</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">path: <span class="string">'builds'</span>,</div><div class="line"><span class="attr">filename</span>: <span class="string">'bundle.js'</span>,</div><div class="line"><span class="attr">publicPath</span>: <span class="string">'builds/'</span>,</div></pre></td></tr></table></figure>
<p><code>output.publicPath</code>告诉Webpack，从当前页面的位置出发哪里可以找到需要的资源（在这个例子里是<code>/builds/</code>）。当我们加载页面的时候一切正常，而且能够看见Webpack已经根据页面上预留的“锚”加载好了包。</p>
<p><img src="/images/WebpackYourBags/example02.png" alt="example02"></p>
<p>如果页面上缺少“锚”(代指link)，那么只会加载<code>bundle.js</code>。通过这种方式，你可以做到在真正需要资源的时候才进行加载，避免让自己的页面变成笨重的一坨。顺带一提，我们可以改变分割点的名字，不使用<code>1.bundle.js</code>而使用更加语义化的名称。通过<code>require.ensure</code>的第三个参数来实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>.ensure([], () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> Button = <span class="built_in">require</span>(<span class="string">'./Components/Button'</span>).default;</div><div class="line">    <span class="keyword">const</span> button = <span class="keyword">new</span> Button(<span class="string">'google.com'</span>);</div><div class="line"></div><div class="line">    button.render(<span class="string">'a'</span>);</div><div class="line">&#125;, <span class="string">'button'</span>);</div></pre></td></tr></table></figure>
<p>这样的话就会生成<code>button.bundle.js</code>而不是<code>1.bundle.js</code></p>
<h3 id="再加个组件（CommonChunksPlugin）"><a href="#再加个组件（CommonChunksPlugin）" class="headerlink" title="再加个组件（CommonChunksPlugin）"></a>再加个组件（<code>CommonChunksPlugin</code>）</h3><p>来让我们再加个组件吧：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/Components/Header.scss</span></div><div class="line"><span class="selector-class">.header</span> &#123;</div><div class="line">  <span class="attribute">font-size</span>: <span class="number">3rem</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- src/Components/Header.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span>&#123;&#123;text&#125;&#125;<span class="tag">&lt;/<span class="name">header</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/Components/Header.js</span></div><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"><span class="keyword">import</span> Mustache <span class="keyword">from</span> <span class="string">'mustache'</span>;</div><div class="line"><span class="keyword">import</span> template <span class="keyword">from</span> <span class="string">'./Header.html'</span>;</div><div class="line"><span class="keyword">import</span> <span class="string">'./Header.scss'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Header</span> </span>&#123;</div><div class="line">    render(node) &#123;</div><div class="line">        <span class="keyword">const</span> text = $(node).text();</div><div class="line">        $(node).html(</div><div class="line">            Mustache.render(template, &#123;text&#125;)</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>将它在应用中渲染出来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 如果有链接，则渲染按钮组件</span></div><div class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.querySelectorAll(<span class="string">'a'</span>).length) &#123;</div><div class="line">    <span class="built_in">require</span>.ensure([], () =&gt; &#123;</div><div class="line">        <span class="keyword">const</span> Button = <span class="built_in">require</span>(<span class="string">'./Components/Button'</span>);</div><div class="line">        <span class="keyword">const</span> button = <span class="keyword">new</span> Button(<span class="string">'google.com'</span>);</div><div class="line"></div><div class="line">        button.render(<span class="string">'a'</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 如果有标题，则渲染标题组件</span></div><div class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.querySelectorAll(<span class="string">'h1'</span>).length) &#123;</div><div class="line">    <span class="built_in">require</span>.ensure([], () =&gt; &#123;</div><div class="line">        <span class="keyword">const</span> Header = <span class="built_in">require</span>(<span class="string">'./Components/Header'</span>);</div><div class="line"></div><div class="line">        <span class="keyword">new</span> Header().render(<span class="string">'h1'</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>瞅瞅使用了<code>--display-chunks --display-modules</code>标记后Webpack的output输出：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">$ webpack --display-modules --display-chunks</div><div class="line">Hash: <span class="number">178</span>b46d1d1570ff8bceb</div><div class="line">Version: webpack <span class="number">1.12</span><span class="number">.14</span></div><div class="line">Time: <span class="number">1548</span>ms</div><div class="line">      Asset     Size  Chunks             Chunk Names</div><div class="line">  bundle.js  <span class="number">4.16</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line"><span class="number">1.</span>bundle.js   <span class="number">300</span> kB       <span class="number">1</span>  [emitted]</div><div class="line"><span class="number">2.</span>bundle.js   <span class="number">299</span> kB       <span class="number">2</span>  [emitted]</div><div class="line">chunk    &#123;<span class="number">0</span>&#125; bundle.js (main) <span class="number">550</span> bytes [rendered]</div><div class="line">    [<span class="number">0</span>] ./src/index.js <span class="number">550</span> bytes &#123;<span class="number">0</span>&#125; [built]</div><div class="line">chunk    &#123;<span class="number">1</span>&#125; <span class="number">1.</span>bundle.js <span class="number">290</span> kB &#123;<span class="number">0</span>&#125; [rendered]</div><div class="line">    [<span class="number">1</span>] ./src/Components/Button.js <span class="number">1.94</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">2</span>] ./~<span class="regexp">/jquery/</span>dist/jquery.js <span class="number">259</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">3</span>] ./src/Components/Button.html <span class="number">72</span> bytes &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">4</span>] ./~<span class="regexp">/mustache/mu</span>stache.js <span class="number">19.4</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">5</span>] ./src/Components/Button.scss <span class="number">1.05</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">6</span>] ./~<span class="regexp">/css-loader!./</span>~<span class="regexp">/sass-loader!./</span>src/Components/Button.scss <span class="number">212</span> bytes &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">7</span>] ./~<span class="regexp">/css-loader/</span>lib/css-base.js <span class="number">1.51</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">8</span>] ./~<span class="regexp">/style-loader/</span>addStyles.js <span class="number">7.21</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">chunk    &#123;<span class="number">2</span>&#125; <span class="number">2.</span>bundle.js <span class="number">290</span> kB &#123;<span class="number">0</span>&#125; [rendered]</div><div class="line">    [<span class="number">2</span>] ./~<span class="regexp">/jquery/</span>dist/jquery.js <span class="number">259</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">4</span>] ./~<span class="regexp">/mustache/mu</span>stache.js <span class="number">19.4</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">7</span>] ./~<span class="regexp">/css-loader/</span>lib/css-base.js <span class="number">1.51</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">8</span>] ./~<span class="regexp">/style-loader/</span>addStyles.js <span class="number">7.21</span> kB &#123;<span class="number">1</span>&#125; &#123;<span class="number">2</span>&#125; [built]</div><div class="line">    [<span class="number">9</span>] ./src/Components/Header.js <span class="number">1.62</span> kB &#123;<span class="number">2</span>&#125; [built]</div><div class="line">   [<span class="number">10</span>] ./src/Components/Header.html <span class="number">64</span> bytes &#123;<span class="number">2</span>&#125; [built]</div><div class="line">   [<span class="number">11</span>] ./src/Components/Header.scss <span class="number">1.05</span> kB &#123;<span class="number">2</span>&#125; [built]</div><div class="line">   [<span class="number">12</span>] ./~<span class="regexp">/css-loader!./</span>~<span class="regexp">/sass-loader!./</span>src/Components/Header.scss <span class="number">192</span> bytes &#123;<span class="number">2</span>&#125; [built]</div></pre></td></tr></table></figure>
<p>可以看出一点问题了：这两个组件都需要jQuery和Mustache，这样的话就造成了包中的依赖重复，这可不是我们想要的。尽管Webpack会在默认情况下进行一定的优化，但还得靠插件来加足火力搞定它。</p>
<p>插件和loader的不同在于，loader只对一类特定的文件有效，而插件往往面向所有文件，并且并不总是会引起转化。Webpack提供了很多插件供你优化。在这里我们使用<code>CommonChunksPlugin</code>插件：它会分析你包中的重复依赖并提取出来，生成一个完全独立的文件（例如vendor.js），甚至生成你的主文件。</p>
<p>现在，我们想要把共同的依赖包从入口中剔除。如果所有的页面都用到了jQuery和Mustache，那么就要把它们提取出来。更新下配置吧：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">entry</span>: <span class="string">'./src'</span>,</div><div class="line">    <span class="attr">output</span>: &#123;</div><div class="line">      <span class="comment">// ...</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">plugins</span>: [</div><div class="line">        <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">'main'</span>, <span class="comment">// 将依赖移到我们的主文件中</span></div><div class="line">            children: <span class="literal">true</span>, <span class="comment">// 再在所有的子文件中检查依赖文件</span></div><div class="line">            minChunks: <span class="number">2</span>, <span class="comment">// 一个依赖重复几次会被提取出来</span></div><div class="line">        &#125;),</div><div class="line">    ],</div><div class="line">    <span class="attr">module</span>: &#123;</div><div class="line">      <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>再跑次Webpack，可以看出现在就好多了。其中，<code>main</code>是我们的默认依赖。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">chunk    &#123;<span class="number">0</span>&#125; bundle.js (main) <span class="number">287</span> kB [rendered]</div><div class="line">    [<span class="number">0</span>] ./src/index.js <span class="number">550</span> bytes &#123;<span class="number">0</span>&#125; [built]</div><div class="line">    [<span class="number">2</span>] ./~<span class="regexp">/jquery/</span>dist/jquery.js <span class="number">259</span> kB &#123;<span class="number">0</span>&#125; [built]</div><div class="line">    [<span class="number">4</span>] ./~<span class="regexp">/mustache/mu</span>stache.js <span class="number">19.4</span> kB &#123;<span class="number">0</span>&#125; [built]</div><div class="line">    [<span class="number">7</span>] ./~<span class="regexp">/css-loader/</span>lib/css-base.js <span class="number">1.51</span> kB &#123;<span class="number">0</span>&#125; [built]</div><div class="line">    [<span class="number">8</span>] ./~<span class="regexp">/style-loader/</span>addStyles.js <span class="number">7.21</span> kB &#123;<span class="number">0</span>&#125; [built]</div><div class="line">chunk    &#123;<span class="number">1</span>&#125; <span class="number">1.</span>bundle.js <span class="number">3.28</span> kB &#123;<span class="number">0</span>&#125; [rendered]</div><div class="line">    [<span class="number">1</span>] ./src/Components/Button.js <span class="number">1.94</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">3</span>] ./src/Components/Button.html <span class="number">72</span> bytes &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">5</span>] ./src/Components/Button.scss <span class="number">1.05</span> kB &#123;<span class="number">1</span>&#125; [built]</div><div class="line">    [<span class="number">6</span>] ./~<span class="regexp">/css-loader!./</span>~<span class="regexp">/sass-loader!./</span>src/Components/Button.scss <span class="number">212</span> bytes &#123;<span class="number">1</span>&#125; [built]</div><div class="line">chunk    &#123;<span class="number">2</span>&#125; <span class="number">2.</span>bundle.js <span class="number">2.92</span> kB &#123;<span class="number">0</span>&#125; [rendered]</div><div class="line">    [<span class="number">9</span>] ./src/Components/Header.js <span class="number">1.62</span> kB &#123;<span class="number">2</span>&#125; [built]</div><div class="line">   [<span class="number">10</span>] ./src/Components/Header.html <span class="number">64</span> bytes &#123;<span class="number">2</span>&#125; [built]</div><div class="line">   [<span class="number">11</span>] ./src/Components/Header.scss <span class="number">1.05</span> kB &#123;<span class="number">2</span>&#125; [built]</div><div class="line">   [<span class="number">12</span>] ./~<span class="regexp">/css-loader!./</span>~<span class="regexp">/sass-loader!./</span>src/Components/Header.scss <span class="number">192</span> bytes &#123;<span class="number">2</span>&#125; [built]</div></pre></td></tr></table></figure>
<p>如果我们改变下名字<code>name: &#39;vendor&#39;</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'vendor'</span>,</div><div class="line">    <span class="attr">children</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">minChunks</span>: <span class="number">2</span>,</div><div class="line">&#125;),</div></pre></td></tr></table></figure>
<p>Webpack会在没有该文件的情况下自动生成<code>builds/vendor.js</code>，之后我们可以手动引入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"builds/vendor.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"builds/bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>你也可以通过<code>async: true</code>，并且不提供共同依赖包的命名，来达到异步加载共同依赖的效果。</p>
<p>Webpack有很多这样给力的优化方案。我没法一个一个介绍它们，不过可以通过创造一个生产环境的应用来进一步学习。</p>
<h3 id="飞跃到生产环境（production）"><a href="#飞跃到生产环境（production）" class="headerlink" title="飞跃到生产环境（production）"></a>飞跃到生产环境（<code>production</code>）</h3><p>首先，要在设置中添加几个插件，但要求只有当<code>NODE_ENV</code>为<code>production</code>的时候才运行它们：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="keyword">var</span> production = process.env.NODE_ENV === <span class="string">'production'</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> plugins = [</div><div class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">'main'</span>,</div><div class="line">        <span class="attr">children</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">minChunks</span>: <span class="number">2</span>,</div><div class="line">    &#125;),</div><div class="line">];</div><div class="line"></div><div class="line"><span class="keyword">if</span> (production) &#123;</div><div class="line">    plugins = plugins.concat([</div><div class="line">       <span class="comment">// 生产环境下需要的插件</span></div><div class="line">    ]);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">entry</span>: <span class="string">'./src'</span>,</div><div class="line">    <span class="attr">output</span>:  &#123;</div><div class="line">        <span class="attr">path</span>: <span class="string">'builds'</span>,</div><div class="line">        <span class="attr">filename</span>: <span class="string">'bundle.js'</span>,</div><div class="line">        <span class="attr">publicPath</span>: <span class="string">'builds/'</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">plugins</span>: plugins,</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Webpack也提供了一些可以切换生产环境的设置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">debug</span>: !production,</div><div class="line">    <span class="attr">devtool</span>: production ? <span class="literal">false</span> : <span class="string">'eval'</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>设置中的第一行表明在开发环境下，将开启debug模式，代码不再混做一团，利于本地调试。第二行则用来生产资源地图（sourcemaps）。Webpack有<a href="http://webpack.github.io/docs/configuration.html#devtool" target="_blank" rel="external">一些方法</a>可以生成<a href="http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/" target="_blank" rel="external">sourcemaps</a>，而<code>eval</code>则是在本地表现最赞的一个。在生产环境下，我们并不关心sourcemaps，因此关闭了这个选项。</p>
<p>现在来添加生产环境下的插件吧：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (production) &#123;</div><div class="line">    plugins = plugins.concat([</div><div class="line">        <span class="comment">// 这个插件用来寻找相同的包和文件，并把它们合并在一起</span></div><div class="line">        <span class="keyword">new</span> webpack.optimize.DedupePlugin(),</div><div class="line"></div><div class="line">        <span class="comment">// 这个插件根据包/库的引用次数来优化它们</span></div><div class="line">        <span class="keyword">new</span> webpack.optimize.OccurenceOrderPlugin(),</div><div class="line"></div><div class="line">        <span class="comment">// 这个插件用来阻止Webpack把过小的文件打成单独的包</span></div><div class="line">        <span class="keyword">new</span> webpack.optimize.MinChunkSizePlugin(&#123;</div><div class="line">            <span class="attr">minChunkSize</span>: <span class="number">51200</span>, <span class="comment">// ~50kb</span></div><div class="line">        &#125;),</div><div class="line"></div><div class="line">        <span class="comment">// 压缩js文件</span></div><div class="line">        <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</div><div class="line">            <span class="attr">mangle</span>: <span class="literal">true</span>,</div><div class="line">            <span class="attr">compress</span>: &#123;</div><div class="line">                <span class="attr">warnings</span>: <span class="literal">false</span>, <span class="comment">// 禁止生成warning</span></div><div class="line">            &#125;,</div><div class="line">        &#125;),</div><div class="line"></div><div class="line">        <span class="comment">// 这个插件提供了各种可用在生产环境下的变量</span></div><div class="line">        <span class="comment">// 通过设置为false，可避免生产环境下调用到它们</span></div><div class="line">        <span class="keyword">new</span> webpack.DefinePlugin(&#123;</div><div class="line">            <span class="attr">__SERVER__</span>: !production,</div><div class="line">            <span class="attr">__DEVELOPMENT__</span>: !production,</div><div class="line">            <span class="attr">__DEVTOOLS__</span>: !production,</div><div class="line">            <span class="string">'process.env'</span>: &#123;</div><div class="line">                <span class="attr">BABEL_ENV</span>: <span class="built_in">JSON</span>.stringify(process.env.NODE_ENV),</div><div class="line">            &#125;,</div><div class="line">        &#125;),</div><div class="line"></div><div class="line">    ]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我普遍使用的差不多就这么多了，不过Webpack还提供了非常多的插件，你可以自己去研究它们。也可以在NPM上找到很多用户自己贡献的插件。插件的链接在文末提供。</p>
<p>还有一个关于生产环境的优化是给资源提供版本的概念。还记得<code>output.filename</code>里的<code>bundle.js</code>吗？在这个配置里面，你可以使用一些变量，而<code>[hash]</code>则会给文件提供一段随机的字符串。除此以外，我们想要包可以被版本化，因此添加了<code>output.chunkFilename</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">output: &#123;</div><div class="line">    <span class="attr">path</span>: <span class="string">'builds'</span>,</div><div class="line">    <span class="attr">filename</span>: production ? <span class="string">'[name]-[hash].js'</span> : <span class="string">'bundle.js'</span>,</div><div class="line">    <span class="attr">chunkFilename</span>: <span class="string">'[name]-[chunkhash].js'</span>,</div><div class="line">    <span class="attr">publicPath</span>: <span class="string">'builds/'</span>,</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>因为无法得知每次打包生成的文件名，所以我们只在生产环境下使用它。除此之外，我们还想保证每次打包的时候，builds文件夹都会被清空以节约空间，因此使用了一个第三方插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install clean-webpack-plugin --save-dev</div></pre></td></tr></table></figure>
<p>并将它添加到配置中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="keyword">var</span> CleanPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">if</span> (production) &#123;</div><div class="line">    plugins = plugins.concat([</div><div class="line">        <span class="comment">// 在打包前清空 builds/ 文件夹</span></div><div class="line">        <span class="keyword">new</span> CleanPlugin(<span class="string">'builds'</span>),</div></pre></td></tr></table></figure>
<p>做完这些漂亮的优化，来比较下结果的不同吧：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ webpack</div><div class="line">                bundle.js   <span class="number">314</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line"><span class="number">1</span><span class="number">-21660</span>ec268fe9de7776c.js  <span class="number">4.46</span> kB       <span class="number">1</span>  [emitted]</div><div class="line"><span class="number">2</span>-fcc95abf34773e79afda.js  <span class="number">4.15</span> kB       <span class="number">2</span>  [emitted]</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ NODE_ENV=production webpack</div><div class="line">main<span class="number">-937</span>cc23ccbf192c9edd6.js  <span class="number">97.2</span> kB       <span class="number">0</span>  [emitted]  main</div></pre></td></tr></table></figure>
<p>来看看Webpack都做了什么：</p>
<ul>
<li>在第一段代码中，后两个包非常轻量，异步请求不会占用多少HTTP带宽，所以在生产环境下Webpack将它们打包进了入口文件里</li>
<li>所有东西都压缩过了。从322kb降到了97kb</li>
</ul>
<blockquote>
<p>但是这样下去，Webpack岂不是会将js文件合并成巨大的一坨吗？</p>
</blockquote>
<p>是的，在这个小小的应用中是这样没错。但是你需要这么想：你不需要考虑在什么时候合并什么。如果你的包中含有太多的依赖，它们会被移走到异步请求包中而不会被合并起来。反之，如果它们很小，不值得独立加载，那么就会被合并。你只需要建立规则，Webpack会最大化的将其优化。没有人力劳作，不需要思考依赖关系，一切都是自动化的。</p>
<p><img src="/images/WebpackYourBags/example03.gif" alt="example03"></p>
<p>或许你已经注意到了，我没有对HTML或CSS进行压缩。那是因为当<code>debug</code>模式开启的时候，<code>css-loader</code>和<code>html-loader</code>已经帮我们搞好了。这也是为什么Uglify是一个独立插件的原因：在Webpack中没有<code>js-loader</code>这种东西，Webpack自己就是个JS loader。</p>
<h3 id="抽取（extract-text-webpack-plugin）"><a href="#抽取（extract-text-webpack-plugin）" class="headerlink" title="抽取（extract-text-webpack-plugin）"></a>抽取（<code>extract-text-webpack-plugin</code>）</h3><p>可能你已经注意到了，从这个教程一开始，Webpack打包好之后，我们的样式就直接插在网页页面上，简直不能更难看了。能通过Webpack把打包过的CSS生成独立的文件吗？当然没问题：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install extract-text-webpack-plugin --save-dev</div></pre></td></tr></table></figure>
<p>这个插件所做的就是我刚刚说的那些：从打出的最终包里面，提取出某一类内容分离开来单独引用。它通常被用于提取CSS文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="keyword">var</span> CleanPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</div><div class="line"><span class="keyword">var</span> ExtractPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>);</div><div class="line"><span class="keyword">var</span> production = process.env.NODE_ENV === <span class="string">'production'</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> plugins = [</div><div class="line">    <span class="keyword">new</span> ExtractPlugin(<span class="string">'bundle.css'</span>), <span class="comment">// &lt;=== 提取出来的文件</span></div><div class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">'main'</span>,</div><div class="line">        <span class="attr">children</span>: <span class="literal">true</span>, </div><div class="line">        <span class="attr">minChunks</span>: <span class="number">2</span>,</div><div class="line">    &#125;),</div><div class="line">];</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    plugins: plugins,</div><div class="line">    <span class="attr">module</span>:  &#123;</div><div class="line">        <span class="attr">loaders</span>: [</div><div class="line">            &#123;</div><div class="line">                <span class="attr">test</span>: <span class="regexp">/\.scss/</span>,</div><div class="line">                <span class="attr">loader</span>: ExtractPlugin.extract(<span class="string">'style'</span>, <span class="string">'css!sass'</span>),</div><div class="line">            &#125;,</div><div class="line">            <span class="comment">// ...</span></div><div class="line">        ],</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><code>ExtractPlugin.extrac</code>方法接收两个参数，第一个参数代表当它处于已经打包好的包（’style’）里时，如何处理那些提取出来的东西；第二个参数代表当它在主文件（’css!sass’）里时，如何对待提取出的东西。当它在包里时，肯定不能直接将CSS加在生成的东西后面，所以先用<code>style-loader</code>进行处理；而对于主文件里面的styles，则将它们放进<code>builds/bundle.css</code>文件。我们来给应用加一个主样式：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/styles.scss</span></div><div class="line"><span class="selector-tag">body</span> &#123;</div><div class="line">  <span class="attribute">font-family</span>: sans-serif;</div><div class="line">  <span class="attribute">background</span>: darken(white, <span class="number">0.2</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/index.js</span></div><div class="line"><span class="keyword">import</span> <span class="string">'./styles.scss'</span>;</div><div class="line"></div><div class="line"><span class="comment">// Rest of our file</span></div></pre></td></tr></table></figure>
<p>跑下Webpack，就能看见已经生成了<code>bundle.css</code>，可以把它引用进HTML里：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ webpack</div><div class="line">                bundle.js    <span class="number">318</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line"><span class="number">1</span>-a110b2d7814eb963b0b5.js   <span class="number">4.43</span> kB       <span class="number">1</span>  [emitted]</div><div class="line"><span class="number">2</span><span class="number">-03</span>eb25b4d6b52a50eb89.js    <span class="number">4.1</span> kB       <span class="number">2</span>  [emitted]</div><div class="line">               bundle.css  <span class="number">59</span> bytes       <span class="number">0</span>  [emitted]  main</div></pre></td></tr></table></figure>
<p>如果你想提取出所有包里的样式，则需要设置<code>ExtractTextPlugin(&#39;bundle.css&#39;, {allChunks: true})</code></p>
<p>顺带一提，你也可以自定义文件名，就跟之前说的改变js output-file名称一样：<code>ExtractTextPlugin(&#39;[name]-[hash].css&#39;)</code></p>
<h3 id="使用图片（url-loader-amp-file-loader）"><a href="#使用图片（url-loader-amp-file-loader）" class="headerlink" title="使用图片（url-loader&amp;file-loader）"></a>使用图片（<code>url-loader</code>&amp;<code>file-loader</code>）</h3><p>到目前为止，我们还没处理例如图片、字体这样的资源文件。它们在Webpack中如何工作，我们又该如何优化？接下来，我要在网站的背景里加入图片，看起来一定酷酷的：</p>
<p><img src="/images/WebpackYourBags/example04.jpg" alt="example04"></p>
<p>把图片保存在<code>img/puppy.jpg</code>，更新下Sass文件：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/styles.scss</span></div><div class="line"><span class="selector-tag">body</span> &#123;</div><div class="line">    <span class="attribute">font-family</span>: sans-serif;</div><div class="line">    <span class="attribute">background</span>: darken(white, <span class="number">0.2</span>);</div><div class="line">    <span class="attribute">background-image</span>: url(<span class="string">'../img/puppy.jpg'</span>);</div><div class="line">    <span class="attribute">background-size</span>: cover;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果仅仅是这样，Webpack一定会告诉你：“你特么的想让我对JPG做啥？”，那是因为还没有加入对应的loader。有两种loader可以使用：<code>file-loader</code>和<code>url-loader</code>：</p>
<ul>
<li><code>file-loader</code>：返回一段指向资源的URL，允许你给文件加入版本的概念（默认）</li>
<li><code>url-loader</code>：以<code>data:image/jpeg;base64</code>的形式返回URL</li>
</ul>
<p>很难说两种方法谁好谁坏：如果你的图片大于2M的话那你一定不希望它直接夹杂在代码中，而是独立出去；而如果仅仅是2kb左右的小图标。那么合并在一起减少HTTP请求会更好。因此，我们两个都要设置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install url-loader file-loader --save-dev</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.(png|gif|jpe?g|svg)$/i</span>,</div><div class="line">    <span class="attr">loader</span>: <span class="string">'url?limit=10000'</span>,</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>在这里，我们给<code>url-loader</code>了一个<code>limit</code>参数，这样，当文件大小小于10kb的时候，会采取行内样式，否则的话，会转到<code>file-loader</code>进行处理。你也可以通过<code>query</code>传递一个Object来实现它：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.(png|gif|jpe?g|svg)$/i</span>,</div><div class="line">    <span class="attr">loader</span>: <span class="string">'url'</span>,</div><div class="line">    <span class="attr">query</span>: &#123;</div><div class="line">      <span class="attr">limit</span>: <span class="number">10000</span>,</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>来瞅一眼Webpack的输出：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">bundle.js   <span class="number">15</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line"><span class="number">1</span>-b8256867498f4be01fd7.js  <span class="number">317</span> kB       <span class="number">1</span>  [emitted]</div><div class="line"><span class="number">2</span>-e1bc215a6b91d55a09aa.js  <span class="number">317</span> kB       <span class="number">2</span>  [emitted]</div><div class="line">               bundle.css  <span class="number">2.9</span> kB       <span class="number">0</span>  [emitted]  main</div></pre></td></tr></table></figure>
<p>输出里面没有JPG图像，那是因为我们的小狗图片比配置里限制的大小要小，因此被加到了行内。访问页面，你就能看见这只可爱的小狗了。</p>
<p><img src="/images/WebpackYourBags/example05.png" alt="example05"></p>
<p>这是一个非常强大的功能，它意味着Webpack可以智能的根据资源的大小和HTTP请求占有的比率，采取不同的优化方案。还有一个叫做<a href="/images/-webpack-loader">image-loader</a>的loader，可以在打包前检查所有图片，避免图片的重复压缩。它有一个叫<code>?bypassOnDebug</code>的参数，通过它你可以只在生产环境下启动该插件。</p>
<p>还有很多优秀的插件，我强烈建议你使用文末的链接去查看它们。</p>
<h3 id="来个牛逼的热加载（dev-server）"><a href="#来个牛逼的热加载（dev-server）" class="headerlink" title="来个牛逼的热加载（dev-server）"></a>来个牛逼的热加载（dev-server）</h3><p>我们的生产环境以及整的差不多了，现在应该更多的关心一下本地开发。或许你以及注意到了，当人们提及开发工具的时候，总是会提及热加载：LiveReload，BrowserSync，或者其他的什么鬼东西。但是只有傻瓜才会整页的刷新，我们则使用更高端的热加载。因为Webpack可以确切的知道你依赖树中某一点位置的代码，因此每次的改变都会据此生成一个新的文件。简单的说，就是不需要刷新页面就能将改变展现在屏幕上。</p>
<p>为了能够使用HMR，我们需要一个server来启动热加载。Webpack提供的<code>dev-server</code>可以完成这个任务：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install webpack-dev-server --save-dev</div></pre></td></tr></table></figure>
<p>安装下面的命令启动server，不能再简单了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ webpack-dev-server --inline --hot</div></pre></td></tr></table></figure>
<p>第一个标记<code>--inline</code>是让Webpack把HMR逻辑直接写入页面上而不是放到iframe里，而第二个标记则开启了HMR。接下来，访问<code>http://localhost:8080/webpack-dev-server/</code>,嗯还是那个正常的页面。试着修改Sass文件，MAGIC！</p>
<p><img src="/images/WebpackYourBags/example06.gif" alt="example06"></p>
<p>你可以把webpack-dev-server作为自己本地的server。如果你打算一直使用HMR，就需要这么配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">output: &#123;</div><div class="line">    <span class="attr">path</span>: <span class="string">'builds'</span>,</div><div class="line">    <span class="attr">filename</span>: production ? <span class="string">'[name]-[hash].js'</span> : <span class="string">'bundle.js'</span>,</div><div class="line">    <span class="attr">chunkFilename</span>: <span class="string">'[name]-[chunkhash].js'</span>,</div><div class="line">    <span class="attr">publicPath</span>: <span class="string">'builds/'</span>,</div><div class="line">&#125;,</div><div class="line"><span class="attr">devServer</span>: &#123;</div><div class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>这样的话，不管我们什么时候运行<code>webpack-dev-server</code>，都会是HMR模式。值得一提的是，我们在这里使用<code>webpack-dev-server</code>对资源进行热加载，但也可以使用在其他地方例如Express server上。Webpack提供了一个中间件，使得你可以把HMR的功能用在其他server上。</p>
<h3 id="代码不干净的人都给我去罚站！（pre-loader-amp-lint"><a href="#代码不干净的人都给我去罚站！（pre-loader-amp-lint" class="headerlink" title="代码不干净的人都给我去罚站！（pre-loader &amp; lint)"></a>代码不干净的人都给我去罚站！（pre-loader &amp; lint)</h3><p>如果你一直跟着本教程走，那或许会有这样的疑问：为什么loader都在<code>module.loaders</code>中而插件不在？那当然是因为还有其他可以配置进<code>module</code>的东西~Webpack不只是有loader，也有pre-loader和post-loader：在main-loader运行之前和之后发动的玩意。举个栗子：我基本可以确信自己在这个文章里面写的代码很糟糕，所以使用ESLint进行代码检查：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install eslint eslint-loader babel-eslint --save-dev</div></pre></td></tr></table></figure>
<p>新建一个肯定会引发错误的<code>.eslintrc</code>文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// .eslintrc</span></div><div class="line">parser: <span class="string">'babel-eslint'</span></div><div class="line">rules:</div><div class="line">  quotes: <span class="number">2</span></div></pre></td></tr></table></figure>
<p>现在增加pre-loader，语法和之前的一样，只不过加在<code>module.preLoaders</code>里：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>:  &#123;</div><div class="line">    <span class="attr">preLoaders</span>: [</div><div class="line">        &#123;</div><div class="line">            <span class="attr">test</span>: <span class="regexp">/\.js/</span>,</div><div class="line">            <span class="attr">loader</span>: <span class="string">'eslint'</span>,</div><div class="line">        &#125;</div><div class="line">    ],</div></pre></td></tr></table></figure>
<p>启动Webpack，然后淡定的看它失败：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">$ webpack</div><div class="line">Hash: <span class="number">33</span>cc307122f0a9608812</div><div class="line">Version: webpack <span class="number">1.12</span><span class="number">.2</span></div><div class="line">Time: <span class="number">1307</span>ms</div><div class="line">                    Asset      Size  Chunks             Chunk Names</div><div class="line">                bundle.js    <span class="number">305</span> kB       <span class="number">0</span>  [emitted]  main</div><div class="line"><span class="number">1</span><span class="number">-551</span>ae2634fda70fd8502.js    <span class="number">4.5</span> kB       <span class="number">1</span>  [emitted]</div><div class="line"><span class="number">2</span><span class="number">-999713</span>ac2cd9c7cf079b.js   <span class="number">4.17</span> kB       <span class="number">2</span>  [emitted]</div><div class="line">               bundle.css  <span class="number">59</span> bytes       <span class="number">0</span>  [emitted]  main</div><div class="line">    + <span class="number">15</span> hidden modules</div><div class="line"></div><div class="line">ERROR <span class="keyword">in</span> ./src/index.js</div><div class="line"></div><div class="line">/Users/anahkiasen/Sites/webpack/src/index.js</div><div class="line">   <span class="number">1</span>:<span class="number">8</span>   error  Strings must use doublequote  quotes</div><div class="line">   <span class="number">4</span>:<span class="number">31</span>  error  Strings must use doublequote  quotes</div><div class="line">   <span class="number">6</span>:<span class="number">32</span>  error  Strings must use doublequote  quotes</div><div class="line">   <span class="number">7</span>:<span class="number">35</span>  error  Strings must use doublequote  quotes</div><div class="line">   <span class="number">9</span>:<span class="number">23</span>  error  Strings must use doublequote  quotes</div><div class="line">  <span class="number">14</span>:<span class="number">31</span>  error  Strings must use doublequote  quotes</div><div class="line">  <span class="number">16</span>:<span class="number">32</span>  error  Strings must use doublequote  quotes</div><div class="line">  <span class="number">18</span>:<span class="number">29</span>  error  Strings must use doublequote  quotes</div></pre></td></tr></table></figure>
<p>再举个pre-loader的例子：每个组件里我们都引用了stylesheet，而它们都有相同命名的对应模板。使用一个pre-loader可以自动将有相同名称的文件作为一个module载入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install baggage-loader --save-dev</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">test</span>: <span class="regexp">/\.js/</span>,</div><div class="line">    <span class="attr">loader</span>: <span class="string">'baggage?[file].html=template&amp;[file].scss'</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过这样的方式告知Webpack，如果遇见和配置相同的HTML文件，则将它作为<code>template</code>引入，同时引入和它同名的Sass文件。这样就能改写组件文件：</p>
<p>将：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"><span class="keyword">import</span> template <span class="keyword">from</span> <span class="string">'./Button.html'</span>;</div><div class="line"><span class="keyword">import</span> Mustache <span class="keyword">from</span> <span class="string">'mustache'</span>;</div><div class="line"><span class="keyword">import</span> <span class="string">'./Button.scss'</span>;</div></pre></td></tr></table></figure>
<p>改为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</div><div class="line"><span class="keyword">import</span> Mustache <span class="keyword">from</span> <span class="string">'mustache'</span>;</div></pre></td></tr></table></figure>
<p>你看，pre-loaders也可以很强大。在文末你可以找到更多的loader</p>
<h3 id="还没看够？"><a href="#还没看够？" class="headerlink" title="还没看够？"></a>还没看够？</h3><p>现在我们的应用还很小，当它变的庞大的时候，观测依赖树就变的非常有用了，从中可以看出我们做的是对是错，应用的瓶颈在哪里等等。Webpack知晓这一切，不过我们得礼貌的请教它才能知晓答案。为了做到这点，你可以通过下面的命令运行Webpack：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webpack --profile --json &gt; stats.json</div></pre></td></tr></table></figure>
<p>第一个标记会让Webpack生成一个profile文件，而第二个则将它转化为JSON格式。最终，讲所有的output都生成了JSON文件。现在有很多网站都可以解析这个JSON文件，不过Webpack官方提供了一个解码的网站<a href="http://webpack.github.io/analyse/" target="_blank" rel="external">Webpack Analyze</a>。将JSON文件导入，进入Modules板块，就可以看见自己依赖树的可视化图像：</p>
<p><img src="/images/WebpackYourBags/example07.png" alt="example07"></p>
<p>小圆点越红，则证明在打包的时候越困难。在这个例子中，jQuery作为最大的文件而成为罪魁祸首。再瞅瞅网站上的其他模块。或许你无法从这个小小的例子里学到很多东西，但是这个工具在分析依赖树和包的时候真的非常有用。</p>
<p>我之前提过，现在有很多服务提供可以对profile文件进行分析。其中一个是<a href="http://chrisbateman.github.io/webpack-visualizer/" target="_blank" rel="external">Webpack Visualizer</a>，它可以以饼状图的形式告知你各个文件占据了多大的比重：</p>
<p><img src="/images/WebpackYourBags/example08.png" alt="example08"></p>
<h3 id="就先讲到这儿吧"><a href="#就先讲到这儿吧" class="headerlink" title="就先讲到这儿吧"></a>就先讲到这儿吧</h3><p>对我而言，Webpack已经取代了Grunt或者Gulp：大部分的功能可以使用Webpack替代，其他的则使用NPM脚本就够了。在以前，每个任务中我们都要通过Aglio，把API文档转换为HTML，而现在只需要这么做：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// package.json</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"build"</span>: <span class="string">"webpack"</span>,</div><div class="line">    <span class="string">"build:api"</span>: <span class="string">"aglio -i docs/api/index.apib -o docs/api/index.html"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>即便是一些不需要打包和构建的Glup任务，Webpack都贴心的提供了对应的服务。下面是一个将Glup融合进Webpack的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line"><span class="keyword">var</span> gutil = <span class="built_in">require</span>(<span class="string">'gutil'</span>);</div><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'./webpack.config'</span>);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  webpack(config, <span class="function"><span class="keyword">function</span>(<span class="params">error, stats</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (error) <span class="keyword">throw</span> <span class="keyword">new</span> gutil.PluginError(<span class="string">'webpack'</span>, error);</div><div class="line">    gutil.log(<span class="string">'[webpack]'</span>, stats.toString());</div><div class="line"></div><div class="line">    callback();</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>因为Webpack具有Node API，因此可以很轻松了运用在其他构建体系中。不用多久你就能发现自己深爱着它无法自拔了。</p>
<p>不管怎样，这篇文字带你预览了Webpack能够帮你做的事情。或许你认为我们讲了很多方面，但实际上这只是个表皮而已：multiple entry points, prefetching, context replacement等等都还没有涉及到。Webpack是个强大的工具，也因此比那些传统的工具更加难懂。但一旦你知道如何使用它，它就会为你鸣奏最悦耳动听的声音。我曾在一些项目里使用过它，它提供的强大的优化和自动化让我深深不能自拔。</p>
<h3 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h3><ul>
<li><a href="https://webpack.github.io/" target="_blank" rel="external">Webpack documentation</a></li>
<li><a href="http://webpack.github.io/docs/list-of-loaders.html" target="_blank" rel="external">List of loaders</a></li>
<li><a href="http://webpack.github.io/docs/list-of-plugins.html" target="_blank" rel="external">List of plugins</a></li>
<li><a href="https://github.com/madewithlove/webpack-article/commits/master" target="_blank" rel="external">Sources for this article</a></li>
<li><a href="https://github.com/madewithlove/webpack-config" target="_blank" rel="external">Our Webpack configuration package</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="译文" scheme="http://ecmadao.com/tags/%E8%AF%91%E6%96%87/"/>
    
  </entry>
  
  <entry>
    <title>PostCSS配置指北</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/CSS/PostCSS%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8C%97/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/CSS/PostCSS配置指北/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#postcss%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8C%97">PostCSS配置指北</a><ul>
<li><a href="#use-with-webpack">Use with webpack</a><ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE">基本配置</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E6%8F%92%E4%BB%B6">使用插件</a></li>
</ul>
</li>
<li><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7css%E7%9A%84%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8">兼容性CSS的自动补全</a></li>
<li><a href="#use-stylelint">Use stylelint</a><ul>
<li><a href="#%E5%9C%A8webpack%E5%86%85%E5%8D%95%E7%8B%AC%E4%BD%BF%E7%94%A8stylelint">在webpack内单独使用stylelint</a></li>
<li><a href="#%E5%9C%A8postcss%E5%86%85%E4%BD%BF%E7%94%A8%E8%8D%90">在PostCSS内使用(荐)</a></li>
<li><a href="#1-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F">1. 基础使用方式</a></li>
<li><a href="#2-%E5%A2%9E%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">2. 增加配置文件</a><ul>
<li><a href="#stylelintignore"><code>.stylelintignore</code></a></li>
<li><a href="#stylelintconfigjs"><code>stylelint.config.js</code></a></li>
</ul>
</li>
<li><a href="#3-stylelintplugin%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0">3. StyleLintPlugin的配置参数</a></li>
</ul>
</li>
<li><a href="#%E8%B5%84%E6%BA%90">资源</a><ul>
<li><a href="#postcss-&amp;-loader">postcss &amp; loader</a></li>
<li><a href="#autoprefixer-&amp;-cssnext">autoprefixer &amp; cssnext</a></li>
<li><a href="#stylelint">stylelint</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="PostCSS配置指北"><a href="#PostCSS配置指北" class="headerlink" title="PostCSS配置指北"></a><a href="https://github.com/postcss/postcss" target="_blank" rel="external">PostCSS</a>配置指北</h2><p><img src="/images/postcss.png" alt="postcss"></p>
<blockquote>
<p><code>PostCSS</code>并不是一门语言，而是一个类似于<code>webpack</code>的工具，它支持很多插件，来达到便捷的编译效果，组成一个CSS编译/lint/autoprefixer的生态圈。它的作者是<a href="https://evilmartians.com/" target="_blank" rel="external">Euil Martians</a>，一家致力于技术研究与网站外包开发的公司。其后端技术栈偏重于Ruby，而前端从React到Node都有涉猎。</p>
</blockquote>
<p><code>PostCSS</code>的一大特点是，具体的编译插件甚至是CSS书写风格，可以根据自己的需要进行安装，选择自己需要的特性：嵌套，函数，变量。自动补全，CSS新特性等等，而不是像<code>less</code>或者<code>scss</code>一样的大型全家桶。因此，不需要再专门去学习<code>less</code>或者<code>scss</code>的语法，只要选择自己喜欢的特性，可以只写CSS文件，但依旧可以写嵌套或者函数，然后选择合适的插件编译它就行了。</p>
<h3 id="Use-with-webpack"><a href="#Use-with-webpack" class="headerlink" title="Use with webpack"></a>Use with webpack</h3><p>鉴于现在<code>webpack</code>也越来越火，所以之后的配置主要是借助于<code>postcss-loader</code>，将<code>PostCSS</code>的生态圈依托在<code>webpack</code>之下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 安装webpack postcss loader</span></div><div class="line">$ npm install postcss-loader --save-dev</div></pre></td></tr></table></figure>
<h4 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 配置webpack.config.js</span></div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="built_in">module</span>: &#123;</div><div class="line">  <span class="attr">loaders</span>: [</div><div class="line">    &#123;</div><div class="line">      <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</div><div class="line">      <span class="comment">// 如果使用了 ExtractTextPlugin</span></div><div class="line">      loader: ExtractTextPlugin.extract(<span class="string">'style'</span>, <span class="string">'css!postcss'</span>)</div><div class="line">      <span class="comment">// 否则</span></div><div class="line">      <span class="comment">// loader: "style-loader!css-loader!postcss-loader"</span></div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;,</div><div class="line"><span class="attr">postcss</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> [ <span class="comment">// 里面是我们要用的插件</span></div><div class="line">	];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="使用插件"><a href="#使用插件" class="headerlink" title="使用插件"></a>使用插件</h4><blockquote>
<p>快速配置一览</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cssnext可以让你写CSS4的语言，并能配合autoprefixer进行浏览器兼容的不全，而且还支持嵌套语法</span></div><div class="line">$ npm install postcss-cssnext --save-dev</div><div class="line"><span class="comment"># 浏览器兼容补全</span></div><div class="line">$ npm install autoprefixer --save-dev</div><div class="line"></div><div class="line"><span class="comment"># 类似scss的语法，实际上如果只是想用嵌套的话有cssnext就够了</span></div><div class="line">$ npm install precss --save-dev</div><div class="line"></div><div class="line"><span class="comment"># 在@import css文件的时候让webpack监听并编译</span></div><div class="line">$ npm install postcss-import --save-dev</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 配置webpack.config.js</span></div><div class="line"><span class="keyword">const</span> postcssImport = <span class="built_in">require</span>(<span class="string">'postcss-import'</span>);</div><div class="line"><span class="keyword">const</span> cssnext = <span class="built_in">require</span>(<span class="string">'postcss-cssnext'</span>);</div><div class="line"></div><div class="line"><span class="comment">// ...</span></div><div class="line">postcss: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> [</div><div class="line">    postcssImport(&#123; <span class="attr">addDependencyTo</span>: webpack &#125;),</div><div class="line">		cssnext(&#123;<span class="attr">autoprefixer</span>: &#123;<span class="attr">browsers</span>: <span class="string">"ie &gt;= 10, ..."</span>&#125;&#125;)</div><div class="line">	];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="兼容性CSS的自动补全"><a href="#兼容性CSS的自动补全" class="headerlink" title="兼容性CSS的自动补全"></a><a href="https://github.com/postcss/autoprefixer" target="_blank" rel="external">兼容性CSS的自动补全</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install autoprefixer --save-dev</div></pre></td></tr></table></figure>
<ul>
<li><code>autoprefixer</code>也可以单独配置使用</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// webpack.config.js</span></div><div class="line"><span class="keyword">const</span> autoprefixer = <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>);</div><div class="line"><span class="comment">// ...</span></div><div class="line">postcss: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> [autoprefixer(&#123; <span class="attr">browsers</span>: [<span class="string">'last 2 versions'</span>] &#125;)]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>或者与<a href="https://github.com/MoOx/postcss-cssnext" target="_blank" rel="external">postcss-cssnext</a>一起使用，但<code>autoprefixer</code>都要进行安装</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> cssnext = <span class="built_in">require</span>(<span class="string">'postcss-cssnext'</span>);</div><div class="line"></div><div class="line">postcss: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="comment">// 通过配置browsers，可以指定将CSS语法兼容到什么程度</span></div><div class="line">  <span class="keyword">return</span> [cssnext(&#123;<span class="attr">autoprefixer</span>: &#123;<span class="attr">browsers</span>: <span class="string">"ie &gt;= 10, ..."</span>&#125;&#125;)]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><a href="https://github.com/postcss/autoprefixer#options" target="_blank" rel="external"><code>autoprefixer</code>的配置</a></li>
</ul>
<h3 id="Use-stylelint"><a href="#Use-stylelint" class="headerlink" title="Use stylelint"></a>Use stylelint</h3><p><a href="https://github.com/stylelint/stylelint" target="_blank" rel="external">Stylelint</a>插件可以让你在编译的时候就知道自己CSS文件里的错误</p>
<h4 id="在webpack内单独使用stylelint"><a href="#在webpack内单独使用stylelint" class="headerlink" title="在webpack内单独使用stylelint"></a>在webpack内单独使用stylelint</h4><p>用到如下插件：</p>
<ul>
<li><a href="https://github.com/vieron/stylelint-webpack-plugin" target="_blank" rel="external">stylelint-webpack-plugin</a></li>
<li><a href="https://github.com/stylelint/stylelint-config-standard" target="_blank" rel="external">stylelint-config-standard</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ npm install stylelint-webpack-plugin --save-dev</div><div class="line"><span class="comment"># stylelint语法，使用标准语法</span></div><div class="line">$ npm install stylelint-config-standard --save-dev</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// webpack.config.js</span></div><div class="line"><span class="keyword">const</span> StyleLintPlugin = <span class="built_in">require</span>(<span class="string">'stylelint-webpack-plugin'</span>);</div><div class="line"><span class="comment">// ...</span></div><div class="line">plugins: [</div><div class="line">	<span class="keyword">new</span> StyleLintPlugin(&#123;</div><div class="line">      <span class="attr">config</span>: &#123;</div><div class="line">        <span class="comment">// 你的lint扩展自刚刚安装的stylelint-config-standard</span></div><div class="line">        <span class="string">"extends"</span>: <span class="string">"stylelint-config-standard"</span></div><div class="line">      &#125;,</div><div class="line">      <span class="comment">// 正则匹配想要lint监测的文件</span></div><div class="line">      files: <span class="string">'frontend/stylesheet/**/*.l?(e|c)ss'</span></div><div class="line">  &#125;),</div><div class="line">],</div></pre></td></tr></table></figure>
<h4 id="在PostCSS内使用-荐"><a href="#在PostCSS内使用-荐" class="headerlink" title="在PostCSS内使用(荐)"></a>在PostCSS内使用(荐)</h4><p>会用到如下插件：</p>
<ul>
<li><a href="https://github.com/stylelint/stylelint" target="_blank" rel="external">stylelint</a></li>
<li><a href="https://github.com/postcss/postcss-reporter" target="_blank" rel="external">postcss-reporter</a></li>
<li><a href="https://github.com/stylelint/stylelint-config-standard" target="_blank" rel="external">stylelint-config-standard</a></li>
</ul>
<h4 id="1-基础使用方式"><a href="#1-基础使用方式" class="headerlink" title="1. 基础使用方式"></a>1. <a href="https://github.com/stylelint/stylelint/blob/master/docs/user-guide/postcss-plugin.md" target="_blank" rel="external">基础使用方式</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 安装stylelint</span></div><div class="line">$ npm install stylelint --save-dev</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// webpack.config.js</span></div><div class="line"><span class="keyword">const</span> stylelint = <span class="built_in">require</span>(<span class="string">'stylelint'</span>);</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="built_in">module</span>: &#123;</div><div class="line">  <span class="attr">loaders</span>: [</div><div class="line">    &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">loader</span>: ExtractTextPlugin.extract(<span class="string">'style'</span>, <span class="string">'css!postcss'</span>) &#125;</div><div class="line">  ]</div><div class="line">&#125;</div><div class="line">postcss: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> [</div><div class="line">    postcssImport(&#123; <span class="attr">addDependencyTo</span>: webpack &#125;),</div><div class="line">    stylelint(&#123;</div><div class="line">      <span class="attr">failOnError</span>: <span class="literal">true</span></div><div class="line">    &#125;)</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这就是最基本的配置了。因为有<code>postcss-loader</code>的存在，所以在webpack解析css的时候，都会调用postcss里返回的插件，因此就会使用<code>stylelint</code>对代码进行检查。</p>
<p>但这样的配置有一个很严重的缺点：如果你在js中引用了node_module里的css文件，或者引用了其他不想进行编译的文件，PostCSS会对其一视同仁的调用插件编译/检查。此时就需要我们来配置<code>.stylelintignore</code>以及<code>stylelint.config.js</code>进行更精确的编译/检查。</p>
<h4 id="2-增加配置文件"><a href="#2-增加配置文件" class="headerlink" title="2. 增加配置文件"></a>2. 增加配置文件</h4><ul>
<li><a href="https://github.com/stylelint/stylelint/blob/master/docs/user-guide/configuration.md" target="_blank" rel="external">stylelint配置说明</a></li>
<li><a href="https://github.com/stylelint/stylelint/blob/master/docs/user-guide/postcss-plugin.md" target="_blank" rel="external">stylelint with postcss配置说明</a></li>
</ul>
<h5 id="stylelintignore"><a href="#stylelintignore" class="headerlink" title=".stylelintignore"></a><code>.stylelintignore</code></h5><p>在项目根目录下添加<code>.stylelintignore</code>文件，并在内部写下不想通过PostCSS编译的文件路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">node_modules/</div><div class="line">frontend/vendor/</div></pre></td></tr></table></figure>
<p>之后，在没有指明<code>ignorePath</code>的情况下，stylelint会自动寻找根目录下的<code>.stylelintignore</code>文件。</p>
<h5 id="stylelint-config-js"><a href="#stylelint-config-js" class="headerlink" title="stylelint.config.js"></a><code>stylelint.config.js</code></h5><p>安装<code>stylelint-config-standard</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install stylelint-config-standard --save-dev</div></pre></td></tr></table></figure>
<p>在配置文件中指明我们的检测语法扩展自该插件：</p>
<ul>
<li><a href="https://github.com/stylelint/stylelint/blob/master/docs/user-guide.md" target="_blank" rel="external">User guide</a></li>
<li><a href="https://github.com/stylelint/stylelint/blob/master/docs/user-guide/rules.md" target="_blank" rel="external">配置规则</a></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 常用配置</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">extends</span>: <span class="string">"stylelint-config-standard"</span>,</div><div class="line">  <span class="comment">// 各rules的具体作用见上面链接</span></div><div class="line">  rules: &#123;</div><div class="line">    <span class="string">"block-no-empty"</span>: <span class="literal">null</span>,</div><div class="line">    <span class="string">"color-no-invalid-hex"</span>: <span class="literal">true</span>,</div><div class="line">    <span class="string">"comment-empty-line-before"</span>: [ <span class="string">"always"</span>, &#123;</div><div class="line">      <span class="string">"ignore"</span>: [<span class="string">"stylelint-commands"</span>, <span class="string">"between-comments"</span>],</div><div class="line">    &#125; ],</div><div class="line">    <span class="string">"declaration-colon-space-after"</span>: <span class="string">"always"</span>,</div><div class="line">    <span class="string">"max-empty-lines"</span>: <span class="number">2</span>,</div><div class="line">    <span class="string">"rule-nested-empty-line-before"</span>: [ <span class="string">"always"</span>, &#123;</div><div class="line">      <span class="string">"except"</span>: [<span class="string">"first-nested"</span>],</div><div class="line">      <span class="string">"ignore"</span>: [<span class="string">"after-comment"</span>],</div><div class="line">    &#125; ],</div><div class="line">    <span class="comment">// 允许的单位</span></div><div class="line">    <span class="string">"unit-whitelist"</span>: [<span class="string">"em"</span>, <span class="string">"rem"</span>, <span class="string">"%"</span>, <span class="string">"s"</span>, <span class="string">"ms"</span>, <span class="string">"px"</span>]</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>然后指明PostCSS的配置文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">postcss: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> [</div><div class="line">    postcssImport(&#123; <span class="attr">addDependencyTo</span>: webpack &#125;),</div><div class="line">    stylelint(&#123;</div><div class="line">        <span class="attr">config</span>: <span class="built_in">require</span>(<span class="string">'../../stylelint.config.js'</span>),</div><div class="line">        <span class="attr">failOnError</span>: <span class="literal">true</span></div><div class="line">    &#125;)</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此时运行webpack，有问题的CSS文件输出大概是这样的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">WARNING <span class="keyword">in</span> ./~/css-loader!./~/postcss-loader!./frontend/stylesheet/layout/test_post_css.css</div><div class="line">    stylelint: /Users/ecmadao1/Dev/Python/where_to_go/frontend/stylesheet/layout/test_post_css.css:17:1: Expected indentation of 2 spaces (indentation)</div></pre></td></tr></table></figure>
<p>很难看清楚吧！因此接下来安装<code>postcss-reporter</code>来美化输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install postcss-reporter --save-dev</div></pre></td></tr></table></figure>
<p>webpack配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">postcss: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> [</div><div class="line">    postcssImport(&#123; <span class="attr">addDependencyTo</span>: webpack &#125;),</div><div class="line">    stylelint(&#123;</div><div class="line">        <span class="attr">config</span>: <span class="built_in">require</span>(<span class="string">'../../stylelint.config.js'</span>),</div><div class="line">        <span class="attr">failOnError</span>: <span class="literal">true</span></div><div class="line">    &#125;),</div><div class="line">    postcssReporter(&#123; <span class="attr">clearMessages</span>: <span class="literal">true</span> &#125;)</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>之后的输出会是这样的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frontend/stylesheet/layout/test_post_css.css</div><div class="line">17:1    ⚠  Expected indentation of 2 spaces (indentation) [stylelint]</div></pre></td></tr></table></figure>
<p>吊吊哒！</p>
<h4 id="3-StyleLintPlugin的配置参数"><a href="#3-StyleLintPlugin的配置参数" class="headerlink" title="3. StyleLintPlugin的配置参数"></a>3. <a href="https://github.com/vieron/stylelint-webpack-plugin#options" target="_blank" rel="external">StyleLintPlugin的配置参数</a></h4><p><a href="http://stylelint.io/user-guide/node-api/#options" target="_blank" rel="external">stylelint options</a>里面的配置也可以在plugin里使用。介绍几个常用的配置：</p>
<ul>
<li>config：lint基础配置。没有的话则会去寻找<code>.stylelintrc</code></li>
<li>configFile：lint配置文件。可以被config的配置替代。默认为<code>.stylelintrc</code>文件</li>
<li>context：上下文环境。默认使用webpack的context</li>
<li>files：要匹配的文件。默认为<code>[&#39;**/*.s?(a|c)ss&#39;]</code></li>
<li>failOnError：错误时是否停止编译。默认<code>false</code></li>
<li>quiet：在console中不打印错误信息。默认<code>false</code></li>
</ul>
<h3 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h3><h4 id="postcss-amp-loader"><a href="#postcss-amp-loader" class="headerlink" title="postcss &amp; loader"></a>postcss &amp; loader</h4><ul>
<li><a href="https://github.com/postcss/postcss" target="_blank" rel="external">postcss</a></li>
<li><a href="https://github.com/postcss/postcss-loader" target="_blank" rel="external">postcss-loader</a></li>
<li><a href="https://github.com/postcss/postcss-import" target="_blank" rel="external">postcss-import</a></li>
</ul>
<h4 id="autoprefixer-amp-cssnext"><a href="#autoprefixer-amp-cssnext" class="headerlink" title="autoprefixer &amp; cssnext"></a>autoprefixer &amp; cssnext</h4><ul>
<li><a href="http://cssnext.io/" target="_blank" rel="external">cssnext</a></li>
<li><a href="https://github.com/postcss/autoprefixer" target="_blank" rel="external">autoprefixer</a></li>
<li><a href="https://github.com/ai/browserslist" target="_blank" rel="external">browserslist</a></li>
</ul>
<h4 id="stylelint"><a href="#stylelint" class="headerlink" title="stylelint"></a>stylelint</h4><ul>
<li><a href="https://github.com/stylelint/stylelint" target="_blank" rel="external">stylelint</a></li>
<li><a href="https://github.com/vieron/stylelint-webpack-plugin" target="_blank" rel="external">stylelint-webpack-plugin</a></li>
<li><a href="https://github.com/stylelint/stylelint-config-standard" target="_blank" rel="external">stylelint-config-standard</a></li>
<li><a href="https://github.com/postcss/postcss-reporter" target="_blank" rel="external">postcss-reporter</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="CSS" scheme="http://ecmadao.com/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>Elm基础语法</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/Elm/Elm%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/Elm/Elm基础语法/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#elm%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95">Elm基础语法</a><ul>
<li><a href="#%E5%9F%BA%E6%9C%AC">基本</a><ul>
<li><a href="#type">Type</a><ul>
<li><a href="#type-aliases">Type aliases</a></li>
<li><a href="#union-types">Union types</a></li>
<li><a href="#unit-type">unit type</a></li>
</ul>
</li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5">字符串拼接</a></li>
<li><a href="#%E7%AE%97%E6%95%B0">算数</a></li>
<li><a href="#boolean">boolean</a></li>
<li><a href="#%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F">条件表达式</a></li>
</ul>
</li>
<li><a href="#more">more</a><ul>
<li><a href="#func">Func</a></li>
<li><a href="#letin">let..in..</a></li>
<li><a href="#list">List</a></li>
<li><a href="#tuple">tuple</a></li>
<li><a href="#record">Record</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="Elm基础语法"><a href="#Elm基础语法" class="headerlink" title="Elm基础语法"></a>Elm基础语法</h2><p><a href="https://learnxinyminutes.com/docs/elm/" target="_blank" rel="external">Learn X in Y minutes – Where X=Elm</a></p>
<h3 id="基本"><a href="#基本" class="headerlink" title="基本"></a>基本</h3><h4 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h4><p><a href="https://github.com/elm-guides/elm-for-js/blob/master/How%20to%20Read%20a%20Type%20Annotation.md" target="_blank" rel="external">How to Read a Type Annotation</a></p>
<p>基本类型和多数语言是类似的，String, Char, Bool Int, Float。<br>但需要注意，String必须用双引号，单引号是用来表示Char的</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 类型声明</span></div><div class="line"><span class="title">a</span>: <span class="type">Int</span> <span class="comment">-- 声明a变量必须是Int类型</span></div><div class="line"><span class="title">a</span> = <span class="number">1</span> <span class="comment">-- 注意在声明之后就需要赋值</span></div><div class="line"></div><div class="line"><span class="comment">-- 声明函数(接受类型和返回类型)</span></div><div class="line"><span class="title">func</span>: <span class="type">Int</span> -&gt; <span class="type">Int</span> <span class="comment">-- 接受一个Int，并返回一个Int</span></div><div class="line"><span class="title">fun</span>: <span class="type">String</span> -&gt; <span class="type">Int</span> -&gt; <span class="type">String</span> <span class="comment">-- 接受一个String一个Int，并返回一个String</span></div></pre></td></tr></table></figure>
<h5 id="Type-aliases"><a href="#Type-aliases" class="headerlink" title="Type aliases"></a>Type aliases</h5><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 类型设置别名</span></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Id</span> = <span class="type">Int</span></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">UserName</span> = <span class="type">String</span></div><div class="line"></div><div class="line"><span class="comment">-- 对于Records</span></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">User</span> = &#123;</div><div class="line">  id: <span class="type">Int</span>,</div><div class="line">  name: <span class="type">String</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">-- 可以通过先对类型设置别名的方式，进行比较简单的声明</span></div><div class="line"><span class="title">a</span>: &#123;b: <span class="type">String</span>, c: <span class="type">Int</span>&#125; <span class="comment">-- a是一个类型较复杂的对象</span></div><div class="line"><span class="title">d</span>: <span class="type">List</span> &#123;b: <span class="type">String</span>, c: <span class="type">Int</span>&#125; <span class="comment">-- d是a组成的List</span></div><div class="line"></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">A</span> = &#123;b: <span class="type">String</span>, c: <span class="type">Int</span>&#125; <span class="comment">-- 声明A的类型</span></div><div class="line"><span class="title">a</span>: <span class="type">A</span></div><div class="line"><span class="title">d</span>: <span class="type">List</span> <span class="type">A</span></div></pre></td></tr></table></figure>
<h5 id="Union-types"><a href="#Union-types" class="headerlink" title="Union types"></a>Union types</h5><p>对于一个不确定类型的变量，其类型可以用<code>|</code>间隔，每个类型叫作一个<strong>Tag</strong></p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> <span class="type">Answer</span> = <span class="type">Yes</span> | <span class="type">No</span></div><div class="line"><span class="keyword">type</span> <span class="type">Visibility</span> = <span class="type">All</span> | <span class="type">Active</span> | <span class="type">Completed</span></div><div class="line"></div><div class="line"><span class="comment">-- usage</span></div><div class="line"><span class="title">update</span> visibility =</div><div class="line">	<span class="keyword">case</span> visibility <span class="keyword">of</span></div><div class="line">		<span class="type">All</span> -&gt;</div><div class="line">			<span class="comment">-- do something</span></div><div class="line">		<span class="type">Active</span> -&gt;</div><div class="line">			<span class="comment">-- do something</span></div><div class="line">		<span class="type">Completed</span> -&gt;</div><div class="line">			<span class="comment">-- do something</span></div></pre></td></tr></table></figure>
<p><strong>Union type</strong>里的Tag还可以是一个方法，后面要跟着它能接受的参数类型，且这个方法的返回值要跟目标type一样</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> <span class="type">User</span> = <span class="type">Anonymous</span> | <span class="type">Named</span> <span class="type">String</span></div><div class="line"></div><div class="line"><span class="type">Anonymous</span> : <span class="type">User</span></div><div class="line"><span class="type">Named</span>: <span class="type">String</span> -&gt; <span class="type">User</span></div><div class="line"></div><div class="line"><span class="comment">-- example</span></div><div class="line"><span class="title">userPhoto</span> : <span class="type">User</span> -&gt; <span class="type">String</span></div><div class="line"><span class="title">userPhoto</span> user =</div><div class="line">  <span class="keyword">case</span> user <span class="keyword">of</span></div><div class="line">    <span class="type">Anonymous</span> -&gt;</div><div class="line">      <span class="string">"anon.png"</span></div><div class="line">    <span class="type">Named</span> name -&gt;</div><div class="line">      <span class="string">"users/"</span> ++ name ++ <span class="string">".png"</span></div></pre></td></tr></table></figure>
<h5 id="unit-type"><a href="#unit-type" class="headerlink" title="unit type"></a>unit type</h5><p>在Elm里，空tuple<code>()</code>叫作<code>unit type</code>，经常被当做占位符使用。</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 举个栗子</span></div><div class="line"><span class="comment">-- 定义一个Message，这个别名接受一个参数并返回一个Record</span></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Message</span> a =</div><div class="line">    &#123; code : <span class="type">String</span></div><div class="line">    , body : a</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">-- 定义一个func，接受Message作为参数，同时函数内部Message必须接受一个String</span></div><div class="line"><span class="title">readMessage</span> : <span class="type">Message</span> <span class="type">String</span> -&gt; <span class="type">String</span></div><div class="line"><span class="title">readMessage</span> message =</div><div class="line">    ...</div><div class="line"></div><div class="line"><span class="comment">-- 但是如果Message在readMessage方法内不需要接受参数，则使用空tuple作为参数</span></div><div class="line"><span class="title">readMessage</span> : <span class="type">Message</span> () -&gt; <span class="type">String</span></div><div class="line"><span class="title">readMessage</span> message =</div><div class="line">    ...</div></pre></td></tr></table></figure>
<h4 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">"hey"</span> ++ <span class="string">" world"</span></div><div class="line"><span class="comment">-- hey world</span></div></pre></td></tr></table></figure>
<h4 id="算数"><a href="#算数" class="headerlink" title="算数"></a>算数</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 整除</span></div><div class="line"><span class="number">9</span> // <span class="number">2</span> <span class="comment">-- 4</span></div><div class="line"></div><div class="line"><span class="comment">-- 返回浮点数的除法</span></div><div class="line"><span class="number">9</span> /<span class="number">2</span> <span class="comment">-- 4.5</span></div><div class="line"></div><div class="line"><span class="comment">-- 平方</span></div><div class="line"><span class="number">5</span> ^ <span class="number">2</span> <span class="comment">-- 25</span></div></pre></td></tr></table></figure>
<h4 id="boolean"><a href="#boolean" class="headerlink" title="boolean"></a>boolean</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="title">not</span> <span class="type">True</span> <span class="comment">-- False</span></div><div class="line"><span class="number">1</span> == <span class="number">1</span> <span class="comment">-- True</span></div><div class="line"><span class="number">1</span> /= <span class="number">1</span> <span class="comment">-- False</span></div><div class="line"><span class="number">1</span> &lt; <span class="number">10</span> <span class="comment">-- False</span></div></pre></td></tr></table></figure>
<h4 id="条件表达式"><a href="#条件表达式" class="headerlink" title="条件表达式"></a>条件表达式</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- if else</span></div><div class="line"><span class="title">if</span> <span class="type">True</span> <span class="keyword">then</span> .. <span class="keyword">else</span> ..</div><div class="line"></div><div class="line"><span class="title">if</span> <span class="type">True</span> <span class="keyword">then</span> </div><div class="line">  ..</div><div class="line"><span class="title">else</span> <span class="keyword">if</span> <span class="type">True</span> <span class="keyword">then</span> </div><div class="line">  ..</div><div class="line"><span class="title">else</span></div><div class="line">  ..</div><div class="line"></div><div class="line"><span class="comment">-- case</span></div><div class="line"><span class="title">case</span> <span class="type">List</span>.head aList <span class="keyword">of</span></div><div class="line">  <span class="type">Just</span> x -&gt;</div><div class="line">  	<span class="string">"The head is "</span> ++ toString x</div><div class="line">  <span class="type">Nothing</span> -&gt;</div><div class="line">  	<span class="string">"The list was empty."</span></div></pre></td></tr></table></figure>
<h3 id="more"><a href="#more" class="headerlink" title="more"></a>more</h3><h4 id="Func"><a href="#Func" class="headerlink" title="Func"></a>Func</h4><p><strong>类型的定义</strong></p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 以空格表示参数的接受和定义</span></div><div class="line"><span class="title">fun</span>: <span class="type">Int</span> -&gt; <span class="type">Int</span> -&gt; <span class="type">Int</span></div><div class="line"><span class="title">fun</span> a b =</div><div class="line">	a + b</div><div class="line">	</div><div class="line"><span class="title">fun</span> <span class="number">1</span> <span class="number">2</span> <span class="comment">-- 3</span></div></pre></td></tr></table></figure>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 使用\表示匿名函数</span></div><div class="line"><span class="type">List</span>.map (\a -&gt; a * <span class="number">2</span>) [<span class="number">1.</span><span class="number">.4</span>] <span class="comment">-- [2, 4, 6, 8]</span></div></pre></td></tr></table></figure>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 在表示函数的参数和返回值的类型时，使用箭头链接</span></div><div class="line"><span class="title">fun</span>: <span class="type">Int</span> -&gt; <span class="type">Int</span> -&gt; <span class="type">Int</span></div><div class="line"><span class="comment">-- 代表</span></div><div class="line"><span class="title">fun</span> a b =</div><div class="line">	<span class="comment">-- 只返回一个Int类型</span></div><div class="line">	a + b</div><div class="line"></div><div class="line"><span class="title">fun</span>: <span class="type">Int</span> -&gt; <span class="type">Int</span> -&gt; <span class="type">Int</span> -&gt; <span class="type">Int</span></div><div class="line"><span class="comment">-- 代表</span></div><div class="line"><span class="title">fun</span> a b c=</div><div class="line">	<span class="comment">-- 只返回一个Int类型</span></div><div class="line">	a + b + c</div></pre></td></tr></table></figure>
<p><strong>why ?</strong></p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- why </span></div><div class="line"><span class="type">Int</span> -&gt; <span class="type">Int</span> -&gt; <span class="type">Int</span></div><div class="line"><span class="comment">-- not</span></div><div class="line">(<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Int</span></div></pre></td></tr></table></figure>
<p>你可能会问，为什么参数类型表示的是使用连续的箭头链接？这给人的直观感觉是，函数接受第一个参数后，返回一个函数，接受第二个参数，然后不断返回接受一个参数的函数直至最后返回一个结果。其实差不多就是这样。Elm是一门FP语言，而这样的函数就展现了柯里化（curry）的思想。</p>
<p><strong>curry</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">y</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> x + y;</div><div class="line">  &#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">const</span> increment = add(<span class="number">1</span>);</div><div class="line">increment(<span class="number">1</span>); <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- elm里的curry很自由</span></div><div class="line"><span class="comment">-- 不需要特地返回一函数</span></div><div class="line"><span class="title">add</span>: <span class="type">Int</span> -&gt; <span class="type">Int</span> -&gt; <span class="type">Int</span></div><div class="line"><span class="title">add</span> x y =</div><div class="line">	x + y</div><div class="line"></div><div class="line"><span class="title">add2</span> = add <span class="number">2</span></div><div class="line"><span class="title">add2</span> <span class="number">3</span> <span class="comment">-- 5</span></div><div class="line"><span class="comment">-- 即</span></div><div class="line"><span class="title">add</span> (<span class="type">Int</span> <span class="type">Int</span>) == add (<span class="type">Int</span>) (<span class="type">Int</span>)</div></pre></td></tr></table></figure>
<p><strong>其他参数类型</strong></p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 接收/返回多个变量</span></div><div class="line"><span class="title">switch</span>: (a, b) -&gt; (b, a)</div><div class="line"><span class="title">switch</span> (x, y) =</div><div class="line">	(y, x)</div><div class="line"></div><div class="line"><span class="comment">-- 函数作为参数</span></div><div class="line"><span class="title">convertIntToString</span>: <span class="type">Int</span> -&gt; <span class="type">String</span></div><div class="line">	toString <span class="type">Int</span></div><div class="line"></div><div class="line"><span class="title">map</span>: (<span class="type">Int</span> -&gt; <span class="type">String</span>) -&gt; <span class="type">List</span> <span class="type">Int</span> -&gt; <span class="type">List</span> <span class="type">String</span></div><div class="line"><span class="title">map</span> convertIntToString [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="comment">-- ["1", "2", "3"]</span></div><div class="line"></div><div class="line"><span class="comment">-- 但有时候我们可以不用特指参数类型</span></div><div class="line"><span class="title">map</span>: (a -&gt; b) -&gt; <span class="type">List</span> a -&gt; <span class="type">List</span> b</div><div class="line"></div><div class="line"><span class="comment">-- 这样只要第一个函数的参数/返回值和List a/b的类型相同就行了</span></div><div class="line"><span class="comment">-- 因此下面这些函数都是可行的</span></div><div class="line"><span class="title">convertStringToInt</span> : <span class="type">String</span> -&gt; <span class="type">Int</span></div><div class="line"><span class="title">convertIntToString</span> : <span class="type">Int</span> -&gt; <span class="type">String</span></div><div class="line"><span class="title">convertBoolToInt</span> : <span class="type">Bool</span> -&gt; <span class="type">Int</span></div><div class="line"></div><div class="line"><span class="comment">-- example</span></div><div class="line"><span class="title">map</span> convertStringToInt [<span class="string">"Hello"</span>, <span class="string">"1"</span>]</div><div class="line"><span class="title">map</span> convertIntToString [<span class="number">1</span>, <span class="number">2</span>]</div><div class="line"><span class="title">map</span> convertBoolToInt [<span class="type">True</span>, <span class="type">False</span>]</div></pre></td></tr></table></figure>
<h4 id="let-in"><a href="#let-in" class="headerlink" title="let..in.."></a>let..in..</h4><p>let 表达式的结果会被用在in表达式内</p>
<blockquote>
<p><code>let</code> defines local variables for <code>in</code></p>
</blockquote>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="title">volume</span> &#123;width, height, depth&#125; =</div><div class="line">  <span class="keyword">let</span></div><div class="line">    area = width * height</div><div class="line">  <span class="keyword">in</span></div><div class="line">    area * depth</div><div class="line"><span class="title">volume</span> &#123; width = <span class="number">3</span>, height = <span class="number">2</span>, depth = <span class="number">7</span> &#125; <span class="comment">-- 42</span></div></pre></td></tr></table></figure>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p><a href="http://package.elm-lang.org/packages/elm-lang/core/3.0.0/List" target="_blank" rel="external">elm-lang - core - List</a></p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> List</div><div class="line"></div><div class="line"><span class="comment">-- List的类型为List a，其中a表示任意的类型。但一个List里的元素必须都是一样的类型</span></div><div class="line"><span class="comment">-- elements in a List must be the same type</span></div><div class="line"></div><div class="line">[<span class="number">1.</span><span class="number">.5</span>] == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] <span class="comment">-- True</span></div><div class="line"></div><div class="line"><span class="title">repeat</span>: <span class="type">Int</span> -&gt; a -&gt; <span class="type">List</span> a</div><div class="line"><span class="comment">-- Create a list with n copies of a value</span></div><div class="line"><span class="title">repeat</span> <span class="number">3</span> (<span class="number">0</span>,<span class="number">0</span>) == [(<span class="number">0</span>,<span class="number">0</span>),(<span class="number">0</span>,<span class="number">0</span>),(<span class="number">0</span>,<span class="number">0</span>)]</div><div class="line"></div><div class="line"><span class="title">append</span>: <span class="type">List</span> a -&gt; <span class="type">List</span> a -&gt; <span class="type">List</span> a</div><div class="line"><span class="comment">-- append list</span></div><div class="line">[<span class="number">1.</span><span class="number">.5</span>] ++ [<span class="number">6.</span><span class="number">.10</span>] == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</div><div class="line"><span class="title">append</span> [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>] [<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>] == [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>]</div><div class="line"><span class="title">append</span> ['a','b'] ['c'] == ['a','b','c']</div><div class="line"></div><div class="line">(::): a -&gt; <span class="type">List</span> a -&gt; <span class="type">List</span> a</div><div class="line"><span class="comment">-- add item to the front of a list</span></div><div class="line"><span class="number">0</span> :: [<span class="number">1.</span><span class="number">.5</span>] <span class="comment">-- [0, 1, 2, 3, 4, 5]</span></div><div class="line"></div><div class="line"><span class="title">concat</span>: <span class="type">List</span> (<span class="type">List</span> a) -&gt;<span class="type">List</span> a</div><div class="line"><span class="title">concat</span> [[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>]] == [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</div></pre></td></tr></table></figure>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> List</div><div class="line"><span class="title">examples</span>: <span class="type">List</span> <span class="type">Int</span></div><div class="line"><span class="title">examples</span> = [<span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>]</div><div class="line"></div><div class="line"><span class="type">List</span>.isEmpty: <span class="type">List</span> a -&gt; <span class="type">Bool</span></div><div class="line"><span class="comment">-- Determine if a list is empty.</span></div><div class="line"><span class="type">List</span>.isEmpty examples <span class="comment">-- False</span></div><div class="line"></div><div class="line"><span class="type">List</span>.length: <span class="type">List</span> a -&gt; <span class="type">Int</span></div><div class="line"><span class="type">List</span>.length examples <span class="comment">-- 5</span></div><div class="line"></div><div class="line"><span class="type">List</span>.reverse: <span class="type">List</span> a -&gt; <span class="type">List</span> a</div><div class="line"><span class="comment">-- Reverse a list.</span></div><div class="line"><span class="type">List</span>.reverse examples <span class="comment">-- [3, 4, 5, 1, 2]</span></div><div class="line"></div><div class="line"><span class="type">List</span>.sort: <span class="type">List</span> a -&gt; <span class="type">List</span> a</div><div class="line"><span class="comment">-- sort a list</span></div><div class="line"><span class="type">List</span>.sort examples -&gt; [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</div><div class="line"></div><div class="line"><span class="type">List</span>.member: a -&gt; <span class="type">List</span> a -&gt; <span class="type">Bool</span></div><div class="line"><span class="comment">-- Figure out whether a list contains a value.</span></div><div class="line"><span class="title">member</span> <span class="number">9</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>] == <span class="type">False</span></div><div class="line"><span class="title">member</span> <span class="number">4</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>] == <span class="type">True</span></div><div class="line"></div><div class="line"><span class="type">List</span>.map: (a -&gt; b) -&gt; <span class="type">List</span> a -&gt; <span class="type">List</span> b</div><div class="line"><span class="comment">-- map func</span></div><div class="line"><span class="title">double</span> n = n * <span class="number">2</span></div><div class="line"><span class="title">number_list</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</div><div class="line"><span class="type">List</span>.map double number_list <span class="comment">-- [2, 4, 6, 8]</span></div></pre></td></tr></table></figure>
<h4 id="tuple"><a href="#tuple" class="headerlink" title="tuple"></a>tuple</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- tuple有固定的长度，里面元素的类型可以不同</span></div><div class="line">(<span class="string">"elm"</span>, <span class="number">42</span>)</div><div class="line"></div><div class="line"><span class="title">fst</span> (<span class="string">"elm"</span>, <span class="number">42</span>) <span class="comment">-- "elm"</span></div><div class="line"><span class="title">snd</span> (<span class="string">"elm"</span>, <span class="number">42</span>) <span class="comment">-- 42</span></div><div class="line"></div><div class="line"><span class="comment">-- 空tuple叫作unit，经常作为占位符使用</span></div><div class="line">()</div></pre></td></tr></table></figure>
<h4 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h4><p>key = value组成的键值对</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- like tuples but the fields have names</span></div><div class="line">&#123; x = <span class="number">3</span>, y = <span class="number">7</span> &#125;</div><div class="line"></div><div class="line">&#123; x = <span class="number">3</span>, y = <span class="number">7</span> &#125;.x <span class="comment">-- 3</span></div><div class="line">.y &#123; x = <span class="number">3</span>, y = <span class="number">7</span> &#125; <span class="comment">-- 7</span></div><div class="line"></div><div class="line"><span class="comment">-- 更新 record. (It must have the fields already.)</span></div><div class="line">&#123; person |</div><div class="line">  name = <span class="string">"ecmadao"</span> &#125;</div><div class="line"></div><div class="line"><span class="comment">-- 批量更新</span></div><div class="line">&#123; person |</div><div class="line">  name = <span class="string">"ecmadao"</span>,</div><div class="line">  age = <span class="number">24</span>&#125;</div></pre></td></tr></table></figure>
<p>与Object不同的是，Record不能使用自身不存在的键，且键值不能是undefined或者null</p>
<p><strong>Record赋值：</strong></p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Model</span> = </div><div class="line">  &#123;a: <span class="type">Int</span>, b: <span class="type">String</span>&#125;</div><div class="line"></div><div class="line"><span class="title">model</span> = <span class="type">Model</span> <span class="number">1</span> <span class="string">"1"</span> </div><div class="line"><span class="comment">-- &#123;a = 1, b = "1"&#125;</span></div></pre></td></tr></table></figure>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="title">origin</span> : &#123; x : <span class="type">Float</span>, y : <span class="type">Float</span>, z : <span class="type">Float</span> &#125;</div><div class="line"><span class="title">origin</span> =</div><div class="line">  &#123; x = <span class="number">0</span>, y = <span class="number">0</span>, z = <span class="number">0</span> &#125;</div><div class="line"></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Point3D</span> =</div><div class="line">  &#123; x : <span class="type">Float</span>, y : <span class="type">Float</span>, z : <span class="type">Float</span> &#125;</div><div class="line"></div><div class="line"><span class="title">otherOrigin</span> : <span class="type">Point3D</span></div><div class="line"><span class="title">otherOrigin</span> =</div><div class="line">  <span class="type">Point3D</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></div><div class="line"></div><div class="line"><span class="title">origin</span> == otherOrigin <span class="comment">-- True</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="Elm" scheme="http://ecmadao.com/tags/Elm/"/>
    
  </entry>
  
  <entry>
    <title>Think in Elm</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/Elm/Think%20in%20Elm/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/Elm/Think in Elm/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#think-in-elm">Think in Elm</a><ul>
<li><a href="#%E5%9F%BA%E7%A1%80%E7%BB%84%E6%88%90">基础组成</a><ul>
<li><a href="#counter-example%EF%BC%9A">Counter Example：</a></li>
<li><a href="#input-example">Input Example</a></li>
<li><a href="#update">Update</a></li>
</ul>
</li>
<li><a href="#%E6%B7%B7%E5%90%88%E5%AE%9E%E4%BE%8B">混合实例</a><ul>
<li><a href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%8D%95">注册表单</a></li>
</ul>
</li>
<li><a href="#advance">Advance</a><ul>
<li><a href="#subscriptions">subscriptions</a><ul>
<li><a href="#example-">example :</a></li>
</ul>
</li>
<li><a href="#commands">Commands</a><ul>
<li><a href="#example--%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0">example–生成随机数</a></li>
</ul>
</li>
<li><a href="#tasks">Tasks</a></li>
<li><a href="#import-&amp;-module">import &amp; module</a></li>
</ul>
</li>
<li><a href="#%E7%94%9F%E6%88%90html">生成HTML</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="Think-in-Elm"><a href="#Think-in-Elm" class="headerlink" title="Think in Elm"></a>Think in Elm</h2><p><img src="/images/elm-application-flow.png" alt="Elm Application Flow"></p>
<h3 id="基础组成"><a href="#基础组成" class="headerlink" title="基础组成"></a>基础组成</h3><p>Elm的基本概念由Model, Update, View三者组成：</p>
<blockquote>
<p>Model — the state of your application</p>
<p>Update — a way to update your state. composed by messages &amp; update</p>
<p>iew — a way to view your state as HTML</p>
</blockquote>
<p><a href="http://www.elm-tutorial.org/en/02-elm-arch/02-structure.html" target="_blank" rel="external">Elm structure</a></p>
<h4 id="Counter-Example："><a href="#Counter-Example：" class="headerlink" title="Counter Example："></a>Counter Example：</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Html <span class="keyword">exposing</span> (..)</div><div class="line"><span class="keyword">import</span> Html.Attributes <span class="keyword">exposing</span> (..)</div><div class="line"><span class="keyword">import</span> Html.Events <span class="keyword">exposing</span> (onClick)</div><div class="line"><span class="keyword">import</span> Html.App <span class="keyword">as</span> App</div><div class="line"></div><div class="line"><span class="comment">-- Model，App state</span></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Model</span> = <span class="type">Int</span></div><div class="line"><span class="title">initModel</span> : <span class="type">Model</span></div><div class="line"><span class="title">initModel</span> = <span class="number">999</span></div><div class="line"></div><div class="line"><span class="comment">-- update the way you can update your state</span></div><div class="line"></div><div class="line"><span class="comment">-- define messages type</span></div><div class="line"><span class="keyword">type</span> <span class="type">Msg</span> = <span class="type">Increment</span> | <span class="type">Decrement</span></div><div class="line"></div><div class="line"><span class="comment">-- define update func</span></div><div class="line"><span class="title">update</span> : <span class="type">Msg</span> -&gt; <span class="type">Model</span> -&gt; <span class="type">Model</span></div><div class="line"><span class="title">update</span> msg model =</div><div class="line">  <span class="keyword">case</span> msg <span class="keyword">of</span></div><div class="line">    <span class="type">Increment</span> -&gt;</div><div class="line">      model + <span class="number">1</span></div><div class="line">    <span class="type">Decrement</span> -&gt;</div><div class="line">      model - <span class="number">1</span></div><div class="line"></div><div class="line"><span class="comment">-- view, render as html</span></div><div class="line"><span class="title">view</span>: <span class="type">Model</span> -&gt; <span class="type">Html</span> <span class="type">Msg</span></div><div class="line"><span class="title">view</span> model =</div><div class="line">  div [class <span class="string">"model_container"</span>]</div><div class="line">    [ button [onClick <span class="type">Decrement</span>] [text <span class="string">"-"</span>]</div><div class="line">    , text (toString model)</div><div class="line">    , button [onClick <span class="type">Increment</span>] [text <span class="string">"+"</span>]</div><div class="line">    ]</div><div class="line"></div><div class="line"><span class="title">main</span> = <span class="type">App</span>.beginnerProgram &#123;model = initModel, view = view, update = update&#125;</div></pre></td></tr></table></figure>
<h4 id="Input-Example"><a href="#Input-Example" class="headerlink" title="Input Example"></a>Input Example</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Html <span class="keyword">exposing</span> (<span class="type">Html</span>, <span class="type">Attribute</span>, text, div, input)</div><div class="line"><span class="keyword">import</span> Html.App <span class="keyword">exposing</span> (beginnerProgram)</div><div class="line"><span class="keyword">import</span> Html.Attributes <span class="keyword">exposing</span> (..)</div><div class="line"><span class="keyword">import</span> Html.Events <span class="keyword">exposing</span> (onInput)</div><div class="line"><span class="keyword">import</span> String</div><div class="line"></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Model</span> = <span class="type">String</span></div><div class="line"></div><div class="line"><span class="title">initModel</span>: <span class="type">Model</span></div><div class="line"><span class="title">initModel</span> = <span class="string">""</span></div><div class="line"></div><div class="line"><span class="keyword">type</span> <span class="type">Msg</span> = <span class="type">NewContent</span> <span class="type">String</span></div><div class="line"></div><div class="line"><span class="title">update</span>: <span class="type">Msg</span> -&gt; <span class="type">Model</span> -&gt; <span class="type">Model</span></div><div class="line"><span class="title">update</span> msg model =</div><div class="line">  <span class="keyword">case</span> msg <span class="keyword">of</span></div><div class="line">    <span class="type">NewContent</span> content -&gt;</div><div class="line">      content</div><div class="line"></div><div class="line"><span class="title">view</span> model =</div><div class="line">  div []</div><div class="line">    [</div><div class="line">      input [onInput <span class="type">NewContent</span>, placeholder <span class="string">"placeholder"</span>] [],</div><div class="line">      div [] [text model]</div><div class="line">    ]</div><div class="line"></div><div class="line"><span class="title">main</span> = beginnerProgram &#123;model = initModel, view = view, update = update&#125;</div></pre></td></tr></table></figure>
<h4 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 定义操作类型</span></div><div class="line"><span class="keyword">type</span> <span class="type">Msg</span> = <span class="type">Increment</span> | <span class="type">Decrement</span></div><div class="line"><span class="comment">-- or</span></div><div class="line"><span class="keyword">type</span> <span class="type">Operation</span> = <span class="type">Increment</span> | <span class="type">Decrement</span> | <span class="type">Reset</span></div><div class="line"><span class="comment">-- or</span></div><div class="line"><span class="keyword">type</span> <span class="type">Bool</span> = <span class="type">True</span> | <span class="type">False</span></div></pre></td></tr></table></figure>
<p>定义的Msg，Operation叫作Union type，用来表示一组可能的值。它的名称可以自己定义，但要大写开头。<br>类型的可能的值叫作Tag</p>
<p><strong>Tag也可以是一个接受参数的函数</strong>，例如：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> <span class="type">Msg</span></div><div class="line">  = <span class="type">Change</span> <span class="type">String</span></div><div class="line"></div><div class="line"><span class="type">Change</span>: <span class="type">String</span> -&gt; <span class="type">String</span></div></pre></td></tr></table></figure>
<p>定义类型如何改变数据：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 定义类型如何改变数据</span></div><div class="line"><span class="comment">-- 该update方法接受operation和state作为参数</span></div><div class="line"><span class="title">update</span> operation state =</div><div class="line">  <span class="keyword">case</span> operation <span class="keyword">of</span></div><div class="line">    <span class="type">Increment</span> -&gt;</div><div class="line">      state + <span class="number">1</span></div><div class="line">    <span class="type">Decrement</span> -&gt;</div><div class="line">      state - <span class="number">1</span></div><div class="line">    <span class="type">Reset</span> -&gt;</div><div class="line">      <span class="number">0</span></div><div class="line"></div><div class="line"><span class="comment">-- view</span></div><div class="line"><span class="title">view</span> : <span class="type">Model</span> -&gt; <span class="type">Html</span> <span class="type">Msg</span></div><div class="line"><span class="title">view</span> model =</div><div class="line">  div []</div><div class="line">    [ input [ placeholder <span class="string">"Text to reverse"</span>, onInput <span class="type">Change</span> ] []</div><div class="line">    , div [] [ text (<span class="type">String</span>.reverse model.content) ]</div><div class="line">    ]</div></pre></td></tr></table></figure>
<p>实例：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- model</span></div><div class="line"><span class="comment">-- Model的类型是一个record</span></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Model</span> =</div><div class="line">  &#123; content : <span class="type">String</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line"><span class="title">model</span> : <span class="type">Model</span></div><div class="line"><span class="title">model</span> =</div><div class="line">  &#123; content = <span class="string">""</span> &#125;</div><div class="line"></div><div class="line"><span class="comment">-- update</span></div><div class="line"><span class="comment">-- tag是Change String，其中Change接受String类型作为参数，并返回Model类型</span></div><div class="line"><span class="keyword">type</span> <span class="type">Msg</span></div><div class="line">  = <span class="type">Change</span> <span class="type">String</span></div><div class="line"></div><div class="line"><span class="title">update</span> : <span class="type">Msg</span> -&gt; <span class="type">Model</span> -&gt; <span class="type">Model</span></div><div class="line"><span class="title">update</span> msg model =</div><div class="line">  <span class="keyword">case</span> msg <span class="keyword">of</span></div><div class="line">    <span class="type">Change</span> newContent -&gt;</div><div class="line">      &#123; model | content = newContent &#125; <span class="comment">-- 更新record类型的model中的content key</span></div></pre></td></tr></table></figure>
<h3 id="混合实例"><a href="#混合实例" class="headerlink" title="混合实例"></a>混合实例</h3><h4 id="注册表单"><a href="#注册表单" class="headerlink" title="注册表单"></a>注册表单</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Html <span class="keyword">exposing</span> (..)</div><div class="line"><span class="keyword">import</span> Html.App <span class="keyword">as</span> App</div><div class="line"><span class="keyword">import</span> Html.Attributes <span class="keyword">exposing</span> (..)</div><div class="line"><span class="keyword">import</span> Html.Events <span class="keyword">exposing</span> (onInput)</div><div class="line"></div><div class="line"><span class="title">main</span> =</div><div class="line">  <span class="type">App</span>.beginnerProgram</div><div class="line">    &#123; model = model</div><div class="line">    , view = view</div><div class="line">    , update = update</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">-- MODEL</span></div><div class="line"></div><div class="line"><span class="comment">-- 定义model别名为Model</span></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Model</span> =</div><div class="line">  &#123; name : <span class="type">String</span></div><div class="line">  , password : <span class="type">String</span></div><div class="line">  , passwordAgain : <span class="type">String</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line"><span class="title">model</span> : <span class="type">Model</span></div><div class="line"><span class="comment">-- 调用Record生成一个实例</span></div><div class="line"><span class="comment">-- &#123;name = "", password = "", passwordAgain = ""&#125;</span></div><div class="line"><span class="title">model</span> =</div><div class="line">  <span class="type">Model</span> <span class="string">""</span> <span class="string">""</span> <span class="string">""</span></div><div class="line"></div><div class="line"><span class="comment">-- UPDATE</span></div><div class="line"></div><div class="line"><span class="comment">-- 定义Tag</span></div><div class="line"><span class="keyword">type</span> <span class="type">Msg</span></div><div class="line">    = <span class="type">Name</span> <span class="type">String</span></div><div class="line">    | <span class="type">Password</span> <span class="type">String</span></div><div class="line">    | <span class="type">PasswordAgain</span> <span class="type">String</span></div><div class="line"></div><div class="line"><span class="title">update</span> : <span class="type">Msg</span> -&gt; <span class="type">Model</span> -&gt; <span class="type">Model</span></div><div class="line"><span class="title">update</span> msg model =</div><div class="line">  <span class="keyword">case</span> msg <span class="keyword">of</span></div><div class="line">    <span class="type">Name</span> name -&gt;</div><div class="line">      &#123; model | name = name &#125;</div><div class="line"></div><div class="line">    <span class="type">Password</span> password -&gt;</div><div class="line">      &#123; model | password = password &#125;</div><div class="line"></div><div class="line">    <span class="type">PasswordAgain</span> password -&gt;</div><div class="line">      &#123; model | passwordAgain = password &#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">-- VIEW</span></div><div class="line"></div><div class="line"><span class="title">view</span> : <span class="type">Model</span> -&gt; <span class="type">Html</span> <span class="type">Msg</span></div><div class="line"><span class="title">view</span> model =</div><div class="line">  div []</div><div class="line">    [ input [ <span class="keyword">type</span>' "text", placeholder "<span class="type">Name</span>", onInput <span class="type">Name</span> ] []</div><div class="line">    , input [ <span class="keyword">type</span>' "password", placeholder "<span class="type">Password</span>", onInput <span class="type">Password</span> ] []</div><div class="line">    , input [ <span class="keyword">type</span>' "password", placeholder "<span class="type">Re</span>-enter <span class="type">Password</span>", onInput <span class="type">PasswordAgain</span> ] []</div><div class="line">    , viewValidation model</div><div class="line">    ]</div><div class="line"></div><div class="line"></div><div class="line"><span class="title">viewValidation</span> : <span class="type">Model</span> -&gt; <span class="type">Html</span> msg</div><div class="line"><span class="title">viewValidation</span> model =</div><div class="line">  <span class="keyword">let</span></div><div class="line">    (color, message) =</div><div class="line">      <span class="keyword">if</span> model.password == model.passwordAgain <span class="keyword">then</span></div><div class="line">        (<span class="string">"green"</span>, <span class="string">"OK"</span>)</div><div class="line">      <span class="keyword">else</span></div><div class="line">        (<span class="string">"red"</span>, <span class="string">"Passwords do not match!"</span>)</div><div class="line">  <span class="keyword">in</span></div><div class="line">    div [ style [(<span class="string">"color"</span>, color)] ] [ text message ]</div></pre></td></tr></table></figure>
<h3 id="Advance"><a href="#Advance" class="headerlink" title="Advance"></a>Advance</h3><h4 id="subscriptions"><a href="#subscriptions" class="headerlink" title="subscriptions"></a>subscriptions</h4><blockquote>
<p>using subscriptions is how your application can listen for external input. Some examples are:<br>Keyboard events,<br>Mouse movements,<br>Browser locations changes,<br>Websocket events</p>
</blockquote>
<p>在Elm中，使用<code>subscriptions</code>来监听应用的一些事件，例如键盘响应、鼠标移动、浏览器URL变化、websocket事件等等，并使用<code>Commands</code>对事件进行处理。</p>
<blockquote>
<p>A Cmd can be one or a collection of things to do. We use commands to gather all the things that need to happen and hand them to the runtime. Then the runtime will execute them and feed the results back to the application</p>
</blockquote>
<p><code>subscriptions</code>要和<code>cmd</code>搭配使用，在使用之后，之前的<code>MUV</code>结构变为<code>MSUV</code>结构。并且Update函数返回的不再仅仅是Model，是<code>Model + Cmd Msg</code></p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- MODEL</span></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Model</span> =</div><div class="line">  &#123; ...</div><div class="line">  &#125;</div><div class="line"></div><div class="line"><span class="comment">-- SUBSCRIPTIONS</span></div><div class="line"><span class="comment">-- subscriptions接受model作为参数，在内部声明了要监听的事件，并返回Msg Value，之后传入UPDATE方法</span></div><div class="line"><span class="title">subscriptions</span> : <span class="type">Model</span> -&gt; <span class="type">Sub</span> <span class="type">Msg</span></div><div class="line"><span class="title">subscriptions</span> model =</div><div class="line">  ...</div><div class="line"></div><div class="line"><span class="comment">-- UPDATE</span></div><div class="line"><span class="keyword">type</span> <span class="type">Msg</span> = <span class="type">Submit</span> | ...</div><div class="line"></div><div class="line"><span class="title">update</span> : <span class="type">Msg</span> -&gt; <span class="type">Model</span> -&gt; (<span class="type">Model</span>, <span class="type">Cmd</span> <span class="type">Msg</span>)</div><div class="line"><span class="title">update</span> msg model =</div><div class="line">  ...</div><div class="line"></div><div class="line"><span class="comment">-- VIEW</span></div><div class="line"><span class="title">view</span> : <span class="type">Model</span> -&gt; <span class="type">Html</span> <span class="type">Msg</span></div><div class="line"><span class="title">view</span> model =</div><div class="line">  ...</div><div class="line"></div><div class="line"><span class="comment">-- INIT</span></div><div class="line"><span class="title">init</span> : (<span class="type">Model</span>, <span class="type">Cmd</span> <span class="type">Msg</span>)</div><div class="line"><span class="title">init</span> =</div><div class="line">  ...</div></pre></td></tr></table></figure>
<h5 id="example"><a href="#example" class="headerlink" title="example :"></a>example :</h5><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Html <span class="keyword">exposing</span> (<span class="type">Html</span>, div, text)</div><div class="line"><span class="keyword">import</span> Html.App</div><div class="line"><span class="keyword">import</span> Mouse</div><div class="line"><span class="keyword">import</span> Keyboard</div><div class="line"></div><div class="line"><span class="comment">-- MODEL</span></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Model</span> =</div><div class="line">    <span class="type">Int</span></div><div class="line"><span class="title">init</span> : ( <span class="type">Model</span>, <span class="type">Cmd</span> <span class="type">Msg</span> )</div><div class="line"><span class="title">init</span> =</div><div class="line">    ( <span class="number">0</span>, <span class="type">Cmd</span>.none )</div><div class="line"></div><div class="line"><span class="comment">-- MESSAGES</span></div><div class="line"><span class="keyword">type</span> <span class="type">Msg</span></div><div class="line">    = <span class="type">MouseMsg</span> <span class="type">Mouse</span>.<span class="type">Position</span></div><div class="line">    | <span class="type">KeyMsg</span> <span class="type">Keyboard</span>.<span class="type">KeyCode</span></div><div class="line"><span class="comment">-- 监听两种消息MouseMsg、KeyMsg。会在鼠标/键盘操作的时候触发相应的监听事件</span></div><div class="line"></div><div class="line"><span class="comment">-- UPDATE</span></div><div class="line"><span class="title">update</span> : <span class="type">Msg</span> -&gt; <span class="type">Model</span> -&gt; ( <span class="type">Model</span>, <span class="type">Cmd</span> <span class="type">Msg</span> )</div><div class="line"><span class="title">update</span> msg model =</div><div class="line">    <span class="keyword">case</span> msg <span class="keyword">of</span></div><div class="line">        <span class="type">MouseMsg</span> position -&gt;</div><div class="line">            ( model + <span class="number">1</span>, <span class="type">Cmd</span>.none )</div><div class="line">        <span class="type">KeyMsg</span> code -&gt;</div><div class="line">            ( model + <span class="number">2</span>, <span class="type">Cmd</span>.none )</div><div class="line"><span class="comment">-- update函数必须多返回一个Cmd</span></div><div class="line"><span class="comment">-- Cmd.none代表没有命令，什么也不需要做</span></div><div class="line"></div><div class="line"><span class="comment">-- SUBSCRIPTIONS</span></div><div class="line"><span class="title">subscriptions</span> : <span class="type">Model</span> -&gt; <span class="type">Sub</span> <span class="type">Msg</span></div><div class="line"><span class="title">subscriptions</span> model =</div><div class="line">    <span class="type">Sub</span>.batch</div><div class="line">        [ <span class="type">Mouse</span>.clicks <span class="type">MouseMsg</span></div><div class="line">        , <span class="type">Keyboard</span>.presses <span class="type">KeyMsg</span></div><div class="line">        ]</div><div class="line"><span class="comment">-- 声明要监听的事件。它们(Mouse.clicks/Keyboard.presses)接受Msg作为参数并返回</span></div><div class="line"><span class="comment">-- 使用Sub.batch监听多个事件</span></div><div class="line"></div><div class="line"><span class="comment">-- VIEW</span></div><div class="line"><span class="title">view</span> : <span class="type">Model</span> -&gt; <span class="type">Html</span> <span class="type">Msg</span></div><div class="line"><span class="title">view</span> model =</div><div class="line">    div []</div><div class="line">        [ text (toString model) ]</div><div class="line"></div><div class="line"><span class="comment">-- MAIN</span></div><div class="line"><span class="title">main</span> : <span class="type">Program</span> <span class="type">Never</span></div><div class="line"><span class="title">main</span> =</div><div class="line">    <span class="type">Html</span>.<span class="type">App</span>.program</div><div class="line">        &#123; init = init</div><div class="line">        , view = view</div><div class="line">        , update = update</div><div class="line">        , subscriptions = subscriptions</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p><a href="http://guide.elm-lang.org/architecture/effects/random.html" target="_blank" rel="external">Random案例</a></p>
<h4 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h4><blockquote>
<p>commands (Cmd) are how we tell the runtime to execute things that involve side effects</p>
</blockquote>
<p>我们使用cmd来处理需要在程序中运行并需要被处理的事件。在处理完成之后程序会将结果返还给应用。</p>
<p>例如：</p>
<ul>
<li>生成随机数</li>
<li>http请求</li>
<li>储存数据</li>
</ul>
<h5 id="example–生成随机数"><a href="#example–生成随机数" class="headerlink" title="example–生成随机数"></a>example–生成随机数</h5><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">module</span> Main <span class="keyword">exposing</span> (..)</div><div class="line"></div><div class="line"><span class="keyword">import</span> Html <span class="keyword">exposing</span> (<span class="type">Html</span>, div, button, text)</div><div class="line"><span class="keyword">import</span> Html.Events <span class="keyword">exposing</span> (onClick)</div><div class="line"><span class="keyword">import</span> Html.App</div><div class="line"><span class="keyword">import</span> Random</div><div class="line"></div><div class="line"><span class="comment">-- MODEL</span></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Model</span> =</div><div class="line">    <span class="type">Int</span></div><div class="line"><span class="title">init</span> : ( <span class="type">Model</span>, <span class="type">Cmd</span> <span class="type">Msg</span> )</div><div class="line"><span class="title">init</span> =</div><div class="line">    ( <span class="number">1</span>, <span class="type">Cmd</span>.none )</div><div class="line"></div><div class="line"><span class="comment">-- MESSAGES</span></div><div class="line"><span class="keyword">type</span> <span class="type">Msg</span></div><div class="line">    = <span class="type">Roll</span></div><div class="line">    | <span class="type">OnResult</span> <span class="type">Int</span></div><div class="line"><span class="comment">-- OnResult 用来从Random库中获取一个随机数</span></div><div class="line">    </div><div class="line"><span class="comment">-- VIEW</span></div><div class="line"><span class="title">view</span> : <span class="type">Model</span> -&gt; <span class="type">Html</span> <span class="type">Msg</span></div><div class="line"><span class="title">view</span> model =</div><div class="line">    div []</div><div class="line">        [ button [ onClick <span class="type">Roll</span> ] [ text <span class="string">"Roll"</span> ]</div><div class="line">        , text (toString model)</div><div class="line">        ]</div><div class="line"></div><div class="line"><span class="comment">-- UPDATE</span></div><div class="line"><span class="title">update</span> : <span class="type">Msg</span> -&gt; <span class="type">Model</span> -&gt; ( <span class="type">Model</span>, <span class="type">Cmd</span> <span class="type">Msg</span> )</div><div class="line"><span class="title">update</span> msg model =</div><div class="line">    <span class="keyword">case</span> msg <span class="keyword">of</span></div><div class="line">        <span class="type">Roll</span> -&gt;</div><div class="line">            ( model, <span class="type">Random</span>.generate <span class="type">OnResult</span> (<span class="type">Random</span>.int <span class="number">1</span> <span class="number">6</span>) )</div><div class="line">        <span class="type">OnResult</span> res -&gt;</div><div class="line">            ( res, <span class="type">Cmd</span>.none )</div><div class="line"></div><div class="line"><span class="comment">-- MAIN</span></div><div class="line"><span class="title">main</span> : <span class="type">Program</span> <span class="type">Never</span></div><div class="line"><span class="title">main</span> =</div><div class="line">    <span class="type">Html</span>.<span class="type">App</span>.program</div><div class="line">        &#123; init = init</div><div class="line">        , view = view</div><div class="line">        , update = update</div><div class="line">        , subscriptions = (always <span class="type">Sub</span>.none)</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p><strong>IMPORTANT</strong></p>
<blockquote>
<p>But commands don’t have a concept of success or failure. They also don’t have the concept of sequencing. Commands are just bags of things to do.</p>
</blockquote>
<h4 id="Tasks"><a href="#Tasks" class="headerlink" title="Tasks"></a>Tasks</h4><p>鉴于commands并不知道任务返回的结果是成功还是失败，而且也没有对立的概念。因此，我们使用task来进行异步操作，它就像是js中的Promise</p>
<p>task的signature：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Task</div><div class="line"></div><div class="line"><span class="comment">-- 第一个参数代表失败值，第二个参数代表成功时的回调</span></div><div class="line"><span class="type">Task</span> errorValue successValue</div><div class="line"></div><div class="line"><span class="comment">-- example</span></div><div class="line"><span class="comment">-- fails with an Http.Error or succeeds with a String</span></div><div class="line"><span class="type">Task</span> <span class="type">Http</span>.<span class="type">Error</span> <span class="type">String</span></div><div class="line"></div><div class="line"><span class="comment">-- a task that never fails, and always succeeds with a Result</span></div><div class="line"><span class="type">Task</span> <span class="type">Never</span> <span class="type">Result</span></div></pre></td></tr></table></figure>
<p><em>举个栗子：</em></p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">module</span> Main <span class="keyword">exposing</span> (..)</div><div class="line"></div><div class="line"><span class="keyword">import</span> Html <span class="keyword">exposing</span> (<span class="type">Html</span>, div, button, text)</div><div class="line"><span class="keyword">import</span> Html.Events <span class="keyword">exposing</span> (onClick)</div><div class="line"><span class="keyword">import</span> Html.App</div><div class="line"><span class="keyword">import</span> Http</div><div class="line"><span class="keyword">import</span> Task <span class="keyword">exposing</span> (<span class="type">Task</span>)</div><div class="line"><span class="keyword">import</span> Json.Decode <span class="keyword">as</span> Decode</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">-- MODEL</span></div><div class="line"><span class="keyword">type</span> <span class="keyword">alias</span> <span class="type">Model</span> =</div><div class="line">    <span class="type">String</span></div><div class="line"><span class="title">init</span> : ( <span class="type">Model</span>, <span class="type">Cmd</span> <span class="type">Msg</span> )</div><div class="line"><span class="title">init</span> =</div><div class="line">    ( <span class="string">""</span>, <span class="type">Cmd</span>.none )</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">-- MESSAGES</span></div><div class="line"><span class="keyword">type</span> <span class="type">Msg</span></div><div class="line">    = <span class="type">Fetch</span></div><div class="line">    | <span class="type">FetchSuccess</span> <span class="type">String</span></div><div class="line">    | <span class="type">FetchError</span> <span class="type">Http</span>.<span class="type">Error</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">-- VIEW</span></div><div class="line"><span class="title">view</span> : <span class="type">Model</span> -&gt; <span class="type">Html</span> <span class="type">Msg</span></div><div class="line"><span class="title">view</span> model =</div><div class="line">    div []</div><div class="line">        [ button [ onClick <span class="type">Fetch</span> ] [ text <span class="string">"Fetch"</span> ]</div><div class="line">        , text model</div><div class="line">        ]</div><div class="line"></div><div class="line"><span class="title">decode</span> : <span class="type">Decode</span>.<span class="type">Decoder</span> <span class="type">String</span></div><div class="line"><span class="title">decode</span> =</div><div class="line">    <span class="type">Decode</span>.at [ <span class="string">"name"</span> ] <span class="type">Decode</span>.string</div><div class="line"></div><div class="line"><span class="title">url</span> : <span class="type">String</span></div><div class="line"><span class="title">url</span> =</div><div class="line">    <span class="string">"http://swapi.co/api/planets/1/?format=json"</span></div><div class="line"></div><div class="line"><span class="comment">-- fetchTask: takes a decoder and a url and returns a task.</span></div><div class="line"><span class="title">fetchTask</span> : <span class="type">Task</span> <span class="type">Http</span>.<span class="type">Error</span> <span class="type">String</span></div><div class="line"><span class="title">fetchTask</span> =</div><div class="line">    <span class="type">Http</span>.get decode url</div><div class="line"></div><div class="line"><span class="comment">-- use Task.perform to transform a task into a command</span></div><div class="line"><span class="title">fetchCmd</span> : <span class="type">Cmd</span> <span class="type">Msg</span></div><div class="line"><span class="title">fetchCmd</span> =</div><div class="line">    <span class="type">Task</span>.perform <span class="type">FetchError</span> <span class="type">FetchSuccess</span> fetchTask</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">-- UPDATE</span></div><div class="line"><span class="title">update</span> : <span class="type">Msg</span> -&gt; <span class="type">Model</span> -&gt; ( <span class="type">Model</span>, <span class="type">Cmd</span> <span class="type">Msg</span> )</div><div class="line"><span class="title">update</span> msg model =</div><div class="line">    <span class="keyword">case</span> msg <span class="keyword">of</span></div><div class="line">        <span class="type">Fetch</span> -&gt;</div><div class="line">            ( model, fetchCmd )</div><div class="line">        <span class="type">FetchSuccess</span> name -&gt;</div><div class="line">            ( name, <span class="type">Cmd</span>.none )</div><div class="line">        <span class="type">FetchError</span> error -&gt;</div><div class="line">            ( toString error, <span class="type">Cmd</span>.none )</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">-- MAIN</span></div><div class="line"><span class="title">main</span> : <span class="type">Program</span> <span class="type">Never</span></div><div class="line"><span class="title">main</span> =</div><div class="line">    <span class="type">Html</span>.<span class="type">App</span>.program</div><div class="line">        &#123; init = init</div><div class="line">        , view = view</div><div class="line">        , update = update</div><div class="line">        , subscriptions = (always <span class="type">Sub</span>.none)</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p><a href="http://guide.elm-lang.org/architecture/effects/http.html" target="_blank" rel="external">http请求</a></p>
<p><em>Task &amp; unit type</em></p>
<p>上面已经说过，一个典型的Task有 errorValue 和 successValue：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="type">Task</span> errorValue successValue</div><div class="line"><span class="comment">-- 如果想要忽略error</span></div><div class="line"><span class="type">Task</span> () successValue</div><div class="line"><span class="comment">-- 同理，忽略success</span></div><div class="line"><span class="type">Task</span> errorValue ()</div><div class="line"><span class="comment">-- 甚至</span></div><div class="line"><span class="type">Task</span> () ()</div></pre></td></tr></table></figure>
<h4 id="import-amp-module"><a href="#import-amp-module" class="headerlink" title="import &amp; module"></a>import &amp; module</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Html <span class="keyword">exposing</span> (..)</div><div class="line"><span class="comment">-- 把Html模块内的变量全部导入</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> Html.Events <span class="keyword">exposing</span> (onClick)</div><div class="line"><span class="comment">-- 只导入指定的变量</span></div><div class="line"></div><div class="line"><span class="comment">-- 暴露module</span></div><div class="line"></div><div class="line"><span class="comment">-- 在文件开头加入</span></div><div class="line"><span class="keyword">module</span> Counter <span class="keyword">exposing</span> (<span class="type">Model</span>, initModel, <span class="type">Msg</span>, update, view)</div><div class="line"><span class="comment">-- exposing后是要暴露出去的变量名。使用(..)则暴露全部(不推荐)</span></div><div class="line"><span class="comment">-- module名(Counter)要首字母大写</span></div><div class="line"><span class="comment">-- module名(Counter)与文件名要一致</span></div><div class="line"><span class="comment">-- 且该文件内不再有main变量</span></div><div class="line"></div><div class="line"><span class="comment">-- 暴露文件夹内部的module</span></div><div class="line"><span class="comment">-- for example, 要暴露位于Players文件夹下的Utils.elm，即Players/Utils.elm</span></div><div class="line"><span class="keyword">module</span> Players.Utils <span class="keyword">exposing</span> (..)</div><div class="line"><span class="comment">-- 引用这个module</span></div><div class="line"><span class="keyword">import</span> Players.Utils</div></pre></td></tr></table></figure>
<h3 id="生成HTML"><a href="#生成HTML" class="headerlink" title="生成HTML"></a>生成HTML</h3><figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 引入全部HTML组件</span></div><div class="line"><span class="keyword">import</span> Html</div><div class="line"><span class="type">Html</span>.div [] []</div><div class="line"></div><div class="line"><span class="comment">-- or</span></div><div class="line"><span class="keyword">import</span> Html <span class="keyword">exposing</span> (..)</div><div class="line"><span class="title">div</span> [] []</div><div class="line"></div><div class="line"><span class="comment">-- 或者引入特定的组件</span></div><div class="line"><span class="keyword">import</span> Html <span class="keyword">exposing</span> (div)</div><div class="line"><span class="title">div</span> [] []</div></pre></td></tr></table></figure>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 调用方式</span></div><div class="line"><span class="title">div</span> [] []</div><div class="line"><span class="comment">-- 第一个[]内写入div的attr</span></div><div class="line"><span class="comment">-- 第二个[]内写入div的子组件</span></div><div class="line"></div><div class="line"><span class="comment">-- example</span></div><div class="line"><span class="keyword">import</span> Html.Events <span class="keyword">exposing</span> (onInput)</div><div class="line"><span class="keyword">import</span> Html.Attributes <span class="keyword">exposing</span> (..)</div><div class="line"><span class="keyword">import</span> Html <span class="keyword">exposing</span> (..)</div><div class="line"></div><div class="line"><span class="title">div</span> [class <span class="string">"example"</span>, id <span class="string">"example"</span>] [</div><div class="line">  span [] [text <span class="string">"hey world"</span>]</div><div class="line">]</div><div class="line"><span class="title">input</span> [onInput <span class="type">NewContent</span>, placeholder <span class="string">"placeholder"</span>] []</div></pre></td></tr></table></figure>
<p><strong>非module的渲染文件中必须有main变量</strong></p>
<blockquote>
<p>Front end applications in Elm start on a function called main. main is a function that returns an element to draw into the page. In this case it returns an Html element </p>
</blockquote>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Html <span class="keyword">exposing</span> (..)</div><div class="line"><span class="keyword">import</span> Html.App <span class="keyword">as</span> App</div><div class="line"></div><div class="line"><span class="title">main</span> = <span class="type">App</span>.beginnerProgram &#123;model = initModel, view = view, update = update&#125;</div><div class="line"><span class="comment">-- or</span></div><div class="line"><span class="title">main</span> =</div><div class="line">  <span class="type">Html</span>.program</div><div class="line">    &#123; init = init</div><div class="line">    , view = view</div><div class="line">    , update = update</div><div class="line">    , subscriptions = subscriptions</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>HTML渲染</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-- 前端使用elm时的渲染方法</div><div class="line"><span class="keyword">const</span> Elm = <span class="built_in">require</span>(<span class="string">'./example.elm'</span>);</div><div class="line"><span class="keyword">const</span> mountNode = <span class="built_in">document</span>.getElementById(<span class="string">'example'</span>);</div><div class="line"><span class="keyword">let</span> app = Elm.Main.embed(mountNode);</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="Elm" scheme="http://ecmadao.com/tags/Elm/"/>
    
  </entry>
  
  <entry>
    <title>Electron【01】--主进程VS渲染进程&amp;不同页面间共享数据</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/Electron/Electron%E3%80%9001%E3%80%91--%E4%B8%BB%E8%BF%9B%E7%A8%8BVS%E6%B8%B2%E6%9F%93%E8%BF%9B%E7%A8%8B&amp;%E4%B8%8D%E5%90%8C%E9%A1%B5%E9%9D%A2%E9%97%B4%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/Electron/Electron【01】--主进程VS渲染进程&amp;不同页面间共享数据/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#electron%E3%80%9001%E3%80%91--%E4%B8%BB%E8%BF%9B%E7%A8%8Bvs%E6%B8%B2%E6%9F%93%E8%BF%9B%E7%A8%8B&amp;%E4%B8%8D%E5%90%8C%E9%A1%B5%E9%9D%A2%E9%97%B4%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE">Electron【01】–主进程VS渲染进程&amp;不同页面间共享数据</a><ul>
<li><a href="#%E4%B8%BB%E8%BF%9B%E7%A8%8Bvs%E6%B8%B2%E6%9F%93%E8%BF%9B%E7%A8%8B">主进程VS渲染进程</a><ul>
<li><a href="#%E4%B8%BB%E8%BF%9B%E7%A8%8B">主进程</a></li>
<li><a href="#%E6%B8%B2%E6%9F%93%E8%BF%9B%E7%A8%8B">渲染进程</a></li>
<li><a href="#%E4%B8%BB%E8%BF%9B%E7%A8%8B%E5%92%8C%E6%B8%B2%E6%9F%93%E8%BF%9B%E7%A8%8B%E7%9A%84%E4%B8%8D%E5%90%8C">主进程和渲染进程的不同</a></li>
</ul>
</li>
<li><a href="#%E4%B8%8D%E5%90%8C%E9%A1%B5%E9%9D%A2%E9%97%B4%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE">不同页面间共享数据</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="Electron【01】–主进程VS渲染进程-amp-不同页面间共享数据"><a href="#Electron【01】–主进程VS渲染进程-amp-不同页面间共享数据" class="headerlink" title="Electron【01】–主进程VS渲染进程&amp;不同页面间共享数据"></a>Electron【01】–主进程VS渲染进程&amp;不同页面间共享数据</h2><p>Electron使用了网页页面作为App的GUI，因此你可以将它看做是一个由JavaScript控制的一个小型的Chrome内核浏览器。</p>
<h3 id="主进程VS渲染进程"><a href="#主进程VS渲染进程" class="headerlink" title="主进程VS渲染进程"></a>主进程VS渲染进程</h3><h4 id="主进程"><a href="#主进程" class="headerlink" title="主进程"></a>主进程</h4><p>在Electron中，跑<code>package.json</code>里的主脚本的进程叫作主进程。在主进程里跑的脚本可以通过创建web页面的窗口来扮演GUI角色。</p>
<p>主进程看起来就是一段脚本：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">'electron'</span>);</div><div class="line"><span class="keyword">const</span> app = electron.app;</div><div class="line"><span class="keyword">const</span> BrowserWindow = electron.BrowserWindow;</div><div class="line"></div><div class="line"><span class="keyword">var</span> <span class="built_in">window</span> = <span class="literal">null</span>;</div><div class="line"></div><div class="line">app.on(<span class="string">'ready'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">window</span> = <span class="keyword">new</span> BrowserWindow(&#123;<span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">600</span>&#125;);</div><div class="line">  <span class="built_in">window</span>.loadURL(<span class="string">'https://github.com'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="渲染进程"><a href="#渲染进程" class="headerlink" title="渲染进程"></a>渲染进程</h4><p>正因为Electron使用了chrome内核，才使得它多进程的结构也可以被我们使用。在Electron里的每个页面都有它自己的进程，叫作渲染进程。</p>
<p>在普通的浏览器里，网页页面跑在一个沙盒环境下，不能接触到native源码。而Electron则允许你在页面中使用Node.js的API，较低程度上的和操作系统进行交互。</p>
<p>渲染进程如同传统的HTML，但它可以直接使用Node模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">  &lt;body&gt;</div><div class="line">  &lt;script&gt;</div><div class="line">    const remote = require('electron').remote;</div><div class="line">    console.log(remote.app.getVersion());</div><div class="line">  &lt;/script&gt;</div><div class="line">  &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h4 id="主进程和渲染进程的不同"><a href="#主进程和渲染进程的不同" class="headerlink" title="主进程和渲染进程的不同"></a>主进程和渲染进程的不同</h4><p>主进程通过实例化<code>BrowserWindow</code>，每个<code>BrowserWindow</code>实例都在它自己的渲染进程内返回一个web页面。当<code>BrowserWindow</code>实例销毁时，相应的渲染进程也会终止。</p>
<p>主进程负责掌管所有的web页面和它们相应的渲染进程。每个渲染进程都是相互独立的，它们只关心自己所运行的web页面。</p>
<p>在页面（渲染进程）中不允许调用原生GUI相关的API，那是因为在网页（渲染进程）中中掌管原生GUI很危险，易造成内存泄露。如果你想在网页中进行GUI的操作，渲染进程必须向主进程传达请求，然后在主进程中完成操作。</p>
<p>在Electron中，我们有几种连接主进程和渲染进程的方法，例如用于传送消息的<a href="https://github.com/heyunjiang/electron/blob/master/docs/api/ipc-renderer.md" target="_blank" rel="external"><code>ipcRenderer</code></a>和<a href="https://github.com/heyunjiang/electron/blob/master/docs/api/ipc-main.md" target="_blank" rel="external"><code>ipcMain</code></a>模块，以及用于RPC的<a href="https://github.com/heyunjiang/electron/blob/master/docs/api/remote.md" target="_blank" rel="external"><code>remote</code></a>模块。</p>
<h3 id="不同页面间共享数据"><a href="#不同页面间共享数据" class="headerlink" title="不同页面间共享数据"></a>不同页面间共享数据</h3><p>非常简单，使用HTML5 API就能完成。</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Storage" target="_blank" rel="external"><code>Storage API</code></a>，<a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" target="_blank" rel="external"><code>IndexedDB</code></a>都是很好的选择。</p>
<p>你还可以使用Electron中提供的<code>IPC</code>系统。它在主进程中将一个对象储存为全局变量，然后可以通过<code>remote</code>模块操作它们：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 在主进程里</span></div><div class="line">global.sharedObject = &#123;</div><div class="line">  <span class="attr">someProperty</span>: <span class="string">'default value'</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// In page 1.</span></div><div class="line"><span class="built_in">require</span>(<span class="string">'remote'</span>).getGlobal(<span class="string">'sharedObject'</span>).someProperty = <span class="string">'new value'</span>;</div><div class="line"></div><div class="line"><span class="comment">// In page 2.</span></div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">require</span>(<span class="string">'remote'</span>).getGlobal(<span class="string">'sharedObject'</span>).someProperty);</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="Electron" scheme="http://ecmadao.com/tags/Electron/"/>
    
  </entry>
  
  <entry>
    <title>Electron【02】--第一个Electron App</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/Electron/Electron%E3%80%9002%E3%80%91--%E7%AC%AC%E4%B8%80%E4%B8%AAElectron%20App/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/Electron/Electron【02】--第一个Electron App/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#electron%E3%80%9002%E3%80%91--%E7%AC%AC%E4%B8%80%E4%B8%AAelectron-app">Electron【02】–第一个Electron App</a><ul>
<li><a href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E4%B8%8E%E6%96%87%E4%BB%B6">目录结构与文件</a></li>
<li><a href="#%E8%BF%90%E8%A1%8C&amp;%E7%94%9F%E6%88%90%E5%BA%94%E7%94%A8">运行&amp;生成应用</a><ul>
<li><a href="#%E9%80%9A%E8%BF%87electron-prebuilt%E8%BF%90%E8%A1%8C">通过<code>electron-prebuilt</code>运行</a></li>
<li><a href="#%E9%80%9A%E8%BF%87electron-binary%E8%BF%90%E8%A1%8C">通过Electron Binary运行</a></li>
<li><a href="#%E7%94%9F%E6%88%90%E5%BA%94%E7%94%A8">生成应用</a></li>
</ul>
</li>
<li><a href="#%E5%BA%94%E7%94%A8%E6%89%93%E5%8C%85">应用打包</a><ul>
<li><a href="#%E7%94%9F%E6%88%90asar%E5%8C%85">生成<code>asar</code>包</a></li>
</ul>
</li>
<li><a href="#%E4%BE%8B%E5%AD%90">例子</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="Electron【02】–第一个Electron-App"><a href="#Electron【02】–第一个Electron-App" class="headerlink" title="Electron【02】–第一个Electron App"></a>Electron【02】–第一个Electron App</h2><h3 id="目录结构与文件"><a href="#目录结构与文件" class="headerlink" title="目录结构与文件"></a>目录结构与文件</h3><p>Electron App的目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">your-app/</div><div class="line">├── package.json</div><div class="line">├── main.js</div><div class="line">└── index.html</div></pre></td></tr></table></figure>
<p>其中的<code>package.json</code>和Node Modules里表现的一样，而<code>main.js</code>则是启动你App的脚本，它将会开启主进程。<code>package.json</code>的一个例子：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>    : <span class="string">"your-app"</span>,</div><div class="line">  <span class="attr">"version"</span> : <span class="string">"0.1.0"</span>,</div><div class="line">  <span class="attr">"main"</span>    : <span class="string">"main.js"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注：当<code>package.json</code>里不存在<code>main</code>时，Electron将会默认使用<code>index.js</code></p>
<p><code>main.js</code>应当创建一个窗口并处理系统事件。一个典型的例子如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">'electron'</span>);</div><div class="line"><span class="keyword">const</span> app = electron.app;  <span class="comment">// 控制App生命周期的模块</span></div><div class="line"><span class="keyword">const</span> BrowserWindow = electron.BrowserWindow;  <span class="comment">// 创建原生窗口的模块</span></div><div class="line"></div><div class="line"><span class="comment">// 保持对窗口对象的全局引用。如果不这么做的话，JavaScript垃圾回收的时候窗口会自动关闭</span></div><div class="line"><span class="keyword">var</span> mainWindow = <span class="literal">null</span>;</div><div class="line"></div><div class="line"><span class="comment">// 当所有的窗口关闭的时候退出应用</span></div><div class="line">app.on(<span class="string">'window-all-closed'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// 在 OS X 系统里，除非用户按下Cmd + Q，否则应用和它们的menu bar会保持运行</span></div><div class="line">  <span class="keyword">if</span> (process.platform != <span class="string">'darwin'</span>) &#123;</div><div class="line">    app.quit();</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 当应用初始化结束后调用这个方法，并渲染浏览器窗口</span></div><div class="line">app.on(<span class="string">'ready'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// 创建一个窗口</span></div><div class="line">  mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;<span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">600</span>&#125;);</div><div class="line"></div><div class="line">  <span class="comment">// 加载index.js</span></div><div class="line">  mainWindow.loadURL(<span class="string">'file://'</span> + __dirname + <span class="string">'/index.html'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 打开 DevTools</span></div><div class="line">  mainWindow.webContents.openDevTools();</div><div class="line"></div><div class="line">  <span class="comment">// 窗口关闭时触发</span></div><div class="line">  mainWindow.on(<span class="string">'closed'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// 如果你的应用允许多个屏幕，那么可以把它存在Array里。</span></div><div class="line">    <span class="comment">// 因此删除的时候可以在这里删掉相应的元素</span></div><div class="line">    mainWindow = <span class="literal">null</span>;</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>最后，<code>index.html</code>是你最终要展示的页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    We are using node <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(process.versions.node)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>,</div><div class="line">    Chrome <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(process.versions.chrome)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>,</div><div class="line">    and Electron <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(process.versions.electron)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>.</div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="运行-amp-生成应用"><a href="#运行-amp-生成应用" class="headerlink" title="运行&amp;生成应用"></a>运行&amp;生成应用</h3><h4 id="通过electron-prebuilt运行"><a href="#通过electron-prebuilt运行" class="headerlink" title="通过electron-prebuilt运行"></a>通过<code>electron-prebuilt</code>运行</h4><p>如果你通过<code>npm</code>全局安装了<code>electron-prebuilt</code>，那么在App文件目录下跑这句就可以运行它：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">electron .</div></pre></td></tr></table></figure>
<p>如果只是在当前项目下安装了，则要跑：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./node_modules/.bin/electron .</div></pre></td></tr></table></figure>
<h4 id="通过Electron-Binary运行"><a href="#通过Electron-Binary运行" class="headerlink" title="通过Electron Binary运行"></a>通过Electron Binary运行</h4><p>在这儿下载<a href="https://github.com/electron/electron/releases" target="_blank" rel="external">Electron二进制文件</a></p>
<p>打开包内的App按照提示操作，或者在该文件夹下运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./Electron.app/Contents/MacOS/Electron your-app/</div></pre></td></tr></table></figure>
<p>就可以通过这个包来运行自己的应用了。</p>
<h4 id="生成应用"><a href="#生成应用" class="headerlink" title="生成应用"></a>生成应用</h4><p>应用写完以后，可以参照<a href="https://github.com/electron/electron/blob/v0.37.8/docs/tutorial/application-distribution.md" target="_blank" rel="external">Application Distribution</a>里的指导进行打包：</p>
<ol>
<li>项目文件名应该命名为<code>app</code></li>
<li>下载Electron资源文件。就是上一步里面的<a href="https://github.com/electron/electron/releases" target="_blank" rel="external">Electron二进制文件</a></li>
<li>把项目目录放在Electron资源文件夹下</li>
</ol>
<p>Mac OS X:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">electron/Electron.app/Contents/Resources/app/</div><div class="line">├── package.json</div><div class="line">├── main.js</div><div class="line">└── index.html</div></pre></td></tr></table></figure>
<p>Windows &amp; Linux:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">electron/resources/app</div><div class="line">├── package.json</div><div class="line">├── main.js</div><div class="line">└── index.html</div></pre></td></tr></table></figure>
<p>之后运行<code>Electron.app</code>就能启动应用</p>
<p>现在，你的应用名称为默认的<code>Electron.app</code>（或<code>Electron.exe</code>），可以通过如下方式修改名称：</p>
<p><strong>Windows</strong></p>
<p>直接修改<code>Electron.exe</code>的名称</p>
<p><strong>OS X</strong></p>
<ol>
<li>修改应用<code>Electron.app</code>的名称</li>
<li>修改文件中的<code>CFBundleDisplayName</code>，<code>CFBundleIdentifier</code>，以及<code>CFBundleName</code>字段。它们的所在位置：</li>
</ol>
<ul>
<li><code>Electron.app/Contents/Info.plist</code></li>
<li><code>Electron.app/Contents/Frameworks/Electron Helper.app/Contents/Info.plist</code></li>
</ul>
<h3 id="应用打包"><a href="#应用打包" class="headerlink" title="应用打包"></a>应用打包</h3><p>使用<code>asar</code>库来替代你的<code>app</code>文件夹，这样可以避免暴露你的源码。</p>
<h4 id="生成asar包"><a href="#生成asar包" class="headerlink" title="生成asar包"></a>生成<code>asar</code>包</h4><p><code>asar</code>可以把多个文件合并成一个类似于tar的归档文件。</p>
<ol>
<li>install</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install -g asar</div></pre></td></tr></table></figure>
<ol>
<li>打包 </li>
</ol>
<p>切换到含有你项目文件夹的父级文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># dev/your-app</span></div><div class="line">$ <span class="built_in">cd</span> dev</div></pre></td></tr></table></figure>
<p>打包项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ asar pack your-app/ app.asar</div></pre></td></tr></table></figure>
<p>将生成的<code>app.asar</code>放在：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// OS X</div><div class="line">electron/Electron.app/Contents/Resources/</div><div class="line">└── app.asar</div><div class="line"></div><div class="line">// Windows &amp; Linux</div><div class="line">electron/resources/</div><div class="line">└── app.asar</div></pre></td></tr></table></figure>
<p>这样你就可以不必放入<code>app</code>文件夹，而且你的代码都是封装压缩过的。</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>按照下面步骤来运行官方案例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Clone the repository</span></div><div class="line">$ git <span class="built_in">clone</span> https://github.com/atom/electron-quick-start</div><div class="line"><span class="comment"># Go into the repository</span></div><div class="line">$ <span class="built_in">cd</span> electron-quick-start</div><div class="line"><span class="comment"># Install dependencies and run the app</span></div><div class="line">$ npm install &amp;&amp; npm start</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="Electron" scheme="http://ecmadao.com/tags/Electron/"/>
    
  </entry>
  
  <entry>
    <title>使用Electron&amp;React&amp;Webpack构建桌面端App【01】--配置</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/Electron/%E4%BD%BF%E7%94%A8Electron&amp;React&amp;Webpack%E6%9E%84%E5%BB%BA%E6%A1%8C%E9%9D%A2%E7%AB%AFApp%E3%80%9001%E3%80%91--%E9%85%8D%E7%BD%AE/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/Electron/使用Electron&amp;React&amp;Webpack构建桌面端App【01】--配置/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#%E4%BD%BF%E7%94%A8electron&amp;react&amp;webpack%E6%9E%84%E5%BB%BA%E6%A1%8C%E9%9D%A2%E7%AB%AFapp%E3%80%9001%E3%80%91--%E9%85%8D%E7%BD%AE">使用Electron&amp;React&amp;Webpack构建桌面端App【01】–配置</a><ul>
<li><a href="#intro">intro</a></li>
<li><a href="#webpack--electron">webpack + electron</a><ul>
<li><a href="#webpack--electron-%E7%9A%84%E9%97%AE%E9%A2%98">webpack + electron 的问题</a><ul>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%881%EF%BC%9A">解决方案1：</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%882%EF%BC%9A">解决方案2：</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#setup">setup</a><ul>
<li><a href="#react">React</a></li>
<li><a href="#redux">Redux</a></li>
<li><a href="#%E6%90%AD%E5%BB%BA%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">搭建目录结构</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="使用Electron-amp-React-amp-Webpack构建桌面端App【01】–配置"><a href="#使用Electron-amp-React-amp-Webpack构建桌面端App【01】–配置" class="headerlink" title="使用Electron&amp;React&amp;Webpack构建桌面端App【01】–配置"></a>使用Electron&amp;React&amp;Webpack构建桌面端App【01】–配置</h2><h3 id="intro"><a href="#intro" class="headerlink" title="intro"></a>intro</h3><p>对于Electron的学习，什么也不比<a href="https://github.com/electron/electron/tree/master/docs-translations/zh-CN" target="_blank" rel="external">官方文档</a>+<a href="https://github.com/sindresorhus/awesome-electron#documentation" target="_blank" rel="external">开源项目代码</a>来的痛快</p>
<p>先看下<a href="http://electron.atom.io/" target="_blank" rel="external">官网</a>，按照上面的Quick Start走：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Clone the Quick Start repository</span></div><div class="line">$ git <span class="built_in">clone</span> https://github.com/electron/electron-quick-start</div><div class="line"></div><div class="line"><span class="comment"># Go into the repository</span></div><div class="line">$ <span class="built_in">cd</span> electron-quick-start</div><div class="line"></div><div class="line"><span class="comment"># Install the dependencies and run</span></div><div class="line">$ npm install &amp;&amp; npm start</div></pre></td></tr></table></figure>
<p>目录结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">|--index.html <span class="comment"># 控制首屏UI</span></div><div class="line">|--renderer.js <span class="comment"># 渲染线程</span></div><div class="line">|--main.js <span class="comment"># 总入口</span></div><div class="line">|--package.json</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// main.js</span></div><div class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">'electron'</span>)</div><div class="line"><span class="comment">// app用于控制应用的生命周期</span></div><div class="line"><span class="keyword">const</span> app = electron.app</div><div class="line"><span class="comment">// BrowserWindow用于生成一个原生的窗口</span></div><div class="line"><span class="keyword">const</span> BrowserWindow = electron.BrowserWindow</div><div class="line"><span class="comment">// 创建一个全局的窗口对象变量，并在接下来的初始化窗口函数中赋值。通过这样的方式我们可以保持对窗口对象的引用，以免垃圾回收导致应用退出</span></div><div class="line"><span class="keyword">let</span> mainWindow</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWindow</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// 创建主窗口，加载资源文件URL（html文件或一个网址）</span></div><div class="line">  <span class="comment">// 在这个官方例子里加载了index.html</span></div><div class="line">  <span class="comment">// 并定义当主窗口关闭时的回调函数</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">app.on(<span class="string">'ready'</span>, createWindow)</div><div class="line">app.on(<span class="string">'window-all-closed'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) <span class="comment">// 全部窗口关闭时的回调</span></div><div class="line">app.on(<span class="string">'active'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// 在mac平台上，当点击dock icon的时候，如果没有其他窗口的话则新建主窗口</span></div><div class="line">  <span class="keyword">if</span>(mainWindow === <span class="literal">null</span>)createWindow();</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--index.html--&gt;</span></div><div class="line"><span class="comment">&lt;!--...省略一些HTML代码--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="built_in">require</span>(<span class="string">'./renderer.js'</span>) <span class="comment">// 在这里render渲染进程</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// renderer.js</span></div><div class="line"><span class="comment">// 在这里可以使用Node.js API</span></div><div class="line"><span class="comment">// 例如，可以调用渲染进程的专用API，如remote（用于在主进程和渲染进程间建立联系，并可获取当前窗口），clipboard（用于粘贴渲染进程的相应文字）</span></div></pre></td></tr></table></figure>
<p>在进一步之前，建议先戳这里：</p>
<p><a href="https://github.com/ecmadao/Coding-Guide/blob/master/Notes/Electron/Electron%E3%80%9001%E3%80%91--%E4%B8%BB%E8%BF%9B%E7%A8%8BVS%E6%B8%B2%E6%9F%93%E8%BF%9B%E7%A8%8B%26%E4%B8%8D%E5%90%8C%E9%A1%B5%E9%9D%A2%E9%97%B4%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE.md" target="_blank" rel="external">Electron【01】–主进程VS渲染进程&amp;不同页面间共享数据</a></p>
<p>和这里：</p>
<p><a href="https://github.com/ecmadao/Coding-Guide/blob/master/Notes/Electron/Electron%E3%80%9002%E3%80%91--%E7%AC%AC%E4%B8%80%E4%B8%AAElectron%20App.md" target="_blank" rel="external">Electron【02】–第一个Electron App</a></p>
<p>加深一下了解。然后我们就开始吧。Electron + React + Webpack构建桌面端App。</p>
<p>使用上面根据官方QuickStart获取的内容，进行进一步的构建。</p>
<p>首先来让我们引入 Webpack + React的环境搭配，戳这篇：</p>
<p><a href="https://segmentfault.com/a/1190000005110967" target="_blank" rel="external">Webpack配置从零到一</a></p>
<p>里面记录了自己搭建webpack时的常用配置，以及配合React+Redux时安装和设置。</p>
<p>React搭配Webpack时，关于<code>production</code>和<code>development</code>需要注意的点：</p>
<p><a href="http://dev.topheman.com/make-your-react-production-minified-version-with-webpack/" target="_blank" rel="external">Make your own React production version with webpack</a></p>
<h3 id="webpack-electron"><a href="#webpack-electron" class="headerlink" title="webpack + electron"></a>webpack + electron</h3><h5 id="webpack-electron-的问题"><a href="#webpack-electron-的问题" class="headerlink" title="webpack + electron 的问题"></a>webpack + electron 的问题</h5><p>配好webpack，先不急搭建目录。先使用根目录下的<code>renderer.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// renderer.js</span></div><div class="line"><span class="comment">// remote用于在主进程和渲染进程之间建立联系</span></div><div class="line"><span class="comment">// clipboard可以提供复制文本的功能</span></div><div class="line"><span class="keyword">import</span> &#123;clipboard, remote&#125; <span class="keyword">from</span> <span class="string">'electron'</span>;</div><div class="line"></div><div class="line"><span class="comment">// 例如，你可以用remote获取当前的窗口</span></div><div class="line"><span class="keyword">let</span> currentWindow = remote.getCurrentWindow();</div><div class="line"><span class="built_in">console</span>.log(currentWindow); <span class="comment">// It's an Object</span></div></pre></td></tr></table></figure>
<p>然后以<code>renderer.js</code>作为webpack<code>entry</code>中的入口：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//config/webpack.config.js</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">entry</span>: &#123;</div><div class="line">    <span class="attr">renderer</span>: <span class="string">'renderer.js'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">output</span>: &#123;</div><div class="line">    <span class="attr">path</span>: BUILD_PATH, <span class="comment">// 设置输出目录</span></div><div class="line">    filename: <span class="string">'[name].bundle.js'</span>, <span class="comment">// 输出文件名</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后再改下<code>index.html</code>，把之前引用的<code>require(&#39;./renderer.js&#39;)</code>改为<code>require(&#39;./assets/renderer.bundle.js&#39;)</code></p>
<p>运行webpack，就会发现直接报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Module not found: Error: Cannot resolve module <span class="string">'electron'</span> <span class="keyword">in</span> /Users/ecmadao1/Dev/Electron-OpenSourceApp/electron-quick-start</div></pre></td></tr></table></figure>
<h4 id="解决方案1："><a href="#解决方案1：" class="headerlink" title="解决方案1："></a>解决方案1：</h4><p>在webpack中配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">externals</span>: [</div><div class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> IGNORES = [</div><div class="line">        <span class="string">'electron'</span></div><div class="line">      ];</div><div class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">context, request, callback</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (IGNORES.indexOf(request) &gt;= <span class="number">0</span>) &#123;</div><div class="line">          <span class="keyword">return</span> callback(<span class="literal">null</span>, <span class="string">"require('"</span> + request + <span class="string">"')"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> callback();</div><div class="line">      &#125;;</div><div class="line">    &#125;)()</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="解决方案2："><a href="#解决方案2：" class="headerlink" title="解决方案2："></a>解决方案2：</h4><p>所有<code>require(&#39;electron&#39;)</code>的地方全部改为<code>window.require(&#39;electron&#39;)</code></p>
<h3 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h3><h4 id="React"><a href="#React" class="headerlink" title="React"></a>React</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm install react --save</div><div class="line">$ npm install react-dom --save</div></pre></td></tr></table></figure>
<h4 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ npm install --save redux <span class="comment"># redux</span></div><div class="line">$ npm install --save react-redux <span class="comment"># 和React配合</span></div><div class="line">$ npm install --save redux-thunk <span class="comment"># middleware</span></div></pre></td></tr></table></figure>
<h4 id="搭建目录结构"><a href="#搭建目录结构" class="headerlink" title="搭建目录结构"></a>搭建目录结构</h4><p>改变目录结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">|--app</div><div class="line">|----Components <span class="comment"># react组件都扔在这里</span></div><div class="line">|----Redux <span class="comment"># redux负责组件的函数逻辑和state更新</span></div><div class="line">|------actions</div><div class="line">|------reducers</div><div class="line">|----View <span class="comment"># html文件扔这里</span></div><div class="line">|------index.html</div><div class="line">|----Page <span class="comment"># 各个页面对应的相关资源</span></div><div class="line">|------image</div><div class="line">|------js</div><div class="line">|------stylesheet</div><div class="line">|--assets <span class="comment"># 打包好以后的资源在这儿</span></div><div class="line">|--config</div><div class="line">|----webpack.config.js <span class="comment"># webpack配置</span></div><div class="line">|--package.json</div><div class="line">|--main.js <span class="comment"># Electron App的入口文件</span></div></pre></td></tr></table></figure>
<hr>
<p>初步的搭建目前就算完成了。接下来该做什么具体的App呢。。我先想一会儿去==</p>
]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="Electron" scheme="http://ecmadao.com/tags/Electron/"/>
    
  </entry>
  
  <entry>
    <title>Eslint配置记录(with webpack)</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/JavaScript/Eslint%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95(with%20webpack)/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/JavaScript/Eslint配置记录(with webpack)/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#eslint-%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95with-webpack">Eslint 配置记录(with webpack)</a><ul>
<li><a href="#%E5%AE%89%E8%A3%85">安装</a></li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE">基本配置</a><ul>
<li><a href="#%E9%85%8D%E7%BD%AEwebpack">配置webpack</a></li>
</ul>
</li>
<li><a href="#%E6%8F%92%E4%BB%B6">插件</a></li>
<li><a href="#%E8%B5%84%E6%96%99">资料</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="Eslint-配置记录-with-webpack"><a href="#Eslint-配置记录-with-webpack" class="headerlink" title="Eslint 配置记录(with webpack)"></a>Eslint 配置记录(with webpack)</h2><p><a href="http://eslint.org/" target="_blank" rel="external">ESLint</a>，The pluggable linting utility for JavaScript and JSX<br><img src="/images/es-lint.jpg" alt="eslint"></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li><a href="https://github.com/eslint/eslint" target="_blank" rel="external">eslint</a></li>
<li><a href="https://github.com/feross/eslint-config-standard" target="_blank" rel="external">eslint-config-standard</a></li>
<li><a href="https://github.com/MoOx/eslint-loader" target="_blank" rel="external">eslint-loader</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ npm install eslint --save-dev</div><div class="line"></div><div class="line"><span class="comment"># use js standard style</span></div><div class="line">$ npm install eslint-config-standard --save-dev</div><div class="line"></div><div class="line"><span class="comment"># with webpack</span></div><div class="line">$ npm install eslint-loader --save-dev</div></pre></td></tr></table></figure>
<h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><h4 id="配置webpack"><a href="#配置webpack" class="headerlink" title="配置webpack"></a>配置webpack</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>: &#123;</div><div class="line">  <span class="attr">preLoaders</span>: [</div><div class="line">      &#123;<span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">loader</span>: <span class="string">"eslint-loader"</span>, <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>&#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在项目根目录下添加<code>.eslintrc.json</code>文件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">// .eslintrc.json</div><div class="line"></div><div class="line">&#123;</div><div class="line">  "extends": "standard",</div><div class="line">  "plugins": [],</div><div class="line">  "env": &#123;</div><div class="line">    "browser": true,</div><div class="line">    "node": true,</div><div class="line">    "es6": true,</div><div class="line">    "jquery": true,</div><div class="line">    "commonjs": true,</div><div class="line">    "phantomjs": true,</div><div class="line">    "mocha": true</div><div class="line">  &#125;,</div><div class="line">  "rules": &#123;</div><div class="line">    // 规则配置</div><div class="line">    "no-console": 1,</div><div class="line">    "no-debugger": 1,</div><div class="line">    "no-extra-semi": 1,</div><div class="line">    "no-constant-condition": 2,</div><div class="line">    "no-extra-boolean-cast": 2,</div><div class="line">    "use-isnan": 2,</div><div class="line">    "no-undef-init": 2,</div><div class="line">    "camelcase": 2,</div><div class="line">    "no-mixed-spaces-and-tabs": 2,</div><div class="line">    "no-const-assign":2,</div><div class="line">    "no-func-assign": 2,</div><div class="line">    "no-else-return": 1,</div><div class="line">    "no-obj-calls": 2,</div><div class="line">    "valid-typeof": 2,</div><div class="line">    "no-unused-vars": 1,</div><div class="line">    "quotes": 0,</div><div class="line">    "object-curly-spacing": 1,</div><div class="line">    "block-spacing": 1,</div><div class="line">    "semi": 0,</div><div class="line">    "no-extra-semi": 1,</div><div class="line">    "keyword-spacing": 1,</div><div class="line">    "comma-dangle": 0,</div><div class="line">    "array-bracket-spacing": 1,</div><div class="line">    "space-before-function-paren": 1,</div><div class="line">    "no-extra-bind": 1,</div><div class="line">    "no-var": "error",</div><div class="line">    "arrow-spacing": ["error", &#123; "before": true, "after": true &#125;],</div><div class="line">    "arrow-body-style": ["error", "as-needed"],</div><div class="line">    "no-empty-function": ["error", &#123; "allow": ["arrowFunctions", "constructors"] &#125;]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Eslint的规则配置具体可戳<a href="http://eslint.org/docs/rules/" target="_blank" rel="external">这里</a></p>
<p>通常，0代表不使用这个规则，1代表<code>warnning</code>的程度，2代表<code>error</code>的程度。</p>
<p>有一篇博客写的挺细的：<a href="http://guowenfh.github.io/2016/08/07/ESLint-Rules/" target="_blank" rel="external">详解 ESLint 规则，规范你的代码</a></p>
<h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><p>如果我们使用ES6/ES7或者JSX的语法，并用babel进行解析的话，可以安装<a href="https://github.com/babel/babel-eslint" target="_blank" rel="external">babel-eslint</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install babel-eslint --save-dev</div></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// .eslintrc.json</div><div class="line"></div><div class="line">&#123;</div><div class="line">  "parser": "babel-eslint",</div><div class="line">  "rules": &#123;</div><div class="line">    "strict": 0</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在使用React的时候，如果Eslint里配置了<code>no-unused-vars</code>的规则，那么在检查代码的时候会报错，提示import的组件没有被调用(实际上使用了)：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">React is defined but never used no-ununsed-vars</div><div class="line">Component is defined but never used</div></pre></td></tr></table></figure>
<p>查到Github上有人提出<a href="https://github.com/eslint/eslint/issues/4821" target="_blank" rel="external">issue</a>，解决方案是使用<code>eslint-plugin-react</code>，因此来安装配置<code>eslint-plugin</code>：</p>
<ul>
<li><a href="https://github.com/yannickcr/eslint-plugin-react" target="_blank" rel="external">eslint-plugin-react</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install eslint-plugin-react --save-dev</div></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">// .eslintrc.json</div><div class="line"></div><div class="line">&#123;</div><div class="line">  "plugins": [</div><div class="line">    "react"</div><div class="line">  ],</div><div class="line">  "parserOptions": &#123;</div><div class="line">    "ecmaFeatures": &#123;</div><div class="line">      "jsx": true</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  "rules": &#123;</div><div class="line">    "react/no-did-mount-set-state": "error",</div><div class="line">    "react/no-did-update-set-state": "error",</div><div class="line">    "react/react-in-jsx-scope": "error",</div><div class="line">    "react/jsx-uses-vars": [2],</div><div class="line">    "react/jsx-uses-react": [2]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><a href="https://github.com/benmosher/eslint-plugin-import" target="_blank" rel="external">eslint-plugin-import</a></li>
</ul>
<blockquote>
<p>检查import是否合法的插件</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install eslint-plugin-import --save-dev</div></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">// .eslintrc.json</div><div class="line"></div><div class="line">&#123;</div><div class="line">  "plugins": [</div><div class="line">    "import"</div><div class="line">  ],</div><div class="line">  "rules": &#123;</div><div class="line">  	// 检查引用的路径是否有误</div><div class="line">  	// 通过&#123;"commonjs": true, "amd": true&#125;来支持commonjs和amd方式的require</div><div class="line">  	"import/no-unresolved": [2, &#123;"commonjs": true, "amd": true&#125;]</div><div class="line">    "import/namespace": 2,</div><div class="line">  	"import/default": 2,</div><div class="line">  	"import/export": 2</div><div class="line">  &#125;,</div><div class="line">  "settings": &#123;</div><div class="line">  	// 如果我们通过webpack配置忽略了js文件后缀，在正常情况下eslint会因为找不到文件而报错。因此需要在settings里配置可省略的后缀名</div><div class="line">    "import/resolver": &#123;</div><div class="line">      "node": &#123;</div><div class="line">        "extensions": [".coffee", ".js", ".jsx"]</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    // 哪些import是不去检查的</div><div class="line">    // node_modules为默认值</div><div class="line">    // 还可以配置带有指定文件后缀不检查，如\.coffee$ </div><div class="line">    "import/ignore": ["node_modules"]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其他可选插件：</p>
<ul>
<li><a href="https://github.com/xjamundx/eslint-plugin-standard" target="_blank" rel="external">eslint-plugin-standard</a></li>
<li><a href="https://github.com/babel/eslint-plugin-babel" target="_blank" rel="external">eslint-plugin-babel</a></li>
<li><a href="https://github.com/xjamundx/eslint-plugin-promise/" target="_blank" rel="external">eslint-plugin-promise</a></li>
<li><a href="https://www.npmjs.com/package/eslint-import-resolver-webpack" target="_blank" rel="external">eslint-import-resolver-webpack</a></li>
</ul>
<h3 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h3><ul>
<li><a href="https://github.com/dustinspecker/awesome-eslint" target="_blank" rel="external">awesome-eslint</a></li>
<li><a href="http://eslint.org/" target="_blank" rel="external">Eslint</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://ecmadao.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JQuery插件开发</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/JavaScript/JQuery%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/JavaScript/JQuery插件开发/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#%E4%B8%BAjquery%E5%86%99%E6%8F%92%E4%BB%B6">为jQuery写插件</a></li>
<li><a href="#%E7%90%86%E8%A7%A3jquery%E7%9A%84extend%E3%80%81fn%E5%92%8Cfnextend">理解jquery的<code>$.extend()</code>、<code>$.fn</code>和<code>$.fn.extend()</code></a><ul>
<li><a href="#jqueryfn"><code>jQuery.fn</code></a></li>
<li><a href="#jqueryextendobject"><code>jQuery.extend(object)</code></a></li>
<li><a href="#jqueryextend-target-object1-objectn"><code>jQuery.extend( target, object1, [objectN])</code></a></li>
<li><a href="#jqueryfnextendobject"><code>jQuery.fn.extend(object);</code></a></li>
<li><a href="#jqueryfnextend--jqueryprototypeextend"><code>jQuery.fn.extend = jQuery.prototype.extend</code></a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<hr>
<p>title: JQuery 插件开发<br>date: 2016-03-04 00:08:05</p>
<h2 id="tags-JavaScript"><a href="#tags-JavaScript" class="headerlink" title="tags: JavaScript"></a>tags: JavaScript</h2><h3 id="为jQuery写插件"><a href="#为jQuery写插件" class="headerlink" title="为jQuery写插件"></a>为jQuery写插件</h3><p><a href="http://www.tuicool.com/articles/mQ7Rnye" title="为jQuery写插件" target="_blank" rel="external">原文链接</a></p>
<p>定义html，假设我们要把test div修改成宽高都是200px，背景色为红色的这么一个插件功能</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'test'</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">"jquery-1.11.3.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>写一个名为test的插件函数，完成插件的功能。这里可以直接使用this，表示选择器选择的那个元素封装对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">this</span>.css(<span class="string">'background-color'</span>,<span class="string">'red'</span>);</div><div class="line">	<span class="keyword">this</span>.css(<span class="string">'width'</span>, <span class="string">'200'</span>);</div><div class="line">	<span class="keyword">this</span>.css(<span class="string">'height'</span>, <span class="string">'200'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>完成一个自执行函数，将jQuery传进去，关键就是把插件函数挂到jQuery.fn中去。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">jquery</span>)</span>&#123;</div><div class="line">	jquery.fn.test = test;</div><div class="line">&#125;)(jQuery);</div></pre></td></tr></table></figure>
<p>调用的时候，就用jQuery选择器选择test div后直接链式调用test插件函数即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'#test'</span>).test();</div></pre></td></tr></table></figure>
<p>如此，最简单的插件就完成了。</p>
<p>代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'test'</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	</div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">"jquery-1.11.3.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">				<span class="keyword">this</span>.css(<span class="string">'background-color'</span>,<span class="string">'red'</span>);</div><div class="line">				<span class="keyword">this</span>.css(<span class="string">'width'</span>, <span class="string">'200'</span>);</div><div class="line">				<span class="keyword">this</span>.css(<span class="string">'height'</span>, <span class="string">'200'</span>);</div><div class="line">			&#125;</div><div class="line">	</div><div class="line">			(<span class="function"><span class="keyword">function</span>(<span class="params">jquery</span>)</span>&#123;</div><div class="line">				jquery.fn.test = test;</div><div class="line">			&#125;)(jQuery);</div><div class="line">	</div><div class="line">			$(<span class="string">'#test'</span>).test();</div><div class="line">	</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<hr>
<h3 id="理解jquery的-extend-、-fn和-fn-extend"><a href="#理解jquery的-extend-、-fn和-fn-extend" class="headerlink" title="理解jquery的$.extend()、$.fn和$.fn.extend()"></a>理解jquery的<code>$.extend()</code>、<code>$.fn</code>和<code>$.fn.extend()</code></h3><p><a href="http://caibaojian.com/jquery-extend-and-jquery-fn-extend.html" title="理解jquery的$.extend()、$.fn和$.fn.extend()" target="_blank" rel="external">原文链接</a></p>
<p>jQuery为开发插件提拱了两个方法，分别是：</p>
<ul>
<li><code>jQuery.fn.extend();</code></li>
<li><code>jQuery.extend();</code></li>
</ul>
<h4 id="jQuery-fn"><a href="#jQuery-fn" class="headerlink" title="jQuery.fn"></a><code>jQuery.fn</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">jQuery.fn = jQuery.prototype = &#123;</div><div class="line">　　　<span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;</div><div class="line">　　　<span class="comment">//….</span></div><div class="line">　　　&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>原来 <code>jQuery.fn = jQuery.prototype</code>对prototype肯定不会陌生啦</p>
<p>虽然 javascript　没有明确的类的概念，但是用类来理解它，会更方便。<br>jQuery便是一个封装得非常好的类，比如我们用语句<code>$(&quot;#btn1&quot;)</code>会生成一个jQuery类的实例。</p>
<h4 id="jQuery-extend-object"><a href="#jQuery-extend-object" class="headerlink" title="jQuery.extend(object)"></a><code>jQuery.extend(object)</code></h4><p>为jQuery类添加类方法，可以理解为添加静态方法。如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">jQuery.extend(&#123;</div><div class="line">	<span class="attr">min</span>: <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123; <span class="keyword">return</span> a &lt; b ? a : b; &#125;,</div><div class="line">	<span class="attr">max</span>: <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123; <span class="keyword">return</span> a &gt; b ? a : b; &#125;</div><div class="line">&#125;);</div><div class="line">jQuery.min(<span class="number">2</span>,<span class="number">3</span>); <span class="comment">//  2 </span></div><div class="line">jQuery.max(<span class="number">4</span>,<span class="number">5</span>); <span class="comment">//  5</span></div></pre></td></tr></table></figure>
<h4 id="jQuery-extend-target-object1-objectN"><a href="#jQuery-extend-target-object1-objectN" class="headerlink" title="jQuery.extend( target, object1, [objectN])"></a><code>jQuery.extend( target, object1, [objectN])</code></h4><p>用一个或多个其他对象来扩展一个对象，返回被扩展的对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> settings = &#123; <span class="attr">validate</span>: <span class="literal">false</span>, <span class="attr">limit</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">"foo"</span> &#125;; </div><div class="line"><span class="keyword">var</span> options = &#123; <span class="attr">validate</span>: <span class="literal">true</span>, <span class="attr">name</span>: <span class="string">"bar"</span> &#125;; </div><div class="line">jQuery.extend(settings, options);</div></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">settings == &#123; <span class="attr">validate</span>: <span class="literal">true</span>, <span class="attr">limit</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">"bar"</span> &#125;</div></pre></td></tr></table></figure>
<h4 id="jQuery-fn-extend-object"><a href="#jQuery-fn-extend-object" class="headerlink" title="jQuery.fn.extend(object);"></a><code>jQuery.fn.extend(object);</code></h4><p>对jQuery.prototype进得扩展，就是为jQuery类添加“成员函数”。jQuery类的实例可以使用这个“成员函数”。</p>
<p>比如我们要开发一个插件，做一个特殊的编辑框，当它被点击时，便alert 当前编辑框里的内容。可以这么做：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$.fn.extend(&#123;          </div><div class="line">	<span class="attr">alertWhileClick</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;            </div><div class="line">   		$(<span class="keyword">this</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;                 </div><div class="line">       	alert($(<span class="keyword">this</span>).val());           </div><div class="line">       &#125;);           </div><div class="line">   &#125;       </div><div class="line">&#125;);       </div><div class="line">$(<span class="string">"#input1"</span>).alertWhileClick();</div></pre></td></tr></table></figure>
<p><code>$(&quot;#input1&quot;)</code>为一个jQuery实例，当它调用成员方法<code>alertWhileClick</code>后，便实现了扩展，每次被点击时它会先弹出目前编辑里的内容。</p>
<p><code>jQuery.extend()</code>的调用并不会把方法扩展到对象的实例上，引用它的方法也需要通过jQuery类来实现，如<code>jQuery.init()</code></p>
<p>而 <strong>jQuery.fn.extend()的调用把方法扩展到了对象的prototype上，所以实例化一个jQuery对象的时候，它就具有了这些方法</strong>，这是很重要的，在jQuery.JS中到处体现这一点</p>
<h4 id="jQuery-fn-extend-jQuery-prototype-extend"><a href="#jQuery-fn-extend-jQuery-prototype-extend" class="headerlink" title="jQuery.fn.extend = jQuery.prototype.extend"></a><code>jQuery.fn.extend = jQuery.prototype.extend</code></h4><p>你可以拓展一个对象到jQuery的 prototype里去，这样的话就是插件机制了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"> $ </span>)</span>&#123;</div><div class="line">	$.fn.tooltip = <span class="function"><span class="keyword">function</span>(<span class="params"> options </span>) </span>&#123;</div><div class="line">		<span class="comment">//do something</span></div><div class="line">	&#125;;</div><div class="line">&#125;)( jQuery );</div><div class="line"><span class="comment">//等价于</span></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"> $ </span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> tooltip = &#123;</div><div class="line">		<span class="function"><span class="keyword">function</span>(<span class="params">options</span>)</span>&#123;</div><div class="line">			<span class="comment">//do something</span></div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">	$.fn.extend(tooltip) = $.prototype.extend(tooltip) = $.fn.tooltip</div><div class="line">&#125;)( jQuery );</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://ecmadao.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript Tips-2</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript%20Tips-2/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript Tips-2/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#javascript-tips-2">JavaScript Tips-2</a><ul>
<li><a href="#%E4%BD%BF%E7%94%A8arguments%E8%8E%B7%E5%8F%96%E5%87%BD%E6%95%B0%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E5%8F%82%E6%95%B0">使用<code>arguments</code>获取函数中的所有参数</a><ul>
<li><a href="#example">example</a></li>
</ul>
</li>
<li><a href="#%E4%BD%BF%E7%94%A8reduce%E9%81%8D%E5%8E%86%E6%95%B0%E7%BB%84%E5%85%83%E7%B4%A0">使用<code>reduce()</code>遍历数组元素</a><ul>
<li><a href="#%E8%AF%AD%E6%B3%95%E4%B8%80%E8%A7%88">语法一览</a></li>
<li><a href="#example-1">example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="JavaScript-Tips-2"><a href="#JavaScript-Tips-2" class="headerlink" title="JavaScript Tips-2"></a>JavaScript Tips-2</h2><h3 id="使用arguments获取函数中的所有参数"><a href="#使用arguments获取函数中的所有参数" class="headerlink" title="使用arguments获取函数中的所有参数"></a>使用<code>arguments</code>获取函数中的所有参数</h3><p><code>arguments</code>是一个类数组对象，代表传给一个函数的参数列表。</p>
<p>可以在函数内部通过<code>arguments</code>对象来获取其所有参数，然后通过<code>arguments[0]</code>这样的方法分别获取每个参数，也可以通过<code>arguments[0] = xxx</code>这样的形式改变参数。</p>
<p><strong>要注意的是，<code>arguments</code>仅仅是一个类数组对象，没有数组特有的属性和方法</strong></p>
<p>因此，如果要对<code>arguments</code>使用数组的方法，需要通过<br><code>Array.prototype.slice.call(arguments)</code><br>将它转换为数组</p>
<h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</div><div class="line">  <span class="built_in">console</span>.log(args[<span class="number">0</span>]);</div><div class="line">  fun2(...args.slice(<span class="number">1</span>));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun2</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>.length);</div><div class="line">&#125;</div><div class="line"></div><div class="line">fun(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 4</span></div></pre></td></tr></table></figure>
<p>需要提出的是，使用下面的方法无法获取<code>arguments</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// WRONG</span></div><div class="line"><span class="keyword">const</span> fun = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>.length);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用reduce-遍历数组元素"><a href="#使用reduce-遍历数组元素" class="headerlink" title="使用reduce()遍历数组元素"></a>使用<code>reduce()</code>遍历数组元素</h3><h4 id="语法一览"><a href="#语法一览" class="headerlink" title="语法一览"></a>语法一览</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">array.reduce(</div><div class="line">  <span class="function">(<span class="params">preValue, currentValue[, currentIndex[, anotherArray]]</span>) =&gt;</span> &#123;&#125;,</div><div class="line">  initialValue</div><div class="line">);</div></pre></td></tr></table></figure>
<p>也就是说，<code>reducer</code>接收一个<code>callback</code>作为必须的参数，<code>callback</code>中，以上一步的value和当前value作为参数，<code>callback</code>的返回值则又会作为下一步<code>callback</code>中的<code>preValue</code></p>
<p>除此以外，如果没有<code>initialValue</code>，则第一次<code>callback</code>时的<code>preValue</code>则为数组中的第一个元素</p>
<h4 id="example-1"><a href="#example-1" class="headerlink" title="example"></a>example</h4><p>```javascript<br>let array = [0, 1, 2, 3, 4];<br>let result = array.reduce((pre, cur) =&gt; {<br>  return pre + cur;<br>});<br>console.log(result); // 10;</p>
<p>let array2 = [0, 1, 2, 3, 4];<br>let result2 = array2.reduce((pre, cur) =&gt; {<br>  return pre + cur;<br>}, 10);<br>console.log(result2); // 20;<br>``` </p>
]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://ecmadao.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript中的一些实用方法</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%9E%E7%94%A8%E6%96%B9%E6%B3%95/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript中的一些实用方法/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#javascript-%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%9E%E7%94%A8%E6%96%B9%E6%B3%95">JavaScript 中的一些实用方法</a><ul>
<li><a href="#objectassign">Object.assign()</a></li>
<li><a href="#%E6%89%A9%E5%B1%95%E8%BF%90%E7%AE%97%E7%AC%A6-"><code>扩展运算符 ...</code></a></li>
<li><a href="#formdata">FormData</a></li>
<li><a href="#%E5%85%B3%E4%BA%8E%E6%95%B0%E7%BB%84">关于数组</a></li>
<li><a href="#weakmap">WeakMap</a><ul>
<li><a href="#%E6%96%B9%E6%B3%95">方法</a></li>
</ul>
</li>
<li><a href="#js%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F">js正则表达式</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="JavaScript-中的一些实用方法"><a href="#JavaScript-中的一些实用方法" class="headerlink" title="JavaScript 中的一些实用方法"></a>JavaScript 中的一些实用方法</h2><blockquote>
<p>偏重于ES6</p>
</blockquote>
<h3 id="Object-assign"><a href="#Object-assign" class="headerlink" title="Object.assign()"></a><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign" target="_blank" rel="external">Object.assign()</a></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Object</span>.assign(target, ...sources);</div></pre></td></tr></table></figure>
<p>把任意多个目标对象所拥有的<strong>可枚举属性</strong>拷贝给目标对象<br>返回被修改之后的 target</p>
<p><strong>继承属性和不可枚举属性不能被拷贝</strong></p>
<ul>
<li>克隆对象</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> obj = &#123;</div><div class="line">	<span class="attr">a</span>: <span class="number">1</span>,</div><div class="line">	<span class="attr">b</span>: <span class="number">2</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> copyObj = <span class="built_in">Object</span>.assign(&#123;&#125;, obj);</div><div class="line"><span class="built_in">console</span>.log(copyObj);</div></pre></td></tr></table></figure>
<ul>
<li>合并对象</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> </div><div class="line">obj1 = &#123;<span class="attr">a</span>: <span class="number">1</span>&#125;,</div><div class="line">obj2 = &#123;<span class="attr">b</span>: <span class="number">2</span>&#125;,</div><div class="line">obj3 = &#123;<span class="attr">c</span>: <span class="number">3</span>&#125;;</div><div class="line"></div><div class="line"><span class="keyword">let</span> obj = <span class="built_in">Object</span>.assign(obj1, obj2, obj3);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(obj); <span class="comment">// &#123;a:1, b:2, c:3&#125;</span></div><div class="line"><span class="built_in">console</span>.log(obj1); <span class="comment">// &#123;a:1, b:2, c:3&#125;</span></div></pre></td></tr></table></figure>
<ul>
<li>修改对象（不改变原有对象，返回新对象）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> obj1 = &#123;</div><div class="line">	<span class="attr">name</span>: <span class="string">'ecmadao'</span>,</div><div class="line">	<span class="attr">age</span>: <span class="number">24</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">let</span> obj2 = <span class="built_in">Object</span>.assign(&#123;&#125;, obj1, &#123;<span class="attr">name</span>: <span class="string">'edward'</span>&#125;);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(obj1); <span class="comment">// &#123;name: 'ecmadao', age: 24&#125;</span></div><div class="line"><span class="built_in">console</span>.log(obj2); <span class="comment">// &#123;name" 'edward', age: 24&#125;</span></div></pre></td></tr></table></figure>
<p>当需要改变的目标对象属性嵌套层级很深时….</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> obj1 = &#123;</div><div class="line">	<span class="attr">profile</span>: &#123;</div><div class="line">		<span class="attr">name</span>: <span class="string">'ecmadao'</span>,</div><div class="line">		<span class="attr">age</span>: <span class="number">24</span></div><div class="line">	&#125;,</div><div class="line">	<span class="attr">job</span>: <span class="string">'developer'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> obj2 = <span class="built_in">Object</span>.assign(&#123;&#125;, obj1, [profile]: &#123;<span class="attr">name</span>: <span class="string">'edward'</span>&#125;);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(obj2);</div><div class="line"><span class="comment">// 输出</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* &#123;</div><div class="line">* 	profile: &#123;</div><div class="line">*  		name: 'edward',</div><div class="line">*  	 	age: 24</div><div class="line">*  &#125;,</div><div class="line">*  job: 'developer'</div><div class="line">* &#125;</div><div class="line">**/</div></pre></td></tr></table></figure>
<h3 id="扩展运算符"><a href="#扩展运算符" class="headerlink" title="扩展运算符 ..."></a><code>扩展运算符 ...</code></h3><p>将一个数组转为用逗号分隔的参数序列</p>
<ul>
<li>作为参数调用</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(...[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// 1 2 3</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> list = [<span class="number">1</span>];</div><div class="line">list.push(...[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</div><div class="line"><span class="built_in">console</span>.log(list); <span class="comment">// [1, 2, 3, 4]</span></div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a, b, c</span>) </span>&#123;</div><div class="line">	<span class="comment">// do something..</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> <span class="built_in">arguments</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</div><div class="line"></div><div class="line">test(...arguments);</div></pre></td></tr></table></figure>
<ul>
<li>数组合并</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</div><div class="line"></div><div class="line">[a, b, ...list]; <span class="comment">// [a, b, 1, 2, 3]</span></div><div class="line"></div><div class="line">[...list, a, b]; <span class="comment">// [1, 2, 3, a, b]</span></div></pre></td></tr></table></figure>
<ul>
<li>将字符串转换为数组</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> a = <span class="string">'ecmadao'</span>;</div><div class="line"></div><div class="line">[...a]; <span class="comment">// ['e', 'c', 'm', 'a', 'd', 'a', 'o'];</span></div></pre></td></tr></table></figure>
<h3 id="FormData"><a href="#FormData" class="headerlink" title="FormData"></a><a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData" target="_blank" rel="external">FormData</a></h3><ul>
<li>构建 form</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 手动构建一个form</span></div><div class="line"><span class="keyword">let</span> form = <span class="keyword">new</span> FormData();</div><div class="line">form.append(key, value);</div><div class="line"></div><div class="line"><span class="comment">// 使用 &lt;form&gt; 构建一个 form</span></div><div class="line"><span class="keyword">let</span> formObj = <span class="built_in">document</span>.getElementById(<span class="string">'form_dom'</span>);</div><div class="line"><span class="comment">// let $formObj = $('#form_dom')[0];</span></div><div class="line"><span class="keyword">let</span> form = <span class="keyword">new</span> FormData(formObj);</div></pre></td></tr></table></figure>
<ul>
<li>发送数据</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">formData.append(key, value); <span class="comment">// 增加数据</span></div><div class="line"></div><div class="line"><span class="comment">// 若通过 dom 构建 form 并传输文件，则需要在 &lt;form&gt; 中加入:</span></div><div class="line">&lt;form enctype=<span class="string">"multipart/form-data"</span> method=<span class="string">"post"</span>&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></div></pre></td></tr></table></figure>
<ul>
<li>通过 jQuery 发送 FormData 时，</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$.ajax(&#123;</div><div class="line">	<span class="attr">url</span>: url,</div><div class="line">	<span class="attr">type</span>: <span class="string">'post'</span>,</div><div class="line">	<span class="attr">data</span>: formData,</div><div class="line">	<span class="attr">processData</span>: <span class="literal">false</span>,  <span class="comment">// 不要处理发送的数据</span></div><div class="line">	contentType: <span class="literal">false</span>   <span class="comment">// 不要设置Content-Type请求头</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="关于数组"><a href="#关于数组" class="headerlink" title="关于数组"></a>关于数组</h3><p><code>map()</code><br>通过<code>.map((value, index) =&gt; {})</code><br>方法返回一个由原数组中的每个元素调用一个指定方法后的返回值组成的新数组</p>
<p><code>some(callback)</code><br>some中的callback返回一个布尔值。数组中的元素只要有一个返回true，则最终将返回true</p>
<p><code>every(callback)</code><br>every中的callback返回一个布尔值，只有当数组中的元素全部返回true的时候才返回true，否则返回false</p>
<p><code>filter((value) =&gt; {})</code><br>根据filter中的函数进行筛选，返回一个符合条件的list</p>
<p><code>list.forEach((value, index) =&gt; {})</code><br>对自身中的每一个元素进行操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</div><div class="line"></div><div class="line"><span class="keyword">const</span> newList = list.map(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> value * <span class="number">2</span></div><div class="line">&#125;); </div><div class="line"><span class="built_in">console</span>.log(newList); <span class="comment">// [2, 4, 6, 8];</span></div><div class="line"><span class="keyword">return</span> list.some(<span class="function">(<span class="params">value, index</span>) =&gt;</span> value &lt; <span class="number">3</span>); <span class="comment">// true</span></div><div class="line"><span class="keyword">return</span> list.every(<span class="function">(<span class="params">value, index</span>) =&gt;</span> value &lt; <span class="number">3</span>); <span class="comment">// false</span></div><div class="line"><span class="keyword">return</span> list.filter(<span class="function">(<span class="params">value, index</span>) =&gt;</span> value &gt; <span class="number">3</span>); <span class="comment">// [4]</span></div><div class="line"><span class="keyword">return</span> list.forEach(<span class="function">(<span class="params">value, index</span>) =&gt;</span> value * <span class="number">2</span>); <span class="comment">// [2, 4, 6, 8]</span></div></pre></td></tr></table></figure>
<p>关于<code>map</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> numbers = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>];</div><div class="line"><span class="keyword">var</span> roots = numbers.map(<span class="built_in">Math</span>.sqrt);</div><div class="line"><span class="comment">/* roots的值为[1, 2, 3], numbers的值仍为[1, 4, 9] */</span></div><div class="line"></div><div class="line">[<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>].map(<span class="built_in">parseInt</span>);</div><div class="line"><span class="comment">// 你可能觉的会是[1, 2, 3]</span></div><div class="line"><span class="comment">// 但实际的结果是 [1, NaN, NaN]</span></div><div class="line"></div><div class="line"><span class="comment">// 通常使用parseInt时,只需要传递一个参数.但实际上,parseInt可以有两个参数.第二个参数是进制数.可以通过语句"alert(parseInt.length)===2"来验证.</span></div><div class="line"><span class="comment">// map方法在调用callback函数时,会给它传递三个参数:当前正在遍历的元素, 元素索引, 原数组本身.</span></div><div class="line"><span class="comment">// 第三个参数parseInt会忽视, 但第二个参数不会,也就是说,parseInt把传过来的索引值当成进制数来使用.从而返回了NaN.</span></div><div class="line"></div><div class="line"><span class="comment">//应该使用如下的函数returnInt</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnInt</span>(<span class="params">element</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">parseInt</span>(element,<span class="number">10</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">[<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>].map(returnInt);</div><div class="line"><span class="comment">// [1,2,3]</span></div></pre></td></tr></table></figure></p>
<h3 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap" target="_blank" rel="external">WeakMap</a></h3><blockquote>
<p>WeakMap对象就是简单的键/值映射.但键只能是对象值,不可以是原始值.</p>
<p>典型应用是，一个对应DOM元素的WeakMap结构，当某个DOM元素被清除，其所对应的WeakMap记录就会自动被移除</p>
</blockquote>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><p><code>const weakMap = new WeakMap();</code></p>
<ul>
<li><code>weakMap.get(key [, defaultValue])</code></li>
<li><code>weakMap.set(key, value)</code></li>
<li><code>weakMap.has(key)</code></li>
<li><code>weakMap.delete(key)</code></li>
<li><code>weakMap.clear()</code></li>
</ul>
<p><a href="https://gist.github.com/greim/44e54c2f23eab955bb73b31426e96d6c" target="_blank" rel="external">利用<code>WeakMap</code>创建对象中的私有变量</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> __ = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(x) &#123;</div><div class="line">    __.set(<span class="keyword">this</span>, &#123; x &#125;);</div><div class="line">  &#125;</div><div class="line">  getX() &#123;</div><div class="line">    <span class="keyword">var</span> &#123; x &#125; = __.get(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">return</span> x;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="js正则表达式"><a href="#js正则表达式" class="headerlink" title="js正则表达式"></a>js正则表达式</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions" target="_blank" rel="external">正则表达式</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://ecmadao.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript Tips-1</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript%20Tips-1/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript Tips-1/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#javascript-tips-1">JavaScript Tips-1</a><ul>
<li><a href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%84%E7%90%86">文件上传处理</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E6%8B%96%E6%8B%BD%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6">通过拖拽上传文件</a></li>
<li><a href="#js%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BDcss">js动态加载CSS</a></li>
<li><a href="#js%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BDjs">js动态加载js</a></li>
<li><a href="#%E7%BB%99%E9%80%9A%E8%BF%87js%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%E7%9A%84%E5%85%83%E7%B4%A0%E7%BB%91%E5%AE%9A%E4%BA%8B%E4%BB%B6">给通过JS动态生成的元素绑定事件</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8javascript%E8%8E%B7%E5%8F%96css%E4%BC%AA%E5%85%83%E7%B4%A0%E5%B1%9E%E6%80%A7">使用JavaScript获取CSS伪元素属性</a></li>
<li><a href="#%E7%A6%81%E6%AD%A2%E5%8F%B3%E9%94%AE%E7%82%B9%E5%87%BB">禁止右键点击</a></li>
<li><a href="#%E6%A3%80%E6%9F%A5%E5%9B%BE%E7%89%87%E6%98%AF%E5%90%A6%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90">检查图片是否加载完成</a></li>
<li><a href="#%E8%87%AA%E5%8A%A8%E4%BF%AE%E6%94%B9%E7%A0%B4%E6%8D%9F%E5%9B%BE%E5%83%8F">自动修改破损图像</a></li>
<li><a href="#%E9%AA%8C%E8%AF%81%E5%85%83%E7%B4%A0%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E4%BA%8Ejquery%E5%AF%B9%E8%B1%A1%E9%9B%86%E5%90%88%E4%B8%AD">验证元素是否存在于jquery对象集合中</a></li>
<li><a href="#%E7%A1%AE%E8%AE%A4%E5%8F%96%E6%B6%88%E5%AF%B9%E8%AF%9D%E6%A1%86">确认/取消对话框</a></li>
<li><a href="#%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6">发送邮件</a></li>
<li><a href="#%E7%9B%91%E6%B5%8B%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AA%97%E5%8F%A3%E7%9A%84%E5%A4%A7%E5%B0%8F%E6%94%B9%E5%8F%98">监测浏览器窗口的大小改变</a></li>
<li><a href="#%E7%9B%91%E6%B5%8B%E6%8C%89%E9%94%AE">监测按键</a></li>
<li><a href="#%E5%9C%A8head%E5%8C%BA%E5%9F%9F%E6%9B%BF%E6%8D%A2%E6%95%B4%E5%BC%A0%E6%A0%B7%E5%BC%8F%E8%A1%A8">在head区域替换整张样式表</a></li>
<li><a href="#null-&amp;-undefined-"><code>null</code> &amp; <code>undefined</code></a></li>
<li><a href="#typeof%E6%A3%80%E6%B5%8B%E5%8E%9F%E5%A7%8B%E7%B1%BB%E5%9E%8B"><code>typeof</code>检测原始类型</a></li>
<li><a href="#instanceof%E6%A3%80%E6%B5%8B%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B"><code>instanceof</code>检测引用类型</a></li>
<li><a href="#forin%E5%BE%AA%E7%8E%AF"><code>for..in</code>循环</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="JavaScript-Tips-1"><a href="#JavaScript-Tips-1" class="headerlink" title="JavaScript Tips-1"></a>JavaScript Tips-1</h2><h3 id="文件上传处理"><a href="#文件上传处理" class="headerlink" title="文件上传处理"></a>文件上传处理</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">onchange</span>=<span class="string">"processFile(this.file)"</span>/&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> processFile = <span class="function">(<span class="params">files</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">let</span> file = files[<span class="number">0</span>];</div><div class="line">  <span class="keyword">let</span> fileName = file.name;</div><div class="line">  <span class="keyword">let</span> reader = <span class="keyword">new</span> FileReader();</div><div class="line">  reader.onload = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    <span class="comment">// if file is a image</span></div><div class="line">    <span class="comment">// let url = e.target.result;</span></div><div class="line">  &#125;</div><div class="line">  reader.readAsText(file); <span class="comment">// 只能处理包含文本内容的文件</span></div><div class="line">  reader.readAsDataUrl(file); <span class="comment">// 处理图片文件</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="通过拖拽上传文件"><a href="#通过拖拽上传文件" class="headerlink" title="通过拖拽上传文件"></a>通过拖拽上传文件</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dropFile"</span>&gt;</span>拖拽上传<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">let</span> dropFile = <span class="built_in">document</span>.getElementById(<span class="string">'dropFile'</span>);</div><div class="line">  dropFile.ondragenter = ignoreDrag;</div><div class="line">  dropFile.ondragover = ignoreDrag;</div><div class="line">  dropFile.ondrop = drop;</div><div class="line">  </div><div class="line">  <span class="keyword">const</span> ignoreDrag = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    e.stopPropagation();</div><div class="line">    e.preventDefault();</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">const</span> drop = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</div><div class="line">    e.stopPropagation();</div><div class="line">    e.preventDefault();</div><div class="line">    <span class="keyword">let</span> data = e.dataTransfer;</div><div class="line">    <span class="keyword">let</span> files = data.files;</div><div class="line">    </div><div class="line">    processFile(files)</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="js动态加载CSS"><a href="#js动态加载CSS" class="headerlink" title="js动态加载CSS"></a>js动态加载CSS</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">	<span class="keyword">var</span> link = <span class="built_in">document</span>.createElement( <span class="string">"link"</span> );</div><div class="line">	link.type = <span class="string">"text/css"</span>;</div><div class="line">	link.rel = <span class="string">"stylesheet"</span>;</div><div class="line">	<span class="keyword">var</span> url = <span class="string">"//static.nutsbp.com/css/user/css/profile.css"</span></div><div class="line">	link.href = url;</div><div class="line">	<span class="built_in">document</span>.getElementsByTagName( <span class="string">"head"</span> )[<span class="number">0</span>].appendChild(link);</div><div class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h3 id="js动态加载js"><a href="#js动态加载js" class="headerlink" title="js动态加载js"></a>js动态加载js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.write(<span class="string">"&lt;script src='http:\/\/static.nutsbp.com\/js\/user\/me_form.js'&gt;&lt;\/script&gt;"</span>);</div></pre></td></tr></table></figure>
<h3 id="给通过JS动态生成的元素绑定事件"><a href="#给通过JS动态生成的元素绑定事件" class="headerlink" title="给通过JS动态生成的元素绑定事件"></a>给通过JS动态生成的元素绑定事件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).on(<span class="string">"click"</span>, <span class="string">".target"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="comment">//获取目标元素</span></div><div class="line">	<span class="keyword">var</span> $target = $(e.target);</div><div class="line">	<span class="comment">// do something..</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="使用JavaScript获取CSS伪元素属性"><a href="#使用JavaScript获取CSS伪元素属性" class="headerlink" title="使用JavaScript获取CSS伪元素属性"></a>使用JavaScript获取CSS伪元素属性</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取 .element:before 的 color 值  </span></div><div class="line"><span class="keyword">var</span> color = <span class="built_in">window</span>.getComputedStyle(  </div><div class="line">	<span class="built_in">document</span>.querySelector(<span class="string">'.element'</span>),</div><div class="line">	<span class="string">':before'</span>).getPropertyValue(<span class="string">'color'</span>); </div><div class="line"></div><div class="line"><span class="comment">// 获取 .element:before 的 content 值  </span></div><div class="line"><span class="keyword">var</span> content = <span class="built_in">window</span>.getComputedStyle(  </div><div class="line">	<span class="built_in">document</span>.querySelector(<span class="string">'.element'</span>),</div><div class="line">	<span class="string">':before'</span>  ).getPropertyValue(<span class="string">'content'</span>);</div></pre></td></tr></table></figure>
<h3 id="禁止右键点击"><a href="#禁止右键点击" class="headerlink" title="禁止右键点击"></a>禁止右键点击</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	$(<span class="built_in">document</span>).bind(<span class="string">"contextmenu"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="检查图片是否加载完成"><a href="#检查图片是否加载完成" class="headerlink" title="检查图片是否加载完成"></a>检查图片是否加载完成</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'img'</span>).load(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'image load successful'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="自动修改破损图像"><a href="#自动修改破损图像" class="headerlink" title="自动修改破损图像"></a>自动修改破损图像</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'img'</span>).on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	$(<span class="keyword">this</span>).prop(<span class="string">'src'</span>, <span class="string">'img/broken.png'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="验证元素是否存在于jquery对象集合中"><a href="#验证元素是否存在于jquery对象集合中" class="headerlink" title="验证元素是否存在于jquery对象集合中"></a>验证元素是否存在于jquery对象集合中</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ($(<span class="string">'#id'</span>).length) &#123;</div><div class="line">	<span class="comment">// do something</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="确认-取消对话框"><a href="#确认-取消对话框" class="headerlink" title="确认/取消对话框"></a>确认/取消对话框</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">	like=<span class="built_in">window</span>.confirm(<span class="string">"how do you do?"</span>);</div><div class="line">	<span class="keyword">if</span>(like==<span class="literal">true</span>)&#123;</div><div class="line">		<span class="built_in">document</span>.write(<span class="string">"fine"</span>);<span class="comment">//confirm</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> &#123;</div><div class="line">		<span class="built_in">document</span>.write(<span class="string">"nothing to say"</span>);<span class="comment">//cancel</span></div><div class="line">	&#125;</div><div class="line">&lt;<span class="regexp">/script&gt;</span></div></pre></td></tr></table></figure>
<h3 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;a href=“mailto:xxx@xxx.com”&gt;<span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></div><div class="line"><span class="comment">//或者在js中</span></div><div class="line"><span class="built_in">window</span>.location.href = <span class="string">'mailto:'</span> + address;</div></pre></td></tr></table></figure>
<h3 id="监测浏览器窗口的大小改变"><a href="#监测浏览器窗口的大小改变" class="headerlink" title="监测浏览器窗口的大小改变"></a>监测浏览器窗口的大小改变</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">window</span>).on(<span class="string">'resize'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="comment">//do something</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="监测按键"><a href="#监测按键" class="headerlink" title="监测按键"></a>监测按键</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).on(<span class="string">'keydown'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> keyCode = event.keyCode;</div><div class="line">	<span class="comment">//do something</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="在head区域替换整张样式表"><a href="#在head区域替换整张样式表" class="headerlink" title="在head区域替换整张样式表"></a>在head区域替换整张样式表</h3><p>如果样式变动很多，那么可以将它独立出来，通过<code>@media</code>放在head区域</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">meida</span>=<span class="string">"(max-width:600px)"</span> <span class="attr">href</span>=<span class="string">"mobile_style.css"</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="null-amp-undefined"><a href="#null-amp-undefined" class="headerlink" title="null &amp; undefined"></a><code>null</code> &amp; <code>undefined</code></h3><p>注意<code>null</code>与<code>undefined</code>的区别:</p>
<ul>
<li>null 可用于初始化一个变量</li>
<li>undefined代表变量未被初始化</li>
</ul>
<p><strong>不要用null来检测是否传入了某个参数</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 反面教材（用null检测是否传入参数）</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">deSomething</span>(<span class="params">arg1, arg2, arg3</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(arg3 != <span class="literal">null</span>)&#123;</div><div class="line">		<span class="comment">// do something..</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>不要用null来检测一个未初始化的变量</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 反面教材（变量没有初始化就和null比较）</span></div><div class="line"><span class="keyword">var</span> person;</div><div class="line"><span class="keyword">if</span>(person != <span class="literal">null</span>)&#123;</div><div class="line">	<span class="comment">// do something..</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>应该将null当做占位符使用</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> person = <span class="literal">null</span>;</div><div class="line"></div><div class="line"><span class="comment">// ....</span></div><div class="line"></div><div class="line"><span class="keyword">if</span>(person != <span class="literal">null</span>)&#123;</div><div class="line">	<span class="comment">// do something..</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>尽量避免使用特殊值undefined</strong></p>
<p>可以有效确保只在一种情况下<code>typeof</code>返回<code>undefined</code>：当变量为声明时</p>
<p><strong>使用null初始化变量</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> person = <span class="literal">null</span>;</div><div class="line"><span class="built_in">console</span>.log(person === <span class="literal">null</span>); <span class="comment">// true</span></div><div class="line"><span class="built_in">console</span>.log(person === <span class="literal">undefined</span>); <span class="comment">// false</span></div></pre></td></tr></table></figure>
<h3 id="typeof检测原始类型"><a href="#typeof检测原始类型" class="headerlink" title="typeof检测原始类型"></a><code>typeof</code>检测原始类型</h3><p>JavaScript中的五种原始类型：字符串(string)、数字(number)、布尔值(boolean)、null、undefined</p>
<p><strong>可使用<code>typeof</code>检测 字符串、数字、布尔值、undefined的类型</strong></p>
<p><strong>未定义的变量和值为undefined的变量通过<code>typeof</code>都将返回<code>undefined</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> </div><div class="line">name = <span class="string">"ecmadao"</span>,</div><div class="line">num = <span class="number">5</span>,</div><div class="line">isTrue = <span class="literal">true</span>,</div><div class="line">jsUndefined;</div><div class="line"></div><div class="line"><span class="keyword">typeof</span> name; <span class="comment">// string</span></div><div class="line"><span class="keyword">typeof</span> num; <span class="comment">// number</span></div><div class="line"><span class="keyword">typeof</span> isTrue; <span class="comment">// boolean</span></div><div class="line"><span class="keyword">typeof</span> jsUndefined; <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<p><strong>可用<code>typeof</code>检测函数</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFun</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line"></div><div class="line"><span class="keyword">typeof</span> myFun; <span class="comment">// function</span></div></pre></td></tr></table></figure>
<h3 id="instanceof检测引用类型"><a href="#instanceof检测引用类型" class="headerlink" title="instanceof检测引用类型"></a><code>instanceof</code>检测引用类型</h3><p><strong><code>typeof</code>检测引用类型的时候，会返回<code>object</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typeof</span> []; <span class="comment">// object</span></div><div class="line"><span class="keyword">typeof</span> &#123;&#125;; <span class="comment">//object</span></div><div class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">// object</span></div></pre></td></tr></table></figure>
<h3 id="for-in循环"><a href="#for-in循环" class="headerlink" title="for..in循环"></a><code>for..in</code>循环</h3><p><code>for..in</code>循环用于遍历对象属性，返回属性名</p>
<p><strong>循环不仅遍历对象的实例属性，也遍历原型属性</strong></p>
<p><strong>可使用<code>hasOwnProperty()</code>方法进行过滤</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> props;</div><div class="line"><span class="keyword">for</span> (props <span class="keyword">in</span> object)&#123;</div><div class="line">	<span class="keyword">if</span>(object.hasOwnProperty(props))&#123;</div><div class="line">		<span class="built_in">console</span>.log(object[props]);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://ecmadao.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript函数式编程</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript函数式编程/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#javascript-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B">JavaScript-函数式编程</a><ul>
<li><a href="#%E5%87%BD%E6%95%B0%E4%B8%8E%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%80%E6%A0%B7%EF%BC%8C%E5%A4%84%E4%BA%8E%E5%B9%B3%E7%AD%89%E5%9C%B0%E4%BD%8D">函数与其他数据类型一样，处于平等地位</a></li>
<li><a href="#%E5%87%BD%E6%95%B0%E5%BA%94%E8%AF%A5%E7%BA%AF%E5%A4%A9%E7%84%B6%EF%BC%8C%E6%97%A0%E5%89%AF%E4%BD%9C%E7%94%A8">函数应该纯天然，无副作用</a></li>
<li><a href="#%E5%BC%95%E7%94%A8%E9%80%8F%E6%98%8E">引用透明</a></li>
<li><a href="#immutable">immutable</a></li>
<li><a href="#%E6%9F%AF%E9%87%8C%E5%8C%96">柯里化</a><ul>
<li><a href="#%E6%A6%82%E5%BF%B5%E6%91%98%E8%A6%81">概念摘要</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E6%9F%AF%E9%87%8C%E5%8C%96%E5%87%BD%E6%95%B0">创建柯里化函数</a></li>
</ul>
</li>
<li><a href="#%E4%BB%A3%E7%A0%81%E7%BB%84%E5%90%88">代码组合</a><ul>
<li><a href="#pointfree-%E5%87%BD%E6%95%B0%E6%97%A0%E9%9C%80%E6%8F%90%E5%8F%8A%E8%A6%81%E6%93%8D%E4%BD%9C%E7%9A%84%E6%95%B0%E6%8D%AE%E6%98%AF%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84">pointfree 函数无需提及要操作的数据是什么样的</a></li>
<li><a href="#%E7%BB%93%E5%90%88%E5%BE%8B">结合律</a></li>
<li><a href="#%E5%9D%91">坑</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="JavaScript-函数式编程"><a href="#JavaScript-函数式编程" class="headerlink" title="JavaScript-函数式编程"></a>JavaScript-函数式编程</h2><p>命令式编程中“典型”的方法和过程都深深地根植于它们所在的环境中，通过状态、依赖和有效作用达成；纯函数与此相反，它与环境无关，只要我们愿意，可以在任何地方运行它</p>
<blockquote>
<p>面向对象语言的问题是，它们永远都要随身携带那些隐式的环境。你只需要一个香蕉，但却得到一个拿着香蕉的大猩猩…以及整个丛林</p>
</blockquote>
<h3 id="函数与其他数据类型一样，处于平等地位"><a href="#函数与其他数据类型一样，处于平等地位" class="headerlink" title="函数与其他数据类型一样，处于平等地位"></a>函数与其他数据类型一样，处于平等地位</h3><p>可作为变量一样被传递、返回或者在函数中嵌套函数。可作为参数。使用总有返回值的表达式而不是语句</p>
<h3 id="函数应该纯天然，无副作用"><a href="#函数应该纯天然，无副作用" class="headerlink" title="函数应该纯天然，无副作用"></a>函数应该纯天然，无副作用</h3><p>副作用是指，函数内部与外部互动，产生运算以外的其他结果。<br>例如在函数调用的过程中，利用并修改到了外部的变量，那么就是一个有副作用的函数。</p>
<p>由于<strong>函数式编程不修改外部变量</strong>，所以根本不存在线程锁的问题。多线程并发的时候不用担心使用的变量被其他线程所修改 </p>
<h3 id="引用透明"><a href="#引用透明" class="headerlink" title="引用透明"></a>引用透明</h3><p><strong>纯函数的运行不应该依赖于外部变量或状态，只依赖于输入的参数。对于相同的输入参数，返回的结果一定相同。</strong></p>
<h3 id="immutable"><a href="#immutable" class="headerlink" title="immutable"></a>immutable</h3><p>如果要改变变量，则需要把数据deep copy出去进行修改</p>
<p>几个函数式编程的普通例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 非函数式编程</span></div><div class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">increase</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  a++;</div><div class="line">&#125;</div><div class="line">increase();</div><div class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 2</span></div><div class="line"></div><div class="line"><span class="comment">// 函数式编程</span></div><div class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">increase</span>(<span class="params">a</span>) </span>&#123; <span class="comment">// 通过参数引用，不依赖外部数据</span></div><div class="line">  <span class="keyword">return</span> a + <span class="number">1</span>; <span class="comment">// 不改变外部数据，返回一个新值</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(increase(a)); <span class="comment">// 2</span></div><div class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 1</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 比较Array中的slice和splice</span></div><div class="line"><span class="keyword">let</span> test = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</div><div class="line"></div><div class="line"><span class="comment">// slice为纯函数，返回一个新的数组</span></div><div class="line"><span class="built_in">console</span>.log(test.slice(<span class="number">0</span>, <span class="number">3</span>)); <span class="comment">// [1, 2, 3]</span></div><div class="line"><span class="built_in">console</span>.log(test); <span class="comment">//[1, 2, 3, 4, 5]</span></div><div class="line"></div><div class="line"><span class="comment">// splice则会修改参数数组</span></div><div class="line"><span class="built_in">console</span>.log(test.splice(<span class="number">0</span>, <span class="number">3</span>)); <span class="comment">// [1, 2, 3]</span></div><div class="line"><span class="built_in">console</span>.log(test); <span class="comment">// [4, 5]</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 函数式编程-函数作为返回参数</span></div><div class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> plus = <span class="function">(<span class="params">y</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> x + y;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">let</span> plus1 = add(<span class="number">1</span>);</div><div class="line"><span class="keyword">let</span> plus2 = add(<span class="number">2</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(plus1(<span class="number">1</span>)); <span class="comment">// 2</span></div><div class="line"><span class="built_in">console</span>.log(plus2(<span class="number">1</span>)); <span class="comment">// 3</span></div></pre></td></tr></table></figure>
<p>函数式编程的几个要点</p>
<blockquote>
<p>把函数当成变量来用，关注于描述问题而不是怎么实现</p>
<p>函数之间没有共享的变量</p>
<p>函数间通过参数和返回值来传递数据</p>
<p>在函数里没有临时变量</p>
</blockquote>
<p><a href="http://coolshell.cn/articles/10822.html" target="_blank" rel="external">函数式编程</a></p>
<h3 id="柯里化"><a href="#柯里化" class="headerlink" title="柯里化"></a>柯里化</h3><blockquote>
<p>把接受多个参数的函数变换成接受一个单一参数(最初函数的第一个参数)的函数，并且返回接受余下参数且返回结果的新函数</p>
</blockquote>
<h4 id="概念摘要"><a href="#概念摘要" class="headerlink" title="概念摘要"></a>概念摘要</h4><p>即：<br>传入一个（或很少量的）参数调用父函数，父函数返回一个可接受多个参数的子函数。例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">y, z</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> x + y + z</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> increase = add(<span class="number">1</span>);</div><div class="line"><span class="built_in">console</span>.log(increase(<span class="number">2</span>, <span class="number">3</span>)); <span class="comment">// 6</span></div></pre></td></tr></table></figure></p>
<p>函数式编程+柯里化，将提取成柯里化的函数部分配置好之后，可作为参数传入，简化操作流程。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 给list中每个元素先加1，再加5，再减1</span></div><div class="line"><span class="keyword">let</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</div><div class="line"></div><div class="line"><span class="comment">//正常做法</span></div><div class="line"><span class="keyword">let</span> list1 = list.map(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> value + <span class="number">1</span>;</div><div class="line">&#125;);</div><div class="line"><span class="keyword">let</span> list2 = list1.map(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> value + <span class="number">5</span>;</div><div class="line">&#125;);</div><div class="line"><span class="keyword">let</span> list3 = list2.map(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> value - <span class="number">1</span>;</div><div class="line">&#125;);</div><div class="line"><span class="built_in">console</span>.log(list3); <span class="comment">// [6, 7, 8, 9, 10]</span></div><div class="line"></div><div class="line"><span class="comment">// 柯里化</span></div><div class="line"><span class="keyword">const</span> changeList = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> data + num</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">let</span> list1 = list.map(changeList(<span class="number">1</span>)).map(changeList(<span class="number">5</span>)).map(changeList(<span class="number">-1</span>));</div><div class="line"><span class="built_in">console</span>.log(list1); <span class="comment">// [6, 7, 8, 9, 10]</span></div></pre></td></tr></table></figure></p>
<h4 id="创建柯里化函数"><a href="#创建柯里化函数" class="headerlink" title="创建柯里化函数"></a>创建柯里化函数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 安装lodash依赖</span></div><div class="line">$ npm install lodash</div><div class="line"></div><div class="line"><span class="keyword">let</span> curry = <span class="built_in">require</span>(<span class="string">'lodash'</span>).curry;</div><div class="line"><span class="keyword">let</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</div><div class="line"></div><div class="line"><span class="keyword">let</span> filter = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, ary</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> ary.filter(f);</div><div class="line">&#125;);</div><div class="line"><span class="keyword">let</span> map = curry(<span class="function"><span class="keyword">function</span>(<span class="params">f, ary</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> ary.map(f);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">let</span> filterFun = <span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">y</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> x &lt; y</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> mapFun = <span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">y</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> x + y</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> filteredList = filter(filterFun(<span class="number">3</span>), list);</div><div class="line"><span class="keyword">let</span> mapedList = map(mapFun(<span class="number">1</span>), list);</div><div class="line"><span class="built_in">console</span>.log(filteredList); <span class="comment">// [4]</span></div><div class="line"><span class="built_in">console</span>.log(mapedList); <span class="comment">// [2, 3, 4, 5]</span></div></pre></td></tr></table></figure>
<h3 id="代码组合"><a href="#代码组合" class="headerlink" title="代码组合"></a>代码组合</h3><p>将数个函数对象作为参数传递给一个函数，在该函数内部将传入的函数参数分别作为参数进行嵌套。最直观的例子如下所示：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> compose = <span class="function">(<span class="params">f,g</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> f(g(x));</div><div class="line">  &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h4 id="pointfree-函数无需提及要操作的数据是什么样的"><a href="#pointfree-函数无需提及要操作的数据是什么样的" class="headerlink" title="pointfree 函数无需提及要操作的数据是什么样的"></a>pointfree 函数无需提及要操作的数据是什么样的</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 非pointfree函数。提及到了数据list</span></div><div class="line"><span class="keyword">const</span> filterList = <span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> list.map(<span class="function">(<span class="params">value</span>) =&gt;</span> value * <span class="number">2</span>).filter(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="keyword">return</span> value &lt; <span class="number">3</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// 非pointfree函数，提及到了数据word</span></div><div class="line"><span class="keyword">const</span> changeWord = <span class="function">(<span class="params">word</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> word.toLowerCase().split(<span class="string">' '</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// pointfree</span></div><div class="line"><span class="keyword">const</span> filterList = compose(filter(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="keyword">return</span> value &lt; <span class="number">3</span>), map(<span class="function">(<span class="params">value</span>) =&gt;</span> value * <span class="number">2</span>));</div><div class="line"><span class="keyword">const</span> changeWord = compose(split(<span class="string">' '</span>), toLowerCase)</div></pre></td></tr></table></figure>
<h4 id="结合律"><a href="#结合律" class="headerlink" title="结合律"></a>结合律</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">compose(f, compose(g, h)) == compose(compose(f, g), h);</div><div class="line"></div><div class="line"><span class="comment">// map函数的组合律</span></div><div class="line">compose(map(f), map(p)) == map(compose(f, g));</div></pre></td></tr></table></figure>
<h4 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h4><p>ERROR: 在没有局部调用之前，就组合类似 map 这样接受两个参数的函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> addOne = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> value + <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// error</span></div><div class="line"><span class="keyword">const</span> greaterList = compose(map, addOne, reverse);</div><div class="line"><span class="comment">// god</span></div><div class="line"><span class="keyword">const</span> greaterList = compose(map(addOne), reverse);</div><div class="line">greaterList([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// [4, 3, 2]</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://ecmadao.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript异步操作</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript异步操作/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#javascript%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C">JavaScript异步操作</a><ul>
<li><a href="#fetch">Fetch</a><ul>
<li><a href="#%E5%AE%9E%E4%BE%8B">实例</a></li>
</ul>
</li>
<li><a href="#promise">Promise</a><ul>
<li><a href="#apis">APIS</a></li>
</ul>
</li>
<li><a href="#es7%E7%9A%84%E5%BC%82%E6%AD%A5asyncawait">ES7的异步<code>async/await</code></a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="JavaScript异步操作"><a href="#JavaScript异步操作" class="headerlink" title="JavaScript异步操作"></a>JavaScript异步操作</h2><h3 id="Fetch"><a href="#Fetch" class="headerlink" title="Fetch"></a><a href="http://github.github.io/fetch/" target="_blank" rel="external">Fetch</a></h3><p>用于发送异步请求，返回 Promise 对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">fetch(request).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</div><div class="line">  <span class="comment">// handle HTTP response</span></div><div class="line">  <span class="keyword">if</span>(response.ok) &#123;</div><div class="line">  	<span class="comment">// ....</span></div><div class="line">  &#125;<span class="keyword">else</span> &#123;</div><div class="line">  	<span class="comment">// ...</span></div><div class="line">  &#125;</div><div class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</div><div class="line">  <span class="comment">// handle network error</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>更详细的例子:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 提交GET请求</span></div><div class="line">fetch(url).then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</div><div class="line"></div><div class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</div><div class="line"></div><div class="line">&#125;);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 提交POST请求</span></div><div class="line"><span class="comment">// request 请求</span></div><div class="line">fetch(url, &#123;</div><div class="line">  <span class="attr">method</span>: <span class="string">"POST"</span>,</div><div class="line">  <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(data),</div><div class="line">  <span class="comment">// fetch 的 Headers 接口</span></div><div class="line">  headers: &#123;</div><div class="line">    <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">credentials</span>: <span class="string">"same-origin"</span></div><div class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// response 相应</span></div><div class="line">  response.status     <span class="comment">//=&gt; number 100–599</span></div><div class="line">  response.statusText <span class="comment">//=&gt; String</span></div><div class="line">  response.headers    <span class="comment">//=&gt; Headers</span></div><div class="line">  response.url        <span class="comment">//=&gt; String</span></div><div class="line"></div><div class="line">  response.text().then(<span class="function"><span class="keyword">function</span>(<span class="params">responseText</span>) </span>&#123; ... &#125;)</div><div class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</div><div class="line">  error.message <span class="comment">//=&gt; String</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<ul>
<li>Headers</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 不同的构造方法</span></div><div class="line"></div><div class="line"><span class="comment">// key-value</span></div><div class="line"><span class="keyword">var</span> content = <span class="string">"Hello World"</span>;</div><div class="line"><span class="keyword">var</span> reqHeaders = <span class="keyword">new</span> Headers();</div><div class="line">reqHeaders.append(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span></div><div class="line">reqHeaders.append(<span class="string">"Content-Length"</span>, content.length.toString());</div><div class="line">reqHeaders.append(<span class="string">"X-Custom-Header"</span>, <span class="string">"ProcessThisImmediately"</span>);</div><div class="line"></div><div class="line"><span class="comment">// json</span></div><div class="line">reqHeaders = <span class="keyword">new</span> Headers(&#123;</div><div class="line">  <span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>,</div><div class="line">  <span class="string">"Content-Length"</span>: content.length.toString(),</div><div class="line">  <span class="string">"X-Custom-Header"</span>: <span class="string">"ProcessThisImmediately"</span>,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>request</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/** 注：</div><div class="line">* request = (url, options)</div><div class="line">* url 为请求的路径</div><div class="line">* options为详细配置:</div><div class="line">**/</div><div class="line"></div><div class="line">- method (String) - HTTP 请求方式, 默认为 &quot;GET&quot;</div><div class="line">- body (String, Blob, FormData) - HTTP 请求体</div><div class="line">- headers (Object, Headers) - 请求头部, Default: &#123;&#125;</div><div class="line">- credentials (String) - 是否允许跨域请求 Authentication credentials mode. Default: &quot;omit&quot;. Other data structures need to be encoded before hand as one of these types</div><div class="line">	- &quot;omit&quot; - don&apos;t include authentication credentials (e.g. cookies) in the request</div><div class="line">	- &quot;same-origin&quot; - 如果一个请求是跨域的，那么返回一个简单的error</div><div class="line">	- &quot;include&quot; - include credentials in requests to all sites</div></pre></td></tr></table></figure>
<ul>
<li>response</li>
</ul>
<p>response 的属性:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">status (number) - HTTP状态码，100~599之间</div><div class="line">statusText (String) - Status text as reported by the server, e.g. &quot;Unauthorized&quot;</div><div class="line">ok (boolean) - 如果返回的HTTP状态码为2XX则为true</div><div class="line">headers (Headers)</div><div class="line">url (String)</div></pre></td></tr></table></figure>
<p>response处理body的方法:</p>
<p><strong>返回一个Promise对象</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">text() - 将 response text 转为 String</div><div class="line">json() - 输出 result of JSON.parse(responseText)</div><div class="line">blob() - yields a Blob</div><div class="line">arrayBuffer() - yields an ArrayBuffer</div><div class="line">formData() - 处理成可以再次被request使用的formData对象</div></pre></td></tr></table></figure>
<p><strong>request 和 response 的body 只能被读取一次, 读取之后 bodyUsed 属性被设置为 true, 则不能再次读取</strong></p>
<p>若要多次读取 body, 则应该在读取之前调用 <code>response.clone()</code> 方法, 之后读取clone的body（每个clone只能读取一次）</p>
<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><ul>
<li>通过fetch获取数据</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">fetch(url).then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json()) <span class="comment">// 解析获取到的json</span></div><div class="line">.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">  <span class="comment">// do something</span></div><div class="line">&#125;)</div><div class="line">.catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">  <span class="comment">// do something</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>通过fetch发送数据</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">fetch(url, &#123;</div><div class="line">  <span class="attr">method</span>: <span class="string">'post'</span>,</div><div class="line">  <span class="attr">headers</span>: &#123;</div><div class="line">        <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</div><div class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(&#123;data&#125;)</div><div class="line">&#125;)</div><div class="line">.then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</div><div class="line">.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">  <span class="comment">// do something</span></div><div class="line">&#125;)</div><div class="line">.then(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;&#125;);</div></pre></td></tr></table></figure>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="external">Promise</a></h3><ul>
<li>作用</li>
</ul>
<p>在 <code>Promise</code> 对象内部编写异步操作，并通过其自带的 <code>resolve</code> 和 <code>reject</code> 进行异步结果返回的处理。之后在使用这个 <code>Promise</code> 的时候，便可以通过 <code>.then((result) =&gt; {}).then((result) =&gt; {})...</code> 进行链式调用。 <code>.then()</code> 函数中的 <code>result</code> 参数即异步操作的结果</p>
<ul>
<li>status</li>
</ul>
<p>Promise 对象所拥有的几种状态:</p>
<pre><code>- pending 初始化状态
- fulfilled 成功的状态
- rejected 失败的状态
</code></pre><ul>
<li>example</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">example</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(data)</div><div class="line">	<span class="comment">// resolve 和 reject 分别表示异步操作执行成功或失败后的回调函数</span></div><div class="line">	<span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">		$.ajax(&#123;</div><div class="line">			<span class="attr">url</span>: www.example.com?page=<span class="number">1</span>&amp;num=<span class="number">1</span>,</div><div class="line">			<span class="attr">methon</span>: get,</div><div class="line">			<span class="attr">success</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">				resolve(data);</div><div class="line">			&#125;,</div><div class="line">			<span class="attr">error</span>: <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">				reject(error);</div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line">	&#125;);</div><div class="line">	<span class="keyword">return</span> promise;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>usage</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// then方法可以接受两个参数，第一个对应resolve的回调，第二个对应reject的回调</span></div><div class="line"><span class="comment">// 但这种方法无法捕获resolve回调中产生的异常</span></div><div class="line">example().then(</div><div class="line">	<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</div><div class="line">		<span class="comment">// 获取 resolve 传输的参数</span></div><div class="line">	&#125;,</div><div class="line">	(error) =&gt; &#123;</div><div class="line">		<span class="comment">// 获取 reject 传输的参数</span></div><div class="line">	&#125;</div><div class="line">);</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">* 或者使用 catch 写法，在 catch 中指定 reject 时的回调</div><div class="line">* 当 reject 或者 resolve 失败的时候，会调用 catch</div><div class="line">* catch()方法是then(undefined, onRejected)的一个别名</div><div class="line">**/</div><div class="line">example().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</div><div class="line">	<span class="comment">// do something..</span></div><div class="line">&#125;).catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">	<span class="comment">// when fail..</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><code>Promise.then()</code>和<code>Promise.catch()</code>都返回 Promise 对象，因此可以链式调用<br>如果只想对异常进行处理，可以采用<code>promise.then(undefined, callback);</code>方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">* Promise 的链式操作</div><div class="line">* 可以保证按照顺序依次执行异步操作，并能利用上一步异步操作的结果</div><div class="line">**/</div><div class="line">example().then(<span class="function">(<span class="params">data1</span>) =&gt;</span> &#123;</div><div class="line">	<span class="comment">// 获取 resolve 传输的参数</span></div><div class="line">	example(data1)</div><div class="line">&#125;).then(<span class="function">(<span class="params">data2</span>) =&gt;</span> &#123;</div><div class="line">	example(data2);</div><div class="line">&#125;).then(<span class="function">(<span class="params">data3</span>) =&gt;</span> &#123;</div><div class="line">	<span class="built_in">console</span>.log(data3);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 输出 data1 data2 data3</span></div></pre></td></tr></table></figure>
<ul>
<li>final</li>
</ul>
<p>Promise中没有<code>.final()</code>API，但是我们可以手动造一个：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">promise(XXX).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</div><div class="line">  <span class="comment">// resolve时</span></div><div class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</div><div class="line">  <span class="comment">// reject时</span></div><div class="line">&#125;).then(</div><div class="line">  <span class="comment">/*</span></div><div class="line">  * 全部处理完以后</div><div class="line">  * do something..</div><div class="line">  * 注：如果发生错误则不会catch</div><div class="line">  */</div><div class="line">)</div></pre></td></tr></table></figure></p>
<h4 id="APIS"><a href="#APIS" class="headerlink" title="APIS"></a>APIS</h4><ul>
<li><code>Promise.all()</code></li>
</ul>
<p>接收一个数组作为参数，数组内是多个 Promise 对象。 <code>.then()</code>会在<strong>全部 Promise 执行完毕</strong>之后返回一个包含所有异步操作结果的 list<br>传递给 Promise.all 的promise并不是一个个的顺序执行的，而是同时开始、并行执行的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Promise</span>.all([example(<span class="number">1</span>), example(<span class="number">2</span>), example(<span class="number">3</span>)])</div><div class="line">	.then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</div><div class="line">		<span class="built_in">console</span>.log(result);</div><div class="line">		<span class="comment">// [data1, data2, data3]</span></div><div class="line">	&#125;);</div></pre></td></tr></table></figure>
<p><code>Promise.all()</code>所耗费的时间为最慢的异步操作的时间</p>
<p>如果传入的数组中某项不是一个 promise ，该项会被用<code>Promise.resolve</code>转换为一个promise</p>
<p><em>如果传出的参数list中有任意 Promise 失败返回 reject, 那么 <code>.all()</code> 将带着该 Promise 的 reject参数进入 reject 状态，不再理会其他 Promise 的返回结果</em></p>
<ul>
<li><code>Promise.race()</code></li>
</ul>
<p>接收一个数组作为参数，数组内是多个 Promise 对象。 <code>.then()</code>会在<strong>执行最快的 Promise 执行完毕</strong>之后返回一个包含异步操作结果的 result</p>
<p>在最快的 Promise 执行完毕之后，数组参数中的其他 Promise 会正常继续执行，并通过 <code>.then()</code>返回结果</p>
<p>如果最快的 Promise 返回 reject，那么<code>.race()</code>将会返回 reject，不再理会之后的 Promise 操作结果</p>
<h3 id="ES7的异步async-await"><a href="#ES7的异步async-await" class="headerlink" title="ES7的异步async/await"></a>ES7的异步<code>async/await</code></h3><p><strong>用同步的方法写异步</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> setTimeoutToLog = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'test async'</span>);</div><div class="line">  &#125;, <span class="number">1000</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> showConsole = <span class="keyword">async</span> () =&gt; &#123;</div><div class="line">  <span class="keyword">await</span> setTimeoutToLog();</div><div class="line">&#125;</div><div class="line"></div><div class="line">showConsole();</div></pre></td></tr></table></figure>
<p><code>await</code>会阻塞后面代码的执行，直到异步函数执行完成</p>
]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://ecmadao.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript结构与代码优化</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript%E7%BB%93%E6%9E%84%E4%B8%8E%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript结构与代码优化/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E4%BC%98%E5%8C%96">文件结构优化</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96">代码优化</a></li>
<li><a href="#%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83">编码规范</a></li>
<li><a href="#webpack%E9%85%8D%E7%BD%AE">webpack配置</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<hr>
<p>title: JavaScript结构与代码优化<br>date: 2016-03-05 09:25:28</p>
<h2 id="tags-JavaScript"><a href="#tags-JavaScript" class="headerlink" title="tags: JavaScript"></a>tags: JavaScript</h2><blockquote>
<p>程序是给人读的，只是偶尔让计算机执行一下</p>
</blockquote>
<p>在网站构建过程中，随着其功能的逐步增加，代码量和复杂深度也成倍增加。随之而来的是维护难度和开发成本。修改麻烦不说，更有可能会误伤友军。因此首先探讨一下js的优化方案。</p>
<h2 id="文件结构优化"><a href="#文件结构优化" class="headerlink" title="文件结构优化"></a>文件结构优化</h2><ul>
<li>相关的文件按照功能/web-page分类</li>
<li>一个文件只包含一个对象</li>
</ul>
<h2 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a>代码优化</h2><ul>
<li>编写通用类函数<ul>
<li>抽离类似UI层，作为模板</li>
<li>抽离工具类函数</li>
<li>通用函数内use let instead of var，避免全局变量污染</li>
<li>高内聚，仅暴露接口</li>
</ul>
</li>
<li>配置数据分离<ul>
<li>静态常量增加统一入口，export出去</li>
</ul>
</li>
<li>隔离应用逻辑<ul>
<li>函数拆分，各个函数独立负责自己本身的职能</li>
<li>应用逻辑是和应用功能相关的功能性代码，而不是和用户行为相关的</li>
<li>交互-&gt;分发交互函数-&gt;触发应用逻辑函数</li>
</ul>
</li>
</ul>
<h2 id="编码规范"><a href="#编码规范" class="headerlink" title="编码规范"></a>编码规范</h2><ul>
<li>命名规范<ul>
<li>小驼峰式命名法（首字母小写）命名函数/变量</li>
<li>大驼峰式命名法（全大写）命名文件</li>
<li>全大写+单词之间下划线连接（MAX_COUNT）命名常量</li>
</ul>
</li>
<li>注释文档<ul>
<li>中大型函数前使用注释说明参数</li>
</ul>
</li>
</ul>
<h2 id="webpack配置"><a href="#webpack配置" class="headerlink" title="webpack配置"></a>webpack配置</h2><hr>
<p>to be continue…</p>
]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://ecmadao.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript编码规范</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript编码规范/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#javascript%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83">JavaScript编码规范</a><ul>
<li><a href="#%E4%BD%BF%E7%94%A8es6%E4%B8%AD%E7%9A%84%E8%A7%84%E8%8C%83">使用ES6中的规范</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E4%B8%8E%E7%BC%96%E7%A0%81">文件与编码</a></li>
<li><a href="#%E8%A7%A3%E6%9E%84">解构</a></li>
<li><a href="#%E5%87%BD%E6%95%B0">函数</a></li>
<li><a href="#%E5%B1%9E%E6%80%A7%E4%B8%8E%E5%8F%98%E9%87%8F">属性与变量</a></li>
<li><a href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6">比较运算符</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E7%BE%8E%E8%A7%82">代码美观</a></li>
<li><a href="#null-&amp;-undefined">null &amp; undefined</a></li>
<li><a href="#%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99">命名规则</a></li>
<li><a href="#jquery%E7%9B%B8%E5%85%B3">jQuery相关</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="JavaScript编码规范"><a href="#JavaScript编码规范" class="headerlink" title="JavaScript编码规范"></a>JavaScript编码规范</h2><h3 id="使用ES6中的规范"><a href="#使用ES6中的规范" class="headerlink" title="使用ES6中的规范"></a>使用ES6中的规范</h3><ul>
<li>使用对象方法的简写</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">const</span> atom = &#123;</div><div class="line">  <span class="attr">value</span>: <span class="number">1</span>,</div><div class="line"></div><div class="line">  <span class="attr">addValue</span>: <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> atom.value + value;</div><div class="line">  &#125;,</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="keyword">const</span> atom = &#123;</div><div class="line">  <span class="attr">value</span>: <span class="number">1</span>,</div><div class="line"></div><div class="line">  addValue(value) &#123;</div><div class="line">    <span class="keyword">return</span> atom.value + value;</div><div class="line">  &#125;,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ul>
<li>使用对象属性的简写</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> lukeSkywalker = <span class="string">'Luke Skywalker'</span>;</div><div class="line"></div><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">const</span> obj = &#123;</div><div class="line">	<span class="attr">lukeSkywalker</span>: lukeSkywalker,</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="keyword">const</span> obj = &#123;</div><div class="line">	lukeSkywalker,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ul>
<li>在对象属性声明前把简写的属性分组</li>
</ul>
<blockquote>
<p>因为这样能清楚地看出哪些属性使用了简写</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> example = <span class="string">'example'</span>;</div><div class="line"><span class="keyword">const</span> count = <span class="number">100</span>;</div><div class="line"></div><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">const</span> obj = &#123;</div><div class="line">	<span class="attr">number</span>: <span class="number">1</span>,</div><div class="line">	<span class="attr">id</span>: <span class="number">2</span>,</div><div class="line">	count,</div><div class="line">	<span class="attr">three</span>: <span class="number">3</span>,</div><div class="line">	example</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="keyword">const</span> obj = &#123;</div><div class="line">	example,</div><div class="line">	count,</div><div class="line">	<span class="attr">number</span>: <span class="number">1</span>,</div><div class="line">	<span class="attr">id</span>: <span class="number">2</span>,</div><div class="line">	<span class="attr">three</span>: <span class="number">3</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ul>
<li>使用拓展运算符 <code>...</code> 复制数组</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">const</span> len = items.length;</div><div class="line"><span class="keyword">const</span> itemsCopy = [];</div><div class="line"><span class="keyword">let</span> i;</div><div class="line"></div><div class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) &#123;</div><div class="line">  itemsCopy[i] = items[i];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="keyword">const</span> itemsCopy = [...items];</div></pre></td></tr></table></figure>
<h3 id="文件与编码"><a href="#文件与编码" class="headerlink" title="文件与编码"></a>文件与编码</h3><ul>
<li>静态常量分离，命名使用 “大写”+”_”</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// create a file named ConstValue.js</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">var</span> CONST_VALUE = <span class="string">'constValue'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">var</span> AMOUNT = <span class="number">10</span>;</div><div class="line"></div><div class="line"><span class="comment">// use const value...</span></div><div class="line"><span class="comment">// in index.js</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">	CONST_VALUE,</div><div class="line">	AMOUNT</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'./ConstValue.js'</span>;</div></pre></td></tr></table></figure>
<ul>
<li>字符串使用单引号 <code>&#39;&#39;</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">const</span> name = <span class="string">"Capt. Janeway"</span>;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="keyword">const</span> name = <span class="string">'Capt. Janeway'</span>;</div></pre></td></tr></table></figure>
<h3 id="解构"><a href="#解构" class="headerlink" title="解构"></a>解构</h3><ul>
<li><strong>使用解构存取和使用多属性对象</strong></li>
</ul>
<blockquote>
<p>解构能减少临时引用属性</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getFullName</span>(<span class="params">user</span>) </span>&#123;</div><div class="line">    <span class="keyword">const</span> firstName = user.firstName;</div><div class="line">    <span class="keyword">const</span> lastName = user.lastName;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span>`</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// good</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getFullName</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">const</span> &#123; firstName, lastName &#125; = obj;</div><div class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span>`</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// best</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getFullName</span>(<span class="params">&#123; firstName, lastName &#125;</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span>`</span>;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<ul>
<li>对数组使用解构赋值</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</div><div class="line"></div><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">const</span> first = arr[<span class="number">0</span>];</div><div class="line"><span class="keyword">const</span> second = arr[<span class="number">1</span>];</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="keyword">const</span> [first, second] = arr;</div></pre></td></tr></table></figure>
<ul>
<li>需要回传多个值时，使用对象解构，而不是数组解构</li>
</ul>
<blockquote>
<p>增加属性或者改变排序不会改变调用时的位置</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">processInput</span>(<span class="params">input</span>) </span>&#123;</div><div class="line">   <span class="comment">// then a miracle occurs</span></div><div class="line">   <span class="keyword">return</span> [left, right, top, bottom];</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">// 调用时需要考虑回调数据的顺序。</span></div><div class="line"> <span class="keyword">const</span> [left, __, top] = processInput(input);</div><div class="line"></div><div class="line"> <span class="comment">// good</span></div><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">processInput</span>(<span class="params">input</span>) </span>&#123;</div><div class="line">   <span class="comment">// then a miracle occurs</span></div><div class="line">   <span class="keyword">return</span> &#123; left, right, top, bottom &#125;;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">// 调用时只选择需要的数据</span></div><div class="line"> <span class="keyword">const</span> &#123; left, right &#125; = processInput(input);</div></pre></td></tr></table></figure>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul>
<li>使用函数声明代替函数表达式</li>
</ul>
<blockquote>
<p>因为函数声明是可命名的，所以他们在调用栈中更容易被识别</p>
<p>此外，函数声明会把整个函数提升（hoisted），而函数表达式只会把函数的引用变量名提升</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">const</span> foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 函数声明的名称和函数体都会被提升</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">example</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  getName(); <span class="comment">// ecmadao</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'ecmadao'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>直接给函数的参数指定默认值，不要使用一个变化的函数参数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleThings</span>(<span class="params">opts</span>) </span>&#123;</div><div class="line">  <span class="comment">// 不应该改变函数参数。</span></div><div class="line">  opts = opts || &#123;&#125;;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleThings</span>(<span class="params">opts</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (opts === <span class="keyword">void</span> <span class="number">0</span>) &#123;</div><div class="line">    opts = &#123;&#125;;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleThings</span>(<span class="params">opts = &#123;&#125;</span>) </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>当需要传递一个匿名函数，或使用函数表达式时，使用箭头函数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].map(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> x * x;</div><div class="line">&#125;);</div><div class="line">	</div><div class="line"><span class="comment">// good</span></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].map(<span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</div><div class="line">	<span class="keyword">return</span> x * x;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="属性与变量"><a href="#属性与变量" class="headerlink" title="属性与变量"></a>属性与变量</h3><ul>
<li>使用 <code>.</code> 来访问对象的属性</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> person = &#123;</div><div class="line">  <span class="attr">name</span>: ecmadao,</div><div class="line">  <span class="attr">age</span>: <span class="number">24</span>,</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">const</span> myName = person[<span class="string">'name'</span>];</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="keyword">const</span> myName = person.name;</div></pre></td></tr></table></figure>
<ul>
<li>一直使用 <code>const</code> 来声明变量</li>
</ul>
<blockquote>
<p>避免全局命名空间的污染</p>
</blockquote>
<ul>
<li>对于不确定值的变量。可以初始化赋值<code>null</code>，通过 <code>value !== null</code> 判断</li>
</ul>
<h3 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h3><ul>
<li><p>use <code>!==</code> &amp; <code>===</code> instead of <code>!=</code> &amp; <code>==</code></p>
</li>
<li><p>使用简写</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> name = <span class="string">''</span>;</div><div class="line"><span class="keyword">if</span>(!name) &#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'don\'t have name yet'</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span>(list.length) &#123;</div><div class="line">	<span class="comment">// do something...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="代码美观"><a href="#代码美观" class="headerlink" title="代码美观"></a>代码美观</h3><ul>
<li>使用 // 作为单行注释。在评论对象上面另起一行使用单行注释。在注释前插入空行</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">example</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">const</span> name = <span class="string">'ecmadao'</span>;</div><div class="line">	</div><div class="line">	<span class="comment">// this is an example</span></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">sayName</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(name);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>注释前缀</li>
</ul>
<blockquote>
<p>对于需要简短说明的注释，在注释前使用前缀快速标注</p>
<p><code>FIXME</code> 代表需要 review 的代码段/标注问题</p>
<p><code>TODO</code> 则标注问题的可能解决方案</p>
</blockquote>
<ul>
<li>在花括号前放一个空格</li>
<li>在控制语句（if、while 等）的小括号前放一个空格</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">example</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span>(<span class="literal">true</span>) &#123;&#125;</div></pre></td></tr></table></figure>
<ul>
<li>在使用长方法链时进行缩进。使用前面的点 <code>.</code> 强调这是方法调用而不是新语句</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line">$(<span class="string">'#items'</span>).find(<span class="string">'.selected'</span>).highlight().end().find(<span class="string">'.open'</span>).updateCount();</div><div class="line"></div><div class="line"><span class="comment">// bad</span></div><div class="line">$(<span class="string">'#items'</span>).</div><div class="line">  find(<span class="string">'.selected'</span>).</div><div class="line">    highlight().</div><div class="line">    end().</div><div class="line">  find(<span class="string">'.open'</span>).</div><div class="line">    updateCount();</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line">$(<span class="string">'#items'</span>)</div><div class="line">  .find(<span class="string">'.selected'</span>)</div><div class="line">    .highlight()</div><div class="line">    .end()</div><div class="line">  .find(<span class="string">'.open'</span>)</div><div class="line">    .updateCount();</div><div class="line"></div><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">const</span> leds = stage.selectAll(<span class="string">'.led'</span>).data(data).enter().append(<span class="string">'svg:svg'</span>).class(<span class="string">'led'</span>, <span class="literal">true</span>)</div><div class="line">    .attr(<span class="string">'width'</span>, (radius + margin) * <span class="number">2</span>).append(<span class="string">'svg:g'</span>)</div><div class="line">    .attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + (radius + margin) + <span class="string">','</span> + (radius + margin) + <span class="string">')'</span>)</div><div class="line">    .call(tron.led);</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="keyword">const</span> leds = stage.selectAll(<span class="string">'.led'</span>)</div><div class="line">    .data(data)</div><div class="line">  .enter().append(<span class="string">'svg:svg'</span>)</div><div class="line">    .classed(<span class="string">'led'</span>, <span class="literal">true</span>)</div><div class="line">    .attr(<span class="string">'width'</span>, (radius + margin) * <span class="number">2</span>)</div><div class="line">  .append(<span class="string">'svg:g'</span>)</div><div class="line">    .attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + (radius + margin) + <span class="string">','</span> + (radius + margin) + <span class="string">')'</span>)</div><div class="line">    .call(tron.led);</div></pre></td></tr></table></figure>
<h3 id="null-amp-undefined"><a href="#null-amp-undefined" class="headerlink" title="null &amp; undefined"></a>null &amp; undefined</h3><ul>
<li>不要用null来检测是否传入了某个参数</li>
<li>不要用null来检测一个未初始化的变量</li>
<li>把null当做占位符，初始化变量的时候赋值</li>
<li>如果所期望的值真的会是null，则可以直接和null比较</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> person = <span class="literal">null</span>;</div><div class="line"><span class="built_in">console</span>.log(person === <span class="literal">null</span>); <span class="comment">// true</span></div><div class="line"><span class="built_in">console</span>.log(person === <span class="literal">undefined</span>); <span class="comment">// false</span></div><div class="line"></div><div class="line"><span class="keyword">typeof</span> <span class="literal">null</span>; <span class="comment">// object</span></div><div class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span>; <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<ul>
<li>检测 函数/原始值 使用 <code>typeof</code></li>
<li>检测 引用值/自定义类型 用 <code>instanceof</code></li>
</ul>
<h3 id="命名规则"><a href="#命名规则" class="headerlink" title="命名规则"></a>命名规则</h3><ul>
<li>使用小驼峰式命名对象、函数和实例</li>
<li>使用大驼峰式命名构造函数或类</li>
<li>使用下划线 <code>_</code> 开头命名私有属性</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> exampleThree = <span class="number">3</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">exampleController</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="keyword">this</span>._name = <span class="string">'ecmadao'</span>;</div></pre></td></tr></table></figure>
<ul>
<li>别保存 <code>this</code> 的引用。使用箭头函数</li>
<li>如果你的文件只输出一个类，那你的文件名必须和类名完全保持一致</li>
</ul>
<h3 id="jQuery相关"><a href="#jQuery相关" class="headerlink" title="jQuery相关"></a>jQuery相关</h3><ul>
<li>使用 $ 作为存储 jQuery 对象的变量名前缀</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">const</span> sidebar = $(<span class="string">'.sidebar'</span>);</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line"><span class="keyword">const</span> $sidebar = $(<span class="string">'.sidebar'</span>);</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://ecmadao.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript设计模式</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/JavaScript/JavaScript设计模式/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#javascript-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">Javascript 设计模式</a><ul>
<li><a href="#%E7%94%A8%E5%AF%B9%E8%B1%A1%E6%94%B6%E7%BC%96%E5%8F%98%E9%87%8F">用对象收编变量</a></li>
<li><a href="#%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF">类的继承</a></li>
<li><a href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">单例模式</a></li>
<li><a href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F">模板方法模式</a></li>
<li><a href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F">观察者模式</a></li>
<li><a href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F">状态模式</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="Javascript-设计模式"><a href="#Javascript-设计模式" class="headerlink" title="Javascript 设计模式"></a>Javascript 设计模式</h2><h3 id="用对象收编变量"><a href="#用对象收编变量" class="headerlink" title="用对象收编变量"></a>用对象收编变量</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> funObject = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"><span class="comment">// 为原型对象属性赋值</span></div><div class="line">funObject.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">funObject.prototype.getAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"><span class="comment">// 或 将一个对象赋值给类的原型对象</span></div><div class="line">funObject.prototype = &#123;</div><div class="line">  <span class="attr">getName</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="comment">// do something..</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">getAge</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="comment">// do something..</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 两种方法不能混用否则会覆盖</span></div></pre></td></tr></table></figure>
<p>当将函数变量赋值到对象原型链的时候，调用时，要通过<code>let funObj = new funObject()</code>获取对象实例，才能使用原型链上的方法。<br>同一个对象不同实例，在调用原型链方法时取得的都是同一个</p>
<p>原型链方法里，通过最终的<code>return this;</code>使方法可以链式调用</p>
<p><strong>不使用<code>this.getName = () =&gt; {}</code>的原因</strong><br>通过 this 定义的属性和方法添加在当前对象上。当通过<code>new</code>新建一个实例的时候，它的 this 属性和方法就会再次重复创建</p>
<h3 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h3><ul>
<li>关于<code>apply()</code>,<code>call()</code>,<code>bind()</code></li>
</ul>
<p><code>apply()</code>和<code>call()</code>被用于立即修改函数的作用域（常见于继承时调用），而<code>bind()</code>则用于在函数调用的时候改变其作用域</p>
<p><code>apply()</code>和<code>call()</code>非常类似，不同之处在于提供参数的方法。<code>apply()</code>可以使用数组字面量，如<code>fun.apply(this, [&#39;eat&#39;, &#39;drink&#39;])</code>，或使用数组对象作为参数，如<code>fun.apply(this, new Array(&#39;eat&#39;, &#39;drink&#39;))</code></p>
<p><strong>推荐好文</strong> </p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain" target="_blank" rel="external">继承与原型链</a></p>
<p><a href="http://stackoverflow.com/questions/15455009/javascript-call-apply-vs-bind" target="_blank" rel="external">Javascript call() &amp; apply() vs bind()?</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply" target="_blank" rel="external">Function.prototype.apply()</a></p>
<ul>
<li>通过原型链赋值父类实例实现继承</li>
</ul>
<p>将父类的实例，赋值给子类的原型链，那么子类的原型就能够访问父类的属性和方法，即继承<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Father = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">this</span>.fatherName = <span class="string">'ecmadao'</span>;</div><div class="line">&#125;</div><div class="line">Father.prototype.getFatherName = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.fatherName);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> Child = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">this</span>.childName = <span class="string">'cavalier'</span>;</div><div class="line">&#125;</div><div class="line">Child.prototype = <span class="keyword">new</span> father();</div><div class="line">Child.prototype.getChildName = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.childName);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> child = <span class="keyword">new</span> Child();</div><div class="line">child.getChildName(); <span class="comment">// cavalier</span></div><div class="line">child.getFatherName(); <span class="comment">// ecmadao</span></div></pre></td></tr></table></figure></p>
<ul>
<li><code>instanceof</code></li>
</ul>
<p>判断前面的对象是否是后面类的实例，并不代表两者的继承<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> child = <span class="keyword">new</span> Child();</div><div class="line">child <span class="keyword">instanceof</span> Child <span class="comment">// true</span></div><div class="line">child <span class="keyword">instanceof</span> Father <span class="comment">// true</span></div><div class="line">Child <span class="keyword">instanceof</span> Father <span class="comment">// false</span></div><div class="line">Child.prototype <span class="keyword">instanceof</span> Father <span class="comment">// true</span></div><div class="line">child <span class="keyword">instanceof</span> <span class="built_in">Object</span> <span class="comment">// true</span></div></pre></td></tr></table></figure></p>
<p><strong>通过<code>prototype</code>继承的坑</strong><br>当有多个子类实例，其中的某个子类修改了从父类继承来的属性/方法时，全部的子类都会被修改。因为它们只是通过原型链链接到了父类实例上</p>
<ul>
<li><code>Object.create(proto[, propertiesObject])</code><ul>
<li><code>proto</code> 一个对象，作为新创建对象的原型。如果不是null或对象，则抛出TypeError异常</li>
<li><code>propertiesObject</code>包含若干个属性描述符的对象</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// father</span></div><div class="line"><span class="keyword">const</span> Father = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">this</span>.x = <span class="number">0</span>;</div><div class="line">  <span class="keyword">this</span>.y = <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line">Father.prototype.move = <span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">this</span>.x += x;</div><div class="line">  <span class="keyword">this</span>.y += y;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'moved'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// child</span></div><div class="line">Child = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  Father.call(<span class="keyword">this</span>); <span class="comment">// 调用基类的构造函数</span></div><div class="line">&#125;</div><div class="line">Child.prototype = <span class="built_in">Object</span>.create(Father.prototype);</div><div class="line"></div><div class="line"><span class="keyword">var</span> child = <span class="keyword">new</span> Child();</div><div class="line">child <span class="keyword">instanceof</span> Child <span class="comment">//true</span></div><div class="line">child <span class="keyword">instanceof</span> Father <span class="comment">// true</span></div><div class="line">child.move(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// moved</span></div></pre></td></tr></table></figure>
<p>传入<code>null</code>作为参数的时候，则会创建一个没有原型链的全新对象<br><code>Object.create(null);</code></p>
<h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><p>避免命名冲突，便于函数管理<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Example = &#123;</div><div class="line">  <span class="attr">Util</span>: &#123;</div><div class="line">    <span class="attr">method1</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      </div><div class="line">    &#125;,</div><div class="line">    <span class="attr">method2</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      </div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">Tools</span>: &#123;</div><div class="line">    <span class="attr">fun1</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      </div><div class="line">    &#125;,</div><div class="line">    <span class="attr">fun2</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      </div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Example.Tools.fun1();</div></pre></td></tr></table></figure></p>
<p>创建静态变量:</p>
<ul>
<li>立即调用创建单利对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Config = <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> config = &#123;</div><div class="line">    MAX_NUMBER = <span class="number">10</span>,</div><div class="line">    MIN_NUMBER = <span class="number">1</span></div><div class="line">  &#125;;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">get</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">return</span> config[<span class="string">'MAX_NUMBER'</span>];</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)();</div><div class="line"><span class="comment">// 上例单例通过自调用()自动创建一次，并赋值给Config，Config作为一个单例放在全局空间里作为静态变量单例对象被使用</span></div></pre></td></tr></table></figure>
<ul>
<li>延迟调用创建单利对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> LazyConfig = <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">let</span> _instance = <span class="literal">null</span>;</div><div class="line">  <span class="keyword">const</span> Config = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> config = &#123;</div><div class="line">      MAX_NUMBER = <span class="number">10</span>,</div><div class="line">      MIN_NUMBER = <span class="number">1</span></div><div class="line">    &#125;; </div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">get</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        <span class="keyword">return</span> config[<span class="string">'MAX_NUMBER'</span>];</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">   </div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">if</span>(!_instance) &#123;</div><div class="line">      _instance = Config();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> _instance;</div><div class="line">  &#125;</div><div class="line">&#125;)();</div><div class="line"> </div><div class="line"><span class="built_in">console</span>.log(LazyConfig().get()); <span class="comment">// 10</span></div></pre></td></tr></table></figure>
<h3 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h3><p>创建一个通用类模板，子类继承模板，按需在原型链上添加自己的方法，实例化后即可使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 模板</span></div><div class="line"><span class="keyword">const</span> Message = <span class="function">(<span class="params">content, time = <span class="number">1000</span></span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">this</span>.content = content;</div><div class="line">  <span class="keyword">this</span>.time = time;</div><div class="line">  <span class="keyword">this</span>.panel = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">  <span class="keyword">this</span>.contentNode = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>);</div><div class="line">&#125;</div><div class="line">Message.prototype = &#123;</div><div class="line">  <span class="attr">init</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.contentNode.innerHTML = <span class="keyword">this</span>.content;</div><div class="line">    <span class="keyword">this</span>.panel.appendChild(<span class="keyword">this</span>.contentNode);</div><div class="line">    body.append(<span class="keyword">this</span>.panel);</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">showAlert</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.panel.addClass(<span class="string">'negative'</span>);</div><div class="line">    <span class="keyword">this</span>.panel.addClass(<span class="string">'active'</span>);</div><div class="line">    <span class="keyword">this</span>.hideMessage();</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">showMessage</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.panel.addClass(<span class="string">'positive'</span>);</div><div class="line">    <span class="keyword">this</span>.panel.addClass(<span class="string">'active'</span>);</div><div class="line">    <span class="keyword">this</span>.hideMessage();</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">hideMessage</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    setTimeout(<span class="keyword">this</span>.callback, <span class="keyword">this</span>.time);</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">callback</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.panel.removeClass(<span class="string">'active'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 子类</span></div><div class="line"><span class="keyword">const</span> MessageWithImage = <span class="function">(<span class="params">data, time = <span class="number">1000</span></span>) =&gt;</span> &#123;</div><div class="line">  Message.call(<span class="keyword">this</span>, data.content, time);</div><div class="line">  <span class="keyword">this</span>.image = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</div><div class="line">  <span class="keyword">this</span>.image.src = data.url;</div><div class="line">&#125;</div><div class="line">MessageWithImage.prototype = <span class="keyword">new</span> Message();</div><div class="line">MessageWithImage.prototype.init = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  Message.prototype.init.call(<span class="keyword">this</span>);</div><div class="line">  <span class="keyword">this</span>.panel.appendChild(<span class="keyword">this</span>.image);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 实例化</span></div><div class="line"><span class="keyword">let</span> Message = <span class="keyword">new</span> Message(<span class="string">'test'</span>).init();</div><div class="line">Message.showAlert();</div><div class="line"></div><div class="line"><span class="keyword">let</span> MessageWithImage = <span class="keyword">new</span> MessageWithImage(&#123;</div><div class="line">  <span class="attr">content</span>: <span class="string">'Message with image'</span>,</div><div class="line">  <span class="attr">url</span>: <span class="string">'/src/image/test.png'</span></div><div class="line">&#125;, <span class="number">2000</span>).init();</div><div class="line">MessageWithImage.showMessage();</div></pre></td></tr></table></figure>
<h3 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h3><p>观察者模式的核心是观察者，它与被观察者和消息接受者应该是一对多的关系，内部包含注册、取消注册、事件监听和消息发送的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 建立观察者</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>() &#123;</div><div class="line">    <span class="keyword">this</span>.message = &#123;&#125;;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 事件接收者注册</span></div><div class="line">  regist(type, callback) &#123;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="keyword">this</span>.message[type] === <span class="string">'undefined'</span>) &#123;</div><div class="line">      <span class="keyword">this</span>.message[type] = [callback]</div><div class="line">    &#125;<span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">this</span>.message[type].push(callback);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.message[type].length - <span class="number">1</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 给事件接收者发送消息</span></div><div class="line">  fire(type, value) &#123;</div><div class="line">    <span class="keyword">this</span>.message[type].map(<span class="function">(<span class="params">callback, index</span>) =&gt;</span> &#123;</div><div class="line">      callback.call(<span class="keyword">this</span>, value);</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 移除事件接收者</span></div><div class="line">  remove(type, key) &#123;</div><div class="line">    <span class="keyword">let</span> filtered = <span class="keyword">this</span>.message[type].filter(<span class="function">(<span class="params">fn, i</span>) =&gt;</span> i !== key);</div><div class="line">    <span class="keyword">this</span>.message[type] = filtered;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'type length is '</span> + filtered.length);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> observer = <span class="keyword">new</span> Observer();</div><div class="line"></div><div class="line"><span class="comment">// 建立监听者</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(name) &#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">  &#125;</div><div class="line">  weatherForecast(weather) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'weather is :'</span> + weather);</div><div class="line">  &#125;</div><div class="line">  watch(weather) &#123;</div><div class="line">    <span class="keyword">let</span> key = observer.regist(weather, <span class="keyword">this</span>.weatherForecast.bind(<span class="keyword">this</span>));</div><div class="line">    <span class="keyword">this</span>.key = key;</div><div class="line">  &#125;</div><div class="line">  broken(weather) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' is broken..'</span>);</div><div class="line">    observer.remove(weather, <span class="keyword">this</span>.key);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Weather</span> </span>&#123;</div><div class="line">  changeWeather(type, value) &#123;</div><div class="line">    observer.fire(type, value);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> watcher1 = <span class="keyword">new</span> Watcher(<span class="string">'一号预报天气'</span>);</div><div class="line">watcher1.watch(<span class="string">'rainy'</span>);</div><div class="line"><span class="keyword">let</span> watcher2 = <span class="keyword">new</span> Watcher(<span class="string">'二号预报天气'</span>);</div><div class="line">watcher2.watch(<span class="string">'sunny'</span>);</div><div class="line"><span class="keyword">let</span> watcher3 = <span class="keyword">new</span> Watcher(<span class="string">'三号预报天气'</span>);</div><div class="line">watcher3.watch(<span class="string">'rainy'</span>);</div><div class="line">watcher3.broken(<span class="string">'rainy'</span>);</div><div class="line"><span class="comment">// 三号预报天气 is broken..</span></div><div class="line"><span class="keyword">let</span> weather = <span class="keyword">new</span> Weather();</div><div class="line">weather.changeWeather(<span class="string">'rainy'</span>, <span class="string">'heavyRain'</span>);</div><div class="line"><span class="comment">// 一号预报天气</span></div><div class="line"><span class="comment">// weather is :heavyRain</span></div><div class="line">weather.changeWeather(<span class="string">'sunny'</span>, <span class="string">'too hot'</span>);</div><div class="line"><span class="comment">// 二号预报天气</span></div><div class="line"><span class="comment">// weather is :too hot</span></div></pre></td></tr></table></figure>
<h3 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h3><p>创建一个状态对象，内部保存各种状态变量，以及对应的状态应该触发的方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BatMan</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(name) &#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">    <span class="keyword">this</span>.actions = &#123;&#125;;</div><div class="line">    <span class="keyword">this</span>.status = &#123;</div><div class="line">      <span class="attr">beat</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        <span class="keyword">this</span>.beat();</div><div class="line">      &#125;,</div><div class="line">      <span class="attr">run</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        <span class="keyword">this</span>.run();</div><div class="line">      &#125;,</div><div class="line">      <span class="attr">shot</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        <span class="keyword">this</span>.shot();</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  beat(num) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' beat bad guys'</span>);</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  run() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' run very fast'</span>);</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  shot() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'holy shit '</span> + <span class="keyword">this</span>.name + <span class="string">' was forced to use his gun'</span>);</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  changeStatus(actions) &#123;</div><div class="line">    actions.map(<span class="function">(<span class="params">action, index</span>) =&gt;</span>&#123;</div><div class="line">      <span class="keyword">this</span>.status[action]();</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> batMan = <span class="keyword">new</span> BatMan(<span class="string">'bluce'</span>);</div><div class="line">batMan.changeStatus([<span class="string">'run'</span>, <span class="string">'beat'</span>, <span class="string">'shot'</span>]);</div><div class="line"><span class="comment">// bluce run very fast</span></div><div class="line"><span class="comment">// bluce beat undefined bad guys</span></div><div class="line"><span class="comment">// holy shit bluce was forced to use his gun</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://ecmadao.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>《JavaScript语言精粹》笔记</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/JavaScript/%E3%80%8AJavaScript%E8%AF%AD%E8%A8%80%E7%B2%BE%E7%B2%B9%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/JavaScript/《JavaScript语言精粹》笔记/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%AF%B9%E8%B1%A1">第三章-对象</a><ul>
<li><a href="#%E5%8E%9F%E5%9E%8B%EF%BC%9A">原型：</a></li>
<li><a href="#%E5%A7%94%E6%89%98%EF%BC%9A">委托：</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E5%87%BD%E6%95%B0">第四章-函数</a><ul>
<li><a href="#%E6%96%B9%E6%B3%95%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%A8%A1%E5%BC%8F">方法/函数调用模式</a></li>
<li><a href="#%E6%9E%84%E9%80%A0%E5%99%A8%E8%B0%83%E7%94%A8%E6%A8%A1%E5%BC%8F">构造器调用模式</a></li>
<li><a href="#apply%E8%B0%83%E7%94%A8%E6%A8%A1%E5%BC%8F">apply调用模式</a><ul>
<li><a href="#%E9%97%AD%E5%8C%85">闭包</a></li>
<li><a href="#%E6%A8%A1%E5%9D%97">模块</a></li>
<li><a href="#%E7%BA%A7%E8%81%94">级联</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E7%BB%A7%E6%89%BF">第五章-继承</a></li>
<li><a href="#%E6%95%B0%E7%BB%84%E6%96%B9%E6%B3%95">数组方法</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%96%B9%E6%B3%95">字符串方法</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<hr>
<p>title: 《JavaScript语言精粹》笔记<br>date: 2016-03-03 08:38:41</p>
<h2 id="tags-JavaScript"><a href="#tags-JavaScript" class="headerlink" title="tags: JavaScript"></a>tags: JavaScript</h2><h2 id="第三章-对象"><a href="#第三章-对象" class="headerlink" title="第三章-对象"></a>第三章-对象</h2><p>通过对象字面量建立对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">	<span class="attr">name</span>: <span class="string">'ecmadao'</span>,</div><div class="line">	<span class="attr">age</span>: <span class="number">24</span>,</div><div class="line">	<span class="attr">job</span>: <span class="string">'developer'</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<hr>
<p>对象的索引：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj.name; <span class="comment">//等同于</span></div><div class="line">obj[<span class="string">'name'</span>];</div></pre></td></tr></table></figure>
<p>建议以链式方法<code>obj.name</code>来调用，速度更快</p>
<hr>
<p><strong> 对象通过引用来传递。它们不会被复制 </strong></p>
<hr>
<h3 id="原型："><a href="#原型：" class="headerlink" title="原型："></a>原型：</h3><p>每个对象都连接到一个原型对象。所有通过对象字面量创建的对象都连接到 <code>Object.prototype</code></p>
<h3 id="委托："><a href="#委托：" class="headerlink" title="委托："></a>委托：</h3><p>原型连接在更新时是不起作用的。当我们对某个对象做出改变时不会触及该对象的原型链。在索引值时，如果该对象没有索引的属性名，那么JavaScript会试着从原型对象中获取属性值。如果原型中也不存在则返回<code>undefined</code></p>
<p>如果我们添加一个新的属性到原型中，该属性会立即对所有基于该原型创建的对象可见。</p>
<hr>
<p>获取/操作对象中的属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// hasOwnProperty() 不检查原型链，返回true || false</span></div><div class="line">obj.hasOwnProperty(<span class="string">'name'</span>);</div><div class="line"></div><div class="line"><span class="comment">// for in 遍历一个对象中所有的属性名</span></div><div class="line"><span class="keyword">for</span> (name <span class="keyword">in</span> obj)&#123;</div><div class="line">	<span class="comment">// do something here;</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// delete 删除对象的某个属性，不会触及原型链</span></div><div class="line"><span class="keyword">delete</span> obj.name;</div></pre></td></tr></table></figure>
<h2 id="第四章-函数"><a href="#第四章-函数" class="headerlink" title="第四章-函数"></a>第四章-函数</h2><p>函数字面量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span>(<span class="params">a + b</span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> a + b;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>函数的调用：</p>
<ul>
<li>方法调用模式</li>
<li>函数调用模式</li>
<li>构造器调用模式</li>
<li>apply调用模式</li>
</ul>
<h4 id="方法-函数调用模式"><a href="#方法-函数调用模式" class="headerlink" title="方法/函数调用模式"></a>方法/函数调用模式</h4><p>当一个函数被保存为对象的一个属性时，称之为方法。并非是对象的属性时，则是被当做一个函数来调用的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myObj = &#123;</div><div class="line">	<span class="attr">name</span>: <span class="string">'ecmadao'</span>,</div><div class="line">	<span class="attr">sayName</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//方法函数可以使用this访问自身对象（注意this作用域的坑）</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> sayTest = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'test'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//以此模式调用函数的时候绑定的全局对象</span></div></pre></td></tr></table></figure>
<h4 id="构造器调用模式"><a href="#构造器调用模式" class="headerlink" title="构造器调用模式"></a>构造器调用模式</h4><p>在一个函数前带上 new 调用的时候，背地里会创建一个连接到该函数的<code>prototype</code>成员的新对象，同时this会绑定到那个新对象上（函数名以大写作为约定）</p>
<h4 id="apply调用模式"><a href="#apply调用模式" class="headerlink" title="apply调用模式"></a>apply调用模式</h4><p>apply方法让我们构建一个参数数组传递给调用函数。允许选择this的值。</p>
<p>apply方法接受两个参数，第一个是要绑定给this的值，第二个是参数数组。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> anotherObj = &#123;</div><div class="line">	<span class="attr">name</span>: <span class="string">'ws'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> status = myObj.apply(anotherObj);</div><div class="line"></div><div class="line">status.sayName(); <span class="comment">//作用域改变，输出ws</span></div></pre></td></tr></table></figure>
<hr>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>闭包是指有权访问另一个函数作用域中变量的函数。创建闭包的最常见办法是在一个函数内部嵌套创建另外一个函数，并访问函数内部的局部变量</p>
<p>闭包三特性：</p>
<ul>
<li>函数嵌套函数</li>
<li>函数内部可以引用外部的参数和变量</li>
<li>参数和变量不会被垃圾回收机制回收</li>
</ul>
<p>闭包缺点：</p>
<ul>
<li>常驻内存。易内存泄露</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">outFunction</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> x = <span class="number">10</span>;</div><div class="line">	<span class="keyword">var</span> innerFunction()&#123;</div><div class="line">		x ++;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'x = '</span> + x);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> innerFunction;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> test = outFunction(); <span class="comment">// test == innerFunction</span></div><div class="line"></div><div class="line">test() <span class="comment">// x = 11</span></div><div class="line">test() <span class="comment">// x = 12</span></div><div class="line"><span class="comment">// 局部变量会保持引用不会被释放。可以一直访问被创建时所处的上下文环境</span></div></pre></td></tr></table></figure>
<hr>
<h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><p>模块模式利用函数作用域/闭包/函数自调用来创建被绑定对象与私有成员的关联，可以用来生成安全的对象</p>
<p>一般形式：</p>
<ul>
<li>一个定义了私有变量和函数的函数</li>
<li>利用闭包创建可以访问私有变量和函数的特权函数</li>
<li>返回特权函数，或者把它保存到一个可以访问到的地方</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ModuleExample = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> x = <span class="number">1</span>;</div><div class="line">	<span class="keyword">var</span> y = <span class="number">1</span>;</div><div class="line">	add = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(a + b);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	log = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'x = '</span> + x + <span class="string">', y = '</span> + y);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		<span class="attr">add</span>: add</div><div class="line">		log: log</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;)();</div><div class="line"></div><div class="line"><span class="keyword">var</span>  moduleExample = <span class="keyword">new</span> ModuleExample();</div><div class="line"></div><div class="line">moduleExample.log(); <span class="comment">//x = 1, y = 1</span></div><div class="line">moduleExample.add(<span class="number">2</span>, <span class="number">2</span>); <span class="comment">//4</span></div></pre></td></tr></table></figure>
<hr>
<h3 id="级联"><a href="#级联" class="headerlink" title="级联"></a>级联</h3><p>让对象的方法返回<code>this</code>而不是undefined，那样的话就可以通过链式方法不断调用对象的方法</p>
<h2 id="第五章-继承"><a href="#第五章-继承" class="headerlink" title="第五章-继承"></a>第五章-继承</h2><p>当一个函数被创建时，Function构造器产生的函数对象会运行类似如下的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.prototype = &#123; <span class="attr">constructor</span>: <span class="keyword">this</span>; &#125;</div></pre></td></tr></table></figure>
<p>新函数被赋予一个prototype属性，它的值是一个包含constructor属性且属性值为该新函数的对象</p>
<p>prototype对象是存放继承特征的地方</p>
<hr>
<p>通过替换函数对象的prototype为父类的实例，来实现继承：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 基于类的继承</span></div><div class="line"><span class="keyword">var</span> Child = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line"></div><div class="line">Child.prototype = <span class="keyword">new</span> Father();</div><div class="line"></div><div class="line"><span class="comment">// 以上可以扩展为一个新方法：</span></div><div class="line"><span class="built_in">Function</span>.method(<span class="string">'inherits'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">Parent</span>)</span>&#123;</div><div class="line">	<span class="keyword">this</span>.prototype = <span class="keyword">new</span> Parent();</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//基于原型的继承</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> father = &#123;</div><div class="line">	<span class="attr">name</span>: <span class="string">'ecmadao'</span>,</div><div class="line">	<span class="attr">get_name</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>.name); &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> children = <span class="built_in">Object</span>.create(father);</div></pre></td></tr></table></figure>
<h2 id="数组方法"><a href="#数组方法" class="headerlink" title="数组方法"></a>数组方法</h2><p>js允许数组包含任意混合类型的值</p>
<ul>
<li>数组的合并 <code>array.concat(item1, item2,....)</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//返回新数组，不修改原数组</span></div><div class="line">newarray =array1.concat(array2);</div></pre></td></tr></table></figure>
<ul>
<li>数组末尾添加新元素 <code>array.push(item1, item2,...);</code></li>
<li>移除数组末尾的元素 <code>array.pop();</code></li>
<li>数组头部添加新元素 <code>array.unshift();</code></li>
<li>移除数组首位的元素 <code>array.shift()</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//push()方法修改array，返回array的新长度</span></div><div class="line"></div><div class="line"><span class="comment">//pop()/shift()方法都返回被移除的元素。在array为空时，返回undefined</span></div></pre></td></tr></table></figure>
<ul>
<li>删除数组中的元素 <code>delete</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">delete</span> array[<span class="number">1</span>]; <span class="comment">//删除list中的第二位元素</span></div><div class="line"><span class="comment">// 这个方法会在数组中留下一个空洞（排在被删除元素之后的元素保留着它们最初的属性）</span></div></pre></td></tr></table></figure>
<ul>
<li>切除/替换数组中的元素 <code>array.splice(start, num, item...)</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> array = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</div><div class="line"></div><div class="line">array.splice(<span class="number">2</span>, <span class="number">1</span>); <span class="comment">//从第二位list[2]开始切除，切除1个元素</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(array); <span class="comment">//[0, 1, 3, 4]</span></div><div class="line"></div><div class="line"><span class="comment">//第三个及之后的参数存在时，会用新的item替换切除的元素</span></div><div class="line"><span class="comment">// splice方法对于大型数组来说可能效率不高</span></div></pre></td></tr></table></figure>
<ul>
<li>获取数组中的数组段 <code>array.slice(start, end);</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//slice方法对array中的一段做浅复制</span></div><div class="line"><span class="comment">//如果两个参数中的任一个参数为负数，array.length会和它们相加，试图让它们变成正数</span></div></pre></td></tr></table></figure>
<ul>
<li>枚举 <code>for val in array</code>，无法保障属性的顺序</li>
</ul>
<p>Object.create()对于数组而言是没有意义的，因为它产生一个对象而不是数组，没有特殊的length属性</p>
<h2 id="字符串方法"><a href="#字符串方法" class="headerlink" title="字符串方法"></a>字符串方法</h2><ul>
<li><code>string.charAt(pos);</code></li>
<li><code>string.indexOf(searchString, position);</code></li>
<li><code>string.lastIndexOf(searchString, position);</code></li>
<li><code>string.search(regexp);</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// charAt(p) 返回p位置的字符串。p小于0或大于字符串长度时，返回空字符串</span></div><div class="line"><span class="comment">// indexOf(target, p) 从p位置开始查找target字符串，返回第一个匹配字符串的位置。没有找到则返回 -1</span></div><div class="line"><span class="comment">// lastIndexOf(target, p) 从字符串的末尾开始查找</span></div><div class="line"><span class="comment">// search(regexp) 接受一个正则表达式对象作为参数。此方法忽略g标识，没有position参数</span></div></pre></td></tr></table></figure>
<ul>
<li><code>string.replace(searchValue, replaceValue)</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 对字符串进行查找和替换，并返回一个新的字符串</span></div><div class="line"><span class="comment">// 参数searchValue可以是一个字符串或者一个正则表达式</span></div><div class="line"><span class="comment">// searchValue是字符串时，只有第一次匹配的地方会被替换；searchValue是正则表达式且带有g标识时，会替换所有的匹配。没有g标识则只替换第一个匹配</span></div></pre></td></tr></table></figure>
<ul>
<li><code>string.slice(start, end);</code></li>
<li><code>string.substring(start, end);</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// slice()中，若存在负数参数，则会与length值相加转换为正数</span></div><div class="line"><span class="comment">// substring()用法与slice()一样，但不接受负数参数</span></div></pre></td></tr></table></figure>
<ul>
<li><code>string.toLowerCase();</code></li>
<li><code>string.toUpperCase();</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//返回新字符串，string中的所有字母都转换格式</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://ecmadao.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Don-t-Make-Me-Think</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/Projects/Don-t-Make-Me-Think/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/Projects/Don-t-Make-Me-Think/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="external">DocToc</a></em></p>
<ul>
<li><a href="#%E5%88%AB%E8%AE%A9%E6%88%91%E6%80%9D%E8%80%83">别让我思考</a></li>
<li><a href="#%E6%88%91%E4%BB%AC%E5%AE%9E%E9%99%85%E4%B8%8A%E6%98%AF%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8web%E7%9A%84">我们实际上是如何使用web的</a></li>
<li><a href="#%E4%B8%BA%E6%89%AB%E6%8F%8F%E8%AE%BE%E8%AE%A1%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E4%B8%BA%E9%98%85%E8%AF%BB%E8%AE%BE%E8%AE%A1">为扫描设计，而不是为阅读设计</a></li>
<li><a href="#%E5%BB%BA%E7%AB%8B%E6%B8%85%E6%A5%9A%E7%9A%84%E8%A7%86%E8%A7%89%E5%B1%82%E6%AC%A1">建立清楚的视觉层次</a></li>
<li><a href="#%E5%88%A9%E7%94%A8%E4%B9%A0%E6%83%AF%E7%94%A8%E6%B3%95">利用习惯用法</a></li>
<li><a href="#%E7%94%A8%E6%88%B7%E5%96%9C%E6%AC%A2%E6%97%A0%E9%9C%80%E6%80%9D%E8%80%83%E7%9A%84%E9%80%89%E6%8B%A9">用户喜欢无需思考的选择</a></li>
<li><a href="#%E7%9C%81%E7%95%A5%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E6%96%87%E5%AD%97">省略不必要的文字</a></li>
<li><a href="#%E8%AE%BE%E8%AE%A1%E5%AF%BC%E8%88%AA">设计导航</a></li>
<li><a href="#%E8%AE%BE%E8%AE%A1%E4%B8%BB%E9%A1%B5">设计主页</a></li>
<li><a href="#%E5%BC%80%E5%8F%91%E5%9B%A2%E9%98%9F%E5%85%B3%E4%BA%8E%E5%8F%AF%E7%94%A8%E6%80%A7%E7%9A%84%E8%AE%A8%E8%AE%BA">开发团队关于可用性的讨论</a></li>
<li><a href="#%E5%8F%AF%E7%94%A8%E6%80%A7%E6%B5%8B%E8%AF%95">可用性测试</a><ul>
<li><a href="#%E7%84%A6%E7%82%B9%E5%B0%8F%E7%BB%84">焦点小组</a></li>
<li><a href="#%E5%8F%AF%E7%94%A8%E6%80%A7%E6%B5%8B%E8%AF%95-1">可用性测试</a></li>
</ul>
</li>
<li><a href="#%E5%B0%8A%E9%87%8D%E7%94%A8%E6%88%B7%EF%BC%8C%E5%B9%B6%E8%8E%B7%E5%BE%97%E7%94%A8%E6%88%B7%E5%B0%8A%E9%87%8D">尊重用户，并获得用户尊重</a></li>
<li><a href="#%E5%8F%AF%E8%AE%BF%E9%97%AE%E6%80%A7">可访问性</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<hr>
<p>title: “Don’t Make Me Think”<br>date: 2016-03-04 14:15:57</p>
<h2 id="tags-product"><a href="#tags-product" class="headerlink" title="tags: product"></a>tags: product</h2><h3 id="别让我思考"><a href="#别让我思考" class="headerlink" title="别让我思考"></a>别让我思考</h3><ul>
<li>减少可能让用户迷茫的东西，文案的明了性至关重要</li>
<li><strong>必要部位的强识别性</strong></li>
</ul>
<p>页面要做到不言而喻。如果不能，那至少要做到自我解释</p>
<h3 id="我们实际上是如何使用web的"><a href="#我们实际上是如何使用web的" class="headerlink" title="我们实际上是如何使用web的"></a>我们实际上是如何使用web的</h3><p>扫描/满意即可/勉强应付</p>
<ul>
<li>用户不会阅读，而是扫描</li>
<li>用户不会斟酌后仔细选择，猜测与随机占多数</li>
<li>用户很少会按照我们所设计的去使用产品，但依旧能够使用</li>
</ul>
<p><strong>网站可用性测试</strong></p>
<p>帮助用户正确使用网站，引导他成为“专家”，把握全局，那样用户有更多的可能会留在这个网站成为老用户</p>
<h3 id="为扫描设计，而不是为阅读设计"><a href="#为扫描设计，而不是为阅读设计" class="headerlink" title="为扫描设计，而不是为阅读设计"></a>为扫描设计，而不是为阅读设计</h3><ul>
<li>在每个页面上建立清楚的视觉层次</li>
<li>尽量利用习惯用法</li>
<li>把页面划分成明确定义的区域</li>
<li>明显标识可以点击的地方</li>
<li>最大限度降低干扰</li>
</ul>
<h3 id="建立清楚的视觉层次"><a href="#建立清楚的视觉层次" class="headerlink" title="建立清楚的视觉层次"></a>建立清楚的视觉层次</h3><ul>
<li>越重要的部分越突出</li>
<li>逻辑上相关的部分在视觉上也相关</li>
<li>逻辑上包含的部分在视觉上进行嵌套</li>
</ul>
<p>好的视觉层次通过预先处理页面，用一种我们能够理解的方式对页面的内容进行组织并区分优先级</p>
<h3 id="利用习惯用法"><a href="#利用习惯用法" class="headerlink" title="利用习惯用法"></a>利用习惯用法</h3><p>如果要创新，那么：</p>
<ul>
<li>新东西必须和习惯用法一样清楚、一样不言而喻，没有学习曲线</li>
<li>能够给用户带来很大价值，值得他花时间学习</li>
</ul>
<h3 id="用户喜欢无需思考的选择"><a href="#用户喜欢无需思考的选择" class="headerlink" title="用户喜欢无需思考的选择"></a>用户喜欢无需思考的选择</h3><p>“达到任何地方的点击次数”：</p>
<p>真正的问题不是到达目标之前要点击的次数，而是每次点击有多艰难–需要多少思考，还有多大的不确定性来判断自己是否做了正确选择</p>
<h3 id="省略不必要的文字"><a href="#省略不必要的文字" class="headerlink" title="省略不必要的文字"></a>省略不必要的文字</h3><p>对于欢迎文字和说明文字要精炼精炼再精炼</p>
<h3 id="设计导航"><a href="#设计导航" class="headerlink" title="设计导航"></a>设计导航</h3><ul>
<li>网站ID标识（名称/logo）</li>
<li>网站导航</li>
<li>用户可以比较方便的回退到上一步操作</li>
</ul>
<h3 id="设计主页"><a href="#设计主页" class="headerlink" title="设计主页"></a>设计主页</h3><p>最重要信息争取在首屏展现</p>
<p>网站标识</p>
<h3 id="开发团队关于可用性的讨论"><a href="#开发团队关于可用性的讨论" class="headerlink" title="开发团队关于可用性的讨论"></a>开发团队关于可用性的讨论</h3><ul>
<li>我们很可能会将个人喜好带入到产品调研和讨论中，并误认为自己喜好的也是用户所喜欢的</li>
<li>不同职位会带来不同的偏见</li>
<li>所有web用户都是独一无二的，没有什么所谓的普通用户。他们对网页的个人反应和那么多不同的变量有关系<ul>
<li>试图用一些简单的喜好来形容用户既琐碎又没有什么关系</li>
<li>好的设计会把这种复杂性考虑进去</li>
</ul>
</li>
<li>对于大部分web设计而言，没有简单的“正确”答案。良好的、一体化的设计能满足需要，也就是说，经过仔细考虑、实现和测试的设计就是好的</li>
<li>测试。通过测试观测用户的动机、理解和反应的不同</li>
</ul>
<h3 id="可用性测试"><a href="#可用性测试" class="headerlink" title="可用性测试"></a>可用性测试</h3><h4 id="焦点小组"><a href="#焦点小组" class="headerlink" title="焦点小组"></a>焦点小组</h4><p>一小组人（5~8）参加，对展现给他们的想法和设计做出反应。<br>主要价值来自参与人员彼此的反应。可以快速得到用户意见和感觉</p>
<p>可以抽象的获知用户想要什么、需要什么、喜欢什么，测试网站的概念是否有意义，价值主张是否吸引人,但不太适合用来了解网站的运行情况和如何改善网站</p>
<hr>
<h4 id="可用性测试-1"><a href="#可用性测试-1" class="headerlink" title="可用性测试"></a>可用性测试</h4><p>一次一个用户的展示内容，并要求用户：</p>
<ol>
<li>说出这是什么</li>
</ol>
<p>“理解”性测试<br>让测试用户看到产品，看他们是否理解产品，如何理解产品，理解产品的目标、价值主张、组织方式、运行方式</p>
<ol>
<li>试着用它来完成一项典型的任务</li>
</ol>
<p>观察用户是如何完成任务的，过程中会遇到哪些问题</p>
<hr>
<p>测试是一个不断迭代的过程，应该穿插在设计开发之中</p>
<p>在可用性测试结束之后：</p>
<ol>
<li>给问题分类<ul>
<li>用户不清楚概念</li>
<li>用户找不到自己想要的东西</li>
<li>内容太多了</li>
</ul>
</li>
<li>解决问题<ul>
<li>忽略“皮划艇问题”<br>“皮划艇问题”指初次使用产品时因小困惑而产生的错误，这些错误往往会在之后被自主修正，不是什么问题</li>
<li>抵制添加的冲动<br>在测试的时候看见用户没有清楚理解一些功能的作用的时候，大部分人的第一反应是为功能添加说明。而正确的解决方案往往是去除一些让人混淆的内容，而不是额外再加入其他干扰</li>
<li>不要太看重人们对新功能的要求</li>
<li>抓住够得到的果子<ul>
<li>恍然大悟型</li>
<li>便宜型</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="尊重用户，并获得用户尊重"><a href="#尊重用户，并获得用户尊重" class="headerlink" title="尊重用户，并获得用户尊重"></a>尊重用户，并获得用户尊重</h3><ul>
<li>知道人们在你网站上想做些什么，并让它明白简易</li>
<li>告诉用户他想知道的</li>
<li>尽量减少步骤</li>
<li>保证信息准确而有用，并用清楚的方式表达</li>
<li>为用户提供协助</li>
<li>容易从错误中恢复</li>
</ul>
<h3 id="可访问性"><a href="#可访问性" class="headerlink" title="可访问性"></a>可访问性</h3><p>可访问性不仅仅针对正常用户，也是对于残疾用户而言的</p>
]]></content>
    
    <summary type="html">
    
      &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
    
    </summary>
    
    
      <category term="Projects" scheme="http://ecmadao.com/tags/Projects/"/>
    
  </entry>
  
  <entry>
    <title>Project-Coding-Guide</title>
    <link href="http://ecmadao.com/2017/01/13/Notes/Projects/Project-Coding-Guide/"/>
    <id>http://ecmadao.com/2017/01/13/Notes/Projects/Project-Coding-Guide/</id>
    <published>2017-01-13T05:58:37.000Z</published>
    <updated>2017-01-14T12:11:43.000Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>title: ‘Project &amp; Coding Guide’<br>date: 2016-03-03 00:33:51</p>
<h2 id="tags-Coding"><a href="#tags-Coding" class="headerlink" title="tags: Coding"></a>tags: Coding</h2><blockquote>
<p>程序是给人读的，只是偶尔让计算机执行一下</p>
</blockquote>
<ul>
<li>团队统一编程风格<ul>
<li>基本的代码格式化</li>
<li>函数/变量/文件/常量等的命名规范<ul>
<li>小驼峰式命名法（首字母小写）命名函数/变量</li>
<li>大驼峰式命名法（全大写）命名文件</li>
<li>全大写+单词之间下划线连接（MAX_COUNT）命名常量</li>
</ul>
</li>
<li>适时空行/换行</li>
<li>合理使用注释<ul>
<li>如果代码具有一些特殊含义，且无法直接从代码中看出来，此时有必要添加注释</li>
<li>可以在函数前添加注释，对函数参数的作用进行说明</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>代码设计<ul>
<li>不要有超大函数或者超大类<ul>
<li>函数拆分，各个函数独立负责自己本身的职能</li>
<li>考虑重用</li>
</ul>
</li>
<li>避免逻辑重复<ul>
<li>同样的信息应该只在一处出现，不然会给以后的维护带来无穷无尽的烦恼</li>
</ul>
</li>
<li>避免if/else嵌套过深</li>
<li>配置数据分离</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>破窗理论<ul>
<li>破窗：低劣的设计、错误的决策或者糟糕的代码</li>
<li>不要留着“破窗户”不修。发现一个就修一个</li>
<li>如果没有足够的时间进行适当的修理，就先把它保留起来<ul>
<li>可以把出问题的代码放到注释中</li>
<li>显示“未实现”（#TODO）消息</li>
<li>用虚拟数据加以替代</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>沉默即赞同<ul>
<li>review代码，找不足找bug</li>
<li>及时提出意见</li>
<li>无情测试</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>代码编写优化<ul>
<li>松耦合<ul>
<li>抽离类似UI层，作为模板</li>
<li>JavaScript模板引擎，例如handlebars.js</li>
<li>函数职能分离，各自独立，必要时引用</li>
</ul>
</li>
<li>高内聚<ul>
<li>use let instead of var</li>
<li>避免对全局变量的依赖</li>
</ul>
</li>
<li>隔离应用逻辑<ul>
<li>应用逻辑是和应用功能相关的功能性代码，而不是和用户行为相关的</li>
<li>交互-&gt;触发交互函数-&gt;触发应用逻辑函数</li>
</ul>
</li>
<li>不要分发事件对象<ul>
<li>在函数向下传递的过程中，方法调用的接口参数应该逐渐精确化，传入明确要使用的参数，没有多余参数</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;title: ‘Project &amp;amp; Coding Guide’&lt;br&gt;date: 2016-03-03 00:33:51&lt;/p&gt;
&lt;h2 id=&quot;tags-Coding&quot;&gt;&lt;a href=&quot;#tags-Coding&quot; class=&quot;headerlink&quot; 
    
    </summary>
    
    
      <category term="Projects" scheme="http://ecmadao.com/tags/Projects/"/>
    
  </entry>
  
</feed>
